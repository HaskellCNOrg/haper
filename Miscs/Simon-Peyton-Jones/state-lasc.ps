%!PS-Adobe-2.0
%%Creator: dvips 5.54 Copyright 1986, 1994 Radical Eye Software
%%Title: state.dvi
%%CreationDate: Tue Nov 22 14:01:59 1994
%%Pages: 51
%%PageOrder: Ascend
%%BoundingBox: 0 0 596 842
%%EndComments
%DVIPSCommandLine: /usr/local/tex/bin/sun4/dvips state.dvi
%DVIPSParameters: dpi=300, comments removed
%DVIPSSource:  TeX output 1994.11.22:1359
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N
/X{S N}B /TR{translate}N /isls false N /vsize 11 72 mul N /hsize 8.5 72
mul N /landplus90{false}def /@rigin{isls{[0 landplus90{1 -1}{-1 1}
ifelse 0 0 0]concat}if 72 Resolution div 72 VResolution div neg scale
isls{landplus90{VResolution 72 div vsize mul 0 exch}{Resolution -72 div
hsize mul 0}ifelse TR}if Resolution VResolution vsize -72 div 1 add mul
TR matrix currentmatrix dup dup 4 get round 4 exch put dup dup 5 get
round 5 exch put setmatrix}N /@landscape{/isls true N}B /@manualfeed{
statusdict /manualfeed true put}B /@copies{/#copies X}B /FMat[1 0 0 -1 0
0]N /FBB[0 0 0 0]N /nn 0 N /IE 0 N /ctr 0 N /df-tail{/nn 8 dict N nn
begin /FontType 3 N /FontMatrix fntrx N /FontBBox FBB N string /base X
array /BitMaps X /BuildChar{CharBuilder}N /Encoding IE N end dup{/foo
setfont}2 array copy cvx N load 0 nn put /ctr 0 N[}B /df{/sf 1 N /fntrx
FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0 0 sf neg 0 0]N df-tail}B /E{
pop nn dup definefont setfont}B /ch-width{ch-data dup length 5 sub get}
B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{128 ch-data dup
length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub get 127 sub}B
/ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data dup type
/stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N /rc 0 N /gp
0 N /cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup /base get 2
index get S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx 0 ch-xoff
ch-yoff ch-height sub ch-xoff ch-width add ch-yoff setcachedevice
ch-width ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-yoff .1 add]{
ch-image}imagemask restore}B /D{/cc X dup type /stringtype ne{]}if nn
/base get cc ctr put nn /BitMaps get S ctr S sf 1 ne{dup dup length 1
sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}B /I{cc 1 add D
}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin 0 0
moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul add
.99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore showpage
userdict /eop-hook known{eop-hook}if}N /@start{userdict /start-hook
known{start-hook}if pop /VResolution X /Resolution X 1000 div /DVImag X
/IE 256 array N 0 1 255{IE S 1 string dup 0 3 index put cvn put}for
65781.76 div /vsize X 65781.76 div /hsize X}N /p{show}N /RMat[1 0 0 -1 0
0]N /BDot 260 string N /rulex 0 N /ruley 0 N /v{/ruley X /rulex X V}B /V
{}B /RV statusdict begin /product where{pop product dup length 7 ge{0 7
getinterval dup(Display)eq exch 0 4 getinterval(NeXT)eq or}{pop false}
ifelse}{false}ifelse end{{gsave TR -.1 -.1 TR 1 1 scale rulex ruley
false RMat{BDot}imagemask grestore}}{{gsave TR -.1 -.1 TR rulex ruley
scale 1 1 false RMat{BDot}imagemask grestore}}ifelse B /QV{gsave newpath
transform round exch round exch itransform moveto rulex 0 rlineto 0
ruley neg rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta
0 N /tail{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}
B /c{-4 M}B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{
3 M}B /k{4 M}B /w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p
-1 w}B /q{p 1 w}B /r{p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{
3 2 roll p a}B /bos{/SS save N}B /eos{SS restore}B end
%%EndProcSet
%%BeginProcSet: special.pro
TeXDict begin /SDict 200 dict N SDict begin /@SpecialDefaults{/hs 612 N
/vs 792 N /ho 0 N /vo 0 N /hsc 1 N /vsc 1 N /ang 0 N /CLIP 0 N /rwiSeen
false N /rhiSeen false N /letter{}N /note{}N /a4{}N /legal{}N}B
/@scaleunit 100 N /@hscale{@scaleunit div /hsc X}B /@vscale{@scaleunit
div /vsc X}B /@hsize{/hs X /CLIP 1 N}B /@vsize{/vs X /CLIP 1 N}B /@clip{
/CLIP 2 N}B /@hoffset{/ho X}B /@voffset{/vo X}B /@angle{/ang X}B /@rwi{
10 div /rwi X /rwiSeen true N}B /@rhi{10 div /rhi X /rhiSeen true N}B
/@llx{/llx X}B /@lly{/lly X}B /@urx{/urx X}B /@ury{/ury X}B /magscale
true def end /@MacSetUp{userdict /md known{userdict /md get type
/dicttype eq{userdict begin md length 10 add md maxlength ge{/md md dup
length 20 add dict copy def}if end md begin /letter{}N /note{}N /legal{}
N /od{txpose 1 0 mtx defaultmatrix dtransform S atan/pa X newpath
clippath mark{transform{itransform moveto}}{transform{itransform lineto}
}{6 -2 roll transform 6 -2 roll transform 6 -2 roll transform{
itransform 6 2 roll itransform 6 2 roll itransform 6 2 roll curveto}}{{
closepath}}pathforall newpath counttomark array astore /gc xdf pop ct 39
0 put 10 fz 0 fs 2 F/|______Courier fnt invertflag{PaintBlack}if}N
/txpose{pxs pys scale ppr aload pop por{noflips{pop S neg S TR pop 1 -1
scale}if xflip yflip and{pop S neg S TR 180 rotate 1 -1 scale ppr 3 get
ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg TR}if xflip yflip
not and{pop S neg S TR pop 180 rotate ppr 3 get ppr 1 get neg sub neg 0
TR}if yflip xflip not and{ppr 1 get neg ppr 0 get neg TR}if}{noflips{TR
pop pop 270 rotate 1 -1 scale}if xflip yflip and{TR pop pop 90 rotate 1
-1 scale ppr 3 get ppr 1 get neg sub neg ppr 2 get ppr 0 get neg sub neg
TR}if xflip yflip not and{TR pop pop 90 rotate ppr 3 get ppr 1 get neg
sub neg 0 TR}if yflip xflip not and{TR pop pop 270 rotate ppr 2 get ppr
0 get neg sub neg 0 S TR}if}ifelse scaleby96{ppr aload pop 4 -1 roll add
2 div 3 1 roll add 2 div 2 copy TR .96 dup scale neg S neg S TR}if}N /cp
{pop pop showpage pm restore}N end}if}if}N /normalscale{Resolution 72
div VResolution 72 div neg scale magscale{DVImag dup scale}if 0 setgray}
N /psfts{S 65781.76 div N}N /startTexFig{/psf$SavedState save N userdict
maxlength dict begin /magscale false def normalscale currentpoint TR
/psf$ury psfts /psf$urx psfts /psf$lly psfts /psf$llx psfts /psf$y psfts
/psf$x psfts currentpoint /psf$cy X /psf$cx X /psf$sx psf$x psf$urx
psf$llx sub div N /psf$sy psf$y psf$ury psf$lly sub div N psf$sx psf$sy
scale psf$cx psf$sx div psf$llx sub psf$cy psf$sy div psf$ury sub TR
/showpage{}N /erasepage{}N /copypage{}N /p 3 def @MacSetUp}N /doclip{
psf$llx psf$lly psf$urx psf$ury currentpoint 6 2 roll newpath 4 copy 4 2
roll moveto 6 -1 roll S lineto S lineto S lineto closepath clip newpath
moveto}N /endTexFig{end psf$SavedState restore}N /@beginspecial{SDict
begin /SpecialSave save N gsave normalscale currentpoint TR
@SpecialDefaults count /ocount X /dcount countdictstack N}N /@setspecial
{CLIP 1 eq{newpath 0 0 moveto hs 0 rlineto 0 vs rlineto hs neg 0 rlineto
closepath clip}if ho vo TR hsc vsc scale ang rotate rwiSeen{rwi urx llx
sub div rhiSeen{rhi ury lly sub div}{dup}ifelse scale llx neg lly neg TR
}{rhiSeen{rhi ury lly sub div dup scale llx neg lly neg TR}if}ifelse
CLIP 2 eq{newpath llx lly moveto urx lly lineto urx ury lineto llx ury
lineto closepath clip}if /showpage{}N /erasepage{}N /copypage{}N newpath
}N /@endspecial{count ocount sub{pop}repeat countdictstack dcount sub{
end}repeat grestore SpecialSave restore end}N /@defspecial{SDict begin}
N /@fedspecial{end}B /li{lineto}B /rl{rlineto}B /rc{rcurveto}B /np{
/SaveX currentpoint /SaveY X N 1 setlinecap newpath}N /st{stroke SaveX
SaveY moveto}N /fil{fill SaveX SaveY moveto}N /ellipse{/endangle X
/startangle X /yrad X /xrad X /savematrix matrix currentmatrix N TR xrad
yrad scale 0 0 1 startangle endangle arc savematrix setmatrix}N end
%%EndProcSet
TeXDict begin 39158280 55380996 1000 300 300
(/tmp_mnt/users/fp/simonpj/docs/papers/state/state.dvi)
@start /Fa 5 119 df<60F0F06004047D830A>58 D<60F0F070101020204040040A7D83
0A>I<0300038003000000000000000000000000001C002400460046008C000C00180018
00180031003100320032001C0009177F960C>105 D<30F049184E384C309C0018001800
18003000300030003000600060000D0E7F8D10>114 D<1C0426064606460686040C040C
040C0418081808181018200C6007800F0E7F8D11>118 D E /Fb
1 57 df<400010C000306000606000606000603000C03000C01801801FFF800FFF000C03
000C0300060600060600030C00030C0001980001980001980000F00000F0000060000060
001417809615>56 D E /Fc 25 121 df<0180038006000C0018003800300070007000E0
00E000E000E000E000E000E000700070003000380018000C0006000380018009197B9612
>40 D<80C06030181C0C0E0E070707070707070E0E0C1C183060C08008197C9612>I<60
F0F878183030E0C00509798312>44 D<FFF8FFF8FFF80D037E8B12>I<60F0F060000000
00000060F0F060040E798D12>58 D<FFFEFFFE7FFE0000000000007FFEFFFEFFFE0F097F
8E12>61 D<4000E000F0007C003E000F8007C001E000F8007800F801E007C00F803E007C
00F000E00040000D137E9312>I<038007C007C006C006C00EE00EE00EE00EE00C601C70
1C701C701FF01FF0383838383838FC7EFC7E0F147F9312>65 D<FFE0FFE00E000E000E00
0E000E000E000E000E000E000E000E000E000E000E000E000E00FFE0FFE00B147D9312>
73 D<FFC0FFC0E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000FFC0FFC00A1A7A9612>91 D<FFC0FFC001C001C001
C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001
C001C0FFC0FFC00A1A7F9612>93 D<1FC0003FF000383800101C00001C0007FC003FFC00
781C00E01C00E01C00E01C00703C003FFF801FCF80110E7F8D12>97
D<07F01FF8383870106000E000E000E000E0006000703838381FF007E00D0E7E8D12>99
D<00F800F8003800380038003807B81FF8387870386038E038E038E038E0386038707838
781FFE0FBE0F147F9312>I<07801FE0387070706038E038FFF8FFF8E000600070383838
1FF007C00D0E7E8D12>I<06000F000F0006000000000000007F007F0007000700070007
00070007000700070007000700FFF0FFF00C157D9412>105 D<FF00FF00070007000700
0700070007000700070007000700070007000700070007000700FFF8FFF80D147E9312>
108 D<F9E0FFF03E383C3838383838383838383838383838383838FE3EFE3E0F0E7F8D12
>110 D<0F803FE038E07070E038E038E038E038E038F078707038E03FE00F800D0E7E8D
12>I<FC78FDFC1F9C1E081E001C001C001C001C001C001C001C00FFC0FFC00E0E7E8D12>
114 D<1FF03FF06070C070E0007F003FE00FF000786018E018F030FFE0DFC00D0E7E8D12
>I<06000E000E000E007FF8FFF80E000E000E000E000E000E000E000E1C0E1C0E1C07F8
01E00E127F9112>I<FC7EFC7E383838381C701C701C700EE00EE00EE00EE007C007C003
800F0E7F8D12>118 D<FEFEFEFE701C701C701C30183BB83FF83FF83AB838B81CF01CF0
1CF00F0E7F8D12>I<7C7C7C7C1CF00EE00FC007C00380078007C00EE01EF01C70FC7EFC
7E0F0E7F8D12>I E /Fd 57 122 df<0007E0001C1000703800E07801C07801C03001C0
0001C0000380000380000380003FFFF00380F00380700700E00700E00700E00700E00700
E00700E00E01C00E01C00E01C00E01C00E01C00E01C01C03801C03C0FF8FF0151D7F9C17
>12 D<183C7C340404080810106080060C799C0C>39 D<00080010002000400080018003
00030006000E000C001C001800180038003000300070007000600060006000E000E000E0
00E000E000C000C000C000E000E000600060006000600030003000100008000C0004000D
2A7B9E10>I<0100008000C0004000600020003000300030001800180018001800180018
001800180018001800380038003800300030007000700060006000E000C000C001800180
0300030006000400080018003000600080000D2A809E10>I<3878783808081010202040
80050C7D830C>44 D<7FF0FFE00C027F890E>I<00000400000C00001800001800003000
00300000600000600000C00000C0000180000300000300000600000600000C00000C0000
180000180000300000300000600000600000C00000C00001800001800003000003000006
00000C00000C0000180000180000300000300000600000600000C00000C0000080000016
297F9E15>47 D<00F800038E000606000C03000C03001803803803803803803003807003
80700380700380700380E00700E00700E00700E00700E00700E00600E00E00C00E00C00E
00C00C00C01C00C0180060300060600030C0001F0000111D7C9B15>I<0018003003F00C
7000700070007000E000E000E000E000E000E001C001C001C001C001C001C00380038003
8003800380038007000780FFF80D1C7C9B15>I<007E000183800201C00400E00400E00F
00E00F00E01F00E01F00E00E00E00001E00001C0000380000380000700000E00001C0000
380000600000C0000180000300800600800801001001003FFF007FFE00FFFE00131C7E9B
15>I<007C000187000203800403800F03C00F03C00F03C00E0380000380000700000600
000C0000380003F000001C00000E00000E00000F00000F00000F00700F00F80F00F80F00
F00E00E01E00801C004038003070000F8000121D7D9B15>I<0000C00001800003800003
80000780000B8000138000270000670000C700008700010700020700040E00080E00180E
00100E00200E00400E00FFFFC0001C00001C00001C00001C00001C00003800003C0003FF
80121C7E9B15>I<003E0000C1000180800303800607800C07801C070018000038000030
000071F000761800780C00E80E00F00600F00600E00700E00700E00700E00E00C00E00C0
0E00C00E00C01C00E0180060380060300030C0000F8000111D7C9B15>54
D<007C000183000201800601800C00C00C00C00C00C01C01801C01801F03000F86000FCC
0007F00003F80003FC000C7E00183F00301F00600700600700C00300C00300C00300C002
00C006006004006008003830000FC000121D7D9B15>56 D<00F8000304000606000C0300
1C0300380300380380300380700380700380700380700380700780700700700F00300F00
18170008270007CE00000E00000C00001C00601800F03800F03000E0600080C000438000
3E0000111D7C9B15>I<0000200000003000000070000000F0000000F0000001F0000001
F800000278000002780000047800000478000008780000083C0000103C0000103C000020
3C0000203C0000403E0000401E0000FFFE0000801E0001001E0001001F0002000F000200
0F0004000F000C000F001E000F80FF807FF01C1D7F9C1F>65 D<07FFFE0000F8078000F0
01C000F001E000F000E000F000F000F000F001E000E001E001E001E001C001E003C001E0
078001E01E0003FFFC0003C00F0003C0078003C003C003C003C003C003C0078003C00780
03C0078003C0078003C00780078007800F000F001E000F003C00FFFFE0001C1C7F9B1D>
I<0007F010001C0C300070026000C001E0038000E0070000E00E0000600E0000601C0000
403C00004038000040780000007800000078000000F0000000F0000000F0000000F00000
00F0000000F0000080F0000100700001007000010038000200380004001C0004000C0018
00060020000380C000007F00001C1E7C9C1E>I<0FFFFC0000F8078000F001C000F000E0
00F0007000F0007000F0007801E0003801E0003801E0003801E0003801E0003C01E00038
03C0003803C0007803C0007803C0007803C0007003C000F0078000E0078000E0078001C0
078003800780078007800E000F001C000F007000FFFFC0001E1C7E9B20>I<07FFFFE000
F801E000F000E000F0004000F0004000F0004000F0004001E0004001E0204001E0200001
E0200001E0600001E0E00003FFC00003C0C00003C0400003C0400003C0400003C0408007
80008007800080078001000780010007800300078006000F000E000F003E00FFFFFC001B
1C7E9B1C>I<07FFFFC000F803C000F001C000F0008000F0008000F0008000F0008001E0
008001E0208001E0200001E0200001E0600001E0E00003FFC00003C0C00003C0400003C0
400003C0400003C040000780000007800000078000000780000007800000078000000F00
00000F800000FFF800001A1C7E9B1B>I<0007F010001C0C300070026000C001E0038000
E0070000E00E0000600E0000601C0000403C000040380000407800000078000000780000
00F0000000F0000000F0000000F000FFF0F0000F80F0000780F0000F0070000F0070000F
0038000F0038000F001C001F000C001E000600660003818200007E00001C1E7C9C21>I<
07FF00F800F000F000F000F000F001E001E001E001E001E001E003C003C003C003C003C0
03C00780078007800780078007800F000F80FFF0101C7F9B0F>73
D<007FF80007C0000780000780000780000780000780000F00000F00000F00000F00000F
00000F00001E00001E00001E00001E00001E00001E00003C00003C00703C00F83C00F83C
00F07800E0700080E00061C0001F0000151D7E9B15>I<07FFC000F80000F00000F00000
F00000F00000F00001E00001E00001E00001E00001E00001E00003C00003C00003C00003
C00003C00003C0040780040780040780040780080780080780180F00380F00F0FFFFF016
1C7E9B1A>76 D<07F80007FC00F8000FC000BC000F8000BC00178000BC00178000BC0027
8000BC002780011E004F00011E004F00011E008F00011E008F00011E010F00010F010F00
020F021E00020F021E00020F041E00020F041E000207881E000207901E000407903C0004
07A03C000407A03C000407C03C000403C03C000403803C000C038078001E03007C00FF83
07FF80261C7E9B26>I<07F800FF8000F8003C0000BC00180000BC001000009E00100000
9F001000008F001000010F80200001078020000107C020000103C020000103E020000101
E020000200F040000200F040000200784000020078400002003C400002003C400004001E
800004001F800004000F800004000F8000040007800004000780000C000300001E000100
00FF80010000211C7F9B1F>I<0007F00000381C0000E00E0001C0030003800380070001
C00E0001C01E0001E01C0000E03C0000E0380000E0780000F0780000F0780000F0F00001
E0F00001E0F00001E0F00001E0F00003C0F00003C0F00003C0700007807000070078000F
0038001E003C001C001C0038000E00E0000383800000FE00001C1E7C9C20>I<07FFFC00
00F80F0000F0038000F003C000F001C000F001C000F001C001E003C001E003C001E003C0
01E0038001E0070001E00E0003C03C0003FFE00003C0000003C0000003C0000003C00000
0780000007800000078000000780000007800000078000000F0000000F800000FFF00000
1A1C7E9B1C>I<0FFFF80000F80E0000F0078000F003C000F001C000F001E000F001E001
E003C001E003C001E0038001E0070001E00E0001E03C0003FFE00003C0780003C01C0003
C01E0003C00E0003C00F0007801E0007801E0007801E0007801E0007801E0007801E080F
001E100F801E10FFF00E20000003C01D1D7E9B1F>82 D<003F0400C0CC01803803003806
00180E00180E00180E00181E00101E00001F00000F80000FF80007FF0003FF8001FFC000
3FE00003E00001E00000E00000E04000E04000E04000E04000C06001C0E00180F00300CC
0E0083F800161E7E9C17>I<1FFFFFF03C07C0F030078030200780206007802040078020
40078020400F0020800F0020000F0000000F0000000F0000000F0000001E0000001E0000
001E0000001E0000001E0000001E0000003C0000003C0000003C0000003C0000003C0000
003C000000780000007C00001FFFE0001C1C7C9B1E>I<FFF01FF01F0007801E0003001E
0002001E0002001E0002001E0002003C0004003C0004003C0004003C0004003C0004003C
000400780008007800080078000800780008007800080078000800F0001000F000100070
001000700020007000200038004000380080001C0100000E0E000001F000001C1D7A9B1F
>I<FFE1FFC0FF801F003E003E000F001E0018000F001E0018000F001E0010000F001E00
30000F001E0020000F003E0060000F802F00400007804F00C00007804F00800007808F01
800007808F01000007810F01000007C10782000003C20782000003C20784000003C60784
000003C40788000003CC0788000003C807D0000001F803D0000001F003E0000001F003E0
000001E003C0000001E003C0000001C00380000000C001800000008001000000291D7B9B
2B>87 D<FFE007F81F8001C00F0001800F8001000780020007C0040003C00C0003C00800
03E0100001E0200001F0600000F0400000F8800000F90000007B0000007E0000003C0000
003C00000038000000780000007800000078000000780000007800000070000000F00000
00F800000FFF00001D1C7B9B1F>89 D<07F0001C18001E0C001C0E00180E00000E00000E
0001FE000F0E001C1C00301C00701C00E01C40E01C40E03C40E05C80709D803F0E001212
7D9115>97 D<3F00000F00000E00000E00000E00000E00000E00000E00001C00001C0000
1C00001C7C001D87001E01803C01803801C03800C03800E03800E03800E07001C07001C0
7001C0700380700300700600F00C00CC380083E000131D7C9C17>I<00FE000307000E07
801C0700380600380000700000700000700000E00000E00000E000006000007002007004
003008001C300007C00011127E9112>I<0001F800007800007000007000007000007000
00700000700000E00000E00000E000F8E00386E00601E00C01C01801C03801C07001C070
01C07001C0E00380E00380E00380600380700380300780300F001C378007C7E0151D7E9C
17>I<01F8070C0C0618073803300370037FFF7000E000E000E00060006002700430081C
3007C010127E9112>I<000F800039C00061C000E3C001C18001C00001C00001C0000380
000380000380003FF8000380000380000700000700000700000700000700000700000E00
000E00000E00000E00000E00000E00001C00001E0000FFC000121D7F9C0D>I<00003800
7CCC01871C0303080703800E03800E03800E03800E03800E0700060600070C0009F00008
00001800001800001FFE000FFF800FFFC03001C06000C06000E0C000C0C000C060018020
0300180E0007F000161C809215>I<07E00001E00001C00001C00001C00001C00001C000
01C000038000038000038000038F8003B0C003C0E00780E00780E00700E00700E00700E0
0700E00E01C00E01C00E01C00E01C00E01C00E01C01C03801E03C0FF9FF0141D7F9C17>
I<00C001C001C0018000000000000000000000000000001F800780038007000700070007
00070007000E000E000E000E000E000E001C001E00FF800A1D7F9C0C>I<07E00001E000
01C00001C00001C00001C00001C00001C0000380000380000380000381FC0380E00380C0
07010007020007080007100007300007F8000F38000E3C000E1C000E1E000E0E000E0F00
1C07001C0F80FF9FE0161D7F9C16>107 D<07E001E001C001C001C001C001C001C00380
038003800380038003800700070007000700070007000E000E000E000E000E000E001C00
1E00FF800B1D7F9C0C>I<1F8FC0FC00079061060003E076070007807807000780780700
07007007000700700700070070070007007007000E00E00E000E00E00E000E00E00E000E
00E00E000E00E00E000E00E00E001C01C01C001E01E01E00FF8FF8FF8021127F9124>I<
1F8F8007B0C003C0E00780E00780E00700E00700E00700E00700E00E01C00E01C00E01C0
0E01C00E01C00E01C01C03801E03C0FF9FF014127F9117>I<00FC000307000E01801C01
C03800C03000C07000E07000E07000E0E001C0E001C0E001C0600180600380700700380E
001C180007E00013127E9115>I<0FC7C003D87001E03803C01803801C03800C03800E03
800E03800E07001C07001C07001C0700380700300700600F00C00EC3800E3E000E00000E
00000E00001C00001C00001C00001C0000FF8000171A809117>I<1F9C07EE03CF078E07
8C07000700070007000E000E000E000E000E000E001C001E00FFC010127F9110>114
D<03F20C0E18061004300438043E001FE00FF007F8003C401C400C400C6018E010D0608F
C00F127F9110>I<020002000200060006000C001C003C00FFE01C001C00380038003800
380038003800700070407040704070407080708031001E000B1A7C9910>I<FC1F803C07
801C0380380700380700380700380700380700380700700E00700E00700E00700E00701E
00701E00703C00305E001F9F8011127C9117>I<FF07E03C03803C03001C02001C02001C
04001C08000E08000E10000E10000E20000F200007400007C00007800007000003000002
000013127C9116>I<FF3FC7E03C0F0380380E0100380E03003C1F02001C1706001C3704
001C270C001C6308001C4318001EC390000E83B0000F83A0000F03E0000F01C0000E01C0
000E018000040180001B127C911E>I<0FF07E03C03803C03001C02001C02001C04001C0
8000E08000E10000E10000E20000F200007400007C000078000070000030000020000020
00004000004000708000F10000F30000E60000780000171A809116>121
D E /Fe 2 51 df<18F818181818181818181818FF080D7D8C0E>49
D<3E00418080C0C0C000C000C0018003000400084030407F80FF800A0D7E8C0E>I
E /Ff 1 51 df<7FFFFCFFFFFEC00006C00006C00006C00006C00006C00006C00006C000
06C00006C00006C00006C00006C00006C00006C00006C00006C00006C00006C00006FFFF
FEFFFFFE17177D991F>50 D E /Fg 12 119 df<3FF87FF8C20082000600060004000400
0C000C000C00180018000D0D7E8C0F>28 D<07FFC000E07001C01801C01C01C01C01C01C
0380380380700380C003FF000701C00701C00700E00700E00E01C00E01C00E01C00E01C2
1C01C4FF807817147F9319>82 D<00F8800305800603000401000C01000C01000C00000E
00000FE00007F80001FC00001C00000E00000E00400C00400C00400800601800D020008F
C00011147E9314>I<07B00C7010703060606060606060C0C0C0C8C0C841C862D03C700D
0D7E8C12>97 D<0780184030206040C040FF80C00080008000C020C04061803E000B0D7E
8C10>101 D<01CC062C0C1C1818301830183018603060302030307010E00F6000600060
60C0E0C0C3807E000E137F8C10>103 D<06070600000000384C4C8C9818183032326464
3808147F930C>105 D<30F8590C4E0C9C0C980C180C180C30183019303130316032601C
100D7F8C15>110 D<03800C6018203030603060306030C060C06040C0608023001E000C
0D7E8C10>I<31E05A704C709C609800180018003000300030003000600060000C0D7F8C
0F>114 D<0700188019C0318038001E000F0003804180E180C10082007C000A0D7E8C10>
I<38104C184C108C10981018101810302030203040304018800F000D0D7F8C11>118
D E /Fh 3 84 df<0000700001F00003C0000780000E00001C0000380000700000700000
F00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000
E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000
E00000E00000E00000E00000E00000E00000E00001C00001C00001C00003800007000006
00000E0000380000700000C000007000003800000E000006000007000003800001C00001
C00001C00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000
E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000
E00000E00000E00000E00000E00000E00000E00000E00000F00000700000700000380000
1C00000E000007800003C00001F000007014637B811F>26 D<FFFFFFFFC0FFFFFFFFC01F
00003E000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C000F00
003C000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C000F0000
3C000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C
000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C00
0F00003C000F00003C000F00003C000F00003C000F00003C000F00003C000F00003C000F
00003C001F80007E00FFF003FFC0FFF003FFC0222A7E7F27>81 D<E000001CE000001CE0
00001CE000001CE000001CE000001CE000001CE000001CE000001CE000001CE000001CE0
00001CE000001CE000001CE000001CE000001CE000001CE000001CE000001CE000001CE0
00001CE000001CE000001CE000001CE000001CE000001CE000001CE000001CE000001CE0
00001CE000001C700000387000003838000070380000701C0000E01E0001E00F8007C007
E01F8001FFFE00007FF800001FE0001E2A7E7F23>83 D E /Fi 59
125 df<60F0F0F0F0F0F0F0F0F0F0F0F0F0600000000060F0F0600417789614>33
D<C060E0E0E0E0E0E0E0E0C060C060C060C060C06040400B0B7C9614>I<60F0F8781818
18303060C080050C789614>39 D<0180038006000C001C0018003800700070007000E000
E000E000E000E000E000E000E000E000700070007000380018001C000C00060003800180
091D799914>I<80C0603038181C0E0E0E0707070707070707070E0E0E1C18383060C080
081D7C9914>I<038003800380638CF39E7FFC3FF80FE00FE03FF87FFCF39E638C038003
8003800F107E9214>I<01C00001C00001C00001C00001C00001C00001C000FFFF80FFFF
80FFFF8001C00001C00001C00001C00001C00001C00001C00011117F9314>I<70F8FCFC
7C0C1830E0C0060A798414>I<FFFEFFFEFFFE0F037E8C14>I<70F8F8F8700505798414>
I<0FC01FF03838701CE00EE00EE00E400E000E001C001C00380030007000E001C0030006
000C00180E300E7FFE7FFE0F177E9614>50 D<0FC01FF03838701C701C201C001C001800
3800700FE00FF00038001C000E000E400EE00EE00E701C78383FF00FC00F177E9614>I<
70F8F8F87000000000000070F8F8F8700510798F14>58 D<000E003E007C00F003E007C0
1F003E00F800F000F8003E001F0007C003E000F0007C003E000E0F137E9414>60
D<FFFF80FFFF807FFF800000000000000000007FFF80FFFF80FFFF8011097F8F14>I<40
00E000F8007C001E000F8007C001F000F8003E001E003E00F801F007C00F801E007C00F8
00E00040000F157E9514>I<01C00003E00003E000036000036000077000077000077000
0770000630000E38000E38000E38000E38001C1C001FFC001FFC001C1C001C1C00380E00
380E00FE3F80FE3F8011177F9614>65 D<FFF0FFFC381E380E3807380738073807380E38
1E3FFC3FFC381E380E38073807380738073807380E381EFFFCFFF810177F9614>I<FFFF
80FFFF803803803803803803803803803800003800003838003838003FF8003FF8003838
00383800380000380000380000380000380000380000380000FF0000FF000011177F9614
>70 D<03C60FFE1C3E181E381E700E700E600EE000E000E000E000E07FE07FE00E600E70
0E700E381E181E1C3E0FFE03CE10177F9614>I<FFF8FFF8070007000700070007000700
0700070007000700070007000700070007000700070007000700FFF8FFF80D177D9614>
73 D<FF00FF003800380038003800380038003800380038003800380038003800380038
003807380738073807FFFFFFFF10177E9614>76 D<FC1F80FC1F807C1F00763700763700
76370076370077770077770073670073670073670073E70071C70071C700700700700700
700700700700700700700700F80F80F80F8011177F9614>I<FE3F80FE3F803E0E003B0E
003B0E003B0E003B0E003B8E00398E00398E0039CE0039CE0039CE0038CE0038CE0038EE
00386E00386E00386E00386E00383E00FE3E00FE3E0011177F9614>I<FFF0FFFC381E38
0E38073807380738073807380E381E3FFC3FF038003800380038003800380038003800FE
00FE0010177F9614>80 D<0FCC1FFC307C603CE01CE01CE01CE00070007E003FE00FF001
F8001C001E000E600EE00EE00EF01CF838FFF0C7E00F177E9614>83
D<7FFF80FFFF80E1C380E1C380E1C380E1C38001C00001C00001C00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00001C00001C00001C0000FF8000FF8001117
7F9614>I<FE0FE0FE0FE038038038038038038038038038038038038038038038038038
03803803803803803803803803803803803803803803801C07001C07000E0E0007FC0001
F0001317809614>I<FC1F80FC1F80380E00380E00380E003C1E001C1C001C1C001C1C00
1C1C000E38000E38000E38000E380006300007700007700007700003600003600003E000
03E00001C00011177F9614>I<FFE0FFE0E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000FFE0FFE00B
1D799914>91 D<C000E000E00070007000380038001C001C000E000E0007000700038003
80038001C001C000E000E00070007000380038001C001C000E000E00060F1D7E9914>I<
FFE0FFE000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E0FFE0FFE00B1D7F9914>I<FFFEFFFEFFFE0F
037E7E14>95 D<0818306060C0C0C0F0F87830050C799914>I<1FC0007FF00070780020
1800001C00001C0007FC001FFC003C1C00701C00E01C00E01C00E01C00707C003FFF800F
8F8011107E8F14>I<FC0000FC00001C00001C00001C00001C00001C00001CF8001DFE00
1F07001E03001C03801C01C01C01C01C01C01C01C01C01C01C01C01C03801E03001F0E00
1DFC000CF8001217809614>I<03F80FFE1C0E380470006000E000E000E000E000600070
00380E1C1E0FFC03F00F107E8F14>I<007E00007E00000E00000E00000E00000E00000E
0007CE000FFE001C3E00301E00700E00E00E00E00E00E00E00E00E00E00E00E00E00700E
00301E00383E001FEFC007CFC012177F9614>I<07E00FF01C38301C700CE00EE00EFFFE
FFFEE00060007000380E1C1E0FFC03F00F107E8F14>I<00FC01FE038E07040700070007
007FFEFFFE070007000700070007000700070007000700070007000700FFF8FFF80F177F
9614>I<07CF001FFF80383B80301800701C00701C00701C003018003838003FF00037C0
007000007000003FF8001FFC003FFE00700F00E00380E00380E00380E003807007003C1E
001FFC0007F00011197F8F14>I<FC0000FC00001C00001C00001C00001C00001C00001C
78001DFE001F86001E07001C07001C07001C07001C07001C07001C07001C07001C07001C
07001C0700FF8FE0FF8FE01317809614>I<06000F000F0006000000000000000000FF00
FF00070007000700070007000700070007000700070007000700FFF8FFF80D187C9714>
I<FC0000FC00001C00001C00001C00001C00001C00001CFF801CFF801C1C001C38001C70
001CE0001DC0001FE0001FE0001E70001C38001C3C001C1C001C0E00FF1F80FF1F801117
809614>107 D<FF80FF8003800380038003800380038003800380038003800380038003
80038003800380038003800380FFFEFFFE0F177E9614>I<FB8E00FFDF003CF3803CF380
38E38038E38038E38038E38038E38038E38038E38038E38038E38038E380FEFBE0FE79E0
1310808F14>I<FC7800FDFE001F86001E07001C07001C07001C07001C07001C07001C07
001C07001C07001C07001C0700FF8FE0FF8FE01310808F14>I<07C01FF03C78701C701C
E00EE00EE00EE00EE00EE00E701C783C3C781FF007C00F107E8F14>I<FCF800FDFE001F
07001E03001C03801C01C01C01C01C01C01C01C01C01C01C01C01C03801E03001F0E001D
FC001CF8001C00001C00001C00001C00001C00001C0000FF8000FF80001218808F14>I<
FE1F00FE7F800EE3800F81000F00000F00000E00000E00000E00000E00000E00000E0000
0E00000E0000FFF000FFF00011107F8F14>114 D<0FD83FF86038C038C038F0007F803F
F007F8001C6006E006F006F81CFFF8CFE00F107E8F14>I<06000E000E000E000E007FFC
FFFC0E000E000E000E000E000E000E000E000E0E0E0E0E0E0E1C07F801F00F157F9414>
I<FC3F00FC3F001C07001C07001C07001C07001C07001C07001C07001C07001C07001C07
001C07001C1F000FFFE003E7E01310808F14>I<FE3F80FE3F803C1E001C1C001C1C001C
1C000E38000E38000E380006300007700007700007700003E00003E00003E00011107F8F
14>I<FE3F80FE3F80700700380E00380E00380E0039CE0039CE0039CE001B6C001A6C00
1A6C001A6C001E7C001E7C000E380011107F8F14>I<7E3F007E3F001E3C000E78000770
0007E00003E00001C00003C00003E0000770000E78000E38001C1C00FE3F80FE3F801110
7F8F14>I<FE3F80FE3F801C0E001C1C001C1C000E1C000E38000E380007380007300007
300003700003700003E00001E00001E00001C00001C00001C0000380007380007700007E
00003C000011187F8F14>I<3FFF7FFF700E701C7038007000E001C0038007000E001C07
38077007FFFFFFFF10107F8F14>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0
E0E0E0E0E0E0E0E0031D789914>124 D E /Fj 52 122 df<007800CC0186030606060E
060C061C07180738063806300E700E700E7FFEE01CE01CE01CE018E038C038C070C060C0
60C0C0C180618062003C00101D7E9C13>18 D<07800001C00001E00000E00000E00000F0
00007000007000007800003800003800003C00001C00001C00001E00000E00001E00003F
0000670000C7000187800303800603800E03C01C01C03801C07001E0E000E0C000F0141D
7E9C18>21 D<001E0000718000C0C00180C00380C00300E00700E00700E00E01C00E01C0
0E01C00E01801C03801C03001C06001E0C003A180039E000380000380000700000700000
700000700000E00000E00000C00000131B7F9115>26 D<01FFF803FFF80FFFF81E1E0018
0E00380600700600700600E00E00E00E00E00E00E00C00E01C00E01800E0300060600030
C0001F000015127E9118>I<0FFFE01FFFE03FFFE060C00040C000808000008000018000
0180000180000300000300000300000700000700000700000E000006000013127E9112>
I<1E3E60C0C0C0C0C0603E1E070B7E930C>44 D<60F0F06004047C830C>58
D<60F0F0701010101020204080040C7C830C>I<00010003000600060006000C000C000C
0018001800180030003000300060006000C000C000C00180018001800300030003000600
06000C000C000C00180018001800300030003000600060006000C000C00010297E9E15>
61 D<00000C0000000C0000001C0000001C0000003C0000005C0000005C0000009E0000
008E0000010E0000020E0000020E0000040E0000040E0000080E0000100E0000100E0000
200700003FFF000040070000800700008007000100070001000700020007000400070004
0007001C000780FF803FF01C1D7F9C1F>65 D<01FFFF00003C01C0003800E0003800F000
3800700038007000700070007000F0007000F0007001E000E003C000E0078000E01F0000
FFFC0001C00F0001C0078001C003C001C003C0038003C0038003C0038003C0038003C007
0007800700070007000E0007001C000E007800FFFFC0001C1C7E9B1F>I<0001F808000E
061800380138006000F001C0007003800070070000300F0000200E0000201C0000203C00
00203C000000780000007800000078000000F0000000F0000000F0000000F0000000F000
0100F0000100F0000100700002007000020030000400380008001C0010000E0060000701
800000FE00001D1E7E9C1E>I<01FFFF80003C01E000380070003800380038003C003800
1C0070001C0070001E0070001E0070001E00E0001E00E0001E00E0001E00E0001E01C000
3C01C0003C01C0003C01C000380380007803800070038000F0038000E0070001C0070003
800700070007001C000E007800FFFFC0001F1C7E9B22>I<01FFFFF8003C007800380018
0038001000380010003800100070001000700010007008100070080000E0100000E01000
00E0300000FFF00001C0200001C0200001C0200001C02000038040400380004003800080
03800080070001000700010007000300070006000E003E00FFFFFC001D1C7E9B1F>I<01
FFFFF0003C00F00038003000380020003800200038002000700020007000200070082000
70080000E0100000E0100000E0300000FFF00001C0200001C0200001C0200001C0200003
804000038000000380000003800000070000000700000007000000070000000F000000FF
F000001C1C7E9B1B>I<0001F808000E061800380138006000F001C00070038000700700
00300F0000200E0000201C0000203C0000203C000000780000007800000078000000F000
0000F0000000F0007FF0F0000780F0000700F0000700F00007007000070070000E003000
0E0038000E001C001E000E0064000701840000FE00001D1E7E9C21>I<01FFC0003C0000
380000380000380000380000700000700000700000700000E00000E00000E00000E00001
C00001C00001C00001C0000380000380000380000380000700000700000700000700000F
0000FFE000121C7E9B12>73 D<01FFC07F80003C001E0000380018000038002000003800
40000038008000007002000000700400000070080000007010000000E040000000E0C000
0000E1E0000000E2E0000001C470000001D070000001E038000001C03800000380380000
03801C000003801C000003800E000007000E000007000E0000070007000007000700000F
00078000FFE03FF000211C7E9B23>75 D<01FFE0003C0000380000380000380000380000
700000700000700000700000E00000E00000E00000E00001C00001C00001C00001C00003
800203800203800203800407000407000C0700180700380E00F0FFFFF0171C7E9B1C>I<
01FE0000FF003E0000F0002E0001E0002E0002E0002E0002E0002E0004E0004E0009C000
4E0009C000470011C000470011C000870023800087004380008700438000870083800107
0107000107010700010382070001038207000203840E000203880E000203880E00020390
0E000403A01C000403A01C000401C01C000C01C01C001C01803C00FF8103FF80281C7E9B
28>I<01FC00FF80001C001C00002E001800002E001000002E0010000027001000004700
20000043002000004380200000438020000081C040000081C040000081C040000080E040
000100E08000010070800001007080000100708000020039000002003900000200390000
02001D000004001E000004000E000004000E00000C000E00001C00040000FF8004000021
1C7E9B21>I<01FFFF00003C03C0003800E0003800F00038007000380070007000F00070
00F0007000F0007000E000E001E000E003C000E0070000E01E0001FFF00001C0000001C0
000001C00000038000000380000003800000038000000700000007000000070000000700
00000F000000FFE000001C1C7E9B1B>80 D<01FFFE00003C03C0003800E0003800F00038
007000380070007000F0007000F0007000F0007001E000E001C000E0078000E01E0000FF
F00001C0380001C00C0001C00E0001C00E0003800E0003800E0003800E0003800E000700
1E0007001E0807001E0807001E100F000F10FFE00F20000003C01D1D7E9B20>82
D<000FC100303300400F0080060180060300060300060600040600040700000700000780
0003F00001FF0000FFC0003FE00003E00000F00000700000300000302000302000306000
606000606000C0600080F00300CC060083F800181E7E9C19>I<1FFFFFF01C0380703007
0030200700206007002040070020400E0020800E0020800E0020000E0000001C0000001C
0000001C0000001C00000038000000380000003800000038000000700000007000000070
00000070000000E0000000E0000000E0000000E0000001E000007FFF00001C1C7F9B18>
I<7FF03FE00F0007000E0006000E0004000E0004000E0004001C0008001C0008001C0008
001C00080038001000380010003800100038001000700020007000200070002000700020
00E0004000E0004000E0004000E0008000E0008000E00100006002000060040000300800
001830000007C000001B1D7D9B1C>I<FFC00FF01C0003801C0003001C0002001C000200
1C0004001C0008001E0008000E0010000E0030000E0020000E0040000E0040000E008000
0E0100000F01000007020000070400000704000007080000070800000710000007200000
03A0000003C00000038000000380000003000000030000001C1D7D9B18>I<01FFC0FF80
001E003C00001C003000000E002000000E004000000F0080000007010000000782000000
038400000003CC00000001D800000001F000000001E000000000E000000000F000000001
70000000027800000004380000000838000000103C000000201C000000401E000000800E
000001000F0000020007000006000700001E000F8000FF803FF000211C7F9B22>88
D<01E3000717000C0F00180F00380E00300E00700E00700E00E01C00E01C00E01C00E01C
00E03880E03880E038806078803199001E0E0011127E9116>97 D<3F00070007000E000E
000E000E001C001C001C001C0039E03A303C1838187018701C701C701CE038E038E038E0
30E070E060E0C061C023001E000E1D7E9C12>I<01F0030C0C0C1C1E383C301870007000
E000E000E000E000E000E0046008601030601F800F127E9112>I<0007E00000E00000E0
0001C00001C00001C00001C000038000038000038000038001E7000717000C0F00180F00
380E00300E00700E00700E00E01C00E01C00E01C00E01C00E03880E03880E03880607880
3199001E0E00131D7E9C16>I<01F007080C0818043808300870307FC0E000E000E000E0
00E000E0046008601030600F800E127E9113>I<0001E0000630000E78000EF0001C6000
1C00001C00001C00001C0000380000380003FFC000380000380000700000700000700000
700000700000E00000E00000E00000E00000E00001C00001C00001C00001C00001C00001
8000038000038000630000F30000F60000E4000078000015257E9C14>I<0038C000C5C0
0183C00303C00703800603800E03800E03801C07001C07001C07001C07001C0E001C0E00
1C0E000C1E00047C00039C00001C00001C00003800603800F03000F07000E0C0007F0000
121A809114>I<0FC00001C00001C0000380000380000380000380000700000700000700
000700000E3E000EC3000F03800E03801E03801C03801C03801C03803807003807003807
00380E00700E20700E20701C20701C40E00C80600700131D7E9C18>I<01C003C003C001
800000000000000000000000001C00270047004700870087000E000E001C001C001C0038
00388038807080710032001C000A1C7E9B0E>I<0FC00001C00001C00003800003800003
80000380000700000700000700000700000E07000E08800E11C00E23C01C47801C83001D
00001E00003FC00038E000387000387000707100707100707100707200E03200601C0012
1D7E9C16>107 D<1F800380038007000700070007000E000E000E000E001C001C001C00
1C0038003800380038007000700070007000E200E200E200E40064003800091D7F9C0C>
I<381F81F04E20C6184640E81C4680F01C8F00F01C8E00E01C0E00E01C0E00E01C1C01C0
381C01C0381C01C0381C01C0703803807138038071380380E1380380E270070064300300
3820127E9124>I<3C1F004E61804681C04701C08F01C08E01C00E01C00E01C01C03801C
03801C03801C0700380710380710380E10380E2070064030038014127E9119>I<00F800
030C000E06001C0300180300300300700380700380E00700E00700E00700E00E00E00E00
E01C0060180060300030E0000F800011127E9114>I<07878009C86008D03008E03011C0
3011C03801C03801C0380380700380700380700380600700E00700C00701800783000E86
000E78000E00000E00001C00001C00001C00001C00003C0000FF0000151A819115>I<01
C206260C1E181E381C301C701C701CE038E038E038E038E070E070E07060F023E01CE000
E000E001C001C001C001C003801FF00F1A7E9113>I<3C3C4E424687470F8E1E8E0C0E00
0E001C001C001C001C0038003800380038007000300010127E9113>I<01F0060C0C040C
0E180C1C001F000FE00FF003F80038201C7018F018F010803060601F800F127E9113>I<
00C001C001C001C00380038003800380FFF00700070007000E000E000E000E001C001C00
1C001C00382038203840384018800F000C1A80990F>I<1C00C02701C04701C04701C087
03808703800E03800E03801C07001C07001C07001C0700180E20180E20180E201C1E200C
264007C38013127E9118>I<1C03270747074703870187010E010E011C021C021C021C04
1804180818081C100C2007C010127E9114>I<1C00C0802701C1C04701C1C04701C0C087
038040870380400E0380400E0380401C0700801C0700801C0700801C0701001806010018
0601001C0E02001C0F04000E13080003E1F0001A127E911E>I<07878008C84010F0C020
F1E020E3C040E18000E00000E00001C00001C00001C00001C000638080F38080F38100E5
810084C60078780013127E9118>I<1C00C02701C04701C04701C08703808703800E0380
0E03801C07001C07001C07001C0700180E00180E00180E001C1E000C3C0007DC00001C00
001800603800F03000F06000E0C0004180003E0000121A7E9114>I
E /Fk 70 127 df<60F0F0F0F0F0F0F0F0F0F0F0F0F0F0F0600000000060F0F060041977
9816>33 D<E038F078F078F078F078F078F078F078E038E03860300D0B7C9816>I<0387
000387000387000387000387000387007FFFC0FFFFE0FFFFE0070E00070E00070E000E1C
000E1C000E1C000E1C00FFFFE0FFFFE07FFFC01C38001C38001C38001C38001C38001C38
0013197F9816>I<30787C3C1C1C1C1C3878F0E040060D789816>39
D<00E001E0038007000E001C001C0038003800700070007000E000E000E000E000E000E0
00E000E000E000700070007000380038001C001C000E000700038001E000E00B217A9C16
>I<C000E000700038001C000E000E000700070003800380038001C001C001C001C001C0
01C001C001C001C0038003800380070007000E000E001C0038007000E000C0000A217B9C
16>I<0380038003800380E38EF39EFFFE3FF80FE00FE03FF8FFFEF39EE38E0380038003
8003800F127D9516>I<00E00000E00000E00000E00000E00000E00000E00000E000FFFF
E0FFFFE0FFFFE000E00000E00000E00000E00000E00000E00000E00000E00013137F9516
>I<387C7E7E3E0E1E1C78F060070B798416>I<FFFF80FFFF80FFFF8011037E8D16>I<70
F8F8F8700505788416>I<03E0000FF8001FFC001E3C00380E00780F00700700700700E0
0380E00380E00380E00380E00380E00380E00380E00380F00780700700700700780F003C
1E001E3C001FFC000FF80003E00011197E9816>48 D<0300070007000F001F00FF00FF00
E70007000700070007000700070007000700070007000700070007000700FFF8FFF8FFF8
0D197B9816>I<07E0001FF8003FFC00783E00E00700F00780F003806003800003800003
80000700000700000E00001C0000380000700000E00001C0000380000F00001E03803803
807FFF80FFFF807FFF8011197E9816>I<07E0001FF8003FFC00781E0078070030070000
0700000700000E00003E0007FC0007F00007FC00001E0000070000030000038000038060
0380F00380E00700781E003FFC001FF80007E00011197E9816>I<E00000FFFF80FFFF80
FFFF80E00F00E01E00001C0000380000780000700000E00000E00001C00001C00001C000
038000038000038000038000070000070000070000070000070000070000070000111A7E
9916>55 D<70F8F8F870000000000000000070F8F8F8700512789116>58
D<000180000780001F80003E0000F80001F00007C0000F80003E0000FC0000F00000FC00
003E00000F800007C00001F00000F800003E00001F8000078000018011157E9616>60
D<7FFFC0FFFFE0FFFFE0000000000000000000000000000000FFFFE0FFFFE07FFFC0130B
7F9116>I<C00000F00000FC00003E00000F800007C00001F00000F800003E00001F8000
0780001F80003E0000F80001F00007C0000F80003E0000FC0000F00000C0000011157E96
16>I<00E00001F00001F00001B00001B00003B80003B80003B800031800071C00071C00
071C00071C00071C000E0E000E0E000FFE000FFE001FFF001C07001C07001C07007E0FC0
FF1FE07E0FC013197F9816>65 D<7FF800FFFE007FFF001C07001C07801C03801C03801C
03801C03801C07001FFF001FFE001FFE001C1F001C03801C03C01C01C01C01C01C01C01C
01C01C03C01C07807FFF80FFFF007FFC0012197F9816>I<01F18007FB800FFF801F0F80
3C0780380380700380700380F00000E00000E00000E00000E00000E00000E00000E00000
F000007003807003803803803C07001F0F000FFE0007FC0001F00011197E9816>I<7FF8
00FFFE007FFF001C0F001C07801C03C01C01C01C01C01C01E01C00E01C00E01C00E01C00
E01C00E01C00E01C00E01C00E01C01C01C01C01C03C01C07801C0F807FFF00FFFE007FF8
001319809816>I<7FFFC0FFFFC07FFFC01C01C01C01C01C01C01C01C01C00001C00001C
1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C00E01C00E01C00E01C00E01C
00E07FFFE0FFFFE07FFFE013197F9816>I<7FFFE0FFFFE07FFFE01C00E01C00E01C00E0
1C00E01C00001C00001C1C001C1C001FFC001FFC001FFC001C1C001C1C001C00001C0000
1C00001C00001C00001C00007F8000FFC0007F800013197F9816>I<01F18007FB800FFF
801F0F803C0780380380700380700380F00000E00000E00000E00000E00000E01FC0E01F
E0E01FC0F003807003807007803807803C07801E0F800FFF8007FB8001F38013197F9816
>I<7FFCFFFE7FFC03800380038003800380038003800380038003800380038003800380
038003800380038003807FFCFFFE7FFC0F197D9816>73 D<FC07E0FE0FE0FE0FE03A0B80
3B1B803B1B803B1B803B1B803B1B803BBB8039B38039B38039B38039B38039F38038E380
38E380380380380380380380380380380380FE0FE0FE0FE0FE0FE013197F9816>77
D<1FFC003FFE007FFF00780F00F00780E00380E00380E00380E00380E00380E00380E003
80E00380E00380E00380E00380E00380E00380E00380F00780F00780780F007FFF003FFE
001FFC0011197E9816>79 D<7FF800FFFE007FFF001C0F801C03801C03C01C01C01C01C0
1C01C01C03C01C03801C0F801FFF001FFE001FF8001C00001C00001C00001C00001C0000
1C00001C00007F0000FF80007F000012197F9816>I<7FF000FFFC007FFE001C0F001C07
801C03801C03801C03801C03801C07801C0F001FFE001FFC001FFE001C0E001C07001C07
001C07001C07001C07101C07381C07387F03F0FF83F07F01E01519809816>82
D<07E3001FFF003FFF00781F00F00700E00700E00700E00000F000007800003F80001FF0
0007FC0000FE00000F00000700000380000380600380E00380E00700F80F00FFFE00FFFC
00C7F00011197E9816>I<7FFFE0FFFFE0FFFFE0E0E0E0E0E0E0E0E0E0E0E0E000E00000
E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000E00000
E00000E00007FC000FFE0007FC0013197F9816>I<7F07F0FF8FF87F07F01C01C01C01C0
1C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C01C0
1C01C01C01C00E03800E038007070007FF0003FE0000F8001519809816>I<FE0FE0FE0F
E0FE0FE03803803C07801C07001C07001C07001E0F000E0E000E0E000E0E000E0E00071C
00071C00071C00071C0003180003B80003B80003B80001B00001F00001F00000E0001319
7F9816>I<7E03F0FF07F87E03F03800E03800E03800E03800E01C01C01C01C01C01C01C
71C01CF9C01CF9C01CD9C01CD9C00CD9800CD9800CD9800DDD800D8D800D8D800D8D8007
8F00078F000707001519809816>I<7FFF80FFFF80FFFF80E00700E00F00E01E00E01C00
003C0000780000700000F00001E00001C00003C0000780000700000F00001E03801C0380
3C0380780380700380FFFF80FFFF80FFFF8011197E9816>90 D<FFF0FFF0FFF0E000E000
E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000
E000E000E000E000E000E000FFF0FFF0FFF00C20789C16>I<C00000E00000E000007000
007000003800003800001C00001C00000E00000E000007000007000003800003800001C0
0001C00000E00000E000007000007000003800003800001C00001C00000E00000E000007
0000070000038000038000018011207E9C16>I<FFF0FFF0FFF000700070007000700070
007000700070007000700070007000700070007000700070007000700070007000700070
007000700070FFF0FFF0FFF00C207F9C16>I<FFFF80FFFF80FFFF8011037E7E16>95
D<081C3C7870E0E0E0E0F0F87830060D789B16>I<1FE0003FF0007FF800783C00300E00
000E00000E0003FE001FFE003E0E00700E00E00E00E00E00E00E00783E007FFFE03FE7E0
0F83E013127E9116>I<FC0000FC0000FC00001C00001C00001C00001C00001C7C001DFE
001FFF001F07801E03C01C01C01C00E01C00E01C00E01C00E01C00E01C00E01C01C01E03
C01F07801FFF001DFE000C780013197F9816>I<03F80FFC1FFE3C1E780C7000E000E000
E000E000E000F000700778073E0E1FFC0FF803F010127D9116>I<003F00003F00003F00
00070000070000070000070003C7000FF7001FFF003C1F00780F00700700E00700E00700
E00700E00700E00700E00700700F00780F003C1F001FFFE00FF7E007C7E013197F9816>
I<03F0000FFC001FFE003C0F00780700700380E00380FFFF80FFFF80FFFF80E00000E000
007003807803803E07801FFF0007FE0001F80011127E9116>I<001E00007F0001FF8001
C7800383000380000380007FFF00FFFF00FFFF0003800003800003800003800003800003
80000380000380000380000380000380000380007FFC00FFFE007FFC0011197F9816>I<
03E3C007F7E00FFFE01C1CC0380E00380E00380E00380E00380E001C1C000FF8001FF000
1BE0003800001800001FFC001FFF003FFF807003C0E000E0E000E0E000E0E000E07001C0
7C07C03FFF800FFE0003F800131C7F9116>I<FC0000FC0000FC00001C00001C00001C00
001C00001C78001DFC001FFE001F0F001E07001C07001C07001C07001C07001C07001C07
001C07001C07001C07001C0700FF8FE0FF9FE0FF8FE013197F9816>I<03000780078003
000000000000000000FF80FF80FF80038003800380038003800380038003800380038003
800380FFFCFFFEFFFC0F1A7C9916>I<7E0000FE00007E00000E00000E00000E00000E00
000E7FE00E7FE00E7FE00E0F000E1E000E3C000E78000EF0000FF0000FF8000FBC000F1E
000E0E000E07000E07807F87F0FFCFF07F87F01419809816>107
D<7FC000FFC0007FC00001C00001C00001C00001C00001C00001C00001C00001C00001C0
0001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0007FFF00FFFF
807FFF0011197E9816>I<F9C380FFEFC0FFFFE03C78E03C78E03870E03870E03870E038
70E03870E03870E03870E03870E03870E03870E0FE7CF8FE7CF8FE7CF81512809116>I<
FC7800FDFC00FFFE001F0F001E07001C07001C07001C07001C07001C07001C07001C0700
1C07001C07001C0700FF8FE0FF9FE0FF8FE013127F9116>I<03E0000FF8001FFC003C1E
00780F00700700E00380E00380E00380E00380E00380F00780700700780F003C1E001FFC
000FF80003E00011127E9116>I<FC7C00FDFE00FFFF001F07801E03C01C01C01C00E01C
00E01C00E01C00E01C00E01C00E01C01C01E03C01F07801FFF001DFE001C78001C00001C
00001C00001C00001C00001C0000FF8000FF8000FF8000131B7F9116>I<03E3800FF380
1FFB803E0F80780780700780E00380E00380E00380E00380E00380E00380700780780780
3C1F801FFB800FF38003E380000380000380000380000380000380000380001FF0003FF8
001FF0151B7F9116>I<7F0FC0FF3FE07F7FE007F04007C0000780000780000700000700
000700000700000700000700000700000700007FFC00FFFC007FFC0013127F9116>I<0F
EC3FFC7FFCF03CE01CE01C70007F801FF007F8003C600EE00EF00EF81EFFFCFFF8C7E00F
127D9116>I<0300000700000700000700000700007FFF00FFFF00FFFF00070000070000
07000007000007000007000007000007010007038007038007038007870003FE0001FC00
00F80011177F9616>I<FC3F00FC3F00FC3F001C07001C07001C07001C07001C07001C07
001C07001C07001C07001C07001C07001C1F001FFFE00FF7E007C7E013127F9116>I<7F
1FC0FF9FE07F1FC01C07001C07000E0E000E0E000E0E00071C00071C00071C00071C0003
B80003B80003B80001F00001F00000E00013127F9116>I<FF1FE0FF1FE0FF1FE0380380
38038038038038038039F38039F38019F30019B30019B30019B3001DB7001D17001F1F00
0F1E000E0E0013127F9116>I<7F1FC07F3FC07F1FC00F1E00073C0003B80003F00001F0
0000E00001E00001F00003B800073C00071C000E0E007F1FC0FF3FE07F1FC013127F9116
>I<7F1FC0FF9FE07F1FC01C07000E07000E0E000E0E00070E00071C00071C00039C0003
9C0003980001B80001B80000F00000F00000F00000E00000E00000E00001C00079C0007B
C0007F80007F00003C0000131B7F9116>I<3FFFC07FFFC07FFFC0700780700F00701E00
003C0000780001F00003E0000780000F00001E01C03C01C07801C0FFFFC0FFFFC0FFFFC0
12127F9116>I<E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0E0
E0E0E00320779C16>124 D<1C303F78FFF8F7E061C00D057C9816>126
D E /Fl 51 123 df<0001F03C00071C47000C1CC7000C19C6001C0180001C0380001803
800038038000380380003807000038070003FFFFF000700700007007000070070000700E
0000700E0000E00E0000E00E0000E00E0000E01C0000E01C0001C01C0001C01C0001C01C
0001C0380001C03800038038000380380003803000030070000300700007006000C630E0
00E638C000CC318000781E00002025819C19>11 D<0000FE000003018000060180000C03
80001C0180001C0000001800000038000000380000003800000038000003FFFE0000700E
0000700E0000700E0000701C0000701C0000E01C0000E01C0000E0380000E0380000E038
0001C0380001C0720001C0720001C0720001C07200038034000380180003800000030000
000300000007000000C6000000E6000000CC000000780000001925819C17>I<0001FEE0
000707E0000E07E0000C07C0001C01C0001C01C0001801C0003803800038038000380380
0038038003FFFF0000700700007007000070070000700E0000700E0000E00E0000E00E00
00E01C0000E01C0000E01C0001C01C0001C0390001C0390001C0390001C0390003801A00
03800C0003800000030000000300000007000000C6000000E6000000CC00000078000000
1B25819C18>I<183878380808101020404080050C7D830D>44 D<FFC0FFC0FFC00A037D
890F>I<3078F06005047C830D>I<00000200000600000600000C00000C00001800003000
00300000600000600000C00000C0000180000180000300000600000600000C00000C0000
180000180000300000300000600000C00000C0000180000180000300000300000600000C
00000C0000180000180000300000300000600000600000C0000080000017297F9E15>I<
0004000C00180038007807B8007000700070007000E000E000E000E001C001C001C001C0
038003800380038007000700070007000F00FFF00E1C7B9B15>49
D<003E000041800080C00100C00200E00440E00440E00840E00840E00840E01081C01081
C01103800E0300000600000C000018000060000080000300000400000800401000802000
802001007F070043FE0081FC00807800131D7D9B15>I<001F000060C00080C001006002
00600240600440E00440E00440E00481C00301C000038000070000FC00001C0000060000
0600000700000700000700000700700700E00E00800E00801C0040180040300020E0001F
8000131D7D9B15>I<0001800001C0000380000380000380000300000700000700000600
000E00000C00001C0000180000180000300000300000600000400000C600018E00010E00
020E00061C000C1C00181C003F1C0040F800803F80003800003800007000007000007000
00700000E00000600012247E9B15>I<00806001FFC001FF8001FE000100000200000200
0002000002000004000004F800050C000606000C0600080600000600000700000600000E
00000E00700E00700C00E01C0080180080380040300040600021C0001F0000131D7C9B15
>I<000F8000386000602000C0E00180E00300000600000E00000C00001C00001CF80039
04003A06003C0300780300780300700380700300600700E00700E00700E00600E00E00E0
0C00601C0060180020300030C0000F8000131D7C9B15>I<003E0000E1000181800300C0
0600C00E00C00C00C01C00C01C00C01C01C03801C03801C03801C03803C0180380180780
080B800C330003C700000700000E00000C00001C00001800E03000E0600080C000C18000
3E0000121D7C9B15>57 D<060F0F06000000000000000000003078F06008127C910D>I<
0000180000001800000038000000380000007800000078000000B8000001380000013800
00023C0000021C0000041C00000C1C0000081C0000101C0000101C0000201C0000201C00
007FFC0000C01C0000801C0001001C0001001E0002000E0002000E0004000E000C000E00
1C001E00FF00FFC01A1D7E9C1F>65 D<0003F020001E0C60003002E000E003C001C001C0
038001C0070000C00E0000801E0000801C0000803C0000803C0000007800000078000000
78000000F0000000F0000000F0000000F0000000F0000400F0000400F0000400F0000800
700008007000100038002000180040000C0180000706000001F800001B1E7A9C1E>67
D<01FFFFF0003C00F0003800300038002000380020003800200070002000700020007008
200070080000E0100000E0100000E0300000FFF00001C0200001C0200001C0200001C020
0003804080038000800380008003800100070001000700030007000200070006000E003C
00FFFFFC001C1C7E9B1C>69 D<03FF0078007000700070007000E000E000E000E001C001
C001C001C0038003800380038007000700070007000E000E000E000E001E00FFC0101C7D
9B10>73 D<01FFC07F80003C001E00003800180000380020000038004000003800800000
7002000000700400000070080000007010000000E040000000E0C0000000E1C0000000E2
E0000001C4E0000001D070000001E070000001C070000003803800000380380000038018
000003801C000007001C000007000E000007000E000007000E00000F000F0000FFE07FC0
00211C7E9B20>75 D<01FFC0003C00003800003800003800003800007000007000007000
00700000E00000E00000E00000E00001C00001C00001C00001C000038002038002038002
03800407000407000C0700180700380E00F0FFFFF0171C7E9B1A>I<0007F000001C1C00
00700E0000E0070001C0038003800380070003800E0003C01E0003C01C0003C03C0003C0
3C0003C0780003C0780003C0780003C0F0000780F0000780F0000780F0000F00F0000F00
F0000E00F0001E00F0003C0070003800700070007800E0003801C0001C0380000E0E0000
03F800001A1E7A9C20>79 D<01FFFE00003C0380003801C0003800E0003800E0003800E0
007001E0007001E0007001E0007001C000E003C000E0038000E0070000E01C0001FFF000
01C0000001C0000001C00000038000000380000003800000038000000700000007000000
07000000070000000F000000FFE000001B1C7E9B1C>I<000F8400304C00403C00801801
001803001803001806001006001006000007000007000003E00003FC0001FF00007F8000
07C00001C00001C00000C00000C02000C02000C0600180600180600300600200F00400CC
180083E000161E7D9C17>83 D<1FFFFFC01C0701C0300E00C0200E0080600E0080400E00
80401C0080801C0080801C0080001C000000380000003800000038000000380000007000
0000700000007000000070000000E0000000E0000000E0000000E0000001C0000001C000
0001C0000001C0000003C000007FFE00001A1C799B1E>I<FF801FC03C0007001C000400
1C0004001C0008001C0010001C0010001C0020001C0020001C0040001C0080001C008000
0E0100000E0100000E0200000E0400000E0400000E0800000E0800000E1000000E200000
0F200000074000000740000007800000070000000700000006000000060000001A1D779B
1F>86 D<01E307170C0F180F380E300E700E700EE01CE01CE01CE01CE039E039E0396079
319A1E0C10127C9115>97 D<3F00070007000E000E000E000E001C001C001C001C0039E0
3A183C0C380C700C700E700E700EE01CE01CE01CE018E038E030E06060C031801E000F1D
7C9C13>I<00F803040E041C0E181C300070007000E000E000E000E000E000E004600860
1030600F800F127C9113>I<0007E00000E00000E00001C00001C00001C00001C0000380
00038000038000038001E7000717000C0F00180F00380E00300E00700E00700E00E01C00
E01C00E01C00E01C00E03900E03900E03900607900319A001E0C00131D7C9C15>I<00F8
07040C0418023804300470087FF0E000E000E000E000E00060046008301030600F800F12
7C9113>I<0003C0000670000C70001C60001C00001C0000380000380000380000380000
380003FF8000700000700000700000700000700000E00000E00000E00000E00000E00001
C00001C00001C00001C00001C000038000038000038000030000030000070000C60000E6
0000CC00007800001425819C0D>I<0078C001C5C00303C00603C00E03800C03801C0380
1C0380380700380700380700380700380E00380E00380E00181E000C7C00079C00001C00
001C00003800003800C03000E07000C1C0007F0000121A7E9113>I<0FC00001C00001C0
000380000380000380000380000700000700000700000700000E3E000EC3000F03800E03
801E03801C03801C03801C0380380700380700380700380E00700E40700E40701C40701C
80E00C80600700121D7E9C15>I<01800380010000000000000000000000000000001C00
2600470047008E008E000E001C001C001C0038003800710071007100720072003C00091C
7C9B0D>I<0FC00001C00001C00003800003800003800003800007000007000007000007
00000E07800E08800E11C00E21C01C41801C80001D00001E00003FC00038E00038700038
7000707100707100707100707200E03200601C00121D7E9C13>107
D<1F800380038007000700070007000E000E000E000E001C001C001C001C003800380038
0038007000700070007000E200E200E200E40064003800091D7D9C0B>I<1C1E07802663
18C04683A0E04703C0E08E0380E08E0380E00E0380E00E0380E01C0701C01C0701C01C07
01C01C070380380E0388380E0388380E0708380E0710701C0320300C01C01D127C9122>
I<383E004CC3004D03804E03809E03809C03801C03801C0380380700380700380700380E
00700E40700E40701C40701C80E00C8060070012127C9117>I<00F800030C000E06001C
0300180300300300700380700380E00700E00700E00700E00E00E00E00E01C0060180060
300030E0000F800011127C9115>I<03878004C86004D03004E03009C03009C03801C038
01C0380380700380700380700380600700E00700C00701800783000E86000E78000E0000
0E00001C00001C00001C00001C0000380000FF0000151A809115>I<01E107130C0F180F
380E300E700E700EE01CE01CE01CE01CE038E038E038607831F01E700070007000E000E0
00E000E001C00FF8101A7C9113>I<1C3C2642468747078E068E000E000E001C001C001C
001C0038003800380038007000300010127C9112>I<01F006080C080C1C18181C001F00
1FC00FF007F0007800386030E030C030806060C01F000E127D9111>I<03000700070007
000E000E000E000E00FFE01C001C001C0038003800380038007000700070007000E080E0
80E100E100660038000B1A7C990E>I<1C01802E03804E03804E03808E07008E07001C07
001C0700380E00380E00380E00380E00301C80301C80301C80383C80184D000F86001112
7C9116>I<1C062E0E4E064E068E028E021C021C02380438043804380830083008301038
2018400F800F127C9113>I<1E01832703874703874703838707018707010E07010E0701
1C0E021C0E021C0E021C0E04180C04181C04181C081C1E080C263007C3C018127C911C>
I<0387800CC8400870E01070E020E0C020E00000E00000E00001C00001C00001C00001C0
00038100638100E38200C5820085840078780013127E9113>I<1C01802E03804E03804E
03808E07008E07001C07001C0700380E00380E00380E00380E00301C00301C00301C0038
3C001878000FB800003800003000007000E06000E0C0008180004300003C0000111A7C91
14>I<01C107E10FF6081C10080010002000400080010002000400080410042C0C73F841
F080E010127E9111>I E /Fm 10 58 df<03F0000E1C001C0E0018060038070070038070
0380700380700380F003C0F003C0F003C0F003C0F003C0F003C0F003C0F003C0F003C0F0
03C0F003C0F003C0F003C07003807003807003807807803807001806001C0E000E1C0003
F000121F7E9D17>48 D<008003800F80F380038003800380038003800380038003800380
03800380038003800380038003800380038003800380038003800380038007C0FFFE0F1E
7C9D17>I<03F0000C1C00100E00200700400780800780F007C0F803C0F803C0F803C020
07C00007C0000780000780000F00000E00001C0000380000700000600000C00001800003
00000600400C00401800401000803FFF807FFF80FFFF80121E7E9D17>I<03F0000C1C00
100E00200F00780F80780780780780380F80000F80000F00000F00001E00001C00007000
07F000003C00000E00000F000007800007800007C02007C0F807C0F807C0F807C0F00780
400780400F00200E00183C0007F000121F7E9D17>I<000600000600000E00000E00001E
00002E00002E00004E00008E00008E00010E00020E00020E00040E00080E00080E00100E
00200E00200E00400E00C00E00FFFFF0000E00000E00000E00000E00000E00000E00000E
0000FFE0141E7F9D17>I<1803001FFE001FFC001FF8001FE00010000010000010000010
000010000010000011F000161C00180E001007001007800003800003800003C00003C000
03C07003C0F003C0F003C0E00380400380400700200600100C0008380007E000121F7E9D
17>I<007C000182000701000E03800C0780180780380300380000780000700000700000
F1F000F21C00F40600F80700F80380F80380F003C0F003C0F003C0F003C0F003C07003C0
7003C07003803803803807001807000C0E00061C0001F000121F7E9D17>I<4000007FFF
E07FFFC07FFFC04000808001008001008002000004000004000008000010000010000020
0000200000600000600000E00000C00001C00001C00001C00001C00003C00003C00003C0
0003C00003C00003C00003C000018000131F7E9D17>I<03F0000C0C0010060030030020
01806001806001806001807001807803003E03003F06001FC8000FF00003F80007FC000C
7E00103F00300F806007806001C0C001C0C000C0C000C0C000C0C0008060018020010010
02000C0C0003F000121F7E9D17>I<03F0000E18001C0C00380600380700700700700380
F00380F00380F003C0F003C0F003C0F003C0F003C07007C07007C03807C0180BC00E13C0
03E3C0000380000380000380000700300700780600780E00700C002018001070000FC000
121F7E9D17>I E /Fn 22 107 df<FFFFFF80FFFFFF8019027D8A20>0
D<400020C000606000C03001801803000C0600060C0003180001B00000E00000E00001B0
00031800060C000C06001803003001806000C0C0006040002013147A9320>2
D<003F800000C46000030418000404040008040200100401002004008020040080400400
4040040040800400208004002080040020FFFFFFE0800400208004002080040020800400
20400400404004004020040080200400801004010008040200040404000304180000C460
00003F80001B1C7E9720>8 D<03C00FF01FF83FFC7FFE7FFEFFFFFFFFFFFFFFFF7FFE7F
FE3FFC1FF80FF003C010107E9115>15 D<FFFFFFE07FFFFFE00000000000000000000000
0000000000000000000000000000000000FFFFFFE0FFFFFFE00000000000000000000000
00000000000000000000000000000000007FFFFFE0FFFFFFE01B147E9320>17
D<00000030000000001800000000180000000018000000000C000000000C000000000600
0000000300000000038000000000C0FFFFFFFFF8FFFFFFFFF800000000C0000000038000
0000030000000006000000000C000000000C000000001800000000180000000018000000
00300025167E942A>33 D<00C00060000180003000018000300001800030000300001800
03000018000600000C000C000006001C000007003000000180FFFFFFFFF0FFFFFFFFF030
000001801C000007000C000006000600000C000300001800030000180001800030000180
003000018000300000C000600024167D942A>36 D<007FF801FFF80780000E0000180000
300000300000600000600000C00000C00000C00000FFFFF8FFFFF8C00000C00000C00000
6000006000003000003000001800000E000007800001FFF8007FF8151A7D961C>50
D<0000600000600000C00000C0000180000180000180000300000300000600000600000C
00000C0000180000180000180000300000300000600000600000C00000C0000180000180
000300000300000300000600000600000C00000C00001800001800003000003000003000
00600000600000C0000040000013287A9D00>54 D<C0C0C0C0C0C0E0E0C0C0C0C0C0C003
0E7E9000>I<400004C0000C600018600018600018300030300030300030180060180060
1FFFE00FFFC00C00C00C00C0060180060180030300030300030300018600018600018600
00CC0000CC0000CC00007800007800007800003000003000161E809C17>I<0004000C03
CC0C381818301C303C703E603660666066E067E067E0C7E0C7E0C7E187E187E187E307E3
07E307E607E607E60766066C067C0E3C0C380C18181C3033C03000300010237E9F15>59
D<00040000000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C00
00000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C00
00000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000FFFFFF
E0FFFFFFE01B1C7D9B21>63 D<00603F0001E1FF8007E30FC001EC07C001D803C001F803
C003F0038003E0038003E0070003E0040003C0180007C060000783C000078FF8000793FC
0007007E000F003E000F001F000F001F000E000F000E000F001E000F001C000E001C000E
003C001C00398018003BC0200077E0C00063FF0000C1FC00001A1E7F9C1B>66
D<003FFE0001FFFFC0071E1FE0081C03F0381C01F8703C00F8603C007CC03C007C003C00
3C0038003C0038003C0078003C0078003C00780038007000380070007800F0007000E000
6000E000E001E001C001C0018001C0020003C004000380180003806000070380000FFE00
001FF000001E1C809B20>68 D<0003F8000FFC00307C00603C00C03C0180300380200780
0007800007800007C00007E00003F80001FE00007C0000C0000300000600000C00001800
00380000700000700020F00060F001C0F80180FC02007E0C003FF0001FC000161E7F9C16
>I<000000001E000000007C00000000FC00020000FC00070001C0000F000100000F0002
00000F000200000F800200000F800400000B800400001B8004000013C004000013C00800
0011C008000011E008000021E010000020E010000020F010000020F01000004070200000
407820000040782000008038200000803C400000803C400001001E400001001E40000100
0FC00062000F80007E00078000FC00078000FC0003000078000000002722809F22>78
D<001000003800003800006C00006C00006C0000C60000C6000183000183000301800301
800600C00600C00600C00C00600C006018003018003030001830001830001860000C6000
0CC00006C00002171A7E981C>94 D<400000C00000C00000C00000C00000C00000C00000
C00000C00000C00000C00000C00000C00000FFFFE0FFFFF0C00000C00000C00000C00000
C00000C00000C00000C00000C00000C00000C00000C00000C00000400000141D7E9C19>
96 D<003C00E001C0018003800380038003800380038003800380038003800380038003
80030007001C00F0001C0007000300038003800380038003800380038003800380038003
8003800380018001C000E0003C0E297D9E15>102 D<F0001C0007000300038003800380
0380038003800380038003800380038003800380018001C000E0003C00E001C001800380
038003800380038003800380038003800380038003800380030007001C00F0000E297D9E
15>I<C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0C0C002297B9E0C>106 D E /Fo 87 128 df<FFFFF00F00F00F00300F00
100F00100F00180F00080F00080F00080F00000F00000F00000F00000F00000F00000F00
000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F8000FFF8
00151C7E9B1A>0 D<007E1F0001C1B1800303E3C00703C3C00E03C1800E01C0000E01C0
000E01C0000E01C0000E01C0000E01C000FFFFFC000E01C0000E01C0000E01C0000E01C0
000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0000E01C0
000E01C0000E01C0000E01C0007F87FC001A1D809C18>11 D<007E0001C1800301800703
C00E03C00E01800E00000E00000E00000E00000E0000FFFFC00E01C00E01C00E01C00E01
C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01
C07F87F8151D809C17>I<007FC001C1C00303C00703C00E01C00E01C00E01C00E01C00E
01C00E01C00E01C0FFFFC00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C00E
01C00E01C00E01C00E01C00E01C00E01C00E01C00E01C07FCFF8151D809C17>I<003F07
E00001C09C18000380F018000701F03C000E01E03C000E00E018000E00E000000E00E000
000E00E000000E00E000000E00E00000FFFFFFFC000E00E01C000E00E01C000E00E01C00
0E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E
00E01C000E00E01C000E00E01C000E00E01C000E00E01C000E00E01C007FC7FCFF80211D
809C23>I<60F0F0F0F0F0F0F060606060606060606060606060000000000060F0F06004
1E7C9D0C>33 D<6060F0F0F8F86868080808080808101010102020404080800D0C7F9C15
>I<00E000000310000006080000060800000E0800000E0800000E0800000E0800000E10
00000E1000000E2000000740000007403FE007800F8007800600038004000780040009C0
080011C0100030E0100020F0200060702000E0384000E03C8000E01C8000E00F0020E007
0020700780403009C0401830E1800FC03F001B1F7E9D20>38 D<60F0F868080808101020
4080050C7C9C0C>I<00800100020006000C000C00180018003000300030006000600060
006000E000E000E000E000E000E000E000E000E000E000E000E000600060006000600030
0030003000180018000C000C000600020001000080092A7C9E10>I<8000400020003000
180018000C000C0006000600060003000300030003000380038003800380038003800380
0380038003800380038003000300030003000600060006000C000C001800180030002000
40008000092A7E9E10>I<60F0F0701010101020204080040C7C830C>44
D<FFE0FFE00B0280890E>I<60F0F06004047C830C>I<00010003000600060006000C000C
000C0018001800180030003000300060006000C000C000C0018001800180030003000300
060006000C000C000C00180018001800300030003000600060006000C000C00010297E9E
15>I<03C00C301818300C300C700E60066006E007E007E007E007E007E007E007E007E0
07E007E007E007E00760066006700E300C300C18180C3007E0101D7E9B15>I<01000700
3F00C7000700070007000700070007000700070007000700070007000700070007000700
0700070007000700070007000700FFF80D1C7C9B15>I<07C01830201C400C400EF00FF8
0FF807F8077007000F000E000E001C001C00380070006000C00180030006010C01180110
023FFE7FFEFFFE101C7E9B15>I<07E01830201C201C781E780E781E381E001C001C0018
0030006007C00030001C001C000E000F000F700FF80FF80FF80FF00E401C201C183007C0
101D7E9B15>I<000C00000C00001C00003C00003C00005C0000DC00009C00011C00031C
00021C00041C000C1C00081C00101C00301C00201C00401C00C01C00FFFFC0001C00001C
00001C00001C00001C00001C00001C0001FFC0121C7F9B15>I<300C3FF83FF03FC02000
2000200020002000200023E02C303018301C200E000E000F000F000F600FF00FF00FF00F
800E401E401C2038187007C0101D7E9B15>I<00F0030C04040C0E181E301E300C700070
006000E3E0E430E818F00CF00EE006E007E007E007E007E007600760077006300E300C18
180C3003E0101D7E9B15>I<4000007FFF807FFF007FFF00400200800400800400800800
00100000100000200000600000400000C00000C00001C000018000018000038000038000
038000038000078000078000078000078000078000078000030000111D7E9B15>I<03E0
0C301008200C200660066006700670067C0C3E183FB01FE007F007F818FC307E601E600F
C007C003C003C003C00360026004300C1C1007E0101D7E9B15>I<03C00C301818300C70
0C600EE006E006E007E007E007E007E0076007700F300F18170C2707C700060006000E30
0C780C78187018203010C00F80101D7E9B15>I<60F0F0600000000000000000000060F0
F06004127C910C>I<60F0F0600000000000000000000060F0F070101010102020408004
1A7C910C>I<7FFFFFC0FFFFFFE000000000000000000000000000000000000000000000
00000000000000000000FFFFFFE07FFFFFC01B0C7E8F20>61 D<03000780078003000000
0000000000000000010001000200020002000200060004000C00180038007000E000E01E
E01EE01EE00E600430180FE00F1D7E9414>I<0FE03038401CE00EF00EF00EF00E000C00
1C0030006000C00080018001000100010001000100010000000000000000000000030007
80078003000F1D7E9C14>I<000600000006000000060000000F0000000F0000000F0000
00178000001780000037C0000023C0000023C0000043E0000041E0000041E0000080F000
0080F0000080F000010078000100780001FFF80002003C0002003C0002003C0004001E00
04001E000C001F000C000F001E001F00FF00FFF01C1D7F9C1F>65
D<FFFFC0000F0078000F003C000F001E000F000E000F000F000F000F000F000F000F000F
000F000E000F001E000F003C000F00F8000FFFF0000F003C000F001E000F000F000F0007
000F0007800F0007800F0007800F0007800F0007800F000F000F000F000F001E000F0078
00FFFFE000191C7F9B1D>I<001F808000E0618001801980070007800E0003801C000380
1C00018038000180780000807800008070000080F0000000F0000000F0000000F0000000
F0000000F0000000F0000000F0000000700000807800008078000080380000801C000100
1C0001000E000200070004000180080000E03000001FC000191E7E9C1E>I<FFFFC0000F
00F0000F003C000F000E000F0007000F0007000F0003800F0003C00F0001C00F0001C00F
0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001E00F0001C00F
0001C00F0003C00F0003800F0007800F0007000F000E000F001C000F007000FFFFC0001B
1C7E9B20>I<FFFFFC0F003C0F000C0F00040F00040F00060F00020F00020F01020F0100
0F01000F01000F03000FFF000F03000F01000F01000F01000F01010F00010F00020F0002
0F00020F00060F00060F000C0F003CFFFFFC181C7E9B1C>I<FFFFF80F00780F00180F00
080F00080F000C0F00040F00040F01040F01000F01000F01000F03000FFF000F03000F01
000F01000F01000F01000F00000F00000F00000F00000F00000F00000F00000F0000FFF8
00161C7E9B1B>I<001F808000E0618001801980070007800E0003801C0003801C000180
38000180780000807800008070000080F0000000F0000000F0000000F0000000F0000000
F0000000F000FFF0F0000F80700007807800078078000780380007801C0007801C000780
0E00078007000B800180118000E06080001F80001C1E7E9C21>I<FFF0FFF00F000F000F
000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000FFFFF000F000F000F000F000F000F000F000F000F000F000F000F000F
000F000F000F000F000F000F000F000F000F000F000F000F000F00FFF0FFF01C1C7F9B1F
>I<FFF00F000F000F000F000F000F000F000F000F000F000F000F000F000F000F000F00
0F000F000F000F000F000F000F000F000F000F00FFF00C1C7F9B0F>I<07FF80007C0000
3C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C00003C0000
3C00003C00003C00003C00003C00003C00003C00703C00F83C00F83C00F8380070780040
700030E0000F8000111D7F9B15>I<FFF01FE00F0007800F0006000F0004000F0008000F
0010000F0020000F0040000F0080000F0100000F0200000F0600000F0F00000F1780000F
2780000F43C0000F81E0000F01E0000F00F0000F0078000F0078000F003C000F003E000F
001E000F000F000F000F800F000FC0FFF03FF01C1C7F9B20>I<FFF8000F80000F00000F
00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F00000F
00000F00000F00000F00080F00080F00080F00180F00180F00100F00300F00700F01F0FF
FFF0151C7E9B1A>I<FF8000FF800F8000F8000F8000F8000BC00178000BC00178000BC0
01780009E002780009E002780008F004780008F004780008F00478000878087800087808
78000878087800083C107800083C107800083C107800081E207800081E207800081E2078
00080F407800080F40780008078078000807807800080780780008030078001C03007800
FF8307FF80211C7E9B26>I<FF001FF00F8003800FC001000BC0010009E0010008F00100
08F0010008780100083C0100083E0100081E0100080F0100080F8100080781000803C100
0801E1000801F1000800F1000800790008007D0008003D0008001F0008001F0008000F00
08000700080003001C000300FF8001001C1C7F9B1F>I<003F800000E0E0000380380007
001C000E000E001C0007003C00078038000380780003C0780003C0700001C0F00001E0F0
0001E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0700001C0780003C078
0003C0380003803C0007801C0007000E000E0007001C000380380000E0E000003F80001B
1E7E9C20>I<FFFF800F00E00F00780F003C0F001C0F001E0F001E0F001E0F001E0F001E
0F001C0F003C0F00780F00E00FFF800F00000F00000F00000F00000F00000F00000F0000
0F00000F00000F00000F00000F0000FFF000171C7E9B1C>I<003F800000E0E000038038
0007001C000E000E001C0007003C00078038000380780003C0780003C0700001C0F00001
E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0F00001E0700001C0780003
C0780003C0380003803C0E07801C1107000E208E0007205C0003A0780000F0E020003FE0
200000602000003060000038E000003FC000003FC000001F8000000F001B257E9C20>I<
FFFF00000F01E0000F0078000F003C000F001C000F001E000F001E000F001E000F001E00
0F001C000F003C000F0078000F01E0000FFF00000F01E0000F0070000F0078000F003C00
0F003C000F003C000F003C000F003C000F003C000F003C100F003C100F001C100F001C10
FFF00E20000003C01C1D7E9B1F>I<07E0801C1980300580300380600180E00180E00080
E00080E00080F00000F800007C00007FC0003FF8001FFE0007FF0000FF80000F800007C0
0003C00001C08001C08001C08001C0C00180C00180E00300D00200CC0C0083F800121E7E
9C17>I<7FFFFFC0700F01C0600F00C0400F0040400F0040C00F0020800F0020800F0020
800F0020000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000
000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000000F0000
001F800003FFFC001B1C7F9B1E>I<FFF01FF00F0003800F0001000F0001000F0001000F
0001000F0001000F0001000F0001000F0001000F0001000F0001000F0001000F0001000F
0001000F0001000F0001000F0001000F0001000F0001000F0001000F0001000700020007
8002000380040001C0040000E0180000706000000F80001C1D7F9B1F>I<FFE00FF01F00
03C01F0001800F0001000F000100078002000780020007C0020003C0040003C0040003E0
0C0001E0080001E0080000F0100000F0100000F810000078200000782000003C4000003C
4000003C4000001E8000001E8000001F8000000F0000000F000000060000000600000006
00001C1D7F9B1F>I<FFE1FFC0FF1F003E003C1E003C00180F001E00100F001E00100F00
1E001007801F002007801F002007801F002003C027804003C027804003C027804001E043
C08001E043C08001E043C08000F081E10000F081E10000F081E10000F900F300007900F2
00007900F200007E007E00003E007C00003E007C00003C003C00001C003800001C003800
00180018000008001000281D7F9B2B>I<FFF07FC00FC01E0007800C0007C0080003C010
0001E0200001F0200000F0400000788000007C8000003D0000003E0000001F0000000F00
00000F8000000F80000013C0000023E0000021E0000040F0000080F8000080780001007C
0002003E0002001E0006001F001F001F80FF807FF01C1C7F9B1F>I<FFF003FC0F8001E0
078000C007C0008003C0010003E0030001E0020000F0040000F8040000780800007C1800
003C1000003E2000001F2000000F4000000FC00000078000000780000007800000078000
00078000000780000007800000078000000780000007800000078000007FF8001E1C809B
1F>I<FEFEC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0C0C0C0C0C0FEFE07297C9E0C>91 D<08081010202040404040808080808080B0B0F8F8
787830300D0C7A9C15>I<FEFE0606060606060606060606060606060606060606060606
0606060606060606060606060606FEFE0729809E0C>I<1FC000307000783800781C0030
1C00001C00001C0001FC000F1C00381C00701C00601C00E01C40E01C40E01C40603C4030
4E801F870012127E9115>97 D<FC00001C00001C00001C00001C00001C00001C00001C00
001C00001C00001C00001C7C001D87001E01801C00C01C00E01C00601C00701C00701C00
701C00701C00701C00701C00601C00E01C00C01E018019070010FC00141D7F9C17>I<03
F80C0C181E301E700C6000E000E000E000E000E000E00060007002300218040C1803E00F
127F9112>I<001F80000380000380000380000380000380000380000380000380000380
00038003F3800E0B80180780300380700380600380E00380E00380E00380E00380E00380
E003806003807003803003801807800E1B8003E3F0141D7F9C17>I<07E00C301818300C
700E6006E006FFFEE000E000E000E00060007002300218040C1803E00F127F9112>I<00
F8018C071E061E0E0C0E000E000E000E000E000E00FFE00E000E000E000E000E000E000E
000E000E000E000E000E000E000E000E000E007FE00F1D809C0D>I<00038007C4C01C78
C0383880301800701C00701C00701C00701C003018003838001C700027C0002000002000
003000003FF8001FFF001FFF802003806001C0C000C0C000C0C000C06001803003001C0E
0007F800121C7F9215>I<FC00001C00001C00001C00001C00001C00001C00001C00001C
00001C00001C00001C7C001C87001D03001E03801C03801C03801C03801C03801C03801C
03801C03801C03801C03801C03801C03801C03801C0380FF9FF0141D7F9C17>I<18003C
003C0018000000000000000000000000000000FC001C001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C00FF80091D7F9C0C>I<00C001E001E000C00000
00000000000000000000000007E000E000E000E000E000E000E000E000E000E000E000E0
00E000E000E000E000E000E000E000E000E060E0F0C0F1C061803E000B25839C0D>I<FC
00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C0FE01C
07801C06001C0C001C10001C20001C40001CE0001DE0001E70001C78001C38001C3C001C
1C001C0E001C0F001C0F80FF9FE0131D7F9C16>I<FC001C001C001C001C001C001C001C
001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C00FF80091D7F9C0C>I<FC7E07E0001C838838001D019018001E01E01C001C01
C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C001C01C0
1C001C01C01C001C01C01C001C01C01C001C01C01C001C01C01C00FF8FF8FF8021127F91
24>I<FC7C001C87001D03001E03801C03801C03801C03801C03801C03801C03801C0380
1C03801C03801C03801C03801C03801C0380FF9FF014127F9117>I<03F0000E1C001806
00300300700380600180E001C0E001C0E001C0E001C0E001C0E001C06001807003803003
001806000E1C0003F00012127F9115>I<FC7C001D87001E01801C01C01C00E01C00E01C
00701C00701C00701C00701C00701C00701C00E01C00E01C01C01E01801D07001CFC001C
00001C00001C00001C00001C00001C00001C0000FF8000141A7F9117>I<03E0800E1980
180580380780700380700380E00380E00380E00380E00380E00380E00380700380700380
3807801807800E1B8003E380000380000380000380000380000380000380000380001FF0
141A7F9116>I<FCE01D381E781E781C301C001C001C001C001C001C001C001C001C001C
001C001C00FFC00D127F9110>I<1F9020704030C010C010E010F8007F803FE00FF000F8
80388018C018C018E010D0608FC00D127F9110>I<04000400040004000C000C001C003C
00FFE01C001C001C001C001C001C001C001C001C001C101C101C101C101C100C100E2003
C00C1A7F9910>I<FC1F801C03801C03801C03801C03801C03801C03801C03801C03801C
03801C03801C03801C03801C03801C07800C07800E1B8003E3F014127F9117>I<FF07E0
3C03801C01001C01000E02000E02000F060007040007040003880003880003C80001D000
01D00000E00000E00000E00000400013127F9116>I<FF3FC7E03C0703C01C0701801C07
01001C0B01000E0B82000E0B82000E1182000711C4000711C4000720C40003A0E80003A0
E80003C0680001C0700001C0700001803000008020001B127F911E>I<FF0FE01E07001C
06000E040007080003900003B00001E00000E00000F00001F000013800021C00041C000C
0E001807003C0780FE1FF014127F9116>I<FF07E03C03801C01001C01000E02000E0200
0F060007040007040003880003880003C80001D00001D00000E00000E00000E000004000
004000008000008000F08000F10000F30000660000380000131A7F9116>I<7FFC703860
38407040F040E041C003C0038007000F040E041C043C0C380870087038FFF80E127F9112
>I<FFFFF01401808B15>I<FFFFFFFFFF802901808B2A>I<6060F0F0F0F060600C047C9C
15>127 D E /Fp 56 123 df<003FC00001F0300003C0380007C07C000F807C000F807C
000F8038000F8000000F8000000F8000000F800000FFFFFC00FFFFFC000F807C000F807C
000F807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C000F807C
000F807C000F807C000F807C007FE1FF807FE1FF80191D809C1B>12
D<003FC1FE0001F03F818003C03E01C007C07E03E00F807C03E00F807C03E00F807C01C0
0F807C00000F807C00000F807C00000F807C0000FFFFFFFFE0FFFFFFFFE00F807C03E00F
807C03E00F807C03E00F807C03E00F807C03E00F807C03E00F807C03E00F807C03E00F80
7C03E00F807C03E00F807C03E00F807C03E00F807C03E00F807C03E07FE1FF0FFC7FE1FF
0FFC261D809C28>14 D<FFF8FFF8FFF8FFF80D04808A10>45 D<78FCFCFCFC7806067D85
0D>I<000180000380000380000700000700000700000E00000E00001C00001C00001C00
00380000380000380000700000700000E00000E00000E00001C00001C00001C000038000
0380000380000700000700000E00000E00000E00001C00001C00001C0000380000380000
700000700000700000E00000E00000C0000011297D9E18>I<03F8000F1E001C07003C07
803803807803C07803C07803C0F803E0F803E0F803E0F803E0F803E0F803E0F803E0F803
E0F803E0F803E0F803E0F803E07803C07803C03803803C07801C07000F1E0003F800131B
7E9A18>I<00600001E0000FE000FFE000F3E00003E00003E00003E00003E00003E00003
E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003E00003
E00003E00003E0007FFF807FFF80111B7D9A18>I<07F8001FFE00383F80780FC0FC07C0
FC07E0FC03E0FC03E07803E00007E00007C00007C0000F80001F00001E00003800007000
00E0000180600300600600600800E01FFFC03FFFC07FFFC0FFFFC0FFFFC0131B7E9A18>
I<07F8001FFE003C1F003C0F807C07C07E07C07C07C03807C0000F80000F80001E00003C
0003F800001E00000F800007C00007C00007E03007E07807E0FC07E0FC07E0FC07C0780F
80781F001FFE0007F800131B7E9A18>I<000180000380000780000F80001F80003F8000
6F8000CF80008F80018F80030F80060F800C0F80180F80300F80600F80C00F80FFFFF8FF
FFF8000F80000F80000F80000F80000F80000F8000FFF800FFF8151B7F9A18>I<380180
3FFF003FFE003FFC003FF8003FC00030000030000030000030000031F800361E00380F80
3007800007C00007E00007E00007E07807E0F807E0F807E0F807C0F007C0600F80381F00
1FFE0007F000131B7E9A18>I<007E0003FF000781800F03C01E07C03C07C07C03807800
00780000F80000F8F800FB0E00FA0780FC0380FC03C0F803E0F803E0F803E0F803E07803
E07803E07803C03C03C03C07801E0F0007FE0003F800131B7E9A18>I<6000007FFFE07F
FFE07FFFC07FFF807FFF80E00300C00600C00C00C0180000300000300000600000E00000
E00001E00001C00003C00003C00003C00003C00007C00007C00007C00007C00007C00007
C000038000131C7D9B18>I<03F8000FFE001E0F803807803803C07803C07C03C07E03C0
7F83803FC7003FFE001FFC000FFE0007FF001DFF80387FC0781FE0700FE0F003E0F001E0
F001E0F001E07801C07803803E07801FFE0003F800131B7E9A18>I<03F8000FFE001E0F
003C07807807807803C0F803C0F803C0F803E0F803E0F803E0F803E07807E03807E03C0B
E00E1BE003E3E00003E00003C00003C03807C07C07807C0700780F00383C001FF8000FE0
00131B7E9A18>I<00038000000380000007C0000007C0000007C000000FE000000FE000
001FF000001BF000003BF8000031F8000031F8000060FC000060FC0000E0FE0000C07E00
00C07E0001803F0001FFFF0003FFFF8003001F8007001FC006000FC006000FC00C0007E0
0C0007E0FF803FFEFF803FFE1F1C7E9B24>65 D<001FE02000FFF8E003F80FE007C003E0
0F8001E01F0000E03E0000E03E0000607E0000607C000060FC000000FC000000FC000000
FC000000FC000000FC000000FC000000FC0000007C0000607E0000603E0000603E0000C0
1F0000C00F80018007C0030003F80E0000FFFC00001FE0001B1C7D9B22>67
D<FFFFF800FFFFFF000FC01FC00FC007E00FC001F00FC001F80FC000F80FC000FC0FC000
7C0FC0007C0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC0007E0FC000
7E0FC0007C0FC0007C0FC0007C0FC000F80FC000F80FC001F00FC007E00FC01FC0FFFFFF
00FFFFF8001F1C7E9B25>I<FFFFFF00FFFFFF000FC01F000FC007000FC003000FC00380
0FC003800FC0C1800FC0C1800FC0C1800FC1C0000FC3C0000FFFC0000FFFC0000FC3C000
0FC1C0000FC0C0000FC0C0600FC0C0600FC000E00FC000C00FC000C00FC001C00FC001C0
0FC003C00FC00F80FFFFFF80FFFFFF801B1C7E9B1F>I<FFFFFF00FFFFFF000FC01F000F
C007000FC003000FC003800FC003800FC001800FC0C1800FC0C1800FC0C0000FC1C0000F
C3C0000FFFC0000FFFC0000FC3C0000FC1C0000FC0C0000FC0C0000FC0C0000FC000000F
C000000FC000000FC000000FC000000FC00000FFFE0000FFFE0000191C7E9B1E>I<FFFC
3FFFFFFC3FFF0FC003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC0
03F00FC003F00FC003F00FFFFFF00FFFFFF00FC003F00FC003F00FC003F00FC003F00FC0
03F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F00FC003F0FFFC3FFFFFFC
3FFF201C7E9B25>72 D<FFFCFFFC0FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC0
0FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC0FFFCFFFC0E1C7E9B12>
I<FFFE00FFFE000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0
000FC0000FC0000FC0000FC0000FC0000FC0030FC0030FC0030FC0070FC0070FC0060FC0
0E0FC01E0FC07EFFFFFEFFFFFE181C7E9B1D>76 D<FFC00003FFFFE00007FF0FE00007F0
0DF0000DF00DF0000DF00DF0000DF00CF80019F00CF80019F00C7C0031F00C7C0031F00C
3E0061F00C3E0061F00C1F00C1F00C1F00C1F00C1F00C1F00C0F8181F00C0F8181F00C07
C301F00C07C301F00C03E601F00C03E601F00C01FC01F00C01FC01F00C01FC01F00C00F8
01F00C00F801F0FFC0701FFFFFC0701FFF281C7E9B2D>I<FFE003FFFFE003FF0FF00030
0FF800300DFC00300CFE00300C7E00300C3F00300C1F80300C1FC0300C0FE0300C07F030
0C03F0300C01F8300C01FC300C00FE300C007F300C003F300C001FB00C001FF00C000FF0
0C0007F00C0003F00C0001F00C0000F00C0000F0FFC00070FFC00030201C7E9B25>I<00
3FE00001F07C0003C01E000F800F801F0007C01E0003C03E0003E07E0003F07C0001F07C
0001F0FC0001F8FC0001F8FC0001F8FC0001F8FC0001F8FC0001F8FC0001F8FC0001F87C
0001F07E0003F07E0003F03E0003E03F0007E01F0007C00F800F8003C01E0001F07C0000
3FE0001D1C7D9B24>I<FFFFF800FFFFFE000FC03F800FC00F800FC007C00FC007E00FC0
07E00FC007E00FC007E00FC007E00FC007C00FC007C00FC00F800FC03F000FFFFC000FC0
00000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC000000FC0
00000FC00000FFFC0000FFFC00001B1C7E9B21>I<FFFFF00000FFFFFE00000FC03F0000
0FC00F80000FC007C0000FC007E0000FC007E0000FC007E0000FC007E0000FC007E0000F
C007C0000FC00F80000FC03E00000FFFF000000FC07C00000FC03E00000FC03F00000FC0
1F80000FC01F80000FC01F80000FC01F80000FC01F80000FC01F80000FC01F81800FC01F
81800FC00FC180FFFC07C300FFFC01FE00211C7E9B24>82 D<07F8201FFEE03C07E07801
E07000E0F000E0F00060F00060F80000FE0000FFE0007FFE003FFF003FFF800FFFC007FF
E0007FE00003F00001F00000F0C000F0C000F0C000E0E000E0F001C0FC03C0EFFF0083FC
00141C7D9B1B>I<7FFFFFE07FFFFFE0781F81E0701F80E0601F8060E01F8070C01F8030
C01F8030C01F8030C01F8030001F8000001F8000001F8000001F8000001F8000001F8000
001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000001F8000
001F800007FFFE0007FFFE001C1C7E9B21>I<FFFC03FFFFFC03FF0FC000300FC000300F
C000300FC000300FC000300FC000300FC000300FC000300FC000300FC000300FC000300F
C000300FC000300FC000300FC000300FC000300FC000300FC000300FC0003007C0003007
C0006003E000E001F001C000FC0780007FFE00000FF800201C7E9B25>I<0FF8001C1E00
3E0F803E07803E07C01C07C00007C0007FC007E7C01F07C03C07C07C07C0F807C0F807C0
F807C0780BC03E13F80FE1F815127F9117>97 D<FF0000FF00001F00001F00001F00001F
00001F00001F00001F00001F00001F00001F3F801FE1E01F80701F00781F003C1F003C1F
003E1F003E1F003E1F003E1F003E1F003E1F003C1F003C1F00781F80701EC1E01C3F0017
1D7F9C1B>I<03FC000E0E001C1F003C1F00781F00780E00F80000F80000F80000F80000
F80000F800007800007801803C01801C03000E0E0003F80011127E9115>I<000FF0000F
F00001F00001F00001F00001F00001F00001F00001F00001F00001F001F9F00F07F01C03
F03C01F07801F07801F0F801F0F801F0F801F0F801F0F801F0F801F07801F07801F03C01
F01C03F00F0FFE03F9FE171D7E9C1B>I<03FC000F07001C03803C01C07801C07801E0F8
01E0F801E0FFFFE0F80000F80000F800007800007800603C00601E00C00F038001FC0013
127F9116>I<007F0001E38003C7C00787C00F87C00F83800F80000F80000F80000F8000
0F8000FFF800FFF8000F80000F80000F80000F80000F80000F80000F80000F80000F8000
0F80000F80000F80000F80000F80007FF0007FF000121D809C0F>I<03F0F00E1F383C0F
383807307807807807807807807807803807003C0F001E1C0033F0003000003000003000
003FFF003FFFC01FFFE01FFFF07801F8F00078F00078F000787000707800F01E03C007FF
00151B7F9118>I<FF0000FF00001F00001F00001F00001F00001F00001F00001F00001F
00001F00001F0FC01F31E01F40F01F80F81F80F81F00F81F00F81F00F81F00F81F00F81F
00F81F00F81F00F81F00F81F00F81F00F8FFE7FFFFE7FF181D7F9C1B>I<1E003F003F00
3F003F001E000000000000000000000000007F007F001F001F001F001F001F001F001F00
1F001F001F001F001F001F001F00FFC0FFC00A1E7F9D0E>I<FF0000FF00001F00001F00
001F00001F00001F00001F00001F00001F00001F00001F03FC1F03FC1F01C01F03001F0E
001F1C001F38001F78001FFC001FBE001F1F001F0F001F0F801F07C01F03E01F01E0FFE7
FEFFE7FE171D7F9C19>107 D<FF00FF001F001F001F001F001F001F001F001F001F001F
001F001F001F001F001F001F001F001F001F001F001F001F001F001F001F00FFE0FFE00B
1D7F9C0E>I<FF0FC07E00FF31E18F001F40F207801F80FC07C01F80FC07C01F00F807C0
1F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F00F807C01F
00F807C01F00F807C01F00F807C0FFE7FF3FF8FFE7FF3FF825127F9128>I<FF0FC0FF31
E01F40F01F80F81F80F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00
F81F00F81F00F8FFE7FFFFE7FF18127F911B>I<01FC000F07801C01C03C01E07800F078
00F0F800F8F800F8F800F8F800F8F800F8F800F87800F07800F03C01E01E03C00F078001
FC0015127F9118>I<FF3F80FFE1E01F80F01F00781F007C1F003C1F003E1F003E1F003E
1F003E1F003E1F003E1F003C1F007C1F00781F80F01FC1E01F3F001F00001F00001F0000
1F00001F00001F0000FFE000FFE000171A7F911B>I<03F0600F0CE01E07E03C03E07C03
E07803E0F803E0F803E0F803E0F803E0F803E0F803E07803E07C03E03C03E01C07E00E0F
E003F3E00003E00003E00003E00003E00003E00003E0001FFC001FFC161A7E9119>I<FE
3E00FE47001E8F801E8F801E8F801F07001F00001F00001F00001F00001F00001F00001F
00001F00001F00001F0000FFE000FFE00011127F9114>I<1FD830786018E018E018F000
FF807FE07FF01FF807FC007CC01CC01CE01CE018F830CFC00E127E9113>I<0300030003
000300070007000F000F003FFCFFFC1F001F001F001F001F001F001F001F001F001F0C1F
0C1F0C1F0C0F08079803F00E1A7F9913>I<FF07F8FF07F81F00F81F00F81F00F81F00F8
1F00F81F00F81F00F81F00F81F00F81F00F81F00F81F00F81F01F80F01F80786FF01F8FF
18127F911B>I<FFC1FCFFC1FC1F00601F80600F80C00F80C007C18007C18003E30003E3
0003F70001F60001FE0000FC0000FC0000780000780000300016127F9119>I<FF8FF8FE
FF8FF8FE1F03E0301F03E0301F03E0300F87F0600F86F0600FC6F8E007CC78C007CC78C0
03FC7D8003F83D8003F83F8001F01F0001F01F0000F01E0000E00E0000E00E001F127F91
22>I<FFC7FCFFC7FC1F81C00F838007C70003EE0001FC0001F80000F800007C0000FE00
01DF00039F80070F800607C00C03E0FF07FCFF07FC16127F9119>I<FFC1FCFFC1FC1F00
601F80600F80C00F80C007C18007C18003E30003E30003F70001F60001FE0000FC0000FC
00007800007800003000003000006000706000F8E000F8C000F980007300003E0000161A
7F9119>I<7FFF80781F00703F00603E00607C0060FC0060F80001F00003F00007E00007
C1800F81801F81801F03803E03007E07007C0F00FFFF0011127F9115>I
E /Fq 8 117 df<70F8F8F87005057D840B>46 D<00060000000F0000000F0000001F80
00001F8000003FC0000037C0000037C0000063E0000063E00000C3F00000C1F00001C1F8
000180F8000180F80003FFFC0003FFFC0006003E0006003E000E003F000C001F00FF80FF
F0FF80FFF01C177F961F>65 D<0FE0003838003C1C003C1E00181E00001E0000FE000F9E
003C1E00781E00F01E00F01E00F01E00786FC01F87C0120F7F8E14>97
D<FC0000FC00003C00003C00003C00003C00003C00003C00003DFC003F0F003C03803C03
C03C01C03C01E03C01E03C01E03C01E03C01E03C01C03C03C03C03803B0F0031F8001317
7E9617>I<07F81C0E381E781E700CF000F000F000F000F0007000780038061C0C07F80F
0F7F8E12>I<F870F99C3A3C3A3C3C183C003C003C003C003C003C003C003C00FF80FF80
0E0F7F8E11>114 D<1FF060704030C030E000FF007FE03FF00FF80078C018C018E010F0
20CFC00D0F7F8E10>I<0C000C000C000C001C001C003FE0FFE03C003C003C003C003C00
3C003C003C303C303C303C301E6007C00C157F9410>I E /Fr 41
122 df<18387838081010204080050A7E830B>44 D<FFFE08027D870D>I<3078F0600504
7D830B>I<01E006300C1018101010301030106030603060306030C060C060C060C040C0
C080808180C10046003C000C157B9412>48 D<004000C000C003801D8001800180030003
000300030006000600060006000C000C000C000C001800FF800A157C9412>I<00F00308
040C0904090611061106220C240C18180030006000C00300040018002004200C7C18C7F0
81E00F157D9412>I<00F8010C02060506090609060A040E0C0018007003E00030001000
1000186030E030C020806041803F000F157D9412>I<000C000C000C0018001800180030
003000600060004000C001800118021806300430083010307F6080FE0060006000C000C0
00C000800F1B7F9412>I<060C07F807F008800800080008001000178018601060007000
7000706070F0E0E0E080C0818043003C000E157C9412>I<00F0030806080C3818381000
30003000678068C07040E060C060C060C060C0C0C0C0C080C10042003C000D157B9412>
I<13822F8438CC60784018801080200020004000C0008001800180030003000300060006
0006000C000C000F157B9412>I<00F8010C060604060C060C060E0C0F1807B003C007F0
0CF83078601C601CC018C018C010602030C01F000F157D9412>I<00E0031006080C0818
0818081818301830183038103818F00730003000600060E0C0E0808100860078000D157C
9412>I<03FFF000E03800E01C00E00C00E00C01C00C01C01C01C01C01C03803807003FF
C003FFE00380700700300700380700380700380E00700E00700E00E00E01C01C0380FFFE
0016177E9619>66 D<03FFFE00E00E00E00400E00400E00401C00401C00401C08001C080
03810003830003FF000383000702000702000702000700000E00000E00000E00000E0000
1C0000FFC00017177E9617>70 D<003F0400E0880380580600380C00381C001038001030
0010700010600000E00000E00000E00000C01FF8C001C0C001C0C001C0E00380E0038060
0380300780181B0007E10016177A961C>I<07FE00E000E000E000E001C001C001C001C0
038003800380038007000700070007000E000E000E000E001C00FF800F177E960E>73
D<001F8000E0C00180600300300600380C00381C00181800183800383000387000387000
38700038700070E00070E000E06000E07001C0700380300300380E001C180007E0001517
7B961B>79 D<03FFE000E03800E01C00E00C00E00C01C01C01C01C01C01C01C038038070
0380E003FF800380000700000700000700000700000E00000E00000E00000E00001C0000
FF800016177E9618>I<001F8000E0C00180600300300600380C00381C00381800383800
38300038700038700038700038600070E00070E000E06000E06001C071E1803223003A1E
001E180007F0400010400030C0003180003F80001F00001E00151D7B961B>I<03FFE000
E03800E01C00E01C00E01C01C01C01C01C01C01C01C0380380700381C003FF0003818007
00C00700E00700E00700E00E01C00E01C00E01C20E01C21C00C4FF807817177E961A>I<
007C400182800301800601800601800C01000C01000E00000E00000FC00007F80003FC00
007C00000E00000E00000600200600400C00400C00600800601000D8600087C00012177D
9614>I<7FC1FC1C00601C00401C00401C00403800803800803800803800807001007001
00700100700100E00200E00200E00200E00200E00400E00800E008006030003040001F80
00161779961A>85 D<03900C70187030303060606060606060C0C0C0C840C841C862D01C
700D0E7C8D12>97 D<07C00C6030E020E06000C000C000C00080008000C020C04061803E
000B0E7C8D10>99 D<003E000C000C000C000C001800180018001803B00C701870303030
60606060606060C0C0C0C840C841C862D01C700F177C9612>I<07801840302060206040
FF80C000C000C000C000C020C04061803E000B0E7C8D10>I<001C0036003E006C006000
60006000C000C007F800C000C000C0018001800180018001800300030003000300020006
0006006600E400C80070000F1D81960B>I<01C4063C0C1C181C18183018301830182030
20302030307011E00E600060006060C0E0C0C3807E000E147E8D10>I<03070600000000
0000182C4C4C8C18181830326264243808177D960B>105 D<3E0C0C0C0C181818183030
303060606060C0C8C8C8D06007177D9609>108 D<3078498C4E044C049C0C180C180C18
0C30183019303130316012601C100E7D8D14>110 D<078018C0304060606060C060C060
C06080C080C08180C10046003C000B0E7B8D12>I<30F04B184E384C3098001800180018
003000300030003000600060000D0E7D8D0F>114 D<07800C4018E018E038001E001F80
07C000C060C0E0C0C180C3003E000B0E7D8D0F>I<060006000C000C000C000C00FF8018
0018001800300030003000300060006100610062006400380009147D930C>I<38042C0C
4C0C4C0C8C18181818181818303030323032307218B40F1C0F0E7D8D13>I<38102C184C
184C188C10181018101810302030203040304018800F000D0E7D8D10>I<3804104C0C18
4C0C184C0C188C1810181810181810181810303020303020303020103040185880078F00
150E7D8D18>I<0E3C1346218E218C430003000300030006000608C608E610CA2071C00F
0E7E8D10>I<38042C0C4C0C4C0C8C18181818181818303030303030307018E00F600060
00C0E0C0E18043003C000E147D8D11>I E /Fs 17 90 df<00600000600000600000F000
00F00001F800013800013800021C00021C00021C00040E00040E0007FE00080700080700
180780100380380380FC0FF014147F9318>65 D<FFFC001C07001C03801C01C01C01C01C
01C01C01C01C03801C07001FFE001C07001C03801C01C01C01C01C01C01C01C01C01C01C
03801C0700FFFC001214809316>I<01F080060D801C0380180180300180700080600080
E00000E00000E00000E00000E00000E000006000807000803000801801001C0200060C00
01F00011147E9317>I<FFFF001C07001C01001C01001C00801C00801C10801C10001C30
001FF0001C30001C10001C10401C00401C00401C00C01C00801C01801C0380FFFF801214
7F9316>69 D<FF9FF01C03801C03801C03801C03801C03801C03801C03801C03801FFF80
1C03801C03801C03801C03801C03801C03801C03801C03801C0380FF9FF014147F9318>
72 D<FF801C001C001C001C001C001C001C001C001C001C001C001C001C001C001C001C
001C001C00FF8009147F930C>I<0FF800E000E000E000E000E000E000E000E000E000E0
00E000E000E000E060E0F0E0F0C061803F000D14809310>I<FFC0001C00001C00001C00
001C00001C00001C00001C00001C00001C00001C00001C00001C00801C00801C00801C01
801C01001C03001C0700FFFF001114809314>76 D<FE003F801E003C001E003C0017005C
0017005C0013809C0013809C0013809C0011C11C0011C11C0011C11C0010E21C0010E21C
0010741C0010741C0010741C0010381C0010381C0038381C00FE10FF8019147F931D>I<
FC07F01E01C01E008017008013808013C08011C08010E08010F080107080103880101C80
101C80100E80100780100780100380100180380180FE008014147F9318>I<01F000060C
001C07003803803001807001C06000C0E000E0E000E0E000E0E000E0E000E0E000E06000
C07001C03001803803801C07000E0E0001F00013147E9319>I<FFF8001C0E001C07001C
03801C03801C03801C03801C03801C07001C0E001FF8001C00001C00001C00001C00001C
00001C00001C00001C0000FF800011147F9316>I<FFF8001C0E001C07001C03801C0380
1C03801C03801C07001C0E001FF8001C0C001C0E001C07001C07001C07001C07001C0708
1C07081C0398FF81F01514809317>82 D<1F1020F04030C030C010C010E000F0007F003F
C01FE001E000700030803080308030C060F0408F800C147E9312>I<7FFFC060E0C040E0
4040E04080E02080E02080E02000E00000E00000E00000E00000E00000E00000E00000E0
0000E00000E00000E00000E0000FFE0013147F9317>I<FF87F01C01C01C00801C00801C
00801C00801C00801C00801C00801C00801C00801C00801C00801C00801C00801C00800E
010006020003040000F80014147F9318>I<FF81FC1E00600E0040070040078080038180
03C10001E20000E20000F400007C00003800003800003800003800003800003800003800
00380001FF001614809318>89 D E /Ft 10 117 df<FFFFF00FFFFFFFFFF00FFFFFFFFF
F00FFFFF03FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC
00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC
00003FC003FC00003FC003FC00003FC003FC00003FC003FFFFFFFFC003FFFFFFFFC003FF
FFFFFFC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC
00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC
00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC003FC00003FC0FFFF
F00FFFFFFFFFF00FFFFFFFFFF00FFFFF30297EA835>72 D<00FF806003FFF0E00FFFF8E0
1F80FDE03F001FE03E0007E07C0003E07C0003E0FC0001E0FC0001E0FC0000E0FE0000E0
FE0000E0FF000000FFC000007FFC00007FFFE0003FFFF8001FFFFE001FFFFF0007FFFF80
03FFFFC000FFFFC0000FFFE000007FE000001FF000000FF0000007F0E00003F0E00003F0
E00003F0E00003F0F00003E0F00003E0F80007E0FC0007C0FF000F80FFE03F80E3FFFE00
E1FFFC00C01FF0001C297CA825>83 D<03FF80000FFFF0001F01FC003F80FE003F807F00
3F803F003F803F801F003F8000003F8000003F8000003F8000003F80003FFF8001FC3F80
0FE03F801F803F803F003F807E003F80FC003F80FC003F80FC003F80FC003F80FC005F80
7E00DF803F839FFC1FFE0FFC03FC03FC1E1B7E9A21>97 D<003FC00001FFF00003E07C00
0F803E001F801F001F001F003F000F807E000F807E000FC07E000FC0FE0007C0FE0007C0
FFFFFFC0FFFFFFC0FE000000FE000000FE0000007E0000007E0000007F0000003F0001C0
1F0001C00F80038007C0070003F01E0000FFFC00003FE0001A1B7E9A1F>101
D<07000F801FC03FE03FE03FE01FC00F8007000000000000000000000000000000FFE0FF
E0FFE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00F
E00FE00FE00FE00FE0FFFEFFFEFFFE0F2B7EAA12>105 D<FFE00000FFE00000FFE00000
0FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE000000FE00000
0FE000000FE000000FE000000FE01FFC0FE01FFC0FE01FFC0FE007800FE00F000FE01E00
0FE03C000FE078000FE0E0000FE3C0000FE7C0000FEFE0000FFFF0000FFFF8000FF3F800
0FE1FC000FC0FE000FC07F000FC07F000FC03F800FC01FC00FC00FE00FC00FE00FC007F0
FFFC1FFFFFFC1FFFFFFC1FFF202A7FA923>107 D<FFE0FFE0FFE00FE00FE00FE00FE00F
E00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00F
E00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE00FE0FFFEFFFEFFFE0F2A7E
A912>I<FFC07E00FFC1FF80FFC30FC00FC40FE00FC807E00FD807F00FD007F00FD007F0
0FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F0
0FE007F00FE007F00FE007F00FE007F00FE007F00FE007F00FE007F0FFFE3FFFFFFE3FFF
FFFE3FFF201B7D9A25>110 D<03FE300FFFF03E03F07800F07000F0F00070F00070F800
70FE0000FFE0007FFF007FFFC03FFFE01FFFF007FFF800FFF80007FC0000FCE0007CE000
3CF0003CF00038F80038FC0070FF01E0E7FFC0C1FF00161B7E9A1B>115
D<00E00000E00000E00000E00001E00001E00001E00003E00003E00007E0000FE0001FFF
E0FFFFE0FFFFE00FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0000FE0
000FE0000FE0000FE0000FE0700FE0700FE0700FE0700FE0700FE0700FE07007F0E003F0
C001FF80007F0014267FA51A>I E /Fu 5 92 df<FFFFC0FFFFC012027D871A>0
D<003F800000FFE00003C0780007001C000C000600180003003000018030000180600000
C0600000C0C0000060C0000060C0000060C0000060C0000060C0000060600000C0600000
C03000018030000180180003000C00060007001C0003C0780000FFE000003F80001B1A7E
9321>13 D<040E0E1C1C1C38383070706060C0C0070F7F8F0A>48
D<00400000C00000C00000C00000C00000C00000C00000C00000C00000C00000C00000C0
0000C00000C00000C00000C00000C00000C000FFFFE0FFFFE013147D931A>63
D<4001C003C003C003C003C003C003C003C003C003C003C003C0036006381C1FF807E010
117E9016>91 D E /Fv 10 100 df<0C001C00EC000C000C000C000C000C000C000C000C
000C000C000C000C000C000C000C00FFC00A137D9211>49 D<1F0060C06060F070F03060
3000700070006000C001C00180020004000810101020207FE0FFE00C137E9211>I<0FC0
30707038703870380038003000E00FC0007000380018001C601CF01CF018E03860701FC0
0E137F9211>I<006000E000E00160026006600C600860106020606060C060FFFC006000
6000600060006003FC0E137F9211>I<60607FC07F8044004000400040004F0070C040E0
006000700070E070E070E06040E021C01F000C137E9211>I<07C00C2010702070600060
00C000CF00D0C0E060C020C030C030C03040306020206010C00F000C137E9211>I<4000
7FFC7FF8401080308020004000800100010003000200060006000E000E000E000E000E00
04000E147E9311>I<0FC0107020186018601870183C303F600F800FE031F06078C01CC0
0CC00CC00C601830300FC00E137F9211>I<0F00308060404060C020C030C030C0304030
607030B00F30003000200060E040E08041003E000C137E9211>I<0FE0187020706020C0
00C000C000C000C0006000201018200FC00C0D7F8C0F>99 D E /Fw
67 124 df<00FCF807839C0E079C1C07081C07001C07001C07001C07001C0700FFFFE01C
07001C07001C07001C07001C07001C07001C07001C07001C07001C07001C07001C07007F
1FE01617809615>11 D<00FC000782000E07001C07001C02001C00001C00001C00001C00
00FFFF001C07001C07001C07001C07001C07001C07001C07001C07001C07001C07001C07
001C07007F1FC01217809614>I<60F0F0F0F0F06060606060606060600000000060F0F0
6004177D960A>33 D<60C0F1E0F1E070E01020102020402040408040800B0A7F9612>I<
60F0F070101020204040040A7D960A>39 D<0102040C1818303070606060E0E0E0E0E0E0
E0E0E0E060606070303018180C04020108227D980E>I<8040203018180C0C0E06060607
0707070707070707070606060E0C0C18183020408008227E980E>I<60F0F07010102020
4040040A7D830A>44 D<FF80FF80090280870C>I<60F0F06004047D830A>I<0008001800
300030003000600060006000C000C000C0018001800180030003000600060006000C000C
000C00180018001800300030003000600060006000C000C0000D217E9812>I<06000E00
FE000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E000E00
FFE00B157D9412>49 D<0F8030E040708030C038E0384038003800700070006000C00180
030006000C08080810183FF07FF0FFF00D157E9412>I<0FE030306018701C701C001C00
180038006007E000300018000C000E000EE00EE00EC00C401830300FE00F157F9412>I<
00300030007000F001F001700270047008701870107020704070C070FFFE007000700070
0070007003FE0F157F9412>I<60307FE07FC0440040004000400040004F8070E0407000
30003800384038E038E0388030406020C01F000D157E9412>I<01F00608080C181C301C
70006000E000E3E0EC30F018F00CE00EE00EE00E600E600E300C3018183007C00F157F94
12>I<40007FFE7FFC7FF8C008801080200040008000800100030003000200060006000E
000E000E000E000E0004000F167E9512>I<07E018302018600C600C700C78183E101F60
07C00FF018F8607C601EC00EC006C006C004600C38300FE00F157F9412>I<07C0183030
186018E00CE00CE00EE00EE00E601E301E186E0F8E000E000C001C70187018603020E01F
800F157F9412>I<60F0F06000000000000060F0F060040E7D8D0A>I<60F0F06000000000
000060F0F07010102020404004147D8D0A>I<00FC000303000C00C01000202078102184
104302084701C88601C48E01C48E01C48E01C48E01C48E01C48601C44701C44303C42184
C82078701000000C001C0300F000FF0016177E961B>64 D<001000003800003800003800
005C00005C00005C00008E00008E00008E0001070001070002038002038002038007FFC0
0401C00401C00800E00800E01800F03800F0FE03FE17177F961A>I<FFFE001C03801C00
E01C00601C00701C00701C00701C00701C00E01C01C01FFF801FFFC01C00E01C00701C00
301C00381C00381C00381C00381C00701C00E01C01C0FFFF0015177F9619>I<00FC1003
83300E00B01C0070380030300030700010600010E00010E00000E00000E00000E00000E0
0000E000106000107000103000203800201C00400E008003830000FC0014177E9619>I<
FFFFE01C00E01C00601C00201C00101C00101C00101C04001C04001C04001C0C001FFC00
1C0C001C04001C04081C04081C00081C00181C00101C00101C00301C00F0FFFFF015177F
9618>69 D<FF83FE1C00701C00701C00701C00701C00701C00701C00701C00701C00701C
00701FFFF01C00701C00701C00701C00701C00701C00701C00701C00701C00701C0070FF
83FE17177F961A>72 D<FFE00E000E000E000E000E000E000E000E000E000E000E000E00
0E000E000E000E000E000E000E000E000E00FFE00B177F960D>I<FF80FE1C00781C0060
1C00401C00801C01001C06001C08001C10001C38001C78001C9C001D0E001E0E001C0700
1C03801C01C01C01C01C00E01C00701C00781C007CFF80FF18177F961B>75
D<FFC0001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00001C00
001C00001C00001C00201C00201C00201C00601C00601C00401C00C01C03C0FFFFC01317
7F9616>I<FE0003F81E0003C0170005C0170005C0170005C0138009C0138009C011C011
C011C011C011C011C010E021C010E021C0107041C0107041C0107041C0103881C0103881
C0101D01C0101D01C0100E01C0100E01C0380E01C0FE040FF81D177F9620>I<FC00FE1E
00381F001017001013801011C01011C01010E010107010103810103810101C10100E1010
0F101007101003901001D01001D01000F0100070100030380030FE001017177F961A>I<
FFFE001C03801C00C01C00601C00701C00701C00701C00701C00601C00C01C03801FFE00
1C00001C00001C00001C00001C00001C00001C00001C00001C00001C0000FF800014177F
9618>80 D<0FC4302C601C400CC004C004C004E00070007F003FE00FF801FC001C000E00
06800680068006C004E008D81087E00F177E9614>83 D<7FFFF860381840380840380880
380480380480380400380000380000380000380000380000380000380000380000380000
380000380000380000380000380000380003FF8016177F9619>I<FF07FC3F803C00E00E
001C00E004001C00E004001C017004000E017008000E017008000E023808000702381000
070238100007041C100003841C200003841C200003880E200001C80E400001C80E400001
D007400000F007800000F007800000F007800000E0038000006003000000600300002117
7F9624>87 D<FCFCC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0
C0FCFC06217D980A>91 D<204020404080408081008100E1C0F1E0F1E060C00B0A7B9612
>I<FCFC0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0CFCFC06
2180980A>I<3FC0706070302038003803F81E3830387038E039E039E07970FF1F1E100E
7F8D12>97 D<F8000038000038000038000038000038000038000038000038000039F000
3E0C00380600380700380300380380380380380380380380380300380700380600361C00
21F00011177F9614>I<07F01838303870106000E000E000E000E0006000700830081830
07C00D0E7F8D10>I<003E00000E00000E00000E00000E00000E00000E00000E00000E00
07CE001C3E00300E00700E00600E00E00E00E00E00E00E00E00E00600E00700E00301E00
182E0007CF8011177F9614>I<0FC0186030307038E018FFF8E000E000E0006000700830
10183007C00D0E7F8D10>I<03E006700E701C201C001C001C001C001C00FF801C001C00
1C001C001C001C001C001C001C001C001C001C007F800C1780960B>I<0F9E18E3306070
7070707070306018C02F80200060003FE03FF83FFC600EC006C006C006600C38380FE010
157F8D12>I<F8000038000038000038000038000038000038000038000038000038F800
3B1C003C0E00380E00380E00380E00380E00380E00380E00380E00380E00380E00380E00
FE3F8011177F9614>I<307878300000000000F8383838383838383838383838FE07177F
960A>I<0300078007800300000000000000000000001F80038003800380038003800380
0380038003800380038003800380038003804380E300E7007C00091D82960B>I<F80038
003800380038003800380038003800383E383838303840388039803FC039E038E038F038
78383C383CFE7F10177F9613>I<F8383838383838383838383838383838383838383838
FE07177F960A>I<F8F83E003B1CC7003C0F0380380E0380380E0380380E0380380E0380
380E0380380E0380380E0380380E0380380E0380380E0380FE3F8FE01B0E7F8D1E>I<F8
F8003B1C003C0E00380E00380E00380E00380E00380E00380E00380E00380E00380E0038
0E00FE3F80110E7F8D14>I<07C018303018600C600CE00EE00EE00EE00EE00E701C3018
183007C00F0E7F8D12>I<F9F0003E1C0038060038070038030038038038038038038038
0380380300380700380E003E1C0039F000380000380000380000380000380000FE000011
147F8D14>I<07C2001C2600381E00700E00600E00E00E00E00E00E00E00E00E00600E00
700E00301E001C2E0007CE00000E00000E00000E00000E00000E00003F8011147F8D13>
I<F9E03A703C703820380038003800380038003800380038003800FF000C0E7F8D0E>I<
1F4060C0C040C040E000FF007F801FC001E080608060C060E0C09F000B0E7F8D0E>I<08
0008000800180018003800FFC0380038003800380038003800380038403840384038401C
800F000A147F930E>I<F83E00380E00380E00380E00380E00380E00380E00380E00380E
00380E00380E00381E001C2E0007CF80110E7F8D14>I<FE1F380E3C0C1C081C080E100E
100720072007E003C003C001800180100E7F8D13>I<FEFE7C383838383810383C101C3C
201C4C201E4E600ECE400E8740078780070380070380030300020100160E7F8D19>I<FE
3F3C1C1C100E20074007C0038001C002E004F008701838383CFC7F100E7F8D13>I<FE1F
380E3C0C1C081C080E100E100720072007E003C003C00180018001000100E200E200A400
780010147F8D13>I<FFF0C0E080E081C08380878007000E001E081C08381870107030FF
F00D0E7F8D10>I<FFFF801101808812>I E end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300dpi
TeXDict begin
%%PaperSize: A4

%%EndSetup
%%Page: 1 1
1 0 bop 1641 216 a Fw(,)12 b(,)g(1{51)e(\(\))614 249
y Fv(c)605 250 y Fu(\015)662 256 y Fw(Klu)o(w)o(er)h(Academic)f
(Publishers,)f(Boston.)14 b(Man)o(ufactured)8 b(in)k(The)f
(Netherlands.)300 534 y Ft(State)22 b(in)i(Hask)n(ell)300
634 y Fs(JOHN)10 b(LA)o(UNCHBUR)m(Y)955 b Fw(jl@cse.ogi.edu)300
680 y Fr(Or)n(e)n(gon)15 b(Gr)n(aduate)e(Institute,)f(PO)h(Box)h
(91000,)g(Portland,)f(OR)g(97291-1000)300 763 y Fs(SIMON)c(L)i(PEYTON)e
(JONES)673 b Fw(simonp)r(j@dcs.glas)o(go)o(w.ac)o(.uk)300
808 y Fr(University)14 b(of)f(Glasgow,)f(G12)h(8QQ,)g(Sc)n(otland)300
941 y Fq(Abstract.)48 b Fw(Some)13 b(algorithms)f(mak)o(e)h(critical)g
(in)o(ternal)f(use)i(of)g(up)q(datable)e(state,)i(ev)o(en)f(though)g
(their)300 981 y(external)c(sp)q(eci\014cation)f(is)j(purely)e
(functional.)j(Based)e(on)h(earlier)e(w)o(ork)i(on)g(monads,)e(w)o(e)j
(presen)o(t)d(a)i(w)o(a)o(y)g(of)300 1020 y(securely)f(encapsulatin)o
(g)f(stateful)h(computation)o(s)g(that)g(manipulate)f(m)o(ultiple,)h
(named,)g(m)o(utable)g(ob)r(jects,)300 1059 y(in)k(the)f(con)o(text)f
(of)i(a)g(non-strict,)f(purely-fun)o(ctio)o(na)o(l)f(language.)20
b(The)15 b(securit)o(y)d(of)i(the)f(encapsulation)e(is)300
1099 y(assured)j(b)o(y)h(the)f(t)o(yp)q(e)h(system,)f(using)h
(parametric)o(it)o(y)l(.)25 b(The)15 b(same)f(framew)o(ork)g(is)h(also)
g(used)f(to)h(handle)300 1138 y(input/outpu)o(t)9 b(op)q(erations)f
(\(state)j(c)o(hanges)e(on)i(the)g(external)e(w)o(orld\))i(and)g(calls)
f(to)h(C.)300 1277 y Fp(1.)48 b(In)o(tro)q(duction)300
1381 y Fo(Purely)16 b(functional)f(programmi)o(ng)d(languages)j(allo)o
(w)f(man)o(y)g(algorithms)f(to)j(b)q(e)g(expressed)300
1431 y(v)o(ery)i(concisely)m(,)h(but)f(there)h(are)f(a)g(few)g
(algorithms)e(in)h(whic)o(h)h(in-place)g(up)q(datable)g(state)300
1481 y(seems)h(to)g(pla)o(y)f(a)h(crucial)g(role.)33
b(F)m(or)18 b(these)j(algorithms,)c(purely-functional)h(languages,)300
1531 y(whic)o(h)13 b(lac)o(k)g(up)q(datable)h(state,)f(app)q(ear)h(to)g
(b)q(e)g(inheren)o(tly)f(ine\016cien)o(t)h(\(P)o(onder,)g(McGeer)g(&)
300 1580 y(Ng)g([1988]\).)i(Examples)d(of)g(suc)o(h)i(algorithms)c
(include:)300 1670 y Fn(\017)45 b Fo(Algorithms)8 b(based)i(on)f(the)h
(use)g(of)e(incremen)o(tally-mo)q(di\014ed)f(hash)i(tables,)h(where)h
(lo)q(okups)366 1719 y(are)k(in)o(terlea)o(v)o(ed)f(with)f(the)i
(insertion)f(of)f(new)h(items.)300 1811 y Fn(\017)45
b Fo(The)16 b(union/\014nd)f(algorithm,)e(whic)o(h)i(relies)h(for)f
(its)h(e\016ciency)g(on)f(the)h(set)g(represen)o(ta-)366
1861 y(tions)e(b)q(eing)g(simpli\014ed)e(eac)o(h)i(time)f(the)h
(structure)i(is)e(examined.)300 1952 y Fn(\017)45 b Fo(Man)o(y)21
b(graph)f(algorithms,)g(whic)o(h)h(require)h(a)e(dynamically)e(c)o
(hanging)i(structure)j(in)366 2002 y(whic)o(h)14 b(sharing)g(is)g
(explicit,)f(so)h(that)f(c)o(hanges)i(are)f(visible)g(non-lo)q(cally)m
(.)333 2091 y(There)g(is,)e(furthermore,)g(one)g(absolutely)g(una)o(v)o
(oidable)f(use)i(of)f(state)h(in)f(ev)o(ery)h(functional)300
2141 y(program:)k(input/output.)i(The)c(plain)e(fact)h(of)g(the)h
(matter)e(is)h(that)h(the)g(whole)f(purp)q(ose)h(of)300
2191 y(running)g(a)g(program,)f(functional)g(or)i(otherwise,)g(is)f(to)
h(mak)o(e)d(some)i(c)o(hange)h(to)f(the)h(w)o(orld)300
2240 y(|)c(an)g(up)q(date-in-place,)g(if)f(y)o(ou)h(please.)18
b(In)12 b(man)o(y)e(programs)h(these)j(I/O)e(e\013ects)i(are)e(rather)
300 2290 y(complex,)g(in)o(v)o(olving)g(in)o(terlea)o(v)o(ed)i(reads)g
(from)f(and)g(writes)i(to)f(the)g(w)o(orld)f(state.)333
2342 y(W)m(e)h(use)h(the)g(term)f(\\stateful")g(to)g(describ)q(e)i
(computations)d(or)i(algorithms)d(in)i(whic)o(h)g(the)300
2392 y(programmer)j(really)h(do)q(es)i(w)o(an)o(t)f(to)g(manipulate)e
(\(up)q(datable\))i(state.)34 b(What)19 b(has)g(b)q(een)300
2442 y(lac)o(king)14 b(un)o(til)g(no)o(w)g(is)h(a)f(clean)h(w)o(a)o(y)f
(of)g(describing)i(suc)o(h)f(algorithms)e(in)h(a)g(functional)g(lan-)
300 2492 y(guage)k(|)f(esp)q(ecially)h(a)f(non-strict)i(one)f(|)f
(without)h(thro)o(wing)f(a)o(w)o(a)o(y)g(the)h(main)e(virtues)300
2541 y(of)h(functional)f(languages:)25 b(indep)q(endence)19
b(of)e(order)h(of)f(ev)n(aluation)f(\(the)i(Ch)o(urc)o(h-Rosser)300
2591 y(prop)q(ert)o(y\),)c(referen)o(tial)h(transparency)m(,)f
(non-strict)h(seman)o(tics,)e(and)g(so)h(on.)p eop
%%Page: 2 2
2 1 bop 300 275 a Fm(2)333 416 y Fo(In)10 b(this)f(pap)q(er)h(w)o(e)g
(describ)q(e)h(a)f(w)o(a)o(y)e(to)i(express)h(stateful)f(algorithms)d
(in)i(non-strict,)h(purely-)300 466 y(functional)f(languages.)16
b(The)10 b(approac)o(h)g(is)f(a)h(dev)o(elopmen)o(t)e(of)i(our)f
(earlier)h(w)o(ork)g(on)f(monadic)300 516 y(I/O)15 b(and)g(state)h
(encapsulation)f(\(Launc)o(h)o(bury)h([1993];)d(P)o(eyton)j(Jones)g(&)f
(W)m(adler)g([1993]\),)300 565 y(but)h(with)g(an)g(imp)q(ortan)o(t)e
(tec)o(hnical)j(inno)o(v)n(ation:)j(w)o(e)d(use)f(parametric)g(p)q
(olymorphism)c(to)300 615 y(ac)o(hiev)o(e)k(safe)h(encapsulation)f(of)f
(state.)26 b(It)16 b(turns)h(out)f(that)h(this)f(allo)o(ws)f(m)o
(utable)f(ob)r(jects)300 665 y(to)g(b)q(e)g(named)e(without)i(losing)e
(safet)o(y)m(,)h(and)h(it)f(also)g(allo)o(ws)g(input/output)g(to)h(b)q
(e)g(smo)q(othly)300 715 y(in)o(tegrated)g(with)g(other)g(state)h
(manipulation.)333 766 y(The)f(other)g(imp)q(ortan)o(t)d(feature)j(of)f
(this)g(pap)q(er)h(is)f(that)g(it)g(describ)q(es)i(a)e(complete)g
(system,)300 816 y(and)f(one)h(that)f(is)g(implemen)o(ted)e(in)i(the)h
(Glasgo)o(w)e(Hask)o(ell)h(compiler)f(and)h(freely)g(a)o(v)n(ailable)
1766 801 y Fv(1)1783 816 y Fo(.)300 866 y(The)i(system)g(has)g(the)h
(follo)o(wing)c(prop)q(erties:)300 953 y Fn(\017)45 b
Fo(Complete)16 b(referen)o(tial)g(transparency)i(is)e(main)o(tained.)23
b(A)o(t)16 b(\014rst)i(it)d(is)i(not)f(clear)g(what)366
1003 y(this)11 b(statemen)o(t)f(means:)15 b(ho)o(w)10
b(can)g(a)g(stateful)h(computation)d(b)q(e)j(said)f(to)g(b)q(e)h
(referen)o(tially)366 1052 y(transparen)o(t?)366 1122
y(T)m(o)18 b(b)q(e)g(more)f(precise,)j(a)d(stateful)h(computation)f(is)
g(a)h Fl(state)g(tr)n(ansformer)p Fo(,)f(that)h(is,)h(a)366
1171 y(function)14 b(from)e(an)h(initial)f(state)j(to)e(a)h(\014nal)f
(state.)19 b(It)14 b(is)f(lik)o(e)g(a)h(\\script",)f(detailing)g(the)
366 1221 y(actions)i(to)f(b)q(e)i(p)q(erformed)e(on)g(its)h(input)f
(state.)21 b(Lik)o(e)14 b(an)o(y)g(other)i(function,)e(it)g(is)g(quite)
366 1271 y(p)q(ossible)k(to)f(apply)f(a)h(single)g(stateful)g
(computation)f(to)h(more)f(than)h(one)h(input)f(state)366
1321 y(and,)d(of)f(course,)i(its)f(b)q(eha)o(viour)f(ma)o(y)f(dep)q
(end)j(on)f(that)g(state.)366 1390 y(But)i(in)f(addition,)g(w)o(e)g
(guaran)o(tee)h(that)g(the)g(state)g(is)f(used)i(in)e(a)g
(single-threaded)h(w)o(a)o(y)m(.)366 1440 y(Consequen)o(tly)m(,)g(the)g
(\014nal)f(state)h(can)g(b)q(e)g(constructed)h(b)o(y)f(mo)q(difying)c
(the)k(input)g(state)366 1490 y Fl(in-plac)n(e)p Fo(.)30
b(This)17 b(e\016cien)o(t)h(implemen)o(tation)c(resp)q(ects)20
b(the)f(purely-functional)d(seman-)366 1540 y(tics)f(of)f(the)h
(state-transformer)f(function,)g(so)h(all)e(the)i(usual)f(tec)o
(hniques)h(for)f(reasoning)366 1589 y(ab)q(out)i(functional)e(programs)
h(con)o(tin)o(ue)g(to)h(w)o(ork.)22 b(Similarly)m(,)12
b(stateful)k(programs)e(can)366 1639 y(b)q(e)g(exp)q(osed)g(to)f(the)h
(full)e(range)h(of)f(program)g(transformations)f(applied)i(b)o(y)f(a)h
(compiler,)366 1689 y(with)h(no)g(sp)q(ecial)g(cases)h(or)f(side)g
(conditions.)300 1778 y Fn(\017)45 b Fo(The)12 b(programmer)c(has)k
(complete)e(con)o(trol)h(o)o(v)o(er)g(where)h(in-place)e(up)q(dates)i
(are)g(used)g(and)366 1827 y(where)19 b(they)f(are)g(not.)29
b(F)m(or)17 b(example,)g(there)h(is)g(no)f(complex)f(analysis)h(to)g
(determine)366 1877 y(when)d(an)e(arra)o(y)h(is)f(used)i(in)e(a)g
(single-threaded)i(w)o(a)o(y)m(.)i(Since)e(the)f(viabilit)o(y)d(of)i
(the)i(en)o(tire)366 1927 y(program)j(ma)o(y)f(b)q(e)j(predicated)h(on)
e(the)g(use)h(of)f(in-place)g(up)q(dates,)i(the)f(programmer)366
1977 y(m)o(ust)13 b(b)q(e)i(con\014den)o(t)g(in,)d(and)i(b)q(e)h(able)e
(to)h(reason)h(ab)q(out,)e(the)h(outcome.)300 2065 y
Fn(\017)45 b Fo(Mutable)12 b(ob)r(jects)g(can)g(b)q(e)g
Fl(name)n(d)p Fo(.)18 b(This)11 b(abilit)o(y)f(sounds)i(inno)q(cuous)g
(enough,)f(but)h(once)366 2115 y(an)j(ob)r(ject)g(can)g(b)q(e)g(named)f
(its)g(use)h(cannot)g(b)q(e)g(con)o(trolled)g(as)f(readily)m(.)19
b(Y)m(et)c(naming)d(is)366 2165 y(imp)q(ortan)o(t.)k(F)m(or)d(example,)
f(it)h(giv)o(es)g(us)g(the)h(abilit)o(y)e(to)h(manipulate)e(m)o
(ultiple)g(m)o(utable)366 2215 y(ob)r(jects)k(sim)o(ultaneously)m(.)300
2303 y Fn(\017)45 b Fo(Input/output)15 b(tak)o(es)g(its)f(place)h(as)f
(a)g(sp)q(ecialised)h(form)e(of)g(stateful)i(computation.)j(In-)366
2353 y(deed,)k(the)f(t)o(yp)q(e)g(of)e(I/O-p)q(erforming)f
(computations)h(is)h(an)f(instance)i(of)f(the)g(\(more)366
2403 y(p)q(olymorphic\))13 b(t)o(yp)q(e)h(of)f(stateful)h
(computations.)j(Along)c(with)h(I/O)g(comes)g(the)g(abilit)o(y)366
2453 y(to)g(call)f(imp)q(erativ)o(e)g(pro)q(cedures)j(written)e(in)g
(other)g(languages.)300 2541 y Fn(\017)45 b Fo(It)17
b(is)f(p)q(ossible)g(to)g Fl(enc)n(apsulate)h Fo(stateful)f
(computations)f(so)h(that)g(they)h(app)q(ear)g(to)f(the)366
2591 y(rest)i(of)e(the)h(program)e(as)i(pure)g(\(stateless\))h
(functions)f(whic)o(h)g(are)f Fl(guar)n(ante)n(e)n(d)h
Fo(b)o(y)g(the)p eop
%%Page: 3 3
3 2 bop 1772 275 a Fm(3)366 416 y Fo(t)o(yp)q(e)12 b(system)f(to)f(ha)o
(v)o(e)h(no)g(in)o(teractions)g(whatev)o(er)h(with)f(other)g
(computations,)f(whether)366 466 y(stateful)i(or)f(otherwise)i
(\(except)g(via)e(the)h(v)n(alues)f(of)g(argumen)o(ts)g(and)g(results,)
h(of)f(course\).)366 538 y(Complete)k(safet)o(y)g(is)g(main)o(tained)e
(b)o(y)i(this)g(encapsulation.)22 b(A)15 b(program)f(ma)o(y)f(con)o
(tain)366 588 y(an)i(arbitrary)g(n)o(um)o(b)q(er)f(of)g(stateful)g
(sub-computations,)g(eac)o(h)h(sim)o(ultaneously)e(activ)o(e,)366
638 y(without)g(concern)h(that)f(a)g(m)o(utable)e(ob)r(ject)j(from)d
(one)i(migh)o(t)e(b)q(e)j(m)o(utated)e(b)o(y)g(another.)300
732 y Fn(\017)45 b Fo(Stateful)16 b(computations)d(can)j(ev)o(en)g(b)q
(e)g(p)q(erformed)f Fl(lazily)g Fo(without)f(losing)h(safet)o(y)m(.)22
b(F)m(or)366 782 y(example,)c(supp)q(ose)h(that)f(stateful)g
(depth-\014rst)h(searc)o(h)g(of)e(a)h(graph)g(returns)h(a)f(list)f(of)
366 832 y(v)o(ertices)k(in)e(depth-\014rst)i(order.)36
b(If)19 b(the)h(consumer)f(of)g(this)h(list)f(only)f(ev)n(aluates)i
(the)366 882 y(\014rst)d(few)g(elemen)o(ts)f(of)g(the)g(list,)g(then)h
(only)f(enough)g(of)g(the)h(stateful)f(computation)e(is)366
932 y(executed)i(to)e(pro)q(duce)h(those)g(elemen)o(ts.)300
1073 y Fp(2.)48 b(Ov)o(erview)300 1179 y Fo(This)13 b(section)h(in)o
(tro)q(duces)h(the)f(k)o(ey)f(ideas)h(of)e(our)i(approac)o(h)f(to)g
(stateful)h(computation.)i(W)m(e)300 1228 y(b)q(egin)e(with)f(the)i
(programmer's-ey)o(e-view.)300 1370 y Fp(2.1.)48 b(State)15
b(transformers)300 1476 y Fo(A)h Fl(state)h(tr)n(ansformer)e
Fo(of)h(t)o(yp)q(e)g Fk(\(ST)21 b(s)h(a\))16 b Fo(is)g(a)g(computation)
e(whic)o(h)i(transforms)g(a)g(state)300 1525 y(indexed)h(b)o(y)f(t)o
(yp)q(e)h Fk(s)p Fo(,)f(and)h(deliv)o(ers)f(a)h(v)n(alue)e(of)h(t)o(yp)
q(e)h Fk(a)p Fo(.)25 b(Y)m(ou)16 b(can)h(think)f(of)g(it)g(as)g(a)h
(pure)300 1575 y(function,)e(taking)g(a)g(state)i(as)e(its)h(argumen)o
(t,)e(and)i(deliv)o(ering)e(a)i(state)g(and)g(a)f(v)n(alue)g(as)g(its)
300 1625 y(result.)k(W)m(e)13 b(depict)i(a)e(state)i(transformer)f(lik)
o(e)f(this:)701 1948 y @beginspecial @setspecial
%%BeginDocument: basic-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-9 -1 translate
0.000000 64.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 149 57 moveto 189 57 lineto stroke
stroke
newpath 181.000 55.000 moveto 189.000 57.000 lineto 181.000 59.000 lineto stroke
% Polyline
newpath 149 67 moveto 149 27 lineto 69 27 lineto 69 67 lineto closepath stroke
% Polyline
newpath 29 57 moveto 69 57 lineto stroke
stroke
newpath 61.000 55.000 moveto 69.000 57.000 lineto 61.000 59.000 lineto stroke
% Polyline
newpath 149 37 moveto 169 37 lineto 169 17 lineto stroke
stroke
newpath 167.000 25.000 moveto 169.000 17.000 lineto 171.000 25.000 lineto stroke
/Times-Roman findfont 12.000 scalefont setfont
156 69 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
9 70 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
150 13 moveto 
1 -1 scale
(Result) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 2040 a(F)m(rom)j(a)h(seman)o(tic)g(p)q(oin)o(t)g(of)g
(view,)h(this)f(is)h(a)f(purely-functional)g(accoun)o(t)h(of)f(state.)
30 b(F)m(or)300 2090 y(example,)12 b(b)q(eing)i(a)g(pure)g(function,)f
(a)h(state)h(transformer)e(is)h(a)g(\014rst-class)h(v)n(alue:)i(it)d
(can)g(b)q(e)300 2140 y(passed)k(to)f(a)f(function,)h(returned)h(as)f
(a)g(result,)h(stored)g(in)e(a)h(data)f(structure,)j(duplicated)300
2190 y(freely)m(,)e(and)f(so)h(on.)27 b(\(Of)17 b(course,)h(it)e(is)h
(our)g(in)o(ten)o(tion)f(that)h(the)g(new)g(state)h(will)d(actually)300
2240 y(b)q(e)h(constructed)h(b)o(y)d(mo)q(difying)e(the)k(old)e(one)h
(in)f(place,)h(a)g(matter)f(to)h(whic)o(h)g(w)o(e)g(return)h(in)300
2289 y(Section)e(9.\))k(F)m(rom)12 b(no)o(w)h(on,)h(w)o(e)g(tak)o(e)g
(the)g(term)f(\\state)i(transformer")e(to)g(b)q(e)i(synon)o(ymous)300
2339 y(with)j(\\stateful)f(computation":)25 b(the)18
b(computation)e(is)i(seen)h(as)f(transforming)e(one)j(state)300
2389 y(in)o(to)13 b(another.)333 2442 y(A)i(state)h(transformer)f(can)g
(ha)o(v)o(e)g(other)g(inputs)h(b)q(esides)g(the)g(state;)g(if)e(so,)h
(it)f(will)g(ha)o(v)o(e)h(a)300 2492 y(functional)f(t)o(yp)q(e.)22
b(It)15 b(can)h(also)e(ha)o(v)o(e)h(man)o(y)e(results,)j(b)o(y)f
(returning)g(them)g(in)f(a)h(tuple.)22 b(F)m(or)300 2541
y(example,)13 b(a)h(state)h(transformer)g(with)f(t)o(w)o(o)g(inputs)g
(of)g(t)o(yp)q(e)h Fk(Int)p Fo(,)f(and)g(t)o(w)o(o)g(results)i(of)e(t)o
(yp)q(e)300 2591 y Fk(Int)f Fo(and)h Fk(Bool)o Fo(,)f(w)o(ould)h(ha)o
(v)o(e)f(the)i(t)o(yp)q(e:)p eop
%%Page: 4 4
4 3 bop 300 275 a Fm(4)344 466 y Fk(Int)21 b(->)g(Int)g(->)h(ST)f(s)h
(\(Int,Bool\))333 565 y Fo(Its)15 b(picture)f(migh)o(t)e(lo)q(ok)h(lik)
o(e)g(this:)707 887 y @beginspecial @setspecial
%%BeginDocument: multi-input-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-9 0 translate
0.000000 68.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 144 63 moveto 184 63 lineto stroke
stroke
newpath 176.000 61.000 moveto 184.000 63.000 lineto 176.000 65.000 lineto stroke
% Polyline
newpath 144 73 moveto 144 33 lineto 64 33 lineto 64 73 lineto closepath stroke
% Polyline
newpath 24 63 moveto 64 63 lineto stroke
stroke
newpath 56.000 61.000 moveto 64.000 63.000 lineto 56.000 65.000 lineto stroke
% Polyline
newpath 43 23 moveto 43 41 lineto 64 41 lineto stroke
stroke
newpath 56.000 39.000 moveto 64.000 41.000 lineto 56.000 43.000 lineto stroke
% Polyline
newpath 24 23 moveto 24 48 lineto 64 48 lineto stroke
stroke
newpath 56.000 46.000 moveto 64.000 48.000 lineto 56.000 50.000 lineto stroke
% Polyline
newpath 144 48 moveto 184 48 lineto 184 22 lineto stroke
stroke
newpath 182.000 30.000 moveto 184.000 22.000 lineto 186.000 30.000 lineto stroke
% Polyline
newpath 144 41 moveto 164 41 lineto 164 21 lineto stroke
stroke
newpath 162.000 29.000 moveto 164.000 21.000 lineto 166.000 29.000 lineto stroke
/Times-Roman findfont 12.000 scalefont setfont
152 75 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
9 75 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
18 16 moveto 
1 -1 scale
(Inputs) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
158 15 moveto 
1 -1 scale
(Results) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 964 a(The)f(simplest)e(state)i(transformer,)f
Fk(returnST)o Fo(,)g(simply)e(deliv)o(ers)j(a)f(v)n(alue)g(without)g
(a\013ecting)300 1013 y(the)j(state)h(at)f(all:)344 1113
y Fk(returnST)20 b(::)h(a)h(->)f(ST)g(s)h(a)333 1213
y Fo(The)15 b(picture)f(for)g Fk(returnST)e Fo(is)i(lik)o(e)f(this:)701
1464 y @beginspecial @setspecial
%%BeginDocument: return-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-5 2 translate
0.000000 51.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 142 44 moveto 182 44 lineto stroke
stroke
newpath 174.000 42.000 moveto 182.000 44.000 lineto 174.000 46.000 lineto stroke
% Polyline
newpath 142 54 moveto 142 14 lineto 62 14 lineto 62 54 lineto closepath stroke
% Polyline
newpath 22 44 moveto 62 44 lineto stroke
stroke
newpath 54.000 42.000 moveto 62.000 44.000 lineto 54.000 46.000 lineto stroke
% Polyline
newpath 41 4 moveto 41 22 lineto 62 22 lineto stroke
stroke
newpath 54.000 20.000 moveto 62.000 22.000 lineto 54.000 24.000 lineto stroke
% Polyline
newpath 142 22 moveto 162 22 lineto 162 2 lineto stroke
stroke
newpath 160.000 10.000 moveto 162.000 2.000 lineto 164.000 10.000 lineto stroke
% Polyline
newpath 62 44 moveto 142 44 lineto stroke
stroke
% Polyline
newpath 63 22 moveto 142 22 lineto stroke
stroke
/Times-Roman findfont 12.000 scalefont setfont
151 58 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
5 57 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 1595 a Fp(2.2.)48 b(Mutable)14 b(v)m(ariables)300
1694 y Fo(Next,)i(w)o(e)f(need)h(to)g(pro)o(vide)f(some)f(primitiv)o(e)
f(state)j(transformers)f(whic)o(h)g(op)q(erate)i(on)e(the)300
1744 y(state.)36 b(The)20 b(simplest)e(thing)h(to)h(pro)o(vide)f(is)g
(the)i(abilit)o(y)c(to)j(allo)q(cate,)g(read,)h(and)e(write)300
1794 y(m)o(utable)12 b(v)n(ariables:)344 1894 y Fk(newVar)64
b(::)21 b(a)h(->)f(ST)g(s)h(\(MutVar)e(s)i(a\))344 1944
y(readVar)42 b(::)21 b(MutVar)g(s)g(a)h(->)f(ST)h(s)f(a)344
1993 y(writeVar)f(::)h(MutVar)g(s)g(a)h(->)f(a)h(->)f(ST)h(s)f(\(\))333
2093 y Fo(The)14 b(t)o(yp)q(e)h Fk(MutVar)20 b(s)i(a)13
b Fo(is)h(the)g(t)o(yp)q(e)g(of)f Fl(r)n(efer)n(enc)n(es)g
Fo(allo)q(cated)g(from)f(a)i(state)g(indexed)h(b)o(y)300
2143 y Fk(s)p Fo(,)f(and)g(con)o(taining)f(a)h(v)n(alue)g(of)g(t)o(yp)q
(e)h Fk(a)o Fo(.)20 b(A)14 b(reference)j(can)e(b)q(e)g(though)o(t)f(of)
f(as)i(the)g(name)e(of)300 2193 y(\(or)i(address)h(of)s(\))f(a)f
Fl(variable)p Fo(,)h(an)f(up)q(datable)h(lo)q(cation)f(in)h(the)g
(state)h(capable)f(of)f(holding)g(a)300 2242 y(v)n(alue.)j(The)e(state)
f(con)o(tains)g(a)g(\014nite)g(mapping)e(of)h(references)k(to)c(v)n
(alues.)333 2292 y(Notice)e(that,)g(unlik)o(e)f(SML's)h
Fk(ref)f Fo(t)o(yp)q(es,)i(for)e(example,)g Fk(MutVar)n
Fo(s)h(are)h(parameterised)e(o)o(v)o(er)300 2342 y(the)17
b(t)o(yp)q(e)g(of)f(the)g(state)i(as)e(w)o(ell)g(as)g(o)o(v)o(er)g(the)
h(t)o(yp)q(e)g(of)f(the)h(v)n(alue)f(to)g(whic)o(h)g(the)h(reference)
300 2392 y(is)k(mapp)q(ed)e(b)o(y)i(the)g(state,)i(a)e(decision)g
(whose)g(imp)q(ortance)f(will)f(b)q(ecome)i(apparen)o(t)g(in)300
2442 y(Section)15 b(2.5.)i(\(W)m(e)d(use)h(the)g(name)e
Fk(MutVar)f Fo(for)i(the)h(t)o(yp)q(e)f(of)g(references,)i(rather)f
(than)f Fk(Ref)p Fo(,)300 2492 y(sp)q(eci\014cally)g(to)g(a)o(v)o(oid)e
(confusion)i(with)f(SML.\))333 2541 y(Returning)j(to)g(the)h(primitiv)o
(es,)d(the)j(function)f Fk(newVar)f Fo(tak)o(es)i(an)e(initial)g(v)n
(alue,)g(of)h(t)o(yp)q(e)300 2591 y Fk(a)p Fo(,)h(sa)o(y)m(,)g(and)g
(deliv)o(ers)h(a)f(state)h(transformer)f(of)g(t)o(yp)q(e)g
Fk(ST)22 b(s)f(\(MutVar)g(s)g(a\))p Fo(.)28 b(When)17
b(this)p eop
%%Page: 5 5
5 4 bop 1772 275 a Fm(5)300 416 y Fo(state)15 b(transformer)e(is)h
(applied)f(to)h(a)f(state,)i(it)e(allo)q(cates)h(a)g(fresh)g(reference)
j(|)c(that)h(is,)f(one)300 466 y(curren)o(tly)i(not)f(used)h(in)e(the)i
(state)f(|)g(augmen)o(ts)f(the)h(state)h(to)f(map)e(the)j(new)f
(reference)i(to)300 516 y(the)e(supplied)g(v)n(alue,)f(and)h(returns)h
(the)g(reference)h(along)d(with)g(the)i(mo)q(di\014ed)d(state.)333
565 y(Giv)o(en)19 b(a)h(reference)j Fk(v)o Fo(,)e Fk(readVar)g(v)e
Fo(is)h(a)g(state)h(transformer)e(whic)o(h)h(lea)o(v)o(es)g(the)h
(state)300 615 y(unc)o(hanged,)14 b(but)g(uses)h(the)g(state)f(to)g
(map)e(the)j(reference)h(to)e(its)g(v)n(alue.)333 665
y(The)e(function)e Fk(writeVar)g Fo(transforms)g(the)i(state)f(so)g
(that)h(it)e(maps)g(the)i(giv)o(en)e(reference)j(to)300
715 y(a)f(new)g(v)n(alue.)17 b(Notice)12 b(that)h Fl(the)g(r)n(efer)n
(enc)n(e)f(itself)g(do)n(es)i(not)f(change)p Fo(;)g(it)f(is)g(the)h
Fl(state)f Fo(whic)o(h)f(is)300 765 y(mo)q(di\014ed.)16
b Fk(writeVar)11 b Fo(deliv)o(ers)h(a)g(result)h(of)f(the)h(unit)f(t)o
(yp)q(e)h Fk(\(\))o Fo(,)f(a)g(t)o(yp)q(e)h(whic)o(h)f(only)g(has)g
(one)300 814 y(v)n(alue)j(\(apart)g(from)f(b)q(ottom\),)g(also)g
(written)i Fk(\(\))p Fo(.)22 b(A)15 b(state)h(transformer)f(of)g(t)o
(yp)q(e)h Fk(ST)21 b(s)h(\(\))300 864 y Fo(is)14 b(useful)g(only)f(for)
g(its)h(e\013ect)i(on)d(the)i(state.)300 996 y Fp(2.3.)48
b(Comp)q(osing)14 b(state)h(transformers)300 1096 y Fo(State)c
(transformers)g(can)g(b)q(e)g(comp)q(osed)g(in)f(sequence,)j(to)e(form)
e(a)h(larger)h(state)g(transformer,)300 1146 y(using)j
Fk(thenST)n Fo(,)g(whic)o(h)g(has)g(t)o(yp)q(e)344 1245
y Fk(thenST)20 b(::)i(ST)f(s)g(a)h(->)f(\(a)h(->)f(ST)h(s)f(b\))h(->)f
(ST)g(s)h(b)333 1345 y Fo(The)15 b(picture)f(for)g Fk(\(s1)21
b(`thenST`)f(s2\))13 b Fo(is)h(lik)o(e)f(this)1170 1330
y Fv(2)1189 1345 y Fo(:)615 1566 y @beginspecial @setspecial
%%BeginDocument: then-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-3 1 translate
0.000000 43.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 194 21 moveto 217 21 lineto 217 1 lineto stroke
stroke
newpath 215.000 9.000 moveto 217.000 1.000 lineto 219.000 9.000 lineto stroke
% Polyline
newpath 108 34 moveto 136 34 lineto stroke
stroke
newpath 128.000 32.000 moveto 136.000 34.000 lineto 128.000 36.000 lineto stroke
% Polyline
newpath 108 41 moveto 108 11 lineto 51 11 lineto 51 41 lineto closepath stroke
% Polyline
newpath 21 34 moveto 51 34 lineto stroke
stroke
newpath 43.000 32.000 moveto 51.000 34.000 lineto 43.000 36.000 lineto stroke
% Polyline
newpath 194 41 moveto 194 11 lineto 136 11 lineto 136 41 lineto closepath stroke
% Polyline
newpath 108 20 moveto 136 20 lineto stroke
stroke
newpath 128.000 18.000 moveto 136.000 20.000 lineto 128.000 22.000 lineto stroke
% Polyline
newpath 193 33 moveto 223 33 lineto stroke
stroke
newpath 215.000 31.000 moveto 223.000 33.000 lineto 215.000 35.000 lineto stroke
% Polyline
newpath 204 48 moveto 39 48 lineto 39 6 lineto 204 6 lineto closepath stroke
/Times-Roman findfont 8.000 scalefont setfont
3 44 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 8.000 scalefont setfont
73 30 moveto 
1 -1 scale
(s1) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 8.000 scalefont setfont
159 30 moveto 
1 -1 scale
(s2) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 8.000 scalefont setfont
207 44 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 1645 a(Notice)f(that)f(the)g(t)o(w)o(o)g(computations)
f(m)o(ust)g(manipulate)f(state)j(indexed)f(b)o(y)g(the)h(same)e(t)o(yp)
q(e,)300 1694 y Fk(s)p Fo(.)17 b(Notice)d(also)e(that)h
Fk(thenST)f Fo(is)g(inheren)o(tly)h(sequen)o(tial,)g(b)q(ecause)i(the)e
(state)h(consumed)f(b)o(y)300 1744 y(the)j(second)g(computation)e(is)h
(that)g(pro)q(duced)i(b)o(y)e(the)h(\014rst.)23 b(Indeed,)16
b(w)o(e)g(often)f(refer)h(to)g(a)300 1794 y(state)g(transformer)e(as)h
(a)g Fl(thr)n(e)n(ad)p Fo(,)g(in)o(v)o(oking)e(the)j(picture)f(of)g(a)g
(series)h(of)e(primitiv)o(e)f(stateful)300 1844 y(op)q(erations)h
(\\threaded)h(together")g(b)o(y)e(a)h(state)h(passed)f(from)f(one)h(to)
f(the)i(next.)333 1894 y(Putting)k(together)g(what)g(w)o(e)f(ha)o(v)o
(e)h(so)f(far,)h(here)h(is)e(a)g(\\pro)q(cedure")i(whic)o(h)f(sw)o(aps)
g(the)300 1944 y(con)o(ten)o(ts)c(of)e(t)o(w)o(o)h(v)n(ariables:)344
2043 y Fk(swap)21 b(::)g(MutVar)f(s)i(a)g(->)f(MutVar)g(s)g(a)h(->)f
(ST)h(s)f(\(\))344 2093 y(swap)g(v)g(w)h(=)f(readVar)g(v)217
b(`thenST`)21 b(\(\\a)g(->)583 2143 y(readVar)g(w)217
b(`thenST`)21 b(\(\\b)g(->)583 2193 y(writeVar)f(v)i(b)152
b(`thenST`)21 b(\(\\_)g(->)583 2242 y(writeVar)f(w)i(a\)\)\))333
2342 y Fo(When)15 b Fk(swap)21 b(v)g(w)15 b Fo(is)f(executed)i(in)e(a)g
(state)i(thread)f(\(that)g(is,)f(when)h(applied)e(to)i(a)f(state\),)300
2392 y Fk(v)h Fo(is)g(dereference)q(d,)j(returning)e(a)f(v)n(alue)g
(whic)o(h)g(is)g(b)q(ound)h(to)f Fk(a)p Fo(.)23 b(Similarly)12
b(the)k(v)n(alue)f(of)g Fk(w)300 2442 y Fo(is)f(b)q(ound)g(to)g
Fk(b)p Fo(.)k(New)d(v)n(alues)f(are)g(then)h(written)f(in)o(to)g(the)h
(state)f(at)g(these)i(lo)q(cations,)d(these)300 2492
y(v)n(alues)h(b)q(eing)f Fk(b)h Fo(and)g Fk(a)f Fo(resp)q(ectiv)o(ely)m
(.)333 2541 y(The)i(syn)o(tax)g(needs)h(a)e(little)g(explanation.)19
b(The)d(form)c(\\)p Fk(\\a->e)o Fo(")j(is)f(Hask)o(ell's)g(syn)o(tax)h
(for)300 2591 y(a)h(lam)o(b)q(da)f(abstraction.)27 b(The)17
b(b)q(o)q(dy)g(of)f(the)h(lam)o(b)q(da)d(abstraction,)k
Fk(e)o Fo(,)f(extends)h(as)f(far)f(to)p eop
%%Page: 6 6
6 5 bop 300 275 a Fm(6)300 416 y Fo(the)18 b(righ)o(t)g(as)g(p)q
(ossible.)30 b(So)17 b(in)h(the)g(co)q(de)h(for)e Fk(swap)p
Fo(,)h(the)g(second)h(argumen)o(t)e(of)g(the)i(\014rst)300
466 y Fk(thenST)c Fo(extends)j(all)d(the)i(w)o(a)o(y)f(from)f(the)i
Fk(\\a)f Fo(to)g(the)h(end)g(of)f(the)h(function.)25
b(That)17 b(is)f(just)300 516 y(as)f(y)o(ou)f(w)o(ould)f(exp)q(ect:)21
b(the)15 b(second)h(argumen)o(t)d(of)h(a)g Fk(thenST)f
Fo(is)h(mean)o(t)g(to)g(b)q(e)h(a)f(function.)300 565
y(F)m(urthermore,)k(the)g(paren)o(theses)h(enclosing)f(the)g(lam)o(b)q
(da)d(abstractions)j(can)f(b)q(e)h(omitted,)300 615 y(and)g(w)o(e)f
(will)g(do)g(so)h(from)e(no)o(w)h(on.)29 b(They)18 b(w)o(ould)f(only)g
(b)q(e)i(required)f(if)f(w)o(e)h(w)o(an)o(ted)g(the)300
665 y(lam)o(b)q(da)c(abstraction)i(to)f(extend)i(less)g(far)e(than)h
(the)h(end)f(of)f(the)i(expression.)25 b(Lastly)m(,)15
b(the)300 715 y(\\)p Fk(_)p Fo(")c(in)h(the)h(second-last)g(line)f(is)g
(a)g(wild-card)f(pattern,)i(whic)o(h)f(matc)o(hes)g(an)o(y)g(v)n(alue.)
17 b(W)m(e)12 b(use)300 765 y(it)i(here)h(b)q(ecause)g(the)g
Fk(writeVar)d Fo(do)q(es)i(not)g(return)h(a)f(v)n(alue)f(of)g(in)o
(terest.)300 901 y Fp(2.4.)48 b(Other)14 b(useful)g(com)o(binators)300
1003 y Fo(T)m(o)g(a)o(v)o(oid)f(the)h(frequen)o(t)i(app)q(earance)f(of)
f(lam)o(b)q(da)e(abstractions)j(with)f(wild-card)g(patterns,)300
1053 y(w)o(e)g(pro)o(vide)f(a)g(sp)q(ecial)h(form)e(of)h
Fk(thenST)n Fo(,)g(called)h Fk(thenST_)n Fo(,)f(with)g(the)h(follo)o
(wing)d(de\014nition:)344 1154 y Fk(thenST_)20 b(::)h(ST)h(s)f(\(\))h
(->)f(ST)g(s)h(b)g(->)f(ST)g(s)h(b)344 1204 y(thenST_)e(st1)h(st2)g(=)h
(st1)f(`thenST`)f(\\)i(_)f(->)736 1254 y(st2)333 1355
y Fo(Unlik)o(e)13 b Fk(thenST)n Fo(,)g(the)h(second)g(argumen)o(t)e(of)
g Fk(thenST_)g Fo(is)h(not)g(a)f(function,)h(so)g(the)h(lam)o(b)q(da)
300 1405 y(isn't)d(required.)18 b(Using)11 b Fk(thenST_)o
Fo(,)g(and)h(omitting)c(paren)o(theses,)14 b(w)o(e)e(can)f(rewrite)i
Fk(swap)d Fo(more)300 1454 y(tidily)j(as)h(follo)o(ws:)344
1555 y Fk(swap)21 b(::)g(MutVar)f(s)i(a)g(->)f(MutVar)g(s)g(a)h(->)f
(ST)h(s)f(\(\))344 1605 y(swap)g(v)g(w)h(=)f(readVar)g(v)217
b(`thenST`)21 b(\\a)g(->)583 1655 y(readVar)g(w)217 b(`thenST`)21
b(\\b)g(->)583 1705 y(writeVar)f(v)i(b)152 b(`thenST_`)583
1755 y(writeVar)20 b(w)i(a)333 1855 y Fo(F)m(our)16 b(other)g(useful)g
(com)o(binators,)f(de\014nable)h(in)f(terms)h(of)f Fk(thenST)g
Fo(and)h Fk(returnST)n Fo(,)g(are)300 1905 y Fk(listST)o
Fo(,)d Fk(listST_)o Fo(,)g Fk(mapST)o Fo(,)g(and)h Fk(mapST_)o
Fo(:)344 1993 y Fk(listST)20 b(::)i([ST)f(s)g(a])h(->)f(ST)g(s)h([a])
344 2043 y(listST)e(sts)h(=)h(foldr)f(consST)f(nilST)h(sts)474
2093 y(where)518 2143 y(nilST)g(=)g(returnST)f([])518
2193 y(consST)g(m)i(ms)f(=)h(m)152 b(`thenST`)21 b(\\)g(r)h(->)801
2242 y(ms)152 b(`thenST`)21 b(\\)g(rs)g(->)801 2292 y(returnST)f
(\(r:rs\))344 2392 y(listST_)g(:)i([ST)f(s)g(a])h(->)f(ST)g(s)h(\(\))
344 2442 y(listST_)e(sts)h(=)h(foldr)e(thenST_)h(\(returnST)f(\(\)\))h
(sts)344 2541 y(mapST)f(::)i(\(a)f(->)g(ST)h(s)f(b\))h(->)f([a])g(->)h
(ST)f(s)h([b])344 2591 y(mapST)e(f)i(xs)f(=)h(listST)e(\(map)h(f)h
(xs\))p eop
%%Page: 7 7
7 6 bop 1772 275 a Fm(7)344 466 y Fk(mapST_)20 b(::)i(\(a)f(->)g(ST)h
(s)f(\(\)\))g(->)h([a])f(->)g(ST)h(s)f(\(\))344 516 y(mapST_)f(f)i(xs)f
(=)h(listST_)e(\(map)h(f)h(xs\))300 589 y Fo(The)f(\014rst,)h
Fk(listST)d Fo(tak)o(es)i(a)f(list)g(of)g(state)i(transformers,)f(eac)o
(h)g(indexed)g(b)o(y)f(the)h(same)300 639 y(state)c(t)o(yp)q(e)g(and)f
(returning)g(a)g(v)n(alue)g(of)f(the)i(same)e(t)o(yp)q(e.)25
b(It)17 b(glues)f(them)f(together)i(in)o(to)f(a)300 689
y(single)c(state)i(transformer,)e(whic)o(h)g(comp)q(oses)h(its)g(comp)q
(onen)o(ts)f(together)i(in)e(sequence,)j(and)300 739
y(collects)j(their)h(results)g(in)o(to)e(a)g(list.)29
b(The)19 b(other)f(three)h(are)f(useful)g(v)n(arian)o(ts.)29
b Fk(mapST)o Fo(,)19 b(for)300 788 y(example,)12 b(is)i(rather)h(lik)o
(e)e(the)i(normal)d Fk(map)h Fo(function)h(|)f(it)h(applies)g(a)f
(function)h(rep)q(eatedly)300 838 y(to)f(the)g(elemen)o(ts)f(of)g(a)h
(list,)f(but)h(then)g(it)f(also)g(feeds)i(the)f(state)h(through)e(the)i
(resulting)f(state)300 888 y(transformers.)300 1018 y
Fp(2.5.)48 b(Encapsulation)300 1118 y Fo(So)13 b(far)g(w)o(e)g(ha)o(v)o
(e)g(b)q(een)h(able)f(to)g(com)o(bine)f(state)h(transformers)g(to)g
(mak)o(e)f(larger)h(state)h(trans-)300 1168 y(formers,)f(but)h(ho)o(w)g
(can)g(w)o(e)h(mak)o(e)d(a)i(state)h(transformer)e(part)i(of)e(a)h
(larger)g(program)e(whic)o(h)300 1218 y(do)q(es)j(not)f(manipulate)f
(state)i(at)f(all?)k(What)c(w)o(e)h(need)g(is)f(a)g(function,)g
Fk(runST)o Fo(,)g(with)g(a)g(t)o(yp)q(e)300 1268 y(something)f(lik)o(e)
g(the)h(follo)o(wing:)344 1367 y Fk(runST)20 b(::)i(ST)f(s)h(a)f(->)h
(a)333 1467 y Fo(The)c(idea)g(is)f(that)h Fk(runST)f
Fo(tak)o(es)h(a)f(state)i(transformer)e(as)h(its)f(argumen)o(t,)h
(conjures)g(up)300 1517 y(an)e(initial)f(empt)o(y)h(state,)i(applies)e
(the)h(state)h(transformer)e(to)h(it,)f(and)h(returns)h(the)g(result)
300 1566 y(while)d(discarding)h(the)g(\014nal)f(state.)24
b(The)16 b(initial)e(state)i(is)g(\\empt)o(y")e(in)h(the)i(sense)g
(that)f(no)300 1616 y(references)h(ha)o(v)o(e)d(b)q(een)h(allo)q(cated)
e(in)h(it)f(b)o(y)h Fk(newVar)o Fo(;)f(it)h(is)f(the)i(empt)o(y)e
(mapping.)j(Here)f(is)f(a)300 1666 y(tin)o(y)f(example)g(of)g
Fk(runST)g Fo(in)g(action:)344 1740 y Fk(three)20 b(::)i(Int)344
1789 y(three)e(=)i(runST)f(\(newVar)f(0)152 b(`thenST`)21
b(\\)g(v)h(->)670 1839 y(writeVar)f(v)g(3)65 b(`thenST_`)670
1889 y(readVar)21 b(v\))300 1963 y Fo(This)14 b(de\014nition)g(of)f
(the)i(v)n(alue)f Fk(three)o Fo(,)f(runs)i(a)f(state)h(thread)g(whic)o
(h)f(allo)q(cates)g(a)g(new)g(v)n(ari-)300 2012 y(able,)c(writes)h
Fk(3)f Fo(in)o(to)g(it,)g(reads)h(the)g(v)n(ariable,)f(and)g(returns)i
(the)f(v)n(alue)e(th)o(us)i(read.)17 b(\(Sections)12
b(5)300 2062 y(and)i(7)f(giv)o(es)h(some)f(more)g(con)o(vincing)g(uses)
i(of)f Fk(runST)n Fo(.\))300 2193 y Fl(2.5.1.)42 b(A)15
b(\015aw)300 2292 y Fo(But)c(there)h(seems)f(to)g(b)q(e)g(a)g(terrible)
g(\015a)o(w:)16 b(what)11 b(is)g(to)f(prev)o(en)o(t)i(a)e(reference)k
(from)9 b(one)i(thread)300 2342 y(b)q(eing)j(used)h(in)e(another?)19
b(F)m(or)13 b(example:)344 2442 y Fk(let)21 b(v)g(=)h(runST)f(\(newVar)
f(True\))344 2492 y(in)344 2541 y(runST)g(\(readVar)g(v\))p
eop
%%Page: 8 8
8 7 bop 300 275 a Fm(8)333 416 y Fo(Here,)15 b(the)f(reference)i(allo)q
(cated)d(in)g(the)h(\014rst)g Fk(runST)o Fo('s)g(thread)g(is)f(used)i
(inside)e(the)h(second)300 466 y Fk(runST)o Fo(.)28 b(Doing)16
b(so)h(w)o(ould)f(b)q(e)i(a)f(great)g(mistak)o(e,)f(b)q(ecause)j(reads)
f(in)f(one)g(thread)h(are)f(not)300 516 y(sequenced)f(with)d(resp)q
(ect)j(to)d(writes)h(in)f(the)h(other,)g(and)g(hence)h(the)f(result)g
(of)f(the)h(program)300 565 y(w)o(ould)h(dep)q(end)i(on)e(the)h(ev)n
(aluation)f(order)h(used)h(to)e(execute)j(it.)k(It)16
b(seems)g(at)g(\014rst)g(that)g(a)300 615 y(run)o(time)c(c)o(hec)o(k)j
(migh)o(t)c(b)q(e)j(required)g(to)f(ensure)i(that)f(references)i(are)e
(only)e(dereferenced)17 b(in)300 665 y(the)d(thread)h(whic)o(h)f(allo)q
(cated)f(them.)k(Unfortunately)d(this)g(w)o(ould)f(b)q(e)i(exp)q(ensiv)
o(e.)333 715 y(Ev)o(en)j(w)o(orse,)f(our)g(exp)q(erience)i(suggests)f
(that)f(it)f(is)h(surprisingly)g(tric)o(ky)f(to)h(implemen)o(t)300
765 y(suc)o(h)11 b(a)f(run)o(time)f(c)o(hec)o(k.)18 b(The)11
b(ob)o(vious)f(idea)g(is)g(to)g(allo)q(cate)g(a)g(unique)g
Fl(state-thr)n(e)n(ad)i(identi\014er)300 814 y Fo(with)h(eac)o(h)h
(call)f(to)h Fk(runST)o Fo(,)f(whic)o(h)g(is)h(carried)g(along)f(in)g
(the)h(state.)19 b(Ev)o(ery)14 b(reference)i(w)o(ould)300
864 y(include)10 b(the)h(iden)o(ti\014er)g(of)f(the)h(thread)g(in)f
(whic)o(h)g(it)g(w)o(as)h(created,)h(and)e(whenev)o(er)i(a)e(reference)
300 914 y(w)o(as)g(used)h(for)f(reading)g(or)h(writing,)e(a)h(run)o
(time)f(c)o(hec)o(k)j(is)e(made)f(to)h(ensure)i(that)e(the)h(iden)o
(ti\014er)300 964 y(in)i(the)i(reference)h(matc)o(hes)e(that)g(in)f
(the)i(state.)333 1014 y(This)h(sounds)g(easy)g(enough,)g(alb)q(eit)f
(p)q(erhaps)i(ine\016cien)o(t.)24 b(The)16 b(trouble)g(is)f(that)h(it)g
(do)q(es)300 1064 y(not)e(w)o(ork!)k(Consider)c(the)g(follo)o(wing)e
(\(recursiv)o(e\))j(de\014nition)344 1137 y Fk(foo)21
b(=)g(runST)g(\(newVar)f(7)196 b(`thenST`)21 b(\\)g(v)h(->)627
1187 y(writeVar)e(foo)h(3)65 b(`thenST_`)627 1236 y(returnST)20
b(v\))300 1310 y Fo(Do)q(es)d(this)g(giv)o(e)g(a)g(run)o(time)e(error?)
29 b(No,)17 b(the)g(write)h(is)e(in)h(the)h(same)e(thread)h(as)g(the)h
(allo-)300 1359 y(cate.)g(Ho)o(w)o(ev)o(er,)c(the)f(follo)o(wing)d
(pair)j(of)f(m)o(utually-recursiv)o(e)g(de\014nitions)h(ough)o(t)f(to)h
(b)q(eha)o(v)o(e)300 1409 y(iden)o(tically:)344 1482
y Fk(foo1)21 b(=)g(runST)g(\(newVar)f(7)174 b(`thenST`)21
b(\\)g(v)h(->)649 1532 y(writeVar)e(foo2)h(3)g(`thenST_`)649
1582 y(returnST)f(v\))344 1632 y(foo2)h(=)g(runST)g(\(newVar)f(7)174
b(`thenST`)21 b(\\)g(v)h(->)649 1682 y(writeVar)e(foo1)h(3)g(`thenST_`)
649 1731 y(returnST)f(v\))300 1805 y Fo(All)11 b(that)g(w)o(e)h(ha)o(v)
o(e)f(done)g(is)h(to)f(unfold)f(the)i(de\014nition)f(of)g
Fk(foo)g Fo(once,)h(whic)o(h)f(certainly)h(should)300
1854 y(not)19 b(c)o(hange)h(the)g(seman)o(tics)f(of)g(the)h(program.)34
b(But)20 b(alas,)f(eac)o(h)h(write)g(sees)h(a)e(v)n(ariable)300
1904 y(from)d(the)j(\\other")f(thread,)h(so)f(the)g(run)o(time)f(c)o
(hec)o(k)i(will)e(fail.)28 b(A)18 b(p)q(erfectly)h(resp)q(ectable)300
1954 y(program)12 b(transformation)h(has)h(c)o(hanged)g(the)h(b)q(eha)o
(viour)f(of)f(the)i(run)o(time)e(c)o(hec)o(k,)i(whic)o(h)e(is)300
2004 y(unacceptable.)300 2134 y Fl(2.5.2.)42 b(The)15
b(solution:)k(p)n(ar)n(ametricity)300 2234 y Fo(This)e(problem)e
(brings)i(us)g(to)f(the)i(main)c(tec)o(hnical)j(con)o(tribution)f(of)g
(the)i(pap)q(er:)24 b(the)17 b(dif-)300 2284 y(\014culties)f(with)f
Fk(runST)g Fo(can)h(all)e(b)q(e)j(solv)o(ed)e(b)o(y)g(giving)g(it)g(a)g
(more)g(sp)q(eci\014c)i(t)o(yp)q(e.)24 b(The)16 b(t)o(yp)q(e)300
2333 y(giv)o(en)e(for)g Fk(runST)f Fo(ab)q(o)o(v)o(e)h(is)h(implicitly)
c(univ)o(ersally)i(quan)o(ti\014ed)i(o)o(v)o(er)f(b)q(oth)g
Fk(s)h Fo(and)f Fk(a)p Fo(.)19 b(If)14 b(w)o(e)300 2383
y(put)g(in)g(the)g(quan)o(ti\014cation)f(explicitly)m(,)f(the)i(t)o(yp)
q(e)h(migh)o(t)d(b)q(e)i(written:)741 2462 y Fk(runST)21
b(::)h Fn(8)p Fk(s,a.)f(\(ST)g(s)g(a)h(->)f(a\))300 2541
y Fo(A)12 b Fk(runST)e Fo(with)h(this)h(t)o(yp)q(e)g(could)f(legally)f
(b)q(e)i(applied)f(to)g(an)o(y)g(state)h(transformer,)f(regardless)300
2591 y(of)j(the)i(t)o(yp)q(es)g(to)f(whic)o(h)f Fk(s)h
Fo(and)g Fk(a)g Fo(are)g(instan)o(tiated.)21 b(Ho)o(w)o(ev)o(er,)15
b(w)o(e)h(can)f(b)q(e)g(more)f(precise:)p eop
%%Page: 9 9
9 8 bop 1772 275 a Fm(9)300 416 y Fo(what)15 b(w)o(e)h
Fl(r)n(e)n(al)r(ly)e Fo(w)o(an)o(t)h(to)g(sa)o(y)g(is)g(that)g
Fk(runST)g Fo(should)g(only)f(b)q(e)i(applied)f(to)g(a)g(state)h
(trans-)300 466 y(former)e(whic)o(h)h(uses)i Fk(newVar)d
Fo(to)h(create)h(an)o(y)f(references)j(whic)o(h)d(are)h(used)g(in)f
(that)g(thread.)300 516 y(T)m(o)g(put)i(it)e(another)i(w)o(a)o(y)m(,)e
(the)i(argumen)o(t)e(of)g Fk(runST)g Fo(should)h(not)g(mak)o(e)f(an)o
(y)g(assumptions)300 565 y(ab)q(out)g(what)h(has)f(already)h(b)q(een)g
(allo)q(cated)f(in)g(the)i(initial)c(state.)24 b(That)15
b(is,)h Fk(runST)f Fl(should)300 615 y(work)f(r)n(e)n(gar)n(d)r(less)g
(of)h(what)g(initial)f(state)g(it)h(is)f(given)p Fo(.)19
b(So)13 b(the)i(t)o(yp)q(e)f(of)f Fk(runST)g Fo(should)h(b)q(e:)719
694 y Fk(runST)21 b(::)g Fn(8)p Fk(a.)h(\()o Fn(8)p Fk(s.)g(ST)f(s)h
(a\))f(->)h(a)300 773 y Fo(This)17 b(is)g(not)g(a)g(Hindley-Milner)f(t)
o(yp)q(e,)i(b)q(ecause)h(the)f(quan)o(ti\014ers)f(are)h(not)f(all)f(at)
h(the)g(top)300 822 y(lev)o(el;)c(it)h(is)f(an)h(example)f(of)g(rank-2)
g(p)q(olymorphism)e(\(McCrac)o(k)o(en)k([1984]\).)333
872 y(Wh)o(y)k(do)q(es)h(this)g(t)o(yp)q(e)g(prev)o(en)o(t)g(the)g
(\\capture")g(of)f(references)k(from)17 b(one)j(thread)g(in)o(to)300
922 y(another?)f(Consider)14 b(our)g(example)e(again)344
1022 y Fk(let)21 b(v)g(=)h(runST)f(\(newVar)f(True\))344
1071 y(in)344 1121 y(runST)g(\(readVar)g(v\))333 1221
y Fo(In)11 b(the)g(last)f(line)g(a)g(reference)j Fk(v)d
Fo(is)h(used)g(in)f(a)g(stateful)h(thread)g Fk(\(readVar)20
b(v\))p Fo(,)10 b(ev)o(en)i(though)300 1271 y(the)19
b(latter)f(is)g(supp)q(osedly)h(encapsulated)g(b)o(y)f
Fk(runST)o Fo(.)30 b(This)18 b(is)g(where)i(the)e(t)o(yp)q(e)h(c)o(hec)
o(k)o(er)300 1321 y(comes)d(in)o(to)g(its)h(o)o(wn.)26
b(During)16 b(t)o(yp)q(ec)o(hec)o(king,)i(the)f(t)o(yp)q(e)g(of)g
Fk(readVar)j(v)c Fo(will)g(dep)q(end)i(on)300 1370 y(the)e(t)o(yp)q(e)f
(of)g Fk(v)g Fo(so,)g(for)g(example,)e(the)j(t)o(yp)q(e)g(deriv)n
(ation)e(will)g(con)o(tain)g(a)h(judgemen)o(t)f(of)h(the)300
1420 y(form:)582 1470 y Fn(f)p Fj(:)7 b(:)g(:)e(;)i Fk(v)k
Fo(:)g Fk(MutVar)21 b(s)g(Bool)o Fn(g)12 b(`)f Fk(readVar)21
b(v)11 b Fo(:)g Fk(ST)22 b(s)f(Bool)300 1537 y Fo(No)o(w)11
b(in)f(order)i(to)f(apply)f Fk(runST)g Fo(w)o(e)i(ha)o(v)o(e)f(to)f(b)q
(e)i(able)f(to)g(generalise)h(the)f(t)o(yp)q(e)h(of)e
Fk(readVar)21 b(v)300 1587 y Fo(with)14 b(resp)q(ect)j(to)e
Fk(s)p Fo(,)f(but)h(w)o(e)g(cannot)g(as)g Fk(s)g Fo(is)f(free)i(in)e
(the)h(t)o(yp)q(e)h(en)o(vironmen)o(t:)i Fk(readVar)j(v)300
1637 y Fo(simply)12 b(do)q(es)i(not)g(ha)o(v)o(e)g(t)o(yp)q(e)g
Fn(8)p Fk(s.ST)21 b(s)h(Bool)o Fo(.)333 1687 y(What)15
b(ab)q(out)h(the)g(other)h(w)o(a)o(y)e(round?)23 b(Let's)16
b(c)o(hec)o(k)h(that)f(the)g(t)o(yp)q(e)g(of)f Fk(runST)g
Fo(prev)o(en)o(ts)300 1736 y(the)f(\\escap)q(e")i(of)d(references)k
(from)12 b(a)h(thread.)19 b(Consider)14 b(the)h(de\014nition)e(of)h
Fk(v)f Fo(ab)q(o)o(v)o(e:)344 1836 y Fk(v)21 b(=)h(runST)f(\(newVar)f
(True\))333 1936 y Fo(Here,)14 b Fk(v)e Fo(is)g(a)g(reference)j(that)d
(is)g(allo)q(cated)g(within)g(the)h(thread,)f(but)h(then)g(released)h
(to)e(the)300 1985 y(outside)h(w)o(orld.)18 b(Again,)11
b(consider)j(what)f(happ)q(ens)h(during)f(t)o(yp)q(ec)o(hec)o(king.)19
b(The)13 b(expression)300 2035 y Fk(\(newVar)20 b(True\))c
Fo(has)i(t)o(yp)q(e)f Fk(ST)22 b(s)f(\(MutVar)f(s)i(Bool\))o
Fo(,)17 b(whic)o(h)g(will)f(generalise)i(nicely)e(to)300
2085 y Fn(8)p Fk(s.ST)21 b(s)h(\(MutVar)e(s)i(Bool\))o
Fo(.)17 b(Ho)o(w)o(ev)o(er,)d(this)f(still)g(do)q(es)h(not)f(matc)o(h)f
(the)i(t)o(yp)q(e)g(of)f Fk(runST)o Fo(.)300 2135 y(T)m(o)g(see)i
(this,)f(consider)g(the)h(instance)g(of)e Fk(runST)g
Fo(with)g Fk(a)h Fo(instan)o(tiated)g(to)f Fk(MutVar)21
b(s)g(Bool)p Fo(:)458 2214 y Fk(runST)g(::)g(\()p Fn(8)p
Fk(s'.)g(ST)h(s')f(\(MutVar)f(s)i(Bool\)\))f(->)g(MutVar)f(s)i(Bool)300
2292 y Fo(W)m(e)d(ha)o(v)o(e)g(had)g(to)h(rename)f(the)h(b)q(ound)f(v)n
(ariable)f Fk(s)i Fo(in)e(the)i(t)o(yp)q(e)g(of)f Fk(runST)f
Fo(to)i(a)o(v)o(oid)e(it)300 2342 y(erroneously)e(capturing)f(the)h
Fk(s)f Fo(in)f(the)i(t)o(yp)q(e)g Fk(MutVar)k(s)i(Bool)o
Fo(.)g(The)15 b(argumen)o(t)f(t)o(yp)q(e)i(no)o(w)300
2392 y(do)q(esn't)h(matc)o(h)f(the)h(t)o(yp)q(e)h(of)e
Fk(\(newVar)k(True\))o Fo(.)27 b(Indeed)17 b(there)i(is)d(no)h
(instance)g(of)f Fk(runST)300 2442 y Fo(whic)o(h)e(can)g(b)q(e)g
(applied)g(to)f Fk(\(newVar)21 b(True\))o Fo(.)333 2492
y(Just)15 b(to)f(demonstrate)g(that)h(the)f(t)o(yp)q(e)h(of)f
Fk(runST)f Fo(do)q(es)i(nev)o(ertheless)h(p)q(ermit)d(one)i(thread)300
2541 y(to)d(manipulate)f(references)k(b)q(elonging)c(to)h(another)h
(thread,)g(here)h(is)e(a)g(p)q(erfectly)i(legitimate)300
2591 y(\(alb)q(eit)g(arti\014cial\))f(example:)p eop
%%Page: 10 10
10 9 bop 300 275 a Fm(10)626 895 y @beginspecial @setspecial
%%BeginDocument: threads.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y translate xrad yrad scale 0 0 1 startangle endangle arc
	savematrix setmatrix
	} def newpath 0 0 0 0 0 1 DrawEllipse stroke

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-4 5 translate
0.000000 115.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Ellipse
newpath 176 65 22 47 0 360 DrawEllipse stroke
% Polyline
newpath 178 34 moveto 178 29 lineto 173 29 lineto 173 34 lineto closepath stroke
% Polyline
newpath 178 47 moveto 178 42 lineto 173 42 lineto 173 47 lineto closepath stroke
% Polyline
newpath 178 59 moveto 178 54 lineto 173 54 lineto 173 59 lineto closepath stroke
% Polyline
newpath 178 96 moveto 178 91 lineto 173 91 lineto 173 96 lineto closepath stroke
% Polyline
newpath 178 71 moveto 178 66 lineto 173 66 lineto 173 71 lineto closepath stroke
% Polyline
newpath 178 83 moveto 178 78 lineto 173 78 lineto 173 83 lineto closepath stroke
% Polyline
newpath 170 26 moveto 175 26 lineto 175 29 lineto stroke
stroke
% Polyline
newpath 175 34 moveto 175 42 lineto stroke
stroke
% Polyline
newpath 175 47 moveto 175 54 lineto stroke
stroke
% Polyline
newpath 175 59 moveto 175 66 lineto stroke
stroke
% Polyline
newpath 175 71 moveto 175 78 lineto stroke
stroke
% Polyline
newpath 175 83 moveto 175 91 lineto stroke
stroke
% Polyline
newpath 175 96 moveto 175 102 lineto 182 102 lineto stroke
stroke
% Ellipse
newpath 42 64 17 37 0 360 DrawEllipse stroke
% Polyline
newpath 44 42 moveto 44 37 lineto 39 37 lineto 39 42 lineto closepath stroke
% Polyline
newpath 44 55 moveto 44 50 lineto 39 50 lineto 39 55 lineto closepath stroke
% Polyline
newpath 44 90 moveto 44 85 lineto 39 85 lineto 39 90 lineto closepath stroke
% Polyline
newpath 41 42 moveto 41 50 lineto stroke
stroke
% Polyline
newpath 41 55 moveto 41 63 lineto stroke
stroke
% Polyline
newpath 44 68 moveto 44 63 lineto 39 63 lineto 39 68 lineto closepath stroke
% Polyline
newpath 44 79 moveto 44 74 lineto 39 74 lineto 39 79 lineto closepath stroke
% Polyline
newpath 41 68 moveto 41 74 lineto stroke
stroke
% Polyline
newpath 41 79 moveto 41 85 lineto stroke
stroke
% Polyline
newpath 41 37 moveto 41 33 lineto 37 33 lineto stroke
stroke
% Polyline
newpath 41 90 moveto 41 94 lineto 45 94 lineto stroke
stroke
% Ellipse
newpath 106 86 18 39 0 360 DrawEllipse stroke
% Polyline
newpath 11 5 moveto 4 5 4 126 7 arcto 4 {pop} repeat 4 133 229 133 7 arcto 4 {pop} repeat 236 133 236 12 7 arcto 4 {pop} repeat 236 5 11 5 7 arcto 4 {pop} repeat closepath stroke
% Polyline
newpath 107 62 moveto 107 57 lineto 102 57 lineto 102 62 lineto closepath stroke
% Polyline
newpath 107 100 moveto 107 95 lineto 102 95 lineto 102 100 lineto closepath stroke
% Polyline
newpath 107 90 moveto 107 85 lineto 102 85 lineto 102 90 lineto closepath stroke
% Polyline
newpath 107 81 moveto 107 76 lineto 102 76 lineto 102 81 lineto closepath stroke
% Polyline
newpath 107 72 moveto 107 67 lineto 102 67 lineto 102 72 lineto closepath stroke
% Polyline
newpath 107 110 moveto 107 105 lineto 102 105 lineto 102 110 lineto closepath stroke
% Polyline
newpath 105 57 moveto 105 53 lineto 101 53 lineto stroke
stroke
% Polyline
newpath 105 62 moveto 105 67 lineto stroke
stroke
% Polyline
newpath 105 72 moveto 105 76 lineto stroke
stroke
% Polyline
newpath 105 81 moveto 105 85 lineto stroke
stroke
% Polyline
newpath 105 90 moveto 105 95 lineto stroke
stroke
% Polyline
newpath 105 100 moveto 105 105 lineto stroke
stroke
% Polyline
newpath 105 110 moveto 105 117 lineto 111 117 lineto stroke
stroke
/Courier-Bold findfont 12.000 scalefont setfont
129 23 moveto 
1 -1 scale
(runST) gsave  0.000 rotate show grestore 1 -1 scale
/Courier-Bold findfont 12.000 scalefont setfont
65 48 moveto 
1 -1 scale
(runST) gsave  0.000 rotate show grestore 1 -1 scale
/Courier-Bold findfont 12.000 scalefont setfont
6 25 moveto 
1 -1 scale
(runST) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 1051 a Fr(Figur)n(e)14 b(1.)i Fw(An)c(informal)d
(picture)g(of)j(a)f(program)e(with)j(state)e(threads)344
1231 y Fk(f)21 b(::)h(MutVar)e(s)i(a)f(->)h(MutVar)e(s)i(a)344
1281 y(f)f(v)h(=)f(runST)g(\(newVar)f(v)i(`thenST`)e(\\w->)627
1331 y(readVar)g(w\))300 1430 y Fo(where)c Fk(v)g Fo(is)f(a)g
(reference)i(from)d(some)g(\(other\))j(arbitrary)e(state)h(thread.)23
b(Because)17 b Fk(v)e Fo(is)g(not)300 1480 y(accessed,)23
b(its)c(state)h(t)o(yp)q(e)g(do)q(es)g(not)g(a\013ect)g(the)g(lo)q(cal)
f(state)h(t)o(yp)q(e)g(of)f(the)h(short)g(thread)300
1530 y(\(whic)o(h)12 b(is)g(in)g(fact)g(totally)f(p)q(olymorphic)f(in)i
Fk(v)p Fo(\).)17 b(Th)o(us)c(it)f(is)g(\014ne)g(for)g(an)g
(encapsulated)i(state)300 1580 y(thread)h(to)f(manipulate)e(references)
17 b(from)12 b(other)j(threads)g(so)f(long)f(as)h(no)g(attempt)g(is)g
(made)300 1630 y(to)g(dereference)j(them.)333 1679 y(In)i(short,)g(b)o
(y)f(the)h(exp)q(edien)o(t)h(of)d(giving)g Fk(runST)g
Fo(a)h(rank-2)g(p)q(olymorphic)f(t)o(yp)q(e)i(w)o(e)f(can)300
1729 y(enforce)c(the)g(safe)f(encapsulation)g(of)f(state)i
(transformers.)j(More)d(details)f(on)f(this)h(are)h(giv)o(en)300
1779 y(in)e(Sections)g(6)g(and)g(9.2,)f(where)i(w)o(e)f(sho)o(w)g(that)
g Fk(runST)o Fo('s)g(t)o(yp)q(e)h(can)f(b)q(e)h(accommo)q(dated)d(with)
300 1829 y(only)j(a)h(minor)e(enhancemen)o(t)i(to)g(the)g(t)o(yp)q(e)h
(c)o(hec)o(k)o(er.)300 1962 y Fp(2.6.)48 b(Summary)300
2061 y Fo(W)m(e)13 b(ha)o(v)o(e)h(describ)q(ed)i(a)d(small)f
(collection)i(of:)300 2144 y Fn(\017)45 b Fo(Primitiv)o(e)8
b(state)i(transformers,)f(namely)f Fk(returnST)n Fo(,)i
Fk(newVar)o Fo(,)f Fk(readVar)o Fo(,)h(and)f Fk(writeVar)n
Fo(;)300 2227 y Fn(\017)45 b Fo(\\Plum)o(bing")14 b(com)o(binators,)g
(whic)o(h)i(comp)q(ose)g(state)h(transformers)f(together,)h(namely)366
2276 y Fk(thenST)c Fo(and)h(its)g(deriv)n(ativ)o(es,)f
Fk(thenST_)n Fo(,)h Fk(listST)o Fo(,)f Fk(mapST)o Fo(,)g(and)h(so)g
(on.)300 2359 y Fn(\017)45 b Fo(An)18 b(encapsulator,)h
Fk(runST)o Fo(,)f(whic)o(h)f(runs)i(a)e(state)i(transformer)e(on)g(the)
h(empt)o(y)f(state,)366 2409 y(discards)d(the)g(resulting)f(state,)g
(and)g(returns)h(the)g(result)g(deliv)o(ered)f(b)o(y)g(the)g(state)h
(trans-)366 2459 y(former.)300 2541 y(Figure)i(1)f(giv)o(es)g(an)g
(informal)e(picture)j(of)f(a)h(program)d(with)j(a)f(n)o(um)o(b)q(er)g
(of)f(calls)i(to)f Fk(runST)o Fo(.)300 2591 y(Eac)o(h)i(call)f(to)h
Fk(runST)e Fo(giv)o(es)i(rise)g(to)g(an)f(indep)q(enden)o(t)i(thread,)g
(depicted)g(as)f(a)f(large)g(o)o(v)n(al.)p eop
%%Page: 11 11
11 10 bop 1749 275 a Fm(11)300 416 y Fo(The)20 b(plum)o(bing)c(com)o
(binators)i(ensure)i(that)f(the)h(state)g(is)f(single-threaded,)h(so)g
(that)f(the)300 466 y(net)e(e\013ect)h(is)e(to)h(plum)o(b)d(the)j
(state)h(through)e(a)g(c)o(hain)g(of)g(primitiv)o(e)e(op)q(erations)j
(\()p Fk(newVar)o Fo(,)300 516 y Fk(readVar)g Fo(and)i
Fk(writeVar)n Fo(\),)g(eac)o(h)g(of)f(whic)o(h)h(is)f(depicted)i(as)f
(a)f(small)f(square)i(b)q(o)o(x.)32 b(The)300 565 y(relativ)o(e)18
b(in)o(terlea)o(ving)f(of)g(the)i(primitiv)o(e)d(op)q(erations)i(in)f
(eac)o(h)i(thread)g(is)e(unde\014ned)j(but,)300 615 y(since)14
b(the)f(threads)i(share)e(no)g(state,)h(di\013eren)o(t)g(in)o(terlea)o
(vings)e(cannot)h(giv)o(e)g(rise)h(to)e(di\013eren)o(t)300
665 y(results.)333 716 y(Notice)i(that)g(it)f(is)g(only)g(the)h(state)g
(that)f(is)h(single-threaded.)k(Both)c(references)i(and)e(state)300
766 y(transformers,)f(in)g(con)o(trast,)h(are)g(\014rst-class)g(v)n
(alues)g(whic)o(h)f(can)h(b)q(e)g(duplicated,)f(discarded,)300
816 y(stored)18 b(in)e(data)h(structures,)j(passed)e(to)e(functions,)i
(returned)g(as)f(results,)i(and)d(so)h(on.)27 b(A)300
865 y(reference)17 b(can)e(only)g(b)q(e)g(used,)h(ho)o(w)o(ev)o(er,)f
(b)o(y)f(bringing)g(it)h(bac)o(k)g(together)h(with)e(\\its")h(state)300
915 y(in)e(a)h Fk(readVar)e Fo(or)i Fk(writeVar)e Fo(op)q(eration.)333
966 y(The)19 b(crucial)g(idea)f(is)h(that)g(of)f(\\indexing")f(state)j
(transformers,)f(states,)h(and)f(m)o(utable)300 1016
y(v)n(ariables,)i(with)e(a)h(t)o(yp)q(e.)38 b(It)20 b(is)g(usual)g(for)
g(a)f(v)n(alue)h(of)f(t)o(yp)q(e)i Fk(Tree)g(t)p Fo(,)g(sa)o(y)m(,)g
(to)f(con)o(tain)300 1066 y(sub-comp)q(onen)o(ts)d(of)g(t)o(yp)q(e)h
Fk(t)p Fo(.)29 b(That)17 b(is)h(not)f(the)h(case)g(for)g(m)o(utable)d
(v)n(ariables)i(and)h(state)300 1116 y(transformers!)24
b(In)16 b(the)g(t)o(yp)q(e)h Fk(ST)k(s)h(a)p Fo(,)16
b(the)g(\\)p Fk(s)p Fo(")f(is)h(used)h(to)f(lab)q(el)f(the)i(state)f
(transformer,)300 1165 y(and)f(force)i(compatibilit)o(y)12
b(b)q(et)o(w)o(een)17 b(state)g(transformers)e(whic)o(h)h(are)g(comp)q
(osed)f(together.)300 1215 y(Similarly)l(,)9 b(the)k(\\)p
Fk(s)o Fo(")f(in)g Fk(MutVar)20 b(s)i(a)12 b Fo(simply)e(ensures)k
(that)e(a)g(reference)i(can)f(only)e(b)q(e)i(deref-)300
1265 y(erenced)k(in)d(\\its")h(state)g(thread.)22 b(It)15
b(is)g(for)f(this)h(reason)h(that)f(w)o(e)g(sp)q(eak)g(of)f(a)h(state)h
(\\b)q(eing)300 1315 y(indexed)e(b)o(y")g(a)f(t)o(yp)q(e,)h(rather)h
(than)f(\\ha)o(ving")e(that)i(t)o(yp)q(e.)333 1366 y(The)e(t)o(yp)q(e)f
(constructor)i Fk(ST)d Fo(together)i(with)e(the)i(functions)f
Fk(returnST)e Fo(and)i Fk(thenST)e Fo(form)h(a)300 1416
y(so-called)j Fl(monad)i Fo(\(Moggi)d([1989]\),)g(and)h(ha)o(v)o(e)h(a)
f(nice)h(algebra.)k(F)m(or)13 b(a)g(detailed)h(discussion)300
1465 y(of)f(monads)g(see)i(W)m(adler)e([1992a].)300 1602
y Fp(3.)48 b(Arra)o(y)15 b(references)300 1703 y Fo(So)c(far)g(w)o(e)g
(ha)o(v)o(e)g(in)o(tro)q(duced)h(the)g(idea)f(of)f(references)k
(\(Section)e(2.2\),)e(whic)o(h)h(can)h(b)q(e)g(though)o(t)300
1753 y(of)f(as)g(a)g(single)g(m)o(utable)e(\\b)q(o)o(x".)16
b(Sometimes,)10 b(though)h(w)o(e)g(w)o(an)o(t)g(to)g(up)q(date)h(an)f
(arra)o(y)f(whic)o(h)300 1803 y(should)15 b(b)q(e)h(though)o(t)f(of)g
(as)h(man)o(y)d(\\b)q(o)o(xes",)j(eac)o(h)f(indep)q(enden)o(tly)i(m)o
(utable.)k(F)m(or)15 b(that)g(w)o(e)300 1853 y(pro)o(vide)h(op)q
(erations)g(to)g(allo)q(cate,)g(read)g(and)g(write)g(elemen)o(ts)g(of)g
(arra)o(ys.)24 b(They)17 b(ha)o(v)o(e)f(the)300 1903
y(follo)o(wing)11 b(t)o(yp)q(es)570 1888 y Fv(3)590 1903
y Fo(:)344 2003 y Fk(newArr)86 b(::)21 b(Ix)g(i)h(=>)f(\(i,i\))g(->)g
(v)h(->)f(ST)h(s)f(\(MutArr)g(s)g(i)h(v\))344 2053 y(readArr)64
b(::)21 b(Ix)g(i)h(=>)f(MutArr)g(s)g(i)h(v)g(->)f(i)h(->)f(ST)g(s)h(v)
344 2103 y(writeArr)42 b(::)21 b(Ix)g(i)h(=>)f(MutArr)g(s)g(i)h(v)g(->)
f(i)h(->)f(v)g(->)h(ST)f(s)h(\(\))333 2204 y Fo(Lik)o(e)13
b(references,)j Fk(newArr)c Fo(allo)q(cates)h(a)h(new)f(arra)o(y)g
(whose)h(b)q(ounds)g(are)g(giv)o(en)f(b)o(y)g(its)h(\014rst)300
2254 y(argumen)o(t.)i(The)11 b(second)h(argumen)o(t)e(is)g(a)h(v)n
(alue)f(to)h(whic)o(h)g(eac)o(h)g(lo)q(cation)f(is)g(initialised.)16
b(The)300 2303 y(state)e(transformer)f(returns)h(a)f(reference)i(to)e
(the)h(arra)o(y)f(of)f(t)o(yp)q(e)i Fk(MutArr)20 b(s)i(i)g(v)o
Fo(,)13 b(whic)o(h)g(w)o(e)300 2353 y(call)f(an)g Fl(arr)n(ay)i(r)n
(efer)n(enc)n(e)p Fo(.)i(The)e(functions)e Fk(readArr)f
Fo(and)i Fk(writeArr)e Fo(do)h(what)h(their)g(names)300
2403 y(suggest.)19 b(The)14 b(result)h(is)f(unde\014ned)h(if)e(the)h
(index)g(is)g(out)g(of)f(b)q(ounds.)333 2454 y(The)19
b(three)h(op)q(erations)e(can)h(b)q(e)f(implemen)o(ted)f(using)h(the)g
(m)o(utable)f(v)n(ariables)h(already)300 2504 y(in)o(tro)q(duced,)11
b(b)o(y)e(represen)o(ting)i(an)e(arra)o(y)g(reference)j(as)d(an)g
(\(imm)o(utabl)o(e\))e(arra)o(y)i(of)g(references,)300
2553 y(th)o(us:)p eop
%%Page: 12 12
12 11 bop 300 275 a Fm(12)344 416 y Fk(type)21 b(MutArr)f(s)i(i)f(v)h
(=)f(Array)g(i)h(\(MutVar)e(s)i(v\))300 501 y Fo(This)d(de\014nition)h
(mak)o(es)e(use)i(of)f(the)h(standard)g(Hask)o(ell)f(t)o(yp)q(e)h
Fk(Array)h(i)h(v)o Fo(,)f(the)f(t)o(yp)q(e)g(of)300 551
y(arra)o(ys)e(indexed)g(b)o(y)g(v)n(alues)g(of)f(t)o(yp)q(e)h
Fk(i)p Fo(,)h(with)e(elemen)o(ts)h(of)f(t)o(yp)q(e)i
Fk(v)o Fo(.)31 b(Hask)o(ell)17 b(arra)o(ys)h(are)300
600 y(constructed)d(b)o(y)d(the)h(function)f Fk(array)o
Fo(,)g(and)h(indexed)g(with)f(the)h(in\014x)f(op)q(erator)h
Fk(\(!\))p Fo(,)f(whose)300 650 y(t)o(yp)q(es)j(are)f(as)g(follo)o(ws:)
344 735 y Fk(array)20 b(::)i(Ix)f(i)h(=>)f(\(i,i\))g(->)g([\(i,v\)])42
b(->)22 b(Array)e(i)i(v)344 785 y(\(!\))64 b(::)22 b(Ix)f(i)h(=>)f
(Array)g(i)g(v)h(->)f(i)h(->)f(v)300 870 y Fo(The)d(arra)o
(y-construction)g(function)f Fk(array)g Fo(tak)o(es)h(the)g(b)q(ounds)g
(of)f(the)h(arra)o(y)f(and)h(list)f(of)300 920 y(index-v)n(alue)f
(pairs,)h(and)g(returns)h(an)f(arra)o(y)g(constructed)i(b)o(y)d
(\014lling)g(in)g(the)i(arra)o(y)e(in)h(the)300 970 y(w)o(a)o(y)c(sp)q
(eci\014ed)j(b)o(y)d(the)i(list)e(of)g(index-v)n(alue)h(pairs)1105
955 y Fv(4)1123 970 y Fo(.)333 1020 y(The)h(implem)o(en)o(tation)c(of)i
Fk(newArr)o Fo(,)g Fk(readArr)o Fo(,)g(and)h Fk(writeArr)e
Fo(is)i(then)g(straigh)o(tforw)o(ard:)344 1105 y Fk(newArr)20
b(bds)h(init)g(=)h(mapST)f(newVar)f(indices)86 b(`thenST`)20
b(\\)i(vs)f(->)736 1155 y(returnST)f(\(array)h(bds)g(\(indices)f(`zip`)
h(vs\)\))540 1205 y(where)583 1255 y(--)h(indices)e(::)h([\(i,v\)])583
1305 y(indices)g(=)g(range)g(bds)344 1404 y(readArr)42
b(arr)21 b(i)65 b(=)22 b(readVar)42 b(\(arr!i\))344 1454
y(writeArr)20 b(arr)h(i)g(v)h(=)g(writeVar)e(\(arr!i\))g(v)300
1539 y Fo(The)12 b(only)e(in)o(teresting)i(de\014nition)f(is)g(that)g
(for)g Fk(newArr)o Fo(,)g(whic)o(h)h(uses)g Fk(mapST)e
Fo(\(Section)i(2.4\))e(to)300 1589 y(apply)i Fk(newVar)e
Fo(to)j(eac)o(h)f(index.)18 b(The)12 b(standard)h(function)f
Fk(range)f Fo(is)h(applied)g(to)g(the)h(b)q(ounds)300
1638 y(of)k(the)g(arra)o(y)g(|)g(that)g(is,)h(a)f(pair)g(of)f(v)n
(alues)h(in)g(class)h Fk(Ix)e Fo(|)h(to)g(deliv)o(er)g(a)g(list)g(of)g
(all)f(the)300 1688 y(indices)e(of)g(the)g(arra)o(y)650
1673 y Fv(5)668 1688 y Fo(.)333 1739 y(In)g(practice,)h(w)o(e)f(do)f
(not)h(implemen)o(t)d(m)o(utable)i(arra)o(ys)g(in)h(this)g(w)o(a)o(y)f
(for)h(t)o(w)o(o)f(reasons:)300 1823 y Fn(\017)45 b Fo(Implemen)o(ting)
9 b(arra)o(ys)j(in)g(terms)f(of)h(v)n(ariables)f(is)g(rather)i
(ine\016cien)o(t.)18 b(A)11 b(single)h(m)o(utable)366
1873 y(arra)o(y)j(of)g(100)f(elemen)o(ts)h(w)o(ould)f(require)i(an)f
(imm)n(utable)d(arra)o(y)j(of)f(100)h(elemen)o(ts,)f(plus)366
1923 y(100)i(separately-allo)q(cated)h(m)o(utable)e(v)n(ariables.)25
b(Eac)o(h)17 b(read)g(or)g(write)g(w)o(ould)e(require)366
1973 y(t)o(w)o(o)d(memory)e(references,)k(one)f(to)e(the)i(arra)o(y)m
(,)e(and)h(a)g(second)h(to)f(the)h(v)n(ariable.)j(It)c(w)o(ould)366
2023 y(ob)o(viously)i(b)q(e)h(more)f(sensible)i(to)e(allo)q(cate)g(one)
h(m)o(utable)f(arra)o(y)g(of)g(100)g(elemen)o(ts,)h(and)366
2072 y(ha)o(v)o(e)f Fk(writeArr)e Fo(m)o(utate)h(the)i(elemen)o(ts)e
(directly)m(.)300 2158 y Fn(\017)45 b Fo(Implemen)o(ting)10
b(arra)o(ys)i(in)g(terms)g(of)g(v)n(ariables)g(dep)q(ends)i(on)e(the)h
(existence)h(of)e(standard)366 2208 y(Hask)o(ell)17 b(arra)o(ys.)27
b(Ho)o(w)17 b(are)g(the)g(latter)h(to)e(b)q(e)i(implemen)o(ted?)25
b(Presumably)m(,)16 b(in)g(a)h(se-)366 2257 y(quen)o(tial)c(system,)g
(the)i(implem)o(en)o(tation)c(of)i Fk(array)g Fo(will)f(in)o(v)o(olv)o
(e)g(allo)q(cating)g(a)h(suitable)366 2307 y(blo)q(c)o(k)i(of)g(memory)
m(,)d(and)i(running)h(do)o(wn)g(the)h(list)e(of)h(index-v)n(alue)f
(pairs,)h(\014lling)e(in)i(the)366 2357 y(sp)q(eci\014ed)i(elemen)o(ts)
d(of)g(the)h(arra)o(y)f(as)h(w)o(e)g(go.)20 b(Lo)q(ok)o(ed)14
b(at)g(lik)o(e)g(this,)h(w)o(e)f(need)i(m)o(utable)366
2407 y(arra)o(ys)e(to)g(implemen)o(t)d(imm)o(utabl)o(e)h(arra)o(ys!)18
b(\(W)m(e)13 b(return)i(to)f(this)g(topic)g(in)f(Section)i(7.\))300
2492 y(Because)c(of)e(these)i(considerations)e(w)o(e)h(actually)e(pro)o
(vide)h Fk(newArray)o Fo(,)g Fk(readArr)f Fo(and)h Fk(writeArr)300
2541 y Fo(as)j(primitiv)o(es,)e(and)i(de\014ne)h Fk(newVar)n
Fo(,)f Fk(readVar)o Fo(,)g(and)f Fk(writeVar)g Fo(in)g(terms)h(of)f
(them,)g(b)o(y)h(rep-)300 2591 y(resen)o(ting)j(v)n(ariables)e(as)h
(arra)o(ys)g(of)f(size)i(one.)p eop
%%Page: 13 13
13 12 bop 1749 275 a Fm(13)300 416 y Fp(4.)48 b(Input/outp)o(ut)300
516 y Fo(No)o(w)13 b(that)g(w)o(e)g(ha)o(v)o(e)g(the)h
(state-transformer)f(framew)o(ork)e(in)i(place,)g(w)o(e)g(can)h(giv)o
(e)e(a)h(new)g(ac-)300 565 y(coun)o(t)d(of)e(input/output.)16
b(An)10 b(I/O-p)q(erforming)e(computation)f(is)i(of)g(t)o(yp)q(e)h
Fk(ST)21 b(RealWorld)f(a)p Fo(;)300 615 y(that)c(is,)f(it)g(is)h(a)f
(state)i(transformer)e(transforming)f(a)h(state)i(of)e(t)o(yp)q(e)h
Fk(RealWorld)n Fo(,)g(and)f(de-)300 665 y(liv)o(ering)d(a)i(v)n(alue)f
(of)g(t)o(yp)q(e)h Fk(a)p Fo(.)k(The)c(only)f(thing)g(whic)o(h)g(mak)o
(es)g(it)g(sp)q(ecial)h(is)f(the)i(t)o(yp)q(e)f(of)f(the)300
715 y(state)f(it)f(transforms,)f(namely)g Fk(RealWorld)n
Fo(,)h(an)g(abstract)h(t)o(yp)q(e)g(whose)f(v)n(alues)g(represen)o(t)j
(the)300 765 y(real)g(w)o(orld.)j(It)d(is)g(con)o(v)o(enien)o(t)g(to)g
(use)h(a)e(t)o(yp)q(e)i(synon)o(ym)d(to)i(express)h(this)f(sp)q
(ecialisation:)344 864 y Fk(type)21 b(IO)g(a)h(=)f(ST)g(RealWorld)f(a)
333 964 y Fo(Since)h Fk(IO)g(a)f Fo(is)g(an)g(instance)h(of)f
Fk(ST)h(s)h(a)o Fo(,)g(it)e(follo)o(ws)e(that)i(all)f(the)i
(state-transformer)300 1014 y(primitiv)o(es)10 b(concerning)i
(references)i(and)d(arra)o(ys)h(w)o(ork)f(equally)g(w)o(ell)f(when)i
(mixed)e(with)h(I/O)300 1064 y(op)q(erations.)18 b(More)c(than)f(that,)
f(the)i(same)e(\\plum)o(bing")e(com)o(binators,)i Fk(thenST)n
Fo(,)h Fk(returnST)300 1113 y Fo(and)i(so)g(on,)f(w)o(ork)h(for)g(I/O)g
(as)g(for)g(other)g(state)h(transformers.)21 b(In)15
b(addition,)f(ho)o(w)o(ev)o(er,)h(w)o(e)300 1163 y(pro)o(vide)d(a)f(v)n
(ariet)o(y)h(of)f(I/O)h(op)q(erations)g(that)h(w)o(ork)e(only)g(on)h
(the)h Fk(IO)e Fo(instance)i(of)e(state)i(\(that)300
1213 y(is,)g(they)i(are)f Fl(not)g Fo(p)q(olymorphic)e(in)i(the)g
(state\),)g(suc)o(h)h(as:)344 1313 y Fk(putChar)20 b(::)h(Char)g(->)h
(IO)f(\(\))344 1362 y(getChar)f(::)h(IO)h(Char)333 1462
y Fo(It)11 b(is)f(easy)h(to)f(build)f(more)h(sophisticated)h(I/O)f(op)q
(erations)h(on)f(top)g(of)g(these.)18 b(F)m(or)10 b(example:)344
1562 y Fk(putString)20 b(::)h([Char])f(->)i(IO)f(\(\))344
1611 y(putString)63 b([])i(=)22 b(returnST)e(\(\))344
1661 y(putString)g(\(c:cs\))g(=)i(putChar)e(c)43 b(`thenST_`)758
1711 y(putString)20 b(cs)300 1811 y Fo(or,)13 b(equiv)n(alen)o(tly)m(,)
344 1910 y Fk(putString)20 b(cs)h(=)g(mapST_)g(putChar)f(cs)300
2093 y Fp(4.1.)48 b(System)15 b(calls)300 2193 y Fo(It)d(w)o(ould)f(b)q
(e)h(p)q(ossible)g(to)f(pro)o(vide)h Fk(putChar)e Fo(and)h
Fk(getChar)f Fo(as)i(primitiv)o(es)e(|)h(that)h(is,)f(func-)300
2242 y(tions)i(whic)o(h)f(are)h(not)g(de\014nable)g(in)g(Hask)o(ell.)k
(The)c(di\016cult)o(y)f(is)g(that)h(there)h(are)g(p)q(oten)o(tially)300
2292 y(a)f(v)o(ery)g(large)f(collection)h(of)f(suc)o(h)i(\\primitiv)o
(e")c(I/O)j(op)q(erations,)g(and)f(it)h(is)g(v)o(ery)g(lik)o(ely)e
(that)300 2342 y(programmers)k(will)g(w)o(an)o(t)i(to)g(add)g(new)g
(ones)g(of)g(their)g(o)o(wn.)27 b(T)m(o)16 b(meet)g(this)h(concern,)i
(w)o(e)300 2392 y(pro)o(vide)e(just)g(one)g(primitiv)o(e)e(I/O)i(op)q
(eration,)g(called)g Fk(ccall)o Fo(,)g(whic)o(h)g(allo)o(ws)e(the)j
(Hask)o(ell)300 2442 y(programmer)11 b(to)j(call)f(an)o(y)g(C)h(pro)q
(cedure.)20 b(Using)14 b Fk(ccall)e Fo(w)o(e)i(can)g(de\014ne)h(all)e
(the)h(other)g(I/O)300 2492 y(op)q(erations;)g(for)f(example,)f
Fk(putChar)h Fo(is)g(de\014ned)i(lik)o(e)f(this:)344
2591 y Fk(putChar)20 b(::)h(Char)g(->)h(IO)f(\(\))p eop
%%Page: 14 14
14 13 bop 300 275 a Fm(14)344 416 y Fk(putChar)20 b(c)i(=)f(ccall)g
(putchar)f(c)333 517 y Fo(That)14 b(is,)g(the)h(state)g(transformer)e
Fk(\(putChar)20 b(c\))14 b Fo(transforms)f(the)i(real)f(w)o(orld)g(b)o
(y)g(calling)300 567 y(the)19 b(C)g(function)f Fk(putchar)n
Fo(,)h(passing)g(it)f(the)h(c)o(haracter)h Fk(c)p Fo(.)31
b(The)19 b(v)n(alue)f(returned)i(b)o(y)f(the)300 617
y(call)d(is)g(ignored,)g(as)h(indicated)f(b)o(y)h(the)g(result)g(t)o
(yp)q(e)g(of)f Fk(putChar)n Fo(.)26 b(Similarly)l(,)14
b Fk(getChar)g Fo(is)300 667 y(implemen)o(ted)e(lik)o(e)h(this:)344
768 y Fk(getChar)20 b(::)h(IO)h(Char)344 818 y(getChar)e(=)i(ccall)e
(getchar)333 919 y Fo(W)m(e)e(implem)o(en)o(t)e Fk(ccall)g
Fo(as)i(a)f(new)i Fl(language)g(c)n(onstruct)p Fo(,)f(rather)h(than)e
(as)h(an)g(ordinary)300 969 y(function,)i(b)q(ecause)i(w)o(e)e(w)o(an)o
(t)f(it)g(to)h(w)o(ork)f(regardless)i(of)e(the)i(n)o(um)o(b)q(er)e(and)
g(t)o(yp)q(e)h(of)f(its)300 1019 y(argumen)o(ts.)28 b(\(An)18
b(ordinary)f(function,)g(p)q(ossessing)i(only)e(one)g(t)o(yp)q(e,)i(w)o
(ould)d(tak)o(e)i(a)f(\014xed)300 1069 y(n)o(um)o(b)q(er)c(of)g
(argumen)o(ts)h(of)f(\014xed)h(t)o(yp)q(e.\))19 b(The)14
b(restrictions)h(placed)g(on)e(its)h(use)h(are:)300 1157
y Fn(\017)45 b Fo(All)16 b(the)h(argumen)o(ts,)g(and)f(the)h(result,)h
(m)o(ust)d(b)q(e)j(t)o(yp)q(es)f(whic)o(h)g(C)f(understands:)25
b Fk(Int)p Fo(,)366 1207 y Fk(Float)o Fo(,)16 b Fk(Double)o
Fo(,)g Fk(Bool)o Fo(,)g Fk(String)o Fo(,)g(or)f Fk(Array)o
Fo(.)24 b(There)17 b(is)f(no)g(automatic)e(con)o(v)o(ersion)i(of)366
1257 y(more)i(complex)g(structured)j(t)o(yp)q(es,)f(suc)o(h)g(as)f
(lists)f(\(apart)h(from)e(lists)i(of)f(c)o(haracters,)366
1306 y(whic)o(h)12 b(are)g(treated)h(sp)q(ecially)e(as)h(strings\))h
(or)e(trees.)19 b(F)m(urthermore,)12 b(the)g(t)o(yp)q(es)h(in)o(v)o
(olv)o(ed)366 1356 y(m)o(ust)e(b)q(e)g(statically)g(deducible)h(b)o(y)f
(the)g(compiler)f(from)g(the)i(surrounding)f(con)o(text;)h(that)366
1406 y(is,)g Fk(ccall)f Fo(cannot)i(b)q(e)f(used)h(in)f(a)g(p)q
(olymorphic)e(con)o(text.)18 b(The)13 b(programmer)d(can)i(easily)366
1456 y(supply)i(an)o(y)g(missing)e(t)o(yp)q(e)i(information)d(with)j(a)
f(t)o(yp)q(e)i(signature.)300 1546 y Fn(\017)45 b Fo(The)12
b(\014rst)g(\\argumen)o(t")d(of)i Fk(ccall)n Fo(,)h(whic)o(h)e(is)h
(the)h(name)e(of)g(the)i(C)f(function)g(to)f(b)q(e)i(called,)366
1596 y(m)o(ust)h(app)q(ear)i(literally)m(.)h(It)e(is)f(part)i(of)e(the)
h(language)f(construct.)300 1734 y Fp(4.2.)48 b(Running)13
b(I/O)300 1837 y Fo(The)18 b Fk(IO)g Fo(t)o(yp)q(e)h(is)e(a)h
(particular)g(instance)h(of)e(state)i(transformers)f(so,)g(in)g
(particular,)g(I/O)300 1887 y(op)q(erations)d(are)g(not)f(p)q
(olymorphic)f(in)h(the)h(state.)21 b(An)15 b(immediate)d(consequence)17
b(of)d(this)g(is)300 1937 y(that)e Fl(I/O)g(op)n(er)n(ations)h(c)n
(annot)g(b)n(e)g(enc)n(apsulate)n(d)h(using)e Fk(runST)o
Fo(.)17 b(Wh)o(y)11 b(not?)17 b(Again,)11 b(b)q(ecause)300
1986 y(of)18 b Fk(runST)o Fo('s)g(t)o(yp)q(e.)31 b(It)18
b(demands)g(that)g(its)g(state)i(transformer)d(argumen)o(t)g(b)q(e)i
(univ)o(ersally)300 2036 y(quan)o(ti\014ed)14 b(o)o(v)o(er)g(the)g
(state,)g(but)g(that)g(is)g(exactly)g(what)g Fk(IO)f
Fo(is)h(not!)333 2088 y(F)m(ortunately)m(,)9 b(this)h(is)g(exactly)g
(what)f(w)o(e)h(w)o(an)o(t.)16 b(If)10 b(I/O)f(op)q(erations)h(could)g
(b)q(e)g(encapsulated)300 2138 y(then)k(it)g(w)o(ould)e(b)q(e)j(p)q
(ossible)f(to)f(write)h(apparen)o(tly)g(pure)g(functions,)f(but)h
(whose)h(b)q(eha)o(viour)300 2187 y(dep)q(ended)g(on)d(external)i
(factors,)e(the)i(con)o(ten)o(ts)g(of)e(a)h(\014le,)f(user)i(input,)e
(a)h(shared)h(C)e(v)n(ariable)300 2237 y(etc.)19 b(The)14
b(language)f(w)o(ould)g(no)h(longer)g(exhibit)f(referen)o(tial)h
(transparency)m(.)333 2289 y(Ho)o(w,)c(then,)h(are)f(I/O)g(op)q
(erations)g(executed)i(at)d(all?)16 b(The)10 b(meaning)e(of)h(the)h
(whole)g(program)300 2339 y(is)k(giv)o(en)f(b)o(y)h(the)g(v)n(alue)g
(of)f(the)h(top-lev)o(el)g(iden)o(ti\014er)g Fk(mainIO)o
Fo(:)344 2440 y Fk(mainIO)20 b(::)i(IO)f(\(\))300 2541
y(mainIO)11 b Fo(is)i(an)f(I/O)h(state)g(transformer,)f(whic)o(h)g(is)h
(applied)f(to)g(the)h(external)g(w)o(orld)f(state)i(b)o(y)300
2591 y(the)f(op)q(erating)g(system.)k(Seman)o(tically)10
b(sp)q(eaking,)j(it)f(returns)i(a)e(new)h(w)o(orld)f(state,)h(and)g
(the)p eop
%%Page: 15 15
15 14 bop 1749 275 a Fm(15)300 416 y Fo(c)o(hanges)13
b(em)o(b)q(o)q(died)e(therein)i(are)f(applied)g(to)g(the)g(real)g(w)o
(orld.)17 b(Of)12 b(course,)h(as)g(in)e(the)i(case)g(of)300
466 y(m)o(utable)h(v)n(ariables,)g(our)h(in)o(ten)o(tion)f(is)h(that)h
(the)f(program)f(will)f(actually)i(m)o(utate)f(the)h(real)300
516 y(w)o(orld)e(\\in)g(place".)333 565 y(By)20 b(this)g(means)e(it)i
(is)f(p)q(ossible)h(to)f(giv)o(e)g(a)h(full)e(de\014nition)h(of)g(Hask)
o(ell's)g(standard)h(in-)300 615 y(put/output)d(b)q(eha)o(viour)f(\(in)
o(v)o(olving)f(lists)i(of)f(requests)i(and)f(resp)q(onses\))i(as)e(w)o
(ell)f(as)h(m)o(uc)o(h)300 665 y(more.)g(Indeed,)d(the)g(Glasgo)o(w)f
(implem)o(en)o(tation)e(of)i(the)h(Hask)o(ell)f(I/O)h(system)f(is)g
(itself)h(no)o(w)300 715 y(written)20 b(en)o(tirely)f(in)g(Hask)o(ell,)
h(using)f Fk(ccall)f Fo(to)i(in)o(v)o(ok)o(e)e(Unix)h(I/O)g(primitiv)o
(es)f(directly)m(.)300 765 y(The)c(same)e(tec)o(hniques)j(ha)o(v)o(e)e
(b)q(een)i(used)f(to)f(write)h(libraries)f(of)f(routines)i(for)f
(calling)f(the)i(X)300 814 y(windo)o(w)f(system,)g(an)h(image-pro)q
(cessing)f(library)m(,)f(and)i(so)g(on.)300 947 y Fp(5.)48
b(Some)15 b(application)o(s)300 1047 y Fo(In)g(this)g(section)g(w)o(e)g
(giv)o(e)f(three)i(applications)e(of)g(the)i(state)f(transformer)g
(framew)o(ork,)e(and)300 1097 y(assess)j(its)d(usefulness.)300
1230 y Fp(5.1.)48 b(A)16 b(functional)c Fk(more)300 1329
y Fo(Our)18 b(\014rst)f(example)f(concerns)j(input/output.)27
b(The)18 b(Unix)e Fk(more)g Fo(utilit)o(y)g(allo)o(ws)g(the)h(user)300
1379 y(to)f(view)g(the)h(con)o(ten)o(ts)g(of)e(a)h(\014le,)h(a)e
(screenful)j(at)e(a)g(time.)23 b(A)16 b(status)h(line)f(is)g(displa)o
(y)o(ed)f(to)300 1429 y(giv)o(e)d(p)q(ositional)e(information,)g(and)h
(commands)f(are)j(pro)o(vided)f(to)g(allo)o(w)e(scrolling)i(in)g
(either)300 1479 y(direction.)333 1528 y(Ho)o(w)o(ev)o(er,)17
b Fk(more)f Fo(can)g(only)g(b)q(e)h(used)g(to)f(displa)o(y)g(ASCI)q(I)h
(text.)26 b(A)16 b(completely)f(di\013eren)o(t)300 1578
y(program)10 b(w)o(ould)i(b)q(e)g(needed)i(to)d(scroll)h(through)g(a)g
(\014le)g(of)f(pictures,)i(or)f(to)g(scroll)g(and)g(render)300
1628 y(a)17 b(\014le)g(of)f(P)o(ostScript.)29 b(W)m(e)17
b(can)g(impro)o(v)o(e)e(on)i(this)g(situation)g(b)o(y)g(separating)g
(the)h(pro)q(cess)300 1678 y(in)o(to)13 b(t)o(w)o(o:)300
1761 y Fn(\017)45 b Fo(A)13 b(represen)o(tation-sp)q(eci\014c)i
(function,)d(whic)o(h)g(con)o(v)o(erts)h(the)g(ASCI)q(I)g(\014le,)f
(description)h(of)366 1811 y(pictures,)i(P)o(ostScript,)f(or)g(whatev)o
(er,)g(to)g(a)g(list)f(of)g(I/O)h(actions,)f(eac)o(h)i(of)e(whic)o(h)h
(pain)o(ts)366 1861 y(a)g(single)g(screenful:)410 1960
y Fk(asciiPages)129 b(::)21 b(String)g(->)g([IO)g(\(\)])410
2010 y(picturePages)85 b(::)21 b(PictureDescription)o(s)e(->)i([IO)g
(\(\)])410 2060 y(postscriptPages)e(::)i(String)g(->)g([IO)g(\(\)])300
2159 y Fn(\017)45 b Fo(A)17 b(represen)o(tation-indep)q(enden)o(t)i
(function,)d(whic)o(h)g(tak)o(es)h(a)f(list)g(of)f(I/O)i(actions)f
(\(one)366 2209 y(for)e(eac)o(h)g(screenful\),)h(and)f(in)o(teracts)h
(with)e(the)i(user)g(to)f(na)o(vigate)f(through)g(them:)410
2309 y Fk(more)21 b(::)g([IO)h(\(\)])f(->)g(IO)g(\(\))300
2408 y Fo(No)o(w)14 b(the)g(three)h(view)o(ers)g(can)f(b)q(e)g(built)g
(b)o(y)f(comp)q(osition:)344 2492 y Fk(moreAscii)128
b(=)22 b(more)f(.)h(asciiPages)344 2541 y(morePictures)62
b(=)22 b(more)f(.)h(picturePages)344 2591 y(morePostscript)c(=)k(more)f
(.)h(postscriptPages)p eop
%%Page: 16 16
16 15 bop 300 275 a Fm(16)300 416 y Fo(Notice)12 b(the)h(complete)f
(separation)g(of)f(concerns.)19 b(The)13 b Fk(asciiPages)d
Fo(function)h(is)h(concerned)300 466 y(only)g(with)g(displa)o(ying)e
(ASCI)q(I)j(text)g(on)f(the)h(screen,)h(and)f(not)f(at)g(all)f(with)h
(user)i(in)o(teraction.)300 516 y(The)19 b Fk(more)e
Fo(function)h(is)g(concerned)j(only)c(with)h(in)o(teraction)g(with)g
(the)h(user,)h(and)e(not)g(at)300 565 y(all)e(with)h(the)h(nature)g(of)
f(the)h(material)e(b)q(eing)h(displa)o(y)o(ed.)28 b(This)17
b(separation)h(of)f(concerns)300 615 y(is)f(ac)o(hiev)o(ed)g(b)o(y)g
(passing)g(a)g(list)g(of)f(I/O)h(actions)g(from)f(one)h(function)g(to)g
(another.)25 b(Notice)300 665 y(to)q(o)15 b(that)g(some)g(of)f(these)j
(actions)e(ma)o(y)f(b)q(e)i(p)q(erformed)e(more)h(than)g(once)h(if,)e
(for)h(example,)300 715 y(the)f(user)g(scrolls)f(bac)o(k)g(to)g(a)g
(previously-displa)o(y)o(ed)f(page.)17 b(None)d(of)e(this)h(is)g(p)q
(ossible)g(in)g(an)o(y)300 765 y(imp)q(erativ)o(e)g(language)f(w)o(e)j
(kno)o(w)e(of.)333 814 y(Our)e(solution)f(has)g(its)g(shortcomings.)16
b(The)11 b(Unix)f Fk(more)f Fo(allo)o(ws)g(the)i(user)g(to)g(scroll)f
(a)g(single)300 864 y(line)j(at)h(a)f(time,)f(whereas)j(ours)f(only)e
(allo)o(ws)h(scrolling)g(in)g(units)g(of)g(pages.)19
b(It)13 b(is)h(a)f(common)300 914 y(disco)o(v)o(ery)h(that)g(go)q(o)q
(d)g(abstractions)g(sometimes)e(con\015ict)j(with)e(arbitrary)h
(functionalit)o(y!)300 1047 y Fp(5.2.)48 b(Depth)14 b(\014rst)g(searc)o
(h)300 1147 y Fo(Depth-\014rst)j(searc)o(h)f(is)f(a)h(k)o(ey)f(comp)q
(onen)o(t)g(of)g(man)o(y)e(graph)j(algorithms.)k(It)c(is)f(one)h(of)f
(the)300 1196 y(v)o(ery)e(few)f(algorithms)e(for)i(whic)o(h)g(an)g
(e\016cien)o(t)h(algorithm)c(is)k(most)e(lucidly)g(expressed)k(using)
300 1246 y(m)o(utable)d(state,)j(so)e(it)h(mak)o(es)f(a)g(go)q(o)q(d)h
(application)e(of)i(the)g(ideas)g(presen)o(ted)i(in)d(this)h(pap)q(er.)
333 1296 y(Our)g(depth-\014rst)h(searc)o(h)g(function,)e
Fk(dfs)o Fo(,)g(is)h(giv)o(en)f(in)g(Figure)g(2.)18 b(It)c(tak)o(es)g
(a)f(graph)g Fk(g)h Fo(and)300 1346 y(a)i(list)f(of)h(v)o(ertices)h
Fk(vs)p Fo(,)f(and)f(returns)j(a)e(list)f(of)h(trees)h(|)f(or)g(forest)
g(|)g(whic)o(h,)g(collectiv)o(ely)m(,)300 1396 y(span)e
Fk(g)p Fo(.)19 b(F)m(urthermore,)14 b(the)h(forest)g(has)f(the)h
(\\depth-\014rst")g(prop)q(ert)o(y;)g(that)f(is,)g(no)g(edge)h(in)300
1445 y(the)d(original)d(graph)i(tra)o(v)o(erses)i(the)f(forest)f(from)f
(left)h(to)g(righ)o(t.)16 b(The)c(list)f(of)f(v)o(ertices)j
Fk(vs)e Fo(giv)o(es)300 1495 y(an)17 b(initial)e(ordering)i(for)g
(searc)o(hing)h(the)g(v)o(ertices,)h(whic)o(h)e(is)g(used)h(to)f
(resume)g(the)h(searc)o(h)300 1545 y(whenev)o(er)c(one)f(is)g
(completed.)k(Clearly)12 b(the)h(head)h(of)e Fk(vs)g
Fo(will)f(b)q(e)j(the)f(ro)q(ot)g(of)f(the)h(v)o(ery)h(\014rst)300
1595 y(tree.)333 1645 y(The)g(graph)f(is)g(represen)o(ted)j(b)o(y)d(an)
g(arra)o(y)m(,)f(indexed)h(b)o(y)g(v)o(ertices,)h(in)f(whic)o(h)g(eac)o
(h)h(elemen)o(t)300 1694 y(con)o(tains)e(a)g(list)g(of)g(the)h(v)o
(ertices)g(reac)o(hable)g(directly)g(from)d(that)j(v)o(ertex.)18
b(The)13 b Fk(dfs)f Fo(function)300 1744 y(b)q(egins)j(b)o(y)f(in)o
(tro)q(ducing)f(a)h(fresh)h(state)g(thread,)g(allo)q(cating)d(an)i
(arra)o(y)g(of)g(marks)f(initialised)300 1794 y(to)g
Fk(False)o Fo(,)g(and)g(then)h(calling)e(the)i(lo)q(cally)e(de\014ned)j
(function)e Fk(search)o Fo(.)18 b(The)13 b(whole)h(thing)e(is)300
1844 y(encapsulated)j(b)o(y)f Fk(runST)o Fo(.)333 1894
y(When)19 b(searc)o(hing)g(a)g(list)f(of)g(v)o(ertices,)j(the)e(mark)e
(asso)q(ciated)j(with)e(the)h(\014rst)h(v)o(ertex)f(is)300
1944 y(examined,)11 b(and)h(if)g Fk(True)f Fo(the)i(v)o(ertex)h(is)e
(discarded)h(and)f(the)h(rest)h(are)f(searc)o(hed.)19
b(If)12 b(ho)o(w)o(ev)o(er)300 1993 y(the)18 b(mark)e(is)i
Fk(False)f Fo(indicating)f(that)i(the)g(v)o(ertex)h(has)f(not)f(b)q
(een)i(examined)d(previously)m(,)300 2043 y(then)i(it)f(is)h(mark)o(ed)
e Fk(True)o Fo(,)i(and)f(t)o(w)o(o)g(recursiv)o(e)i(calls)e(of)g(searc)
o(h)i(are)e(p)q(erformed,)h(eac)o(h)g(of)300 2093 y(whic)o(h)c(returns)
h(a)f(list)f(of)h(trees.)19 b(The)c(\014rst)f(call,)f(namely)m(,)e
Fk(search)21 b(marks)g(\(g!v\))o Fo(,)13 b(is)h(giv)o(en)300
2143 y(the)19 b(edges)g(leading)f(from)e Fk(v)p Fo(,)j(and)f(it)g(pro)q
(duces)i(a)e(forest)h Fk(ts)f Fo(whic)o(h)h(is)f(built)f(in)o(to)h(a)g
(tree)300 2193 y(with)13 b Fk(v)f Fo(at)h(the)h(ro)q(ot|all)d(these)j
(no)q(des)g(are)f(reac)o(hable)h(from)d Fk(v)p Fo(.)17
b(The)d(second)g(recursiv)o(e)g(call)300 2242 y(\()p
Fk(search)21 b(marks)f(vs)p Fo(\))d(pro)q(duces)i(a)d(forest)i(of)e
(those)i(v)o(ertices)g(not)f(reac)o(hable)h(from)d Fk(v)i
Fo(and)300 2292 y(not)h(previously)g(visited.)30 b(The)19
b(tree)g(ro)q(oted)g(at)f Fk(v)f Fo(is)h(added)h(to)f(the)g(fron)o(t)g
(of)g(this)g(forest)300 2342 y(giving)12 b(the)j(complete)e
(depth-\014rst)i(forest.)333 2392 y(In)e(a)g(non-strict)h(language,)e
(an)h(expression)h(is)f(ev)n(aluated)g(in)g(resp)q(onse)i(to)e(demands)
f(from)300 2442 y(the)j(consumer)g(of)f(the)h(expression's)h(v)n(alue.)
k(This)14 b(prop)q(ert)o(y)i(extends)g(to)f(v)n(alues)f(pro)q(duced)300
2492 y(b)o(y)e(stateful)g(computations.)k(In)c(the)g(case)h(of)f
(depth-\014rst)h(searc)o(h,)g(if)e(only)h(part)g(of)f(the)i(forest)300
2541 y(returned)20 b(b)o(y)e Fk(dfs)f Fo(is)h(ev)n(aluated)g(then)h
(only)e(part)h(of)g(the)h(stateful)f(computation)e(will)h(b)q(e)300
2591 y(carried)j(out.)33 b(This)19 b(is)g(quite)h(a)e(remark)n(able)g
(prop)q(ert)o(y:)29 b(w)o(e)20 b(kno)o(w)e(of)h(no)g(other)h(system)p
eop
%%Page: 17 17
17 16 bop 1749 275 a Fm(17)339 442 y Fi(type)18 b(Graph)38
b(=)19 b(Array)f(Vertex)f([Vertex])339 488 y(data)h(Tree)g(a)i(=)f
(Node)f(a)h([Tree)f(a])339 579 y(dfs)h(::)g(Graph)e(->)i([Vertex])e(->)
h([Tree)g(Vertex])339 625 y(dfs)h(g)g(vs)g(=)g(runST)f(\()614
670 y(newArr)f(\(bounds)g(g\))i(False)f(`thenST`)e(\\)j(marks)f(->)614
716 y(search)f(marks)h(vs)555 762 y(\))378 853 y(where)g(search)f(::)i
(MutArr)f(s)h(Vertex)e(Bool)h(->)h([Vertex])633 899 y(->)g(ST)g(s)g
([Tree)f(Vertex])496 944 y(search)f(marks)57 b([])h(=)20
b(returnST)c([])496 990 y(search)h(marks)h(\(v:vs\))f(=)j(readArr)d
(marks)g(v)i(`thenST`)e(\\)i(visited)e(->)928 1036 y(if)h(visited)f
(then)986 1081 y(search)h(marks)f(vs)928 1127 y(else)967
1172 y(writeArr)f(marks)i(v)h(True)38 b(`thenST_`)967
1218 y(search)17 b(marks)h(\(g!v\))96 b(`thenST`)17 b(\\)i(ts)g(->)967
1264 y(search)e(marks)h(vs)156 b(`thenST`)17 b(\\)i(us)g(->)967
1309 y(returnST)d(\(\(Node)i(v)h(ts\):)f(us\))300 1465
y Fr(Figur)n(e)c(2.)i Fw(Lazy)11 b(depth-\014rst)d(searc)o(h)300
1611 y Fo(whic)o(h)13 b(can)g(execute)i(a)e(sequen)o(tial,)g(imp)q
(erativ)o(e)e(algorithm,)f(incremen)o(tally)i(in)h(resp)q(onse)h(to)300
1660 y(demands)f(on)h(its)g(result)g(v)n(alue.)333 1717
y(This)f(algorithm,)d(and)i(man)o(y)f(others)j(deriv)n(able)e(from)f
(it,)i(or)f(de\014nable)i(in)e(terms)g(of)h(it)f(are)300
1767 y(discussed)k(in)d(detail)g(in)h(King)f(&)h(Launc)o(h)o(bury)g
([1993].)300 1922 y Fp(5.3.)48 b(An)16 b(in)o(terpr)o(eter)333
2036 y Fo(W)m(e)d(conclude)h(this)f(section)h(with)f(a)f(larger)h
(example)f(of)h(arra)o(y)g(references)j(in)c(use)i(\(Figure)300
2086 y(3\).)24 b(It)16 b(de\014nes)h(an)f(in)o(terpreter)i(for)d(a)h
(simple)e(imp)q(erativ)o(e)h(language,)g(whose)h(input)g(is)g(the)300
2136 y(program)c(together)i(with)f(a)h(list)f(of)f(input)i(v)n(alues,)e
(and)i(whose)g(output)f(is)h(the)g(list)f(of)g(v)n(alues)300
2185 y(written)f(b)o(y)g(the)g(program.)j(The)d(in)o(terpreter)i
(naturally)d(in)o(v)o(olv)o(es)f(a)h(v)n(alue)g(represen)o(ting)j(the)
300 2235 y(state)h(of)f(the)h(store.)21 b(The)15 b(idea)f(is,)g(of)g
(course,)h(that)f(the)h(store)h(should)e(b)q(e)h(implemen)o(ted)d(as)
300 2285 y(an)i(in-place-up)q(dated)g(arra)o(y)m(,)e(and)i(that)g(is)g
(precisely)h(what)e(is)h(ac)o(hiev)o(ed)1472 2270 y Fv(6)1491
2285 y Fo(.)333 2342 y(The)i(resulting)g(program)d(has)j(the)g(same)f
(laziness)h(prop)q(ert)o(y)g(as)f(our)h(depth-\014rst)h(searc)o(h.)300
2392 y(As)g(successiv)o(e)h(elemen)o(ts)e(of)f(the)i(result)g(of)e(a)h
(call)g(to)g Fk(interpret)e Fo(are)i(ev)n(aluated,)g(the)h(in-)300
2442 y(terpreter)e(will)d(incremen)o(tally)f(execute)k(the)f(program)d
(just)i(far)g(enough)g(to)f(get)i(to)e(the)i(next)300
2492 y Fk(Write)f Fo(command,)d(when)k(the)g Fk(returnST)e
Fo(deliv)o(ers)i(a)g(new)g(elemen)o(t)f(of)g(the)h(result)h(list,)e
(and)300 2541 y(no)18 b(further.)32 b(If)18 b(only)g(the)h(\014rst)g
(few)g(elemen)o(ts)f(of)f(the)i(result)h(are)e(needed,)j(m)o(uc)o(h)c
(of)h(the)300 2591 y(imp)q(erativ)o(e)13 b(program)f(b)q(eing)i(in)o
(terpreted)h(will)e(nev)o(er)h(b)q(e)h(executed)h(at)d(all.)p
eop
%%Page: 18 18
18 17 bop 300 275 a Fm(18)300 655 y Fk(data)21 b(Com)g(=)h(Assign)e
(Var)h(Exp)h(|)f(Read)g(Var)g(|)h(Write)f(Exp)g(|)g(While)g(Exp)g
([Com])300 704 y(type)g(Var)g(=)h(Char)300 754 y(data)f(Exp)g(=)h(....)
300 854 y(interpret)e(::)h([Com])g(->)g([Int])g(->)h([Int])300
904 y(interpret)e(cs)h(input)g(=)h(runST)e(\(newArr)h(\('A','Z'\))f(0)
43 b(`thenST`)20 b(\\store)h(->)910 953 y(newVar)g(input)173
b(`thenST`)20 b(\\inp->)910 1003 y(command)h(cs)g(store)g(inp\))300
1103 y(command)f(::)i([Com])e(->)i(MutArray)e(s)i(Int)f(->)g(MutVar)g
(s)g([Int])g(->)g(ST)h(s)f([Int])300 1153 y(command)f(cs)i(store)e(inp)
i(=)f(obey)g(cs)344 1202 y(where)387 1252 y(--)h(obey)f(::)g([Com])g
(->)g(ST)g(s)h([Int])387 1302 y(obey)f([])h(=)f(returnST)f([])387
1352 y(obey)h(\(Assign)f(v)i(e:cs\))f(=)g(eval)g(e)327
b(`thenST`)20 b(\\val->)888 1402 y(writeArr)h(store)f(v)i(val)f
(`thenST_`)888 1452 y(obey)g(cs)387 1501 y(obey)g(\(Read)g(v:cs\))108
b(=)21 b(readVar)g(inp)43 b(`thenST`)20 b(\\\(x:xs\))g(->)888
1551 y(writeArr)h(store)f(v)i(x)65 b(`thenST_`)888 1601
y(writeVar)21 b(inp)g(xs)130 b(`thenST_`)888 1651 y(obey)21
b(cs)387 1701 y(obey)g(\(Write)g(e:cs\))86 b(=)21 b(eval)g(e)327
b(`thenST`)20 b(\\out->)888 1750 y(obey)h(cs)305 b(`thenST`)20
b(\\outs->)888 1800 y(returnST)h(\(out:outs\))387 1850
y(obey)g(\(While)g(e)g(bs:cs\))g(=)g(eval)g(e)327 b(`thenST`)20
b(\\val->)888 1900 y(if)i(val==0)e(then)932 1950 y(obey)h(cs)888
1999 y(else)932 2049 y(obey)g(\(bs)g(++)h(While)e(e)i(bs)f(:)h(cs\))f
(inp)387 2149 y(--)h(eval)f(::)g(Exp)g(->)g(ST)h(s)f(Int)387
2199 y(eval)g(e)h(=)f(....)300 2354 y Fr(Figur)n(e)14
b(3.)i Fw(An)c(in)o(terpreter)c(with)k(lazy)e(stream)g(output)p
eop
%%Page: 19 19
19 18 bop 1749 275 a Fm(19)333 416 y Fo(This)19 b(example)e(has)i(long)
f(b)q(een)i(a)e(classic)i(test)f(case)h(for)f(systems)g(whic)o(h)f
(infer)h(single-)300 466 y(threadedness)d(\(Sc)o(hmidt)c([1985]\),)f
(and)i(is)h(also)e(used)j(b)o(y)e(W)m(adler)f(in)h(his)h(pap)q(er)g(on)
f(monads)300 516 y(\(W)m(adler)h([1992a]\).)k(The)d(only)f
(unsatisfactory)g(feature)i(of)e(the)h(solution)f(is)g(that)h
Fk(eval)e Fo(has)300 565 y(to)h(b)q(e)i(written)f(as)g(a)f
(fully-\015edged)g(state)h(transformer,)f(while)g(one)h(migh)o(t)e(p)q
(erhaps)j(lik)o(e)d(to)300 615 y(tak)o(e)h(adv)n(an)o(tage)f(of)g(its)h
(\\read-only")f(nature.)300 754 y Fp(5.4.)48 b(Summary)300
858 y Fo(An)13 b(ob)o(vious)f(question)h(arises)g(when)g(lo)q(oking)e
(at)i(monadic)e(co)q(de:)18 b(it)12 b(app)q(ears)i(to)e(di\013er)h
(only)300 908 y(sup)q(er\014cially)j(from)d(an)j(ordinary)f(imp)q
(erativ)o(e)f(program.)22 b(Ha)o(v)o(e)15 b(w)o(e)h(done)g(an)o(y)f
(more)f(than)300 957 y(disco)o(v)o(er)g(a)g(w)o(a)o(y)f(to)h(mimi)o(c)d
(C)j(in)g(Hask)o(ell?)333 1009 y(W)m(e)j(b)q(eliev)o(e)g(that,)g(on)g
(the)g(con)o(trary)m(,)h(there)g(are)f(v)o(ery)g(signi\014can)o(t)g
(di\013erences)i(b)q(et)o(w)o(een)300 1059 y(writing)12
b(programs)g(in)g(C)h(and)g(writing)f(in)h(Hask)o(ell)f(with)h(monadic)
e(state)j(transformers)f(and)300 1109 y(I/O:)300 1198
y Fn(\017)45 b Fo(Usually)m(,)18 b(most)g(of)g(the)h(program)e(is)h
(neither)h(stateful)g(nor)f(directly)h(concerned)i(with)366
1248 y(I/O.)13 b(The)h(monadic)e(approac)o(h)i(allo)o(ws)e(the)i
(graceful)f(co-existence)j(of)d(a)g(small)e(amoun)o(t)366
1297 y(of)j(\\imp)q(erativ)o(e")e(co)q(de)i(and)g(the)h(large)e(purely)
h(functional)f(part)h(of)g(the)g(program.)300 1389 y
Fn(\017)45 b Fo(The)10 b(\\imp)q(erativ)o(e")e(comp)q(onen)o(t)h(of)g
(the)h(program)e(still)g(enjo)o(ys)i(all)e(the)i(b)q(ene\014ts)h(of)e
(higher)366 1438 y(order)15 b(functions,)f(p)q(olymorphic)d(t)o(yping,)
i(and)h(automatically-m)n(anaged)d(storage.)300 1529
y Fn(\017)45 b Fo(A)15 b(state)g(transformer)f(corresp)q(onds,)i(more)e
(or)g(less,)h(to)f(a)g(statemen)o(t)h(in)f(C)g(or)g(P)o(ascal)1764
1514 y Fv(7)1783 1529 y Fo(.)366 1579 y(Ho)o(w)o(ev)o(er,)20
b(a)e(state)i(transformer)e(is)h(a)f(\014rst-class)i(v)n(alue,)e(whic)o
(h)h(can)g(b)q(e)g(stored)g(in)g(a)366 1629 y(data)g(structure,)k
(passed)d(to)f(a)g(function,)h(returned)h(as)e(a)g(result,)i(and)f(so)f
(on,)h(while)366 1679 y(a)h(C)g(statemen)o(t)f(enjo)o(ys)h(none)g(of)f
(these)i(prop)q(erties.)40 b(This)21 b(expressiv)o(e)h(p)q(o)o(w)o(er)f
(w)o(as)366 1729 y(used)h(in)d(the)i Fk(more)f Fo(example)f(ab)q(o)o(v)
o(e)h(\(Section)g(5.1\),)h(where)g(complete)f(I/O)g(actions)366
1779 y(are)c(constructed)h(b)o(y)e(one)h(function,)e(stored)j(in)d(a)h
(list,)g(and)g(subsequen)o(tly)h(p)q(erformed,)366 1828
y(p)q(erhaps)f(rep)q(eatedly)m(,)g(under)f(the)h(con)o(trol)e(of)h(an)f
(en)o(tirely)h(separate)h(function.)300 1919 y Fn(\017)45
b Fo(Imp)q(erativ)o(e)10 b(languages)h(pro)o(vide)g(a)f(\014xed)i(rep)q
(etoire)g(of)e(con)o(trol)h(structures)j(\(conditional)366
1969 y(statemen)o(ts,)i(while)e(lo)q(ops,)h(for)g(lo)q(ops,)g(and)g(so)
g(on\).)22 b(Because)17 b(state)f(transformers)f(are)366
2019 y(\014rst)j(class)f(v)n(alues,)f(the)i(programmer)c(can)j
(de\014ne)g(functions)g(whic)o(h)g(pla)o(y)e(the)i(role)g(of)366
2069 y Fl(applic)n(ation-sp)n(e)n(ci\014c)h Fo(con)o(trol)g
(structures.)32 b(F)m(or)17 b(example,)g(here)i(is)f(a)f(function)g
(whic)o(h)366 2119 y(p)q(erforms)d(its)g(argumen)o(t)e(a)i(sp)q
(eci\014ed)i(n)o(um)o(b)q(er)d(of)g(times:)410 2226 y
Fk(repeatST)20 b(::)i(Int)f(->)g(ST)g(s)h(\(\))f(->)h(ST)f(s)h(\(\))410
2276 y(repeatST)e(n)i(st)f(=)h(listST_)e([st)h(|)h(i)f(<-)h([1..n]])366
2384 y Fo(If)15 b(w)o(e)g(need)h(a)f Fk(for)f Fo(lo)q(op,)g(where)i
(the)g(lo)q(op)e(index)h(is)g(used)h(in)e(the)i(\\b)q(o)q(dy",)e(it)h
(is)g(easily)366 2434 y(pro)o(vided:)410 2541 y Fk(forST)21
b(::)g(Int)g(->)h(\(Int)f(->)g(ST)g(s)h(\(\)\))f(->)h(ST)f(s)h(\(\))410
2591 y(forST)f(n)g(stf)h(=)f(mapST_)g(stf)g([1..n])p
eop
%%Page: 20 20
20 19 bop 300 275 a Fm(20)366 416 y Fo(And)15 b(so)f(on.)k(The)c(p)q
(oin)o(t)g(is)g(not)g(that)g(these)h(particular)f(c)o(hoices)h(are)g
(the)f(\\righ)o(t")f(ones,)366 466 y(but)k(rather)h(that)e(it)h(is)f(v)
o(ery)h(easy)g(to)f(de\014ne)i(new)f(w)o(a)o(ys)f(to)h(comp)q(ose)f
(together)i(small)366 516 y(state)d(transformers)f(to)g(mak)o(e)e
(larger)i(ones.)300 598 y Fn(\017)45 b Fo(The)15 b(usual)g
(co-routining)e(b)q(eha)o(viour)h(of)g(lazy)g(ev)n(aluation,)f(in)h
(whic)o(h)g(the)i(consumer)e(of)366 648 y(a)f(data)g(structure)i
(co-routines)e(with)g(its)g(pro)q(ducer,)h(extends)g(to)f(stateful)g
(computation)366 698 y(as)21 b(w)o(ell.)35 b(As)21 b(Hughes)g(argues)f
(\(Hughes)h([1989]\),)f(the)g(abilit)o(y)f(to)g(separate)j
Fl(what)d Fo(is)366 748 y(computed)11 b(from)f Fl(how)i(much)g
Fo(of)e(it)h(is)g(computed)g(is)g(a)g(p)q(o)o(w)o(erful)f(aid)h(to)g
(writing)f(mo)q(dular)366 797 y(programs.)300 930 y Fp(6.)48
b(F)l(ormalism)300 1030 y Fo(Ha)o(ving)13 b(giv)o(en)h(the)h
(programmer's)d(ey)o(e)j(view,)f(it)g(is)g(time)f(no)o(w)h(to)g(b)q(e)h
(more)e(formal)f(and)i(to)300 1080 y(de\014ne)g(precisely)g(the)g
(ideas)f(w)o(e)h(ha)o(v)o(e)f(discussed.)19 b(W)m(e)13
b(ha)o(v)o(e)g(presen)o(ted)i(state)f(transformers)300
1129 y(in)9 b(the)i(con)o(text)f(of)g(the)g(full-sized)f(programming)d
(language)j(Hask)o(ell,)h(since)h(that)e(is)h(where)h(w)o(e)300
1179 y(ha)o(v)o(e)i(implem)o(en)o(ted)e(the)i(ideas.)18
b(In)13 b(order)g(to)g(giv)o(e)f(seman)o(tics)g(to)h(the)g(constructs,)
h(ho)o(w)o(ev)o(er,)300 1229 y(it)i(is)f(con)o(v)o(enien)o(t)i(to)e
(restrict)j(ourselv)o(es)f(to)e(the)i(essen)o(tials.)25
b(In)16 b(particular,)g(w)o(e)g(c)o(ho)q(ose)g(to)300
1279 y(omit)11 b(the)j(sp)q(ecial)f(seman)o(tics)f(of)h(IO)g(op)q
(erations)g(with)g(their)g(calls)g(to)g(C.)f(Instead,)i(w)o(e)f(fo)q
(cus)300 1329 y(on)d(pro)o(viding)e(a)h(seman)o(tics)h(for)f
(encapsulated)i(state)g(together)f(with)g(a)f(pro)q(of)g(demonstrating)
300 1378 y(the)14 b(securit)o(y)h(of)f(encapsulation.)300
1511 y Fp(6.1.)48 b(A)16 b(Language)300 1611 y Fo(W)m(e)d(fo)q(cus)h
(on)f(lam)o(b)q(da)e(calculus)j(extended)h(with)e(the)h(state)g
(transformer)f(op)q(erations.)18 b(The)300 1660 y(syn)o(tax)c(of)f(the)
i(language)e(is)g(giv)o(en)h(b)o(y:)668 1748 y Fj(e)29
b Fo(::=)24 b Fj(x)j Fn(j)h Fj(k)g Fn(j)f Fj(e)995 1754
y Fv(1)1028 1748 y Fj(e)1047 1754 y Fv(2)1094 1748 y
Fn(j)g Fj(\025x:e)g Fn(j)796 1798 y Fk(let)13 b Fj(x)e
Fo(=)h Fj(e)973 1804 y Fv(1)1006 1798 y Fk(in)h Fj(e)1082
1804 y Fv(2)1129 1798 y Fn(j)27 b Fk(runST)13 b Fj(e)668
1897 y(k)26 b Fo(::=)e Fk(thenST)i Fn(j)i Fk(returnST)e
Fn(j)796 1947 y Fk(newVar)g Fn(j)i Fk(readVar)e Fn(j)h
Fk(writeVar)f Fn(j)796 1997 y Fj(:)7 b(:)g(:)300 2168
y Fp(6.2.)48 b(T)o(yp)q(e)16 b(rules)300 2268 y Fo(The)c(t)o(yp)q(e)g
(rules)g(are)g(giv)o(en)f(in)g(Figure)h(4,)f(and)h(are)f(the)i(usual)e
(Hindley-Milner)g(rules,)h(except)300 2318 y(that)g Fk(runST)g
Fo(also)f(requires)j(a)e(judgmen)o(t)f(of)h(its)g(o)o(wn.)17
b(T)m(reating)12 b(it)g(as)g(a)g(language)g(construct)300
2368 y(a)o(v)o(oids)j(the)h(need)h(to)f(go)f(b)q(ey)o(ond)h
(Hindley-Milner)g(t)o(yp)q(es.)25 b(So)15 b(rather)i(than)f(actually)f
(giv)o(e)300 2417 y Fk(runST)e Fo(the)h(t)o(yp)q(e)741
2467 y Fk(runST)21 b(::)g Fn(8)p Fk(a.\()o Fn(8)p Fk(s.ST)g(s)h(a\))f
(->)h(a)300 2541 y Fo(as)d(suggested)h(in)f(the)g(in)o(tro)q(duction,)h
(w)o(e)f(pro)o(vide)f(a)h(t)o(yping)f(judgemen)o(t)g(whic)o(h)h(has)g
(the)300 2591 y(same)13 b(e\013ect.)p eop
%%Page: 21 21
21 20 bop 1749 275 a Fm(21)688 987 y Fj(AP)6 b(P)851
948 y Fo(\000)12 b Fn(`)g Fj(e)945 954 y Fv(1)975 948
y Fo(:)f Fj(T)1022 954 y Fv(1)1053 948 y Fn(!)g Fj(T)1130
954 y Fv(2)1204 948 y Fo(\000)g Fn(`)h Fj(e)1297 954
y Fv(2)1328 948 y Fo(:)f Fj(T)1375 954 y Fv(1)p 851 977
543 2 v 986 1019 a Fo(\000)g Fn(`)h Fo(\()p Fj(e)1095
1025 y Fv(1)1128 1019 y Fj(e)1147 1025 y Fv(2)1166 1019
y Fo(\))g(:)f Fj(T)1241 1025 y Fv(2)688 1151 y Fj(LAM)984
1113 y Fo(\000)p Fj(;)c(x)k Fo(:)g Fj(T)1111 1119 y Fv(1)1141
1113 y Fn(`)h Fj(e)g Fo(:)f Fj(T)1256 1119 y Fv(2)p 960
1138 339 2 v 960 1183 a Fo(\000)h Fn(`)g Fj(\025x:e)f
Fo(:)g Fj(T)1172 1189 y Fv(1)1203 1183 y Fn(!)g Fj(T)1280
1189 y Fv(2)688 1315 y Fj(LE)r(T)867 1276 y Fo(\000)g
Fn(`)h Fj(e)960 1282 y Fv(1)991 1276 y Fo(:)f Fj(S)58
b Fo(\000)p Fj(;)7 b(x)k Fo(:)g Fj(S)j Fn(`)e Fj(e)1295
1282 y Fv(2)1325 1276 y Fo(:)f Fj(T)p 867 1305 512 2
v 884 1348 a Fo(\000)h Fn(`)g Fo(\()p Fk(let)h Fj(x)e
Fo(=)h Fj(e)1152 1354 y Fv(1)1185 1348 y Fk(in)h Fj(e)1261
1354 y Fv(2)1280 1348 y Fo(\))f(:)f Fj(T)688 1448 y(V)f(AR)205
b Fo(\000)p Fj(;)7 b(x)k Fo(:)g Fj(S)j Fn(`)e Fj(x)f
Fo(:)g Fj(S)688 1580 y(S)r(P)6 b(E)r(C)1006 1541 y Fo(\000)11
b Fn(`)h Fj(e)g Fo(:)f Fn(8)p Fj(t:S)p 987 1567 244 2
v 987 1611 a Fo(\000)g Fn(`)h Fj(e)g Fo(:)f Fj(S)r Fo([)p
Fj(T)5 b(=t)p Fo(])1285 1580 y Fj(t)11 b Fn(62)g Fj(F)6
b(V)j Fo(\()p Fj(T)d Fo(\))688 1743 y Fj(GE)r(N)1031
1705 y Fo(\000)11 b Fn(`)h Fj(e)g Fo(:)f Fj(S)p 1006
1730 206 2 v 1006 1774 a Fo(\000)g Fn(`)h Fj(e)g Fo(:)f
Fn(8)p Fj(t:S)1266 1743 y(t)g Fn(62)g Fj(F)6 b(V)j Fo(\(\000\))688
1906 y Fj(RU)c(N)962 1868 y Fo(\000)11 b Fn(`)h Fj(e)g
Fo(:)f Fn(8)p Fj(t:)p Fk(ST)i Fj(t)h(T)p 952 1893 314
2 v 952 1938 a Fo(\000)e Fn(`)f Fo(\()p Fk(runST)i Fj(e)p
Fo(\))f(:)f Fj(T)1319 1906 y(t)h Fn(62)f Fj(F)6 b(V)j
Fo(\()p Fj(T)d Fo(\))300 2079 y Fr(Figur)n(e)14 b(4.)i
Fw(T)o(yp)q(e)11 b(rules)p eop
%%Page: 22 22
22 21 bop 300 275 a Fm(22)468 463 y Fn(E)t Fo([)-7 b([)7
b Fj(E)r(xpr)f Fo(])-7 b(])11 b(:)g Fl(Env)17 b Fn(!)11
b Fl(V)m(al)468 563 y Fn(E)t Fo([)-7 b([)7 b Fj(k)g Fo(])-7
b(])13 b Fj(\032)274 b Fo(=)25 b Fn(B)q Fo([)-7 b([)7
b Fj(k)h Fo(])-7 b(])468 613 y Fn(E)t Fo([)g([)7 b Fj(x)g
Fo(])-7 b(])12 b Fj(\032)273 b Fo(=)25 b Fj(\032)15 b(x)468
663 y Fn(E)t Fo([)-7 b([)7 b Fj(e)537 669 y Fv(1)569
663 y Fj(e)588 669 y Fv(2)614 663 y Fo(])-7 b(])241 b(=)25
b(\()p Fn(E)t Fo([)-7 b([)7 b Fj(e)1014 669 y Fv(1)1039
663 y Fo(])-7 b(])13 b Fj(\032)p Fo(\))h(\()p Fn(E)t
Fo([)-7 b([)7 b Fj(e)1205 669 y Fv(2)1230 663 y Fo(])-7
b(])13 b Fj(\032)p Fo(\))468 712 y Fn(E)t Fo([)-7 b([)7
b Fk(\\)o Fj(x)p Fk(->)o Fj(e)g Fo(])-7 b(])13 b Fj(\032)189
b Fo(=)25 b Fj(\025v)q(:)p Fo(\()p Fn(E)t Fo([)-7 b([)7
b Fj(e)g Fo(])-7 b(])13 b(\()p Fj(\032)d Fn(\010)f(f)p
Fj(x)i Fn(7!)g Fj(v)q Fn(g)p Fo(\)\))468 762 y Fn(E)t
Fo([)-7 b([)7 b Fk(let)12 b Fj(x)p Fk(=)p Fj(e)661 768
y Fv(1)693 762 y Fk(in)i Fj(e)770 768 y Fv(2)796 762
y Fo(])-7 b(])13 b Fj(\032)25 b Fo(=)g Fn(E)t Fo([)-7
b([)7 b Fj(e)998 768 y Fv(2)1023 762 y Fo(])-7 b(])13
b(\()p Fj(f)t(ix)p Fo(\()p Fj(\025\032)1192 747 y Fu(0)1205
762 y Fj(:)p Fo(\()p Fj(\032)d Fn(\010)f(f)p Fj(x)i Fn(7!)g(E)t
Fo([)-7 b([)7 b Fj(e)1483 768 y Fv(1)1508 762 y Fo(])-7
b(])p Fj(\032)1546 747 y Fu(0)1557 762 y Fn(g)p Fo(\)\)\))468
862 y Fn(B)q Fo([)g([)7 b Fk(runST)f Fo(])-7 b(])219
b(=)25 b Fj(r)q(unS)r(T)468 912 y Fn(B)q Fo([)-7 b([)7
b Fk(thenST)f Fo(])-7 b(])197 b(=)25 b Fj(thenS)r(T)496
961 y Fo(:)300 1103 y Fr(Figur)n(e)14 b(5.)i Fw(Seman)o(tics)9
b(of)i(T)m(erms)333 1229 y Fo(As)18 b(usual,)f(w)o(e)h(talk)e(b)q(oth)i
(of)e Fl(typ)n(es)i Fo(and)f Fl(typ)n(e)h(schemes)g Fo(\(that)f(is,)h
(t)o(yp)q(es)g(p)q(ossibly)f(with)300 1279 y(univ)o(ersal)d(quan)o
(ti\014ers)g(on)g(the)h(outside\).)k(W)m(e)14 b(use)h
Fj(T)20 b Fo(for)13 b(t)o(yp)q(es,)i Fj(S)i Fo(for)d(t)o(yp)q(e)g(sc)o
(hemes,)h(and)300 1329 y Fj(K)i Fo(for)d(t)o(yp)q(e)g(constan)o(ts)h
(suc)o(h)f(as)g Fj(I)s(nt)h Fo(and)e Fj(B)r(ool)q Fo(.)791
1411 y Fj(T)31 b Fo(::=)25 b Fj(t)i Fn(j)g Fj(K)k Fn(j)d
Fj(T)1138 1417 y Fv(1)1168 1411 y Fn(!)11 b Fj(T)1245
1417 y Fv(2)1292 1411 y Fn(j)927 1461 y Fk(ST)i Fj(T)1008
1467 y Fv(1)1041 1461 y Fj(T)1065 1467 y Fv(2)1111 1461
y Fn(j)927 1511 y Fk(MutVar)f Fj(T)1095 1517 y Fv(1)1128
1511 y Fj(T)1152 1517 y Fv(2)791 1611 y Fj(S)30 b Fo(::=)25
b Fj(T)33 b Fn(j)27 b(8)p Fj(t:S)300 1696 y Fo(In)14
b(addition,)f(\000)h(ranges)h(o)o(v)o(er)f(t)o(yp)q(e)h(en)o(vironmen)o
(ts)f(\(that)g(is,)g(partial)f(functions)h(from)f(term)300
1746 y(v)n(ariables)d(to)h(t)o(yp)q(es\),)g(and)g(w)o(e)g(write)g
Fj(F)6 b(V)j Fo(\()p Fj(T)d Fo(\))11 b(for)f(the)i(free)f(v)n(ariables)
f(of)g(t)o(yp)q(e)i Fj(T)k Fo(and)11 b(lik)o(ewise)300
1796 y(for)j(t)o(yp)q(e)g(en)o(vironmen)o(ts.)300 1927
y Fp(6.3.)48 b(Denotational)12 b(Seman)o(tics)300 2027
y Fo(In)j(Figure)g(5,)f(w)o(e)h(extend)h(a)f(standard)g(denotational)f
(seman)o(tics)g(for)h(a)f(non-strict)i(lam)o(b)q(da)300
2077 y(calculus)i(to)f(include)h(the)g(seman)o(tics)f(of)g(state)h(op)q
(erations)g(b)o(y)f(pro)o(viding)f(de\014nitions)i(for)300
2127 y(the)c(new)h(constan)o(ts.)333 2176 y(The)f(v)n(aluation)e
(function)h Fn(E)t Fo([)-7 b([)13 b(])-7 b(])13 b(tak)o(es)h(an)f
Fl(expr)n(ession)h Fo(and)f(an)g Fl(envir)n(onment)h
Fo(and)g(returns)300 2226 y(a)i Fl(value)p Fo(.)24 b(W)m(e)15
b(use)i Fl(Env)k Fo(for)15 b(the)i(domain)d(of)h(en)o(vironmen)o(ts,)g
(and)h Fl(V)m(al)j Fo(for)d(the)g(domain)e(of)300 2276
y(v)n(alues,)f(de\014ned)i(as)f(follo)o(ws:)822 2358
y Fl(Env)30 b Fo(=)979 2327 y Fh(Q)1019 2371 y Fg(\034)1039
2358 y Fo(\()p Fj(v)q(ar)1117 2364 y Fg(\034)1150 2358
y Fn(!)11 b(D)1235 2364 y Fg(\034)1256 2358 y Fo(\))822
2408 y Fl(V)m(al)40 b Fo(=)979 2377 y Fh(S)1014 2421
y Fg(\034)1042 2408 y Fn(D)1074 2414 y Fg(\034)300 2492
y Fo(The)20 b(en)o(vironmen)o(t)f(maps)f(a)i(v)n(ariable)e(of)h(t)o(yp)
q(e)i Fj(\034)j Fo(to)c(a)f(v)n(alue)g(in)g(the)i(domain)c
Fn(D)1674 2498 y Fg(\034)1695 2492 y Fo(,)k(and)300 2541
y(the)d(domain)d(of)h(v)n(alues)h(is)g(the)h(union)f(of)g(all)f(the)h
Fn(D)1160 2547 y Fg(\034)1181 2541 y Fo(,)h(where)g Fj(\034)k
Fo(ranges)c(o)o(v)o(er)f(monot)o(yp)q(es)300 2591 y(\(p)q(olymorphic)12
b(v)n(alues)i(lie)f(in)g(the)i(in)o(tersection)g(of)e(their)h
(monomorphic)d(instances\).)p eop
%%Page: 23 23
23 22 bop 1749 275 a Fm(23)586 413 y Fo(\()p Fj(r)q(etur)q(nS)r(T)20
b(v)q Fo(\))15 b Fj(\033)38 b Fo(=)25 b(\()p Fj(v)q(;)7
b(\033)q Fo(\))586 463 y(\()p Fj(thenS)r(T)21 b(m)14
b(k)q Fo(\))g Fj(\033)26 b Fo(=)f Fj(k)15 b(x)f(\033)1067
448 y Fu(0)1094 463 y Fp(where)i Fo(\()p Fj(x;)7 b(\033)1319
448 y Fu(0)1330 463 y Fo(\))12 b(=)f Fj(m)k(\033)586
588 y(new)q(V)9 b(ar)15 b(v)g(\033)85 b Fo(=)952 530
y Fh(\032)995 563 y Fo(\()p Fn(?)p Fj(;)20 b Fn(?)p Fo(\))p
Fj(;)136 b Fp(if)19 b Fj(\033)13 b Fo(=)e Fn(?)995 613
y Fo(\()p Fj(p;)21 b(\033)q Fo([)p Fj(p)11 b Fn(7!)g
Fj(v)q Fo(]\))p Fj(;)25 b Fp(otherwise)995 663 y(where)16
b Fj(p)11 b Fn(62)g Fj(dom)p Fo(\()p Fj(\033)q Fo(\))586
787 y Fj(r)q(eadV)e(ar)15 b(p)e(\033)78 b Fo(=)952 729
y Fh(\032)995 762 y Fo(\()p Fn(?)p Fj(;)20 b Fn(?)p Fo(\))p
Fj(;)44 b(p)12 b Fn(62)f Fj(dom)p Fo(\()p Fj(\033)q Fo(\))995
812 y(\()p Fj(\033)k(p;)21 b(\033)q Fo(\))p Fj(;)j Fp(otherwise)586
937 y Fj(w)q(r)q(iteV)10 b(ar)k(p)g(v)h(\033)26 b Fo(=)952
878 y Fh(\032)995 912 y Fo(\()p Fn(?)p Fj(;)20 b Fn(?)p
Fo(\))p Fj(;)147 b(p)11 b Fn(62)h Fj(dom)p Fo(\()p Fj(\033)q
Fo(\))995 961 y(\(\(\))p Fj(;)21 b(\033)q Fo([)p Fj(p)11
b Fn(7!)g Fj(v)q Fo(]\))p Fj(;)25 b Fp(otherwise)586
1061 y Fj(r)q(unS)r(T)20 b(m)25 b Fo(=)h Fj(x)j Fp(where)15
b Fo(\()p Fj(x;)7 b(\033)q Fo(\))12 b(=)f Fj(m)k Fn(;)300
1203 y Fr(Figur)n(e)f(6.)i Fw(Seman)o(tics)9 b(of)i(State)f(Com)o
(binators)f(and)i(Primitiv)o(es)333 1342 y Fo(F)m(rom)g(the)j(p)q(oin)o
(t)e(of)h(view)f(of)h(the)g(language,)f(the)i(t)o(yp)q(e)f
(constructors)i Fk(ST)e Fo(and)f Fk(MutVar)g Fo(are)300
1392 y(opaque.)26 b(T)m(o)16 b(giv)o(e)h(them)f(meaning,)f(ho)o(w)o(ev)
o(er,)i(the)g(seman)o(tics)g(m)o(ust)e(pro)o(vide)i(them)f(with)300
1442 y(some)d(structure.)692 1493 y Fj(D)726 1504 y Fk(ST)h
Fg(s)f(a)945 1493 y Fo(=)25 b Fj(S)r(tate)13 b Fn(!)e
Fo(\()p Fj(D)1216 1499 y Fg(a)1246 1493 y Fn(\002)e Fj(S)r(tate)p
Fo(\))692 1543 y Fj(S)r(tate)155 b Fo(=)25 b(\()p Fn(N)18
b Fj(,)-7 b Fn(!)11 b Fj(V)e(al)q Fo(\))1212 1549 y Fu(?)692
1593 y Fj(D)726 1604 y Fk(MutVar)k Fg(s)g(a)945 1593
y Fo(=)25 b Fn(N)1036 1599 y Fu(?)300 1678 y Fo(A)13
b(state)h(transformer)e(is)h(a)g(function)f(whic)o(h,)h(giv)o(en)f(a)h
(state,)g(pro)q(duces)i(a)d(pair)h(of)f(results:)19 b(a)300
1728 y(v)n(alue)c(and)g(a)g(new)h(state.)24 b(The)16
b(least)f(de\014ned)i(state)f(transformer)f(is)h(the)g(function)f(whic)
o(h,)300 1778 y(giv)o(en)c(an)o(y)g(state,)h(returns)h(the)f(pair)f
(con)o(taining)g(the)h(b)q(ottom)e(v)n(alue)h(and)g(the)h(b)q(ottom)e
(state.)333 1832 y(A)17 b(state)g(is)f(a)g(lifted)g(\014nite)g(partial)
g(function)g(from)f(lo)q(cations)g(\(represen)o(ted)20
b(b)o(y)c(natural)300 1881 y(n)o(um)o(b)q(ers\))f(to)g(v)n(alues.)21
b(The)16 b(b)q(ottom)e(state)i(is)f(totally)f(unde\014ned.)23
b(This)15 b(is)g(the)g(state)h(that)300 1931 y(results)h(after)f(an)g
(in\014nite)f(lo)q(op.)23 b(W)m(e)16 b(cannot)g(tell)f(ev)o(en)i(whic)o
(h)f(v)n(ariables)f(exist,)h(let)g(alone)300 1981 y(what)h(their)h(v)n
(alues)e(are.)29 b(Non-b)q(ottom)15 b(states)j(are)g(partial)e
(functions)h(with)g(w)o(ell-de\014ned)300 2031 y(domains)e(whic)o(h)h
(sp)q(ecify)h(whic)o(h)g(v)n(ariables)f(exist.)26 b(These)18
b(v)n(ariables)e(ma)o(y)f(b)q(e)i(mapp)q(ed)e(to)300
2081 y(an)o(y)e(v)n(alue,)g(including)g(b)q(ottom.)333
2135 y(References)18 b(are)e(denoted)g(simply)d(b)o(y)i(natural)g(n)o
(um)o(b)q(ers,)g(except)i(that)f(it)f(is)g(p)q(ossible)g(to)300
2184 y(ha)o(v)o(e)10 b(an)f(unde\014ned)i(reference)h(also,)e(denoted)g
(b)o(y)g Fn(?)p Fo(.)16 b(The)10 b(n)o(um)o(b)q(er)f(represen)o(ts)j(a)
e(\\lo)q(cation")300 2234 y(in)j(the)i(state.)333 2288
y(It)h(is)g(w)o(orth)g(noting)f(in)h(passing)f(that)h(the)h(state)g
(parameter)e Fj(s)i Fo(is)e(ignored)h(in)g(pro)o(viding)300
2338 y(seman)o(tic)e(meaning.)19 b(It)c(is)f(purely)i(a)e(tec)o(hnical)
h(device)h(whic)o(h)e(sho)o(ws)i(up)e(in)h(the)g(pro)q(ofs)g(of)300
2388 y(safet)o(y)m(.)333 2442 y(The)d(de\014nitions)f(of)f(the)i(state)
g(constan)o(ts)g(are)g(giv)o(en)e(in)h(Figure)g(6.)17
b(Neither)12 b Fk(returnST)d Fo(nor)300 2492 y Fk(thenST)h
Fo(are)h(strict)h(in)f(the)g(state,)h(but)g(b)q(oth)f(are)g(single)g
(threaded.)18 b(Th)o(us)11 b(they)h(sequen)o(tialise)300
2541 y(state)h(op)q(erations,)f(and)g(guaran)o(tee)g(that)h(only)e(one)
h(cop)o(y)g(of)f(the)i(state)g(is)f(required,)h(without)300
2591 y(themselv)o(es)h(forcing)f(op)q(erations)h(to)g(b)q(e)h(p)q
(erformed.)p eop
%%Page: 24 24
24 23 bop 300 275 a Fm(24)523 439 y Fj(new)q(V)9 b(ar)672
445 y Fg(S)710 439 y Fj(v)16 b(\033)84 b Fo(=)911 380
y Fh(\032)955 413 y Fo(\()p Fn(?)p Fj(;)19 b Fn(?)p Fo(\))p
Fj(;)212 b Fp(if)19 b Fj(\033)13 b Fo(=)e Fn(?)955 463
y Fo(\()p Fj(\022)990 469 y Fg(S)1014 463 y Fo(\()p Fj(p)p
Fo(\))p Fj(;)21 b(\033)q Fo([)p Fj(p)11 b Fn(7!)g Fj(v)q
Fo(]\))p Fj(;)25 b Fp(otherwise)955 513 y(where)15 b
Fj(p)c Fn(62)g Fj(dom)p Fo(\()p Fj(\033)q Fo(\))523 639
y Fj(r)q(eadV)e(ar)680 645 y Fg(S)718 639 y Fj(q)15 b(\033)78
b Fo(=)911 580 y Fh(\032)955 613 y Fo(\()p Fn(?)p Fj(;)19
b Fn(?)p Fo(\))p Fj(;)187 b(p)12 b Fn(62)f Fj(dom)p Fo(\()p
Fj(\033)q Fo(\))955 664 y(\()p Fj(\033)k Fo(\()p Fj(\022)1046
646 y Fu(\000)p Fv(1)1045 676 y Fg(S)1105 664 y Fo(\()p
Fj(q)q Fo(\)\))p Fj(;)21 b(\033)q Fo(\))p Fj(;)j Fp(otherwise)523
790 y Fj(w)q(r)q(iteV)10 b(ar)697 796 y Fg(S)734 790
y Fj(q)15 b(v)h(\033)26 b Fo(=)911 731 y Fh(\032)955
764 y Fo(\()p Fn(?)p Fj(;)19 b Fn(?)p Fo(\))p Fj(;)251
b(p)11 b Fn(62)g Fj(dom)p Fo(\()p Fj(\033)q Fo(\))955
815 y(\(\(\))p Fj(;)20 b(\033)q Fo([)p Fj(\022)1092 797
y Fu(\000)p Fv(1)1091 827 y Fg(S)1137 815 y Fo(\()p Fj(q)q
Fo(\))p Fj(;)7 b Fn(7!)k Fj(v)q Fo(]\))p Fj(;)25 b Fp(otherwise)511
1014 y Fn(f)p Fj(\022)551 1020 y Fg(\034)583 1014 y Fo(:)11
b Fn(N)18 b(!)11 b(N)20 b(j)13 b Fj(\034)k Fn(2)11 b
Fj(T)6 b(y)q(pe;)h(\022)993 1020 y Fg(\034)1028 1014
y Fo(1)i Fn(\000)h Fj(to)f Fn(\000)h Fo(1)p Fn(g)511
1114 y Fj(D)545 1125 y Fk(MutVar)i Fg(s)i(a)751 1114
y Fo(=)d(\()p Fj(r)q(an)j Fo(\()p Fj(\022)926 1120 y
Fg(S)951 1114 y Fo(\)\))983 1120 y Fu(?)300 1256 y Fr(Figur)n(e)g(7.)i
Fw(Seman)o(tics)9 b(of)i(Indexed)e(State)h(Primitiv)o(es)333
1382 y Fo(In)15 b(con)o(trast,)h(the)g(primitiv)o(e)d(op)q(erations)i
(are)h(strict)g(in)e(the)i(state.)23 b(In)15 b(order)h(to)f(allo)q
(cate)300 1431 y(a)g(new)h(v)n(ariable,)e(for)h(example,)f(w)o(e)i
(need)g(to)f(kno)o(w)g(whic)o(h)h(lo)q(cations)e(are)i(free.)24
b(Similarl)o(y)m(,)300 1481 y(with)12 b(the)g(other)h(op)q(erations)f
(\(in)f(the)i(seman)o(tics,)e(w)o(e)h(tak)o(e)g Fj(p)g
Fn(62)f Fj(dom)p Fo(\()p Fj(\033)q Fo(\))h(to)g(b)q(e)h(true)f(if)g
(either)300 1531 y Fj(p)j Fo(or)g Fj(\033)i Fo(are)e(b)q(ottom\).)21
b(This)16 b(all)e(has)h(a)g(direct)h(op)q(erational)f(reading)g(whic)o
(h)g(w)o(e)g(discuss)i(in)300 1581 y(Section)d(9.3.3.)333
1631 y(Finally)m(,)g(the)j(meaning)e(of)g Fk(runST)h
Fo(is)g(giv)o(en)f(b)o(y)h(applying)f(its)i(state-transforming)e(argu-)
300 1680 y(men)o(t)h(to)g(the)i(empt)o(y)d(state,)j(and)e(extracting)i
(the)f(\014rst)g(comp)q(onen)o(t)f(of)g(the)i(result.)27
b(Note)300 1730 y(that)14 b Fk(runST)f Fo(is)g(not)h(strict)h(in)e(the)
i(\014nal)e(state|it)h(is)g(simply)e(discarded.)300 1862
y Fp(6.4.)48 b(Safet)o(y)300 1961 y Fo(In)14 b(an)o(y)g(program)e
(there)j(ma)o(y)d(b)q(e)j(lots)f(of)f(concurren)o(tly)i(activ)o(e)g
(state)f(threads)h(whic)o(h)f(m)o(ust)300 2011 y(not)h(b)q(e)h(allo)o
(w)o(ed)e(to)h(in)o(terfere)h(with)f(one)g(another.)23
b(That)15 b(is)g(state)h(c)o(hanges)g(p)q(erformed)f(b)o(y)300
2061 y(one)f(thread)h(m)o(ust)e(not)g(a\013ect)i(the)g(result)f(of)g
(an)o(y)f(other.)333 2111 y(W)m(e)d(ac)o(hiev)o(e)g(this)g(b)o(y)f
(using)h(the)g(t)o(yp)q(e)h(sc)o(heme)f(for)f Fk(runST)o
Fo(.)17 b(W)m(e)9 b(use)i(the)g(parametric)e(nature)300
2161 y(of)19 b(p)q(olymorphism)d(to)j(sho)o(w)g(that)g(v)n(alues)g
(within)g(a)g(state)h(thread)g(\(including)e(the)i(\014nal)300
2211 y(v)n(alue\))12 b(cannot)i(dep)q(end)g(on)f(references)i
(generated)g(b)o(y)e(other)g(state)h(threads.)19 b(Section)13
b(6.4.2)300 2260 y(con)o(tains)i(the)h(pro)q(of)e(of)h(the)h(k)o(ey)f
(lemma.)j(Here,)e(w)o(e)g(will)d(fo)q(cus)j(on)f(the)g(o)o(v)o(erall)f
(reasoning)300 2310 y(pro)q(cess,)h(assuming)e(that)h(the)g(lemma)d
(holds.)300 2442 y Fl(6.4.1.)42 b(Indep)n(endenc)n(e)17
b(of)e(thr)n(e)n(ads)300 2541 y Fo(Figure)g(7)g(con)o(tains)g(a)g(more)
f(complex)g(v)o(ersion)h(of)g(the)g(seman)o(tics)g(of)g(the)g(state)h
(primitiv)o(es)300 2591 y(in)c(whic)o(h)g(the)h(references)i(are)d
(resp)q(ectiv)o(ely)i(co)q(ded)f(and)f(deco)q(ded.)19
b(W)m(e)12 b(assume)g(an)g(indexed)p eop
%%Page: 25 25
25 24 bop 1749 275 a Fm(25)300 416 y Fo(family)8 b(of)j(injections)g
Fj(\022)i Fo(from)d(the)i(naturals)f(to)g(themselv)o(es)h(to)f(act)g
(as)h(co)q(dings.)17 b(This)11 b(family)300 466 y(is)h(indexed)h(b)o(y)
e(t)o(yp)q(es)i(to)f(allo)o(w)f(the)i(di\013eren)o(t)g(instances)g(of)e
(the)i(primitiv)o(es)d(to)i(use)h(di\013eren)o(t)300
516 y(enco)q(dings)h(for)g(the)g(v)n(ariables)f(\(b)q(ecause)j(the)f
(co)q(ding)e(function)h(is)f(selected)j(on)e(the)g(basis)g(of)300
565 y(the)g(particular)g(instance)h(t)o(yp)q(e\).)333
615 y(When)j Fj(new)q(V)9 b(ar)19 b Fo(allo)q(cates)e(a)g(new)h(lo)q
(cation,)f(rather)h(than)g(return)g(the)g(address)h(of)e(the)300
665 y(lo)q(cation,)j(it)g(co)q(des)h(it)f(using)g(a)g(particular)g(co)q
(ding)g(function)g Fj(\022)q Fo(.)37 b(When)20 b Fj(r)q(eadV)10
b(ar)21 b Fo(and)300 715 y Fj(w)q(r)q(iteV)10 b(ar)h
Fo(come)e(to)i(dereference)i(the)e(v)n(ariable,)e(they)i(\014rst)g
(apply)f(the)h(in)o(v)o(erse)g(of)f(the)h(co)q(ding)300
765 y(function)j(to)f(\014nd)h(the)h(true)g(lo)q(cation,)d(and)i(then)g
(act)h(as)f(b)q(efore.)333 814 y(All)f(the)i(comp)q(onen)o(t)e(parts)i
(of)e(the)i(state)g(thread)f(are)h(ev)o(en)o(tually)e(joined)h
(together)h(using)300 864 y Fk(thenST)d Fo(whose)j(t)o(yp)q(e)f(forces)
h(these)g(v)n(arious)e(parts)h(to)g(ha)o(v)o(e)g(the)g(same)f(state)h
(instance,)h(and)300 914 y(hence)j(use)f(the)g(same)f(co)q(ding)g
(function.)26 b(Similarl)o(y)m(,)13 b(the)k(fact)g(that)f(references)k
(carry)d(the)300 964 y(t)o(yp)q(e)g(of)e(their)i(creator)g(forces)g(an)
o(y)e(dereferencer)20 b(to)c(b)q(e)g(in)g(the)h(same)e(instance,)i(and)
f(also)300 1014 y(use)c(the)h(same)d(co)q(ding)i(function.)k(In)o
(tuitiv)o(ely)m(,)11 b(therefore,)i(the)f(b)q(eha)o(viour)f(of)g(a)g
(state)i(thread)300 1064 y(should)f(b)q(e)g(indep)q(enden)o(t)h(of)f
(the)g(c)o(hoice)h(of)e(co)q(ding)g(function.)18 b(Only)11
b(if)g(references)k(managed)300 1113 y(to)d(cross)i(state)f(b)q
(oundaries,)g(or)f(if)g(the)g(state)i(information)9 b(could)j(someho)o
(w)f(b)q(ecome)i(lost)f(in)300 1163 y(the)i(pro)q(cess)i(of)d(t)o(yp)q
(ec)o(hec)o(king,)i(could)e(something)g(go)g(wrong.)333
1213 y(The)k(essence)h(of)d(the)i(pro)q(of)f(is)f(that)h(nothing)g(do)q
(es)g(go)g(wrong.)24 b(The)16 b(k)o(ey)g(lemma)d(states)300
1263 y(that)j(a)g(state)h(transformer)e(whic)o(h)h(is)g(p)q(olymorphic)
e(in)i(the)h(state)f(is)g(indeed)h(indep)q(enden)o(t)300
1313 y(of)f(the)i(co)q(ding)e(function)h(used.)27 b(This)17
b(means)f(that)h(state)h(references)h(do)e(not)g(cross)h(state)300
1362 y(b)q(oundaries,)11 b(that)f(is,)h(no)f(reference)j(is)d
(dereferenced)j(in)d(an)o(y)g(thread)h(other)g(than)f(its)h(creator.)
300 1412 y(If)17 b(the)g(con)o(v)o(erse)h(w)o(ere)g(so,)f(then)h(w)o(e)
f(could)g(construct)h(a)f(state)h(thread)f(whose)h(b)q(eha)o(viour)300
1462 y(w)o(as)c Fl(dep)n(endent)h Fo(in)f(the)h(particular)e(co)q(ding)
h(function)g(used)h(\(c)o(hange)g(the)f(co)q(ding)g(function,)300
1512 y(so)19 b(e\013ectiv)o(ely)h(c)o(hanging)e(what)h(the)g(external)h
(reference)h(p)q(oin)o(ts)e(to\),)h(con)o(tradicting)f(the)300
1562 y(lemma.)333 1611 y(Finally)m(,)14 b(as)i(the)g(c)o(hoice)g(of)f
Fj(\022)j Fo(is)d(irrelev)n(an)o(t,)h(w)o(e)g(are)g(free)g(to)g(use)h
(the)f(iden)o(tit)o(y)f(function,)300 1661 y(and)c(disp)q(ense)h(with)f
(co)q(dings)g(completely)m(.)k(This)c(giv)o(es)g(the)g(original)e
(seman)o(tics)i(of)f(Figure)h(6.)300 1794 y Fl(6.4.2.)42
b(Key)15 b(L)n(emma)300 1894 y Fo(The)h(dev)o(elopmen)o(t)f(here)i
(relies)f(on)f(parametric)g(p)q(olymorphism)d(in)k(the)g(st)o(yle)g(of)
f(Mitc)o(hell)300 1944 y(&)g(Mey)o(er)g([1985],)e(who)h(detail)g(what)g
(e\013ect)j(the)e(addition)e(of)h(p)q(olymorphic)f(constan)o(ts)i(has)
300 1993 y(on)h(parametricit)o(y)m(.)24 b(In)17 b(general,)f(w)o(e)h
(cannot)g(hop)q(e)g(that)f(adding)g(new)h(p)q(olymorphic)d(con-)300
2043 y(stan)o(ts)k(willy-nilly)c(will)i(lea)o(v)o(e)h(parametricit)o(y)
f(in)o(tact.)29 b(In)17 b(particular,)h(the)g(addition)e(of)h(a)300
2093 y(\\p)q(olymorphic)d(equalit)o(y")h(will)g(ha)o(v)o(e)h(a)g
(disastrous)h(e\013ect)h(on)e(the)h(lev)o(el)f(of)g(parametricit)o(y)
300 2143 y(implied)c(b)o(y)h(a)h(p)q(olymorphic)e(t)o(yp)q(e.)333
2193 y(Mitc)o(hell)h(and)g(Mey)o(er)h(sho)o(w)f(that)h(parametricit)o
(y)e(is)h(preserv)o(ed)i(so)e(long)g(as)g(\(1\))g(eac)o(h)h(new)300
2242 y(t)o(yp)q(e)g(constructor)h(comes)e(equipp)q(ed)h(with)f(a)g
(corresp)q(onding)h(op)q(eration)g(on)f(relations,)g(and)300
2292 y(\(2\))h(the)g(new)h(p)q(olymorphic)d(constan)o(ts)i(all)f
(satisfy)g(the)i(relev)n(an)o(t)f(logical)e(relations)i(implied)300
2342 y(b)o(y)g(their)g(t)o(yp)q(es.)333 2392 y(In)j(our)g(setting,)g
(this)g(means)f(that)h(w)o(e)g(ha)o(v)o(e)g(to)g(giv)o(e)f(an)h(accoun)
o(t)g(of)f(what)h Fk(State)f Fo(and)300 2442 y Fk(MutVar)d
Fo(do)i(to)f(relations,)g(and)h(sho)o(w)f(that)h Fk(newVar)o
Fo(,)f Fk(readVar)f Fo(and)i Fk(writeVar)d Fo(satisfy)j(the)300
2492 y(logical)d(relations)i(corresp)q(onding)h(to)e(their)i(t)o(yp)q
(es.)333 2541 y(Because)i(w)o(e)d(are)h(here)h(concerned)h(purely)d
(with)h(the)g(issue)g(of)f(separating)h(distinct)g(state)300
2591 y(threads,)j(w)o(e)f(only)f(fo)q(cus)h(on)f(the)i(p)q(olymorphism)
13 b(with)j(rep)q(ect)j(to)d(the)i(state)f(parameter.)p
eop
%%Page: 26 26
26 25 bop 300 275 a Fm(26)300 416 y Fo(Consequen)o(tly)m(,)11
b(w)o(e)g(will)e(assume)i(that)g(w)o(e)g(only)f(store)i(v)n(alues)e(of)
g(some)g(\014xed)i(t)o(yp)q(e,)f Fj(X)j Fo(sa)o(y)m(,)d(in)300
466 y(the)j(state,)f(and)g(w)o(e)g(completely)f(sidestep)j(the)e(issue)
h(of)e(pro)o(ving)h(that)g(the)g(retriev)o(ed)i(v)n(alues)300
516 y(are)f(of)g(the)g(same)f(t)o(yp)q(e)h(as)g(the)h
Fk(MutVar)e Fo(reference)j(whic)o(h)e(p)q(oin)o(ted)g(to)f(the)i(lo)q
(cation.)333 567 y(W)m(e)f(de\014ne)829 621 y Fj(V)9
b(ar)15 b(s)25 b Fo(=)g Fj(M)5 b(utV)k(ar)15 b(a)f(X)300
700 y Fo(Th)o(us)g Fk(Var)f Fo(is)h(a)g(unary)g(t)o(yp)q(e)g
(constructor)i(whic)o(h)d(w)o(e)h(no)o(w)g(use)h(instead)f(of)f
Fk(MutVar)o Fo(.)333 751 y(Let)j Fj(R)g Fo(and)f Fj(S)j
Fo(b)q(e)e(t)o(yp)q(es,)h(and)e(let)h Fj(r)f Fo(:)e Fj(R)i
Fn($)e Fj(S)19 b Fo(b)q(e)d(a)f(relation)1346 736 y Fv(8)1380
751 y Fo(b)q(et)o(w)o(een)h Fj(R)g Fo(and)f Fj(S)r Fo(.)24
b(Let)300 801 y Fj(q)319 807 y Fg(R)360 801 y Fo(b)q(e)14
b(a)g(reference)i(of)d(t)o(yp)q(e)i Fj(V)9 b(ar)15 b(R)e
Fo(and)h Fj(q)1000 807 y Fg(S)1038 801 y Fo(b)q(e)g(t)o(yp)q(e)h
Fj(V)9 b(ar)15 b(S)r Fo(.)j(W)m(e)c(de\014ne)722 894
y Fj(q)741 900 y Fg(R)768 894 y Fo(\()p Fj(V)9 b(ar)15
b(r)q Fo(\))p Fj(q)928 900 y Fg(S)994 894 y Fn(\021)25
b Fj(\022)1071 877 y Fu(\000)p Fv(1)1070 907 y Fg(R)1116
894 y Fo(\()p Fj(q)1151 900 y Fg(R)1178 894 y Fo(\))12
b(=)f Fj(\022)1269 877 y Fu(\000)p Fv(1)1268 907 y Fg(S)1315
894 y Fo(\()p Fj(q)1350 900 y Fg(S)1373 894 y Fo(\))705
944 y Fj(\033)729 950 y Fg(R)756 944 y Fo(\()p Fj(S)r(tate)k(r)q
Fo(\))p Fj(\033)945 950 y Fg(S)994 944 y Fn(\021)117
b Fj(\033)1167 950 y Fg(R)1206 944 y Fo(=)11 b Fj(\033)1273
950 y Fg(S)300 1037 y Fo(Tw)o(o)17 b(v)n(ariables)g(are)h(related)g(if)
f(they)h(p)q(oin)o(t)f(to)h(the)g(same)e(lo)q(cation,)i(and)f(t)o(w)o
(o)g(states)i(are)300 1086 y(related)14 b(if)g(they)g(are)g(equal.)300
1138 y Fp(Lemma)300 1188 y Fk(newVar)o Fo(,)f Fk(readVar)g
Fo(and)g Fk(writeVar)f Fo(are)j(all)d(logical)h(relations.)300
1239 y Fp(Pro)q(of)300 1289 y Fo(W)m(e)g(do)g(the)h(pro)q(of)f(in)g
(the)h(case)h(of)d Fk(newVar)o Fo(.)18 b(The)c(others)g(are)g(just)g
(as)f(easy)m(.)18 b(F)m(rom)12 b(the)i(t)o(yp)q(e)300
1338 y(of)f Fk(newVar)o Fo(,)g(w)o(e)i(ha)o(v)o(e)e(to)h(sho)o(w)g
(that)g(for)f(all)g Fj(r)f Fo(:)f Fj(R)h Fn($)f Fj(S)r
Fo(,)652 1433 y Fj(new)q(V)f(ar)802 1439 y Fg(R)842 1433
y Fj(a)k(\033)q Fo(\()p Fj(V)c(ar)k(r)d Fn(\002)e Fj(S)r(tate)p
Fo(\))p Fj(new)q(V)i(ar)1344 1439 y Fg(S)1381 1433 y
Fj(a)j(\033)300 1527 y Fo(Expanding)f(out)h(the)h(de\014nition)e(giv)o
(es,)618 1621 y Fj(\022)638 1603 y Fu(\000)p Fv(1)637
1633 y Fg(R)683 1621 y Fo(\()p Fj(\022)718 1627 y Fg(R)746
1621 y Fo(\()p Fj(p)p Fo(\)\))f(=)f Fj(\022)890 1603
y Fu(\000)p Fv(1)889 1633 y Fg(S)936 1621 y Fo(\()p Fj(\022)971
1627 y Fg(S)995 1621 y Fo(\()p Fj(p)p Fo(\)\))f Fn(^)f
Fj(\033)q Fo([)p Fj(p)i Fn(7!)g Fj(v)q Fo(])h(=)f Fj(\033)q
Fo([)p Fj(p)h Fn(7!)f Fj(v)q Fo(])300 1715 y(whic)o(h)j(is)g(clearly)f
(true.)1085 b Ff(2)333 1767 y Fo(As)16 b(the)f(constan)o(ts)i(are)e
(parametric,)f(so)h(are)h(terms)f(built)f(from)g(them)g(\(this)h(is)g
(the)h(force)300 1817 y(of)d(Mitc)o(hell)h(and)f(Mey)o(er's)i
(result\).)k(Th)o(us)14 b(w)o(e)g(deduce)i(the)e(k)o(ey)g(lemma)d(as)j
(a)f(corollary:)300 1868 y Fp(Lemma)300 1918 y Fo(If)g
Fj(m)f Fo(:)f Fn(8)p Fj(s:S)r(T)20 b(s)14 b(T)19 b Fo(\(where)14
b Fj(s)25 b Fn(62)12 b Fj(F)6 b(V)j Fo(\()p Fj(T)d Fo(\)\))13
b(then)h(for)f(an)o(y)g(t)o(yp)q(es)h Fj(R)f Fo(and)g
Fj(S)r Fo(,)g(and)g(an)o(y)g(state)h Fj(\033)300 1967
y Fo(w)o(e)g(ha)o(v)o(e,)932 2022 y Fj(m)968 2028 y Fg(R)996
2022 y Fj(\033)f Fo(=)e Fj(m)1112 2028 y Fg(S)1137 2022
y Fj(\033)333 2102 y Fo(As)h(it)f(is)g(the)h(instance)g(of)f
Fj(m)h Fo(whic)o(h)f(selects)i(its)e(co)q(ding)h(for)f(v)n(ariables,)f
(the)i(theorem)f(states)300 2152 y(that)18 b(the)g(result)h(of)e(a)g(p)
q(olymorphic)f(state)j(transformer)e(is)h(indep)q(enden)o(t)h(of)e(its)
h(in)o(ternal)300 2202 y(co)q(ding.)30 b(This)18 b(is)g(exactly)g(what)
g(w)o(e)g(needed)i(to)e(sho)o(w)g(for)g(our)g(earlier)g(reasoning)g(to)
g(b)q(e)300 2252 y(supp)q(orted.)300 2389 y Fp(7.)48
b(Hask)o(ell)14 b(Arra)o(ys)300 2492 y Fo(Next,)k(w)o(e)f(turn)h(our)f
(atten)o(tion)g(to)g(the)h(implem)o(en)o(tation)c(of)j(imm)n(utable)d
(Hask)o(ell)j(arra)o(ys.)300 2541 y(W)m(e)e(will)e(sho)o(w)i(that)g
(the)h(pro)o(vision)e(of)g Fl(mutable)h Fo(arra)o(ys)g(\(Section)h(3\))
e(pro)o(vides)i(an)e(elegan)o(t)300 2591 y(route)h(to)e(an)h(e\016cien)
o(t)g(implemen)o(tation)d(of)i Fl(immutable)g Fo(arra)o(ys.)p
eop
%%Page: 27 27
27 26 bop 1749 275 a Fm(27)300 416 y Fp(7.1.)48 b(Implemen)o(ti)o(ng)13
b Fk(array)300 516 y Fo(As)k(w)o(e)f(ha)o(v)o(e)g(already)g(indicated,)
g(Hask)o(ell's)g(imm)n(utable)e(arra)o(ys)i(are)g(constructed)j(b)o(y)d
(ap-)300 565 y(plying)g(the)h(function)g Fk(array)f Fo(to)g(a)h(list)f
(of)g(index-v)n(alue)h(pairs.)26 b(F)m(or)17 b(example,)f(here)i(is)f
(an)300 615 y(arra)o(y)d(in)f(whic)o(h)h(eac)o(h)g(elemen)o(t)g(is)f
(the)i(square)f(of)g(its)g(index:)344 698 y Fk(array)20
b(\(1,n\))h([\(i,i*i\))f(|)i(i)f(<-)h([1..n]])300 781
y Fo(This)f(expression)i(mak)o(es)d(use)j(of)d(a)i Fl(list)e(c)n(ompr)n
(ehension)j Fk([\(i,i*i\))d(|)h(i)h(<-)f([1..n]])o Fo(,)300
831 y(whic)o(h)f(should)f(b)q(e)i(read)f(\\the)g(list)g(of)f(all)g
(pairs)g Fk(\(i,i*i\))g Fo(suc)o(h)h(that)g Fk(i)g Fo(is)f(dra)o(wn)h
(from)300 881 y(the)f(list)f Fk([1..n])o Fo(.)31 b(No)o(w,)19
b(it)f(is)h(ob)o(viously)e(a)h(big)g(w)o(aste)h(to)f(construct)i(the)f
(in)o(termediate)300 931 y(list)c(of)g(index)h(v)n(alue)f(pairs!)24
b(It)16 b(w)o(ould)e(b)q(e)j(m)o(uc)o(h)d(b)q(etter)k(to)d(compile)f
(this)i(expression)h(in)o(to)300 981 y(a)f(simple)g(lo)q(op)g(whic)o(h)
g(appropriately)g(initialises)g(eac)o(h)h(elemen)o(t)f(of)g(the)i(arra)
o(y)m(.)25 b(Unfortu-)300 1030 y(nately)m(,)12 b(it)h(is)g(m)o(uc)o(h)e
(less)j(ob)o(vious)e(ho)o(w)h(to)g(ac)o(hiev)o(e)g(optimisation,)d(at)j
(least)g(in)f(a)h(w)o(a)o(y)f(whic)o(h)300 1080 y(is)i(not)g
(\\brittle".)k(F)m(or)c(example,)e(it)i(w)o(ould)f(b)q(e)h(a)g(pit)o(y)
g(if)f(the)i(optimisation)c(w)o(as)j(lost)g(if)f(the)300
1130 y(expression)i(w)o(as)f(instead)g(written)g(in)g(this)g(equiv)n
(alen)o(t)f(form:)344 1213 y Fk(array)20 b(\(1,n\))h(\(map)g(\(\\i)g
(->)h(\(i,i*i\)\))e([1..n]\))300 1296 y Fo(An)13 b(ob)o(vious)g(idea)g
(is)g(to)g(try)g(to)g(mak)o(e)f(use)i(of)f Fl(defor)n(estation)p
Fo(.)k(Deforestation)d(is)f(the)g(generic)300 1346 y(name)e(used)j(for)
e(transformations)f(whic)o(h)i(aim)d(to)i(eliminate)f(in)o(termediate)h
(lists)g(|)g(that)h(is,)300 1396 y(lists)e(used)g(simply)e(as)i
(\\glue")f(b)q(et)o(w)o(een)i(t)o(w)o(o)f(parts)g(of)f(a)h(functional)e
(program.)16 b(F)m(or)10 b(example,)300 1445 y(in)j(the)i(expression)
344 1528 y Fk(map)21 b(f)g(\(map)g(g)h(xs\))300 1611
y Fo(there)14 b(is)f(an)f(in)o(termediate)g(list)h Fk(\(map)21
b(g)g(xs\))12 b Fo(whic)o(h)h(can)g(usefully)f(b)q(e)i(eliminated.)h
(Quite)f(a)300 1661 y(bit)f(of)h(w)o(ork)f(has)h(b)q(een)h(done)f(on)f
(deforestation)h(\(Chin)g([1990];)d(Marlo)o(w)i(&)h(W)m(adler)f
([1993];)300 1711 y(W)m(adler)g([1990]\),)f(and)i(our)g(compiler)f
(includes)i(deforestation)f(as)h(a)e(standard)i(transforma-)300
1761 y(tion)e(\(Gill,)f(Launc)o(h)o(bury)i(&)g(P)o(eyton)h(Jones)f
([1993]\).)333 1811 y(The)f(di\016cult)o(y)e(with)h(applying)f
(deforestation)i(to)f(the)h(construction)g(of)e(arra)o(ys)i(is)f(this:)
17 b Fl(so)300 1861 y(long)g(as)f Fk(array)g Fl(is)g(a)h(primitive,)e
(op)n(aque)j(op)n(er)n(ation,)e(ther)n(e)g(is)g(nothing)i(defor)n
(estation)e(c)n(an)300 1910 y(do,)d(b)n(e)n(c)n(ause)f(defor)n
(estation)f(inher)n(ently)h(c)n(onsists)g(of)f(melding)h(to)n(gether)g
(p)n(art)f(of)h(the)g(pr)n(o)n(duc)n(er)300 1960 y(of)17
b(a)g(list)f(with)h(p)n(art)f(of)h(its)g(c)n(onsumer.)26
b Fo(The)16 b(\015ip)g(side)h(is)f(this:)23 b(if)15 b(w)o(e)i(can)f
(express)i Fk(array)300 2010 y Fo(in)13 b(Hask)o(ell,)f(then)i(our)f
(standard)g(deforestation)h(tec)o(hnique)g(ma)o(y)d(b)q(e)j(able)f(to)g
(eliminate)e(the)300 2060 y(in)o(termediate)i(list.)333
2110 y(With)i(this)h(motiv)n(atio)o(n)d(in)i(mind,)f(w)o(e)h(no)o(w)g
(giv)o(e)g(a)g(de\014nition)g(of)g Fk(array)g Fo(using)g(m)o(utable)300
2159 y(arra)o(ys:)344 2242 y Fk(array)20 b(::)i(Ix)f(i)h(=>)f(\(i,i\))g
(->)g([\(i,v\)])g(->)g(Array)g(i)g(v)344 2292 y(array)f(bds)i(ivs)387
2342 y(=)g(runST)f(\()474 2392 y(newArr)g(bds)g(unInit)130
b(`thenST`)20 b(\\)h(arr)g(->)474 2442 y(mapST_)g(\(fill)g(arr\))g(ivs)
43 b(`thenST_`)474 2492 y(freezeArr)20 b(arr)431 2541
y(\))387 2591 y(where)p eop
%%Page: 28 28
28 27 bop 300 275 a Fm(28)431 416 y Fk(unInit)20 b(=)i(error)f
("Uninitialised)e(element")431 466 y(fill)i(arr)g(\(i,v\))g(=)g
(writeArr)f(arr)i(i)f(v)300 553 y Fo(The)14 b(de\014nition)g(can)g(b)q
(e)g(read)h(th)o(us:)300 640 y(1.)33 b(The)15 b(call)e(to)h
Fk(newArr)e Fo(allo)q(cates)i(a)g(suitably-sized)f(blo)q(c)o(k)h(of)f
(memory)m(.)300 729 y(2.)33 b(The)19 b(call)e(to)h Fk(mapST_)e
Fo(p)q(erforms)i(in)f(sequence)j(the)f(actions)f Fk(\(fill)i(arr)i
(\(i,v\)\))n Fo(,)d(for)366 778 y(eac)o(h)c Fk(\(i,v\))e
Fo(in)g(the)i(index-v)n(alue)e(list.)18 b(Eac)o(h)c(of)g(these)h
(actions)f(\014lls)g(in)f(one)h(elemen)o(t)g(of)366 828
y(the)h(arra)o(y)m(.)300 917 y(3.)33 b(The)13 b(function)e
Fk(freezeArray)f Fo(is)i(a)g(new)g(primitiv)o(e)e(whic)o(h)i(con)o(v)o
(erts)h(the)f(m)o(utable)f(arra)o(y)366 967 y(in)o(to)j(an)f(imm)o
(utabl)o(e)f(arra)o(y:)410 1072 y Fk(freezeArr)20 b(::)h(Ix)h(i)f(=>)h
(MutArr)e(s)i(i)f(v)h(->)f(ST)h(s)f(\(Array)g(i)g(v\))366
1177 y Fo(Op)q(erationally)11 b(sp)q(eaking,)h Fk(freezeArr)e
Fo(tak)o(es)i(the)h(name)e(of)g(an)h(arra)o(y)f(as)h(its)g(argumen)o
(t,)366 1227 y(lo)q(oks)18 b(it)f(up)h(in)f(the)i(state,)g(and)f
(returns)h(a)f(cop)o(y)f(of)h(what)f(it)h(\014nds,)h(along)d(with)i
(the)366 1277 y(unaltered)f(state.)25 b(The)17 b(cop)o(y)f(is)g
(required)g(in)g(case)h(a)f(subsequen)o(t)h Fk(writeArr)e
Fo(c)o(hanges)366 1326 y(the)j(v)n(alue)f(of)g(the)h(arra)o(y)f(in)g
(the)h(state,)h(but)f(it)f(is)g(sometimes)f(p)q(ossible)h(to)h(a)o(v)o
(oid)e(the)366 1376 y(o)o(v)o(erhead)f(of)e(making)e(the)k(cop)o(y)f
(\(see)h(Section)f(9.3.4\).)300 1465 y(4.)33 b(Finally)m(,)10
b(the)i(whole)f(sequence)i(is)e(encapsulated)i(in)d(a)h
Fk(runST)o Fo(.)17 b(Notice)12 b(the)g(use)g(of)f(encap-)366
1515 y(sulation)j(here.)19 b(The)14 b Fl(implementation)g
Fo(\(or)h(in)o(ternal)e(details\))h(of)f Fk(array)g Fo(is)h(imp)q
(erativ)o(e,)366 1564 y(but)f(its)f Fl(sp)n(e)n(ci\014c)n(ation)g
Fo(\(or)h(external)f(b)q(eha)o(viour\))g(is)g(purely)h(functional.)j
(Ev)o(en)d(the)f(pres-)366 1614 y(ence)k(of)d(state)i(cannot)f(b)q(e)g
(detected)i(outside)e Fk(array)o Fo(.)300 1701 y(The)g(imp)q(ortan)o(t)
d(thing)h(is)h(that)g(the)h(list)f(of)f(index-v)n(alue)h(pairs,)f
Fk(ivs)h Fo(is)g(no)o(w)f(explicitly)g(con-)300 1751
y(sumed)f(b)o(y)g Fk(mapST_)n Fo(,)h(whic)o(h)f(giv)o(es)g(enough)g
(lev)o(erage)h(for)e(our)i(deforestation)f(transformation)300
1801 y(to)k(eliminate)e(the)i(in)o(termediate)f(list.)21
b(The)15 b(details)g(of)f(the)i(deforestation)f(transformation)300
1851 y(are)10 b(giv)o(en)f(in)g(Gill,)g(Launc)o(h)o(bury)h(&)f(P)o
(eyton)h(Jones)h([1993],)d(and)i(are)g(not)f(germane)g(here.)18
b(The)300 1901 y(p)q(oin)o(t)d(is)h(simply)e(that)i(exp)q(osing)f(the)i
(implemen)o(tatio)o(n)c(of)i Fk(array)g Fo(to)h(the)g(transformation)
300 1950 y(system)e(is)f(the)i(k)o(ey)f(step.)300 2087
y Fp(7.2.)48 b(Accum)o(ulating)13 b(arra)o(ys)300 2190
y Fo(Of)h(course,)h(w)o(e)f(can)g(also)f(de\014ne)i(other)g(Hask)o(ell)
e(arra)o(y)h(\\primitiv)o(es")d(in)j(a)f(similar)f(fashion.)300
2240 y(F)m(or)h(example,)g Fk(accumArray)e Fo(is)j(a)g(standard)g(Hask)
o(ell)f(arra)o(y)h(op)q(eration)g(with)f(t)o(yp)q(e:)344
2341 y Fk(accumArray)19 b(::)j(Ix)f(i)h(=>)f(\(a->b->a\))f(->)h(a)h(->)
f(\(i,i\))823 2390 y(->)g([\(i,b\)])g(->)g(Array)g(i)g(a)333
2492 y Fo(The)13 b(result)h(of)e(a)h(call)f Fk(\(accumArray)19
b(f)j(x)f(bnds)g(ivs\))12 b Fo(is)h(an)f(arra)o(y)h(whose)g(size)h(is)e
(deter-)300 2541 y(mined)f(b)o(y)h Fk(bnds)o Fo(,)g(and)g(whose)g(v)n
(alues)g(are)h(de\014ned)g(b)o(y)f(separating)g(all)f(the)i(v)n(alues)e
(in)h(the)h(list)300 2591 y Fk(ivs)f Fo(according)g(to)g(their)h
(index,)f(and)g(then)h(p)q(erforming)e(a)h(left-fold)f(op)q(eration,)i
(using)f Fk(f)o Fo(,)h(on)p eop
%%Page: 29 29
29 28 bop 1749 275 a Fm(29)300 416 y Fo(eac)o(h)15 b(collection,)f
(starting)h(with)f(the)h(v)n(alue)f Fk(x)p Fo(.)21 b(T)o(ypical)13
b(uses)j(of)e Fk(accumArray)f Fo(migh)o(t)f(b)q(e)k(a)300
466 y(histogram,)c(for)h(example:)322 578 y Fk(hist)21
b(::)g(Ix)h(i)f(=>)g(\(i,i\))g(->)h([i])f(->)g(Array)g(i)h(Int)322
628 y(hist)f(bnds)g(is)g(=)h(accumArray)d(\(+\))j(0)f(bnds)g
([\(i,1\)|i<-is,)e(inRange)i(bnds)g(i])300 740 y Fo(whic)o(h)c(coun)o
(ts)h(the)g(o)q(ccurrences)i(of)d(eac)o(h)h(elemen)o(t)f(of)f(the)i
(list)f Fk(is)g Fo(that)g(falls)f(within)h(the)300 790
y(range)d(giv)o(en)g(b)o(y)f(the)i(b)q(ounds)f Fk(bnds)o
Fo(.)k(Another)d(example)d(is)i(bin)g(sort:)322 902 y
Fk(binSort)20 b(::)i(Ix)f(i)g(=>)h(\(i,i\))f(->)g(\(a->i\))g(->)g([a])g
(->)g(Array)g(i)h(a)322 951 y(binSort)e(bnds)h(key)g(vs)h(=)f
(accumArray)f(\(flip\(:\)\))g([])h(bnds)g([\(key)g(v,v\)|v<-vs])300
1064 y Fo(where)e(the)f(v)n(alue)f(in)g Fk(vs)g Fo(are)h(placed)g(in)f
(bins)h(according)f(to)h(their)g(k)o(ey)g(v)n(alue)f(as)g(de\014ned)300
1113 y(b)o(y)c(the)h(function)g Fk(key)f Fo(\(whose)h(results)h(are)f
(assumed)f(to)g(lie)g(in)g(the)i(range)e(sp)q(eci\014ed)i(b)o(y)f(the)
300 1163 y(b)q(ounds)g Fk(bnds)o Fo(\).)19 b(Eac)o(h)14
b(bin)f(|)g(that)h(is,)f(eac)o(h)i(elemen)o(t)e(of)g(the)i(arra)o(y)e
(|)h(will)e(con)o(tain)h(a)h(list)300 1213 y(of)e(the)i(v)n(alues)f
(with)f(the)i(same)e(k)o(ey)h(v)n(alue.)k(The)c(lists)g(start)h(empt)o
(y)m(,)d(and)i(new)g(elemen)o(ts)g(are)300 1263 y(added)h(using)f(a)h
(v)o(ersion)f(of)g(cons)h(in)g(whic)o(h)f(the)h(order)g(of)f(argumen)o
(ts)g(is)h(rev)o(ersed.)20 b(In)13 b(b)q(oth)300 1313
y(examples,)f(the)j(arra)o(y)f(is)f(built)h(b)o(y)f(a)h(single)f(pass)i
(along)d(the)j(input)f(list.)333 1375 y(The)h(implem)o(en)o(tation)c
(of)i Fk(accumArray)f Fo(simple,)g(and)i(v)o(ery)g(similar)d(to)j(that)
g(of)f Fk(array)o Fo(:)344 1487 y Fk(accumArray)19 b(bnds)i(f)h(z)f
(ivs)387 1537 y(=)h(runST)f(\()474 1587 y(newArr)g(bnds)g(z)239
b(`thenST`)21 b(\\a)g(->)474 1636 y(mapST_)g(\(update)f(a\))i(ivs)64
b(`thenST_`)474 1686 y(freezeArr)20 b(a)431 1736 y(\))387
1786 y(where)431 1836 y(update)g(a)i(\(i,v\))f(=)g(readArr)g(a)g(i)h
(`thenST`)e(\\x->)801 1885 y(writeArr)g(a)i(i)g(\(f)f(x)h(v\))333
1998 y Fo(If)c Fk(array)f Fo(and)i Fk(accumArray)d Fo(w)o(ere)j
(primitiv)o(e)d(then)j(the)g(programmer)d(w)o(ould)h(ha)o(v)o(e)i(no)
300 2047 y(recourse)k(if)c(he)i(or)g(she)g(w)o(an)o(ted)g(some)e(other)
j(arra)o(y-construction)f(op)q(erator.)38 b(Mutable)300
2097 y(arra)o(ys)12 b(allo)o(w)f(the)i(programmer)d(to)i(de\014ne)h
(new)f(arra)o(y)g(op)q(erations)h(without)f(mo)q(difying)d(the)300
2147 y(compiler)k(or)i(run)o(time)e(system.)20 b(W)m(e)14
b(describ)q(e)i(a)e(more)g(complex)f(application)g(of)h(the)h(same)300
2197 y(idea)f(in)f(Section)h(10.3.)300 2367 y Fp(8.)48
b(Other)14 b(useful)g(com)o(binators)300 2492 y Fo(W)m(e)e(ha)o(v)o(e)h
(found)f(it)g(useful)h(to)g(expand)f(the)i(range)f(of)f(com)o(binators)
f(and)h(primitiv)o(es)f(b)q(ey)o(ond)300 2541 y(the)19
b(minim)o(al)14 b(set)19 b(presen)o(ted)h(so)e(far.)31
b(This)18 b(section)g(presen)o(ts)i(the)f(ones)g(w)o(e)f(ha)o(v)o(e)g
(found)300 2591 y(most)13 b(useful.)p eop
%%Page: 30 30
30 29 bop 300 275 a Fm(30)300 416 y Fp(8.1.)48 b(Equalit)o(y)300
516 y Fo(The)19 b(references)j(w)o(e)c(ha)o(v)o(e)h(corresp)q(ond)h(v)o
(ery)f(closely)f(to)h(\\p)q(oin)o(ters)g(to)f(v)n(ariables".)32
b(One)300 565 y(useful)12 b(additional)d(op)q(eration)j(on)f
(references)k(is)c(to)h(determine)f(whether)i(t)o(w)o(o)e(references)k
(are)300 615 y(aliases)d(for)g(the)i(same)d(v)n(ariable)h(\(so)g
Fj(w)q(r)q(ite)p Fo(s)i(to)e(the)h(one)g(will)e(a\013ect)j
Fj(r)q(ead)p Fo(s)e(from)f(the)i(other\).)300 665 y(It)h(turns)h(out)f
(to)f(b)q(e)i(quite)f(straigh)o(tforw)o(ard)f(to)h(add)f(an)h
(additional)e(constan)o(t,)i Fk(eqMutVar)n Fo(:)344 765
y Fk(eqMutVar)20 b(::)h(MutVar)g(s)g(a)h(->)f(MutVar)g(s)g(a)h(->)f
(Bool)344 814 y(eqMutArr)f(::)h(Ix)g(i)h(=>)f(MutArr)g(s)h(i)f(v)h(->)f
(MutArr)g(s)g(i)h(v)f(->)h(Bool)333 914 y Fo(Notice)11
b(that)f(the)g(result)h(do)q(es)g Fl(not)f Fo(dep)q(end)h(on)f(the)g
(state|it)g(is)g(simply)e(a)i(b)q(o)q(olean.)16 b(Notice)300
964 y(also)c(that)h(w)o(e)g(only)g(pro)o(vide)f(a)h(test)h(on)f
(references)i(whic)o(h)e(exist)g(in)g(the)g(same)f(state)i(thread.)300
1014 y(References)i(from)c(di\013eren)o(t)j(state)g(threads)g(cannot)f
(b)q(e)g(aliases)g(for)f(one)h(another.)300 1145 y Fp(8.2.)48
b(Fixp)q(oin)o(t)300 1245 y Fo(In)14 b(lazy)f(functional)g(programs)g
(it)g(is)h(often)g(useful)g(to)g(write)g(recursiv)o(e)h(de\014nitions)f
(suc)o(h)h(as)474 1323 y Fk(\(newTree,)20 b(min\))h(=)h(f)f(tree)g(min)
300 1402 y Fo(Here,)e(part)e(of)g(the)h(result)g(of)f
Fk(f)g Fo(is)g(passed)h(in)o(to)f Fk(f)o Fo(.)29 b(A)17
b(standard)h(example)e(is)h(a)g(function)300 1452 y(whic)o(h)12
b(replaces)g(all)f(the)h(lea)o(v)o(es)g(of)f(a)g(tree)i(with)e(the)h
(minim)o(um)7 b(of)k(all)f(the)i(lea)o(v)o(es,)g(in)f(a)h(single)300
1502 y(pass)g(of)f(the)i(tree)g(\(hence)g(our)f(c)o(hoice)g(of)f(names)
g(in)h(the)g(example\))e(\(Bird)j([1984]\).)i(The)d(alert)300
1551 y(reader)j(ma)o(y)e(ha)o(v)o(e)h(noticed)h(that)f(it)g(is)g(imp)q
(ossible)f(to)h(write)g(programs)f(in)h(this)g(w)o(a)o(y)g(if)f
Fk(f)h Fo(is)300 1601 y(a)g(state)g(transformer.)k(W)m(e)13
b(migh)o(t)f(try:)474 1680 y Fk(f)22 b(tree)f(min)43
b(`thenST`)20 b(\\)i(\(newTree,)e(min\))g(->)i(...)300
1758 y Fo(but)14 b(alas)f(the)i Fk(min)e Fo(result)h(is)g(not)g(in)f
(scop)q(e)i(at)f(the)g(call.)j(What)d(is)g(needed)h(is)f(a)f(new)h(com)
o(bi-)300 1808 y(nator)g Fk(fixST)o Fo(,)f(with)h(t)o(yp)q(e:)344
1907 y Fk(fixST)20 b(::)i(\(a)f(->)g(ST)h(s)f(a\))h(->)f(ST)h(s)f(a)333
2007 y Fo(and)14 b(the)g(usual)g(knot-t)o(ying)f(seman)o(tics,)g(whic)o
(h)h(w)o(e)g(depict)g(th)o(us:)699 2256 y @beginspecial
@setspecial
%%BeginDocument: fix-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-3 12 translate
0.000000 50.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 142 22 moveto 142 22 lineto stroke
stroke
% Polyline
newpath 142 67 moveto 142 27 lineto 62 27 lineto 62 67 lineto closepath stroke
% Polyline
newpath 21 56 moveto 61 56 lineto stroke
stroke
newpath 53.000 54.000 moveto 61.000 56.000 lineto 53.000 58.000 lineto stroke
% Polyline
newpath 142 56 moveto 182 56 lineto stroke
stroke
newpath 174.000 54.000 moveto 182.000 56.000 lineto 174.000 58.000 lineto stroke
% Polyline
newpath 125 61 moveto 125 40 lineto 80 40 lineto 80 61 lineto closepath stroke
% Polyline
newpath 61 56 moveto 80 56 lineto stroke
stroke
newpath 72.000 54.000 moveto 80.000 56.000 lineto 72.000 58.000 lineto stroke
% Polyline
newpath 125 56 moveto 142 56 lineto stroke
stroke
% Polyline
newpath 125 46 moveto 162 46 lineto 162 13 lineto stroke
stroke
newpath 160.000 21.000 moveto 162.000 13.000 lineto 164.000 21.000 lineto stroke
% Polyline
newpath 132 46 moveto 132 33 lineto 69 33 lineto 69 45 lineto 80 45 lineto stroke
stroke
newpath 72.000 43.000 moveto 80.000 45.000 lineto 72.000 47.000 lineto stroke
/Times-Roman findfont 12.000 scalefont setfont
150 68 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
3 68 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 12.000 scalefont setfont
96 53 moveto 
1 -1 scale
(s) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 2335 a(No)o(w)g(w)o(e)g(can)g(write)g(our)g(recursiv)o
(e)h(state)g(transformer:)474 2413 y Fk(fixST)21 b(\(\\)g(~\(newTree,)f
(min\))h(->)h(f)f(tree)g(min\))300 2492 y Fo(\(The)16
b(\\)p Fk(~)o Fo(")f(in)g(this)g(example)e(sp)q(eci\014es)k(that)e(the)
h(tuple)f(should)g(b)q(e)h(matc)o(hed)e(lazily)m(.)20
b(If)15 b(the)300 2541 y(argumen)o(t)f(to)h Fk(fixST)e
Fo(is)i(a)g(strict)h(function,)e(then)i(of)e(course)i(the)g(result)f
(of)g(the)g Fk(fixST)f Fo(call)300 2591 y(is)g(b)q(ottom.\))p
eop
%%Page: 31 31
31 30 bop 1749 275 a Fm(31)300 416 y Fp(9.)48 b(Implemen)o(tati)o(on)
300 518 y Fo(The)20 b(whole)g(p)q(oin)o(t)g(of)f(expressing)i(stateful)
f(computations)f(in)g(the)i(framew)o(ork)d(that)i(w)o(e)300
568 y(ha)o(v)o(e)g(describ)q(ed)i(is)e(that)g(op)q(erations)g(whic)o(h)
g(mo)q(dify)e(the)j(state)g(can)f(up)q(date)h(the)g(state)300
618 y Fl(in)d(plac)n(e)p Fo(.)27 b(The)17 b(implemen)o(tation)d(is)i
(therefore)j(crucial)e(to)f(the)i(whole)e(en)o(terprise,)j(rather)300
667 y(than)c(b)q(eing)g(a)g(p)q(eripheral)g(issue.)22
b(This)15 b(section)h(fo)q(cuses)g(on)f(implemen)o(tation)d(issues,)k
(and)300 717 y(app)q(eals)11 b(to)g(some)g(in)o(tuitions)f(ab)q(out)h
(what)g(will)e(generate)k(\\go)q(o)q(d)d(co)q(de")i(and)f(what)g(will)f
(not.)300 767 y(Readers)16 b(in)o(terested)i(in)d(a)g(more)g(substan)o
(tial)g(treatmen)o(t)h(of)f(suc)o(h)h(in)o(tuitions)e(are)j(referred)
300 817 y(to)d(P)o(eyton)g(Jones)h([1987],)c(P)o(eyton)k(Jones)f
([1992].)333 868 y(W)m(e)g(ha)o(v)o(e)f(in)h(mind)e(the)i(follo)o(wing)
e(framew)o(ork:)300 954 y Fn(\017)45 b Fo(The)19 b Fl(state)f
Fo(of)f(eac)o(h)i(encapsulated)g(state)g(thread)g(is)f(represen)o(ted)j
(b)o(y)c(a)h(collection)g(of)366 1004 y(ob)r(jects)d(in)f(heap-allo)q
(cated)f(storage.)300 1092 y Fn(\017)45 b Fo(A)14 b Fl(r)n(efer)n(enc)n
(e)f Fo(is)h(represen)o(ted)j(b)o(y)d(the)g(address)h(of)e(an)h(ob)r
(ject)h(in)e(heap-allo)q(cated)h(store.)300 1180 y Fn(\017)45
b Fo(A)16 b Fl(r)n(e)n(ad)g(op)n(er)n(ation)g Fo(returns)h(the)f
(curren)o(t)h(con)o(ten)o(ts)g(of)e(the)h(ob)r(ject)g(whose)g
(reference)i(is)366 1230 y(giv)o(en.)300 1317 y Fn(\017)45
b Fo(A)14 b Fl(write)f(op)n(er)n(ation)h Fo(o)o(v)o(erwrites)g(the)g
(con)o(ten)o(ts)h(of)e(the)h(sp)q(eci\014ed)h(ob)r(ject)f(or,)f(in)g
(the)h(case)366 1367 y(of)g(m)o(utable)e(arra)o(ys,)h(part)i(of)e(the)h
(con)o(ten)o(ts.)300 1454 y(As)i(the)g(previous)g(section)g(outlined,)f
(the)i(correctness)h(of)d(this)h(implem)o(en)o(tation)d(relies)j(to-)
300 1504 y(tally)g(on)g(the)h(t)o(yp)q(e)h(system.)26
b(Suc)o(h)17 b(a)g(reliance)g(is)g(quite)g(famili)o(ar:)k(for)16
b(example,)g(the)h(im-)300 1553 y(plemen)o(tation)12
b(of)g(addition)g(mak)o(es)g(no)h(attempt)g(to)g(c)o(hec)o(k)h(that)f
(its)h(argumen)o(ts)e(are)i(indeed)300 1603 y(in)o(tegers,)g(b)q
(ecause)h(the)f(t)o(yp)q(e)g(system)g(ensures)h(it.)j(In)13
b(the)h(same)f(w)o(a)o(y)m(,)f(the)i(implemen)o(tatio)o(n)300
1653 y(of)f(state)h(transformers)g(mak)o(es)e(no)i(attempt)f(to)g
(ensure,)i(for)e(example,)f(that)i(references)i(are)300
1703 y(only)g(used)j(in)d(the)i(same)f(state)h(thread)g(in)f(whic)o(h)g
(they)h(w)o(ere)g(created;)i(the)e(t)o(yp)q(e)g(system)300
1753 y(ensures)e(that)e(this)g(is)f(so.)300 1889 y Fp(9.1.)48
b(Up)q(date)15 b(in)f(place)300 1991 y Fo(The)f(most)f(critical)g
(correctness)k(issue)e(concerns)h(the)e(up)q(date-in-place)g(b)q(eha)o
(viour)g(of)f(write)300 2041 y(op)q(erations.)31 b(Wh)o(y)17
b(is)h(up)q(date-in-place)g(safe?)31 b(It)18 b(is)g(safe)g(b)q(ecause)h
(all)e(the)i(com)o(binators)300 2091 y(\()p Fk(thenST)o
Fo(,)10 b Fk(returnST)o Fo(,)g Fk(fixST)o Fo(\))g(use)h(the)g(state)g
(only)f(in)f(a)h(single-threaded)h(manner)f(\(Sc)o(hmidt)300
2140 y([1985]\);)k(that)h(is,)g(they)h(neither)g(duplicate)f(nor)g
(discard)h(it)f(\(Figure)h(5\).)22 b(F)m(urthermore,)15
b(all)300 2190 y(the)f(primitiv)o(e)e(op)q(erations)i(are)h(strict)f
(in)g(the)g(state.)333 2241 y(It)f(follo)o(ws)f(that)h(a)f(write)i(op)q
(eration)e(can)i(mo)q(dify)c(the)k(state)g(in)e(place,)h(b)q(ecause)i
(\(a\))e(it)f(has)300 2291 y(the)i(only)e(cop)o(y)h(of)f(the)h
(incoming)e(state,)j(and)e(\(b\))i(since)f(it)g(is)g(strict)g(in)g(the)
g(incoming)e(state,)300 2341 y(and)i(the)h(preceding)g(op)q(eration)g
(will)e(not)h(pro)q(duce)h(its)g(result)g(state)g(un)o(til)e(it)h(has)h
(computed)300 2391 y(its)c(result,)i(there)g(can)e(b)q(e)h(no)f(other)i
(as-y)o(et-unexecuted)g(op)q(erations)f(p)q(ending)f(on)h(that)f
(state.)333 2442 y(Can)19 b(the)h(programmer)d(someho)o(w)h(duplicate)h
(the)g(state?)35 b(No:)28 b(since)20 b(the)g Fk(ST)f
Fo(t)o(yp)q(e)g(is)300 2492 y(opaque,)f(the)h(only)e(w)o(a)o(y)g(the)i
(programmer)c(can)k(manipulate)c(the)k(state)g(is)e Fl(via)h
Fo(the)h(com-)300 2541 y(binators)d Fk(thenST)g Fo(and)g
Fk(returnST)f Fo(and)h Fk(fixST)o Fo(.)26 b(The)17 b(programmer)d
(certainly)i(do)q(es)i(ha)o(v)o(e)300 2591 y(access)e(to)e(named)f
(references)k(in)o(to)c(the)i(state.)20 b(Ho)o(w)o(ev)o(er,)14
b(it)f(is)h(p)q(erfectly)i(OK)e(for)g(these)h(to)p eop
%%Page: 32 32
32 31 bop 300 275 a Fm(32)300 416 y Fo(b)q(e)16 b(duplicated,)f(stored)
i(in)e(data)g(structures)j(and)d(so)h(on.)22 b(V)m(ariables)15
b(are)h Fl(immutable)p Fo(;)f(it)g(is)300 466 y(only)e(the)i(state)f
(to)g(whic)o(h)g(they)g(refer)h(that)f(is)g(altered)g(b)o(y)g(a)g
(write)g(op)q(eration.)333 523 y(W)m(e)f(\014nd)g(these)h(argumen)o(ts)
e(con)o(vincing,)g(but)h(they)h(are)f(certainly)g(not)g(formal.)i(A)e
(formal)300 573 y(pro)q(of)k(w)o(ould)f(necessarily)j(in)o(v)o(olv)o(e)
d(some)g(op)q(erational)h(seman)o(tics,)g(and)g(a)g(pro)q(of)g(that)h
(no)300 623 y(ev)n(aluation)g(order)i(could)f(c)o(hange)h(the)g(b)q
(eha)o(viour)f(of)g(the)h(program.)33 b(W)m(e)19 b(ha)o(v)o(e)g(not)g
(y)o(et)300 672 y(undertak)o(en)c(suc)o(h)g(a)e(pro)q(of.)300
828 y Fp(9.2.)48 b(T)o(yp)q(ec)o(hec)o(king)14 b Fk(runST)300
942 y Fo(Since)e Fk(runST)f Fo(has)h(a)f(rank-2)g(t)o(yp)q(e,)i(w)o(e)e
(needed)j(to)d(mo)q(dify)f(the)i(t)o(yp)q(e)g(c)o(hec)o(k)o(er)h(to)f
(include)g(the)300 992 y(extra)18 b(rule)f Fj(RU)5 b(N)22
b Fo(in)16 b(Figure)i(4.)27 b(The)18 b(mo)q(di\014cation)d(is)i(quite)g
(straigh)o(tforw)o(ard,)g(b)q(ecause)300 1042 y(the)12
b(rule)g(for)g Fj(RU)5 b(N)16 b Fo(is)11 b(so)h(similar)d(to)j(that)g
(for)f Fj(LE)r(T)6 b Fo(.)18 b(All)11 b(that)g(is)h(required)h(is)e(to)
h(c)o(hec)o(k)g(that)300 1092 y(the)i(t)o(yp)q(e)g(inferred)f(for)g
(the)h(argumen)o(t)e(of)h Fk(runST)f Fo(has)h(a)g(t)o(yp)q(e)h(of)e
(the)i(form)e Fk(ST)g Fj(s)i(\034)5 b Fo(,)13 b(where)h
Fj(s)300 1142 y Fo(is)g(an)f(un-constrained)i(t)o(yp)q(e)f(v)n
(ariable,)f(not)h(app)q(earing)f(in)h Fj(\034)5 b Fo(.)333
1199 y(The)17 b Fj(RU)5 b(N)22 b Fo(rule)17 b(describ)q(es)i(ho)o(w)d
(to)h(t)o(yp)q(e-c)o(hec)o(king)h Fl(applic)n(ations)f
Fo(of)f Fk(runST)o Fo(.)27 b(What)16 b(of)300 1249 y(other)e(o)q
(ccurrences)i(of)d Fk(runST)o Fo(?)18 b(F)m(or)13 b(example,)f(the)i
Fj(RU)5 b(N)18 b Fo(rule)13 b(do)q(es)h(not)f(sa)o(y)h(ho)o(w)f(to)g(t)
o(yp)q(e)300 1298 y(the)h(follo)o(wing)e(expression,)i(in)g(whic)o(h)g
Fk(runST)e Fo(app)q(ears)j(as)f(an)g(argumen)o(t:)344
1411 y Fk(map)21 b(runST)g(xs)300 1517 y Fo(W)m(e)f(side-step)i(this)e
(di\016cult)o(y)g(b)o(y)g(insisting)g(that)g Fk(runST)g
Fo(only)f(app)q(ears)i(applied)f(to)h(an)300 1567 y(argumen)o(t,)15
b(as)i(implied)d(b)o(y)i(the)h(syn)o(tax)f(in)g(Section)h(6.1.)24
b(It)16 b(migh)o(t)e(b)q(e)j(p)q(ossible)g(to)f(allo)o(w)300
1616 y(greater)j(generalit)o(y)m(,)g(but)f(p)q(erforming)f(t)o(yp)q(e)i
(inference)h(in)e(the)h(presence)i(of)d(unrestricted)300
1666 y(rank-2)c(t)o(yp)q(es)h(is)f(a)g(m)o(uc)o(h)g(harder)h(prop)q
(osition,)e(and)h(one)h(whic)o(h)f(is)h(not)f(necessary)i(for)e(our)300
1716 y(en)o(terprise.)19 b(Kfoury)12 b([1992])d(and)j(Kfoury)f(&)h(W)m
(ells)f([1994])e(explore)j(this)g(territory)g(in)f(detail.)300
1871 y Fp(9.3.)48 b(E\016ciency)15 b(considerations)300
1986 y Fo(It)d(w)o(ould)g(b)q(e)h(p)q(ossible)g(to)f(implem)o(en)o(t)e
(state)j(transformers)g(b)o(y)f(pro)o(viding)f(the)i(com)o(binators)300
2036 y(\()p Fk(thenST)o Fo(,)19 b Fk(returnST)o Fo(,)g(etc\))h(and)f
(op)q(erations)g(\()p Fk(readVar)o Fo(,)h Fk(writeVar)d
Fo(etc\))j(as)f(primitiv)o(es.)300 2086 y(But)14 b(this)g(w)o(ould)e
(imp)q(ose)h(a)g(v)o(ery)h(hea)o(vy)f(o)o(v)o(erhead)h(on)f(eac)o(h)h
(op)q(eration)g(and)f(w)o(orse)h(still)f(on)300 2135
y(comp)q(osition.)26 b(F)m(or)17 b(example,)g(a)g(use)h(of)f
Fk(thenST)f Fo(w)o(ould)g(en)o(tail)h(the)h(construction)g(in)f(the)300
2185 y(heap)10 b(of)e(t)o(w)o(o)h(function-v)n(alued)f(argumen)o(ts,)h
(follo)o(w)o(ed)f(b)o(y)h(a)g(pro)q(cedure)j(call)c(to)h
Fk(thenST)o Fo(.)16 b(This)300 2235 y(compares)g(v)o(ery)h(p)q(o)q
(orly)g(with)f(simple)f(juxtap)q(osition)h(of)g(co)q(de,)i(whic)o(h)e
(is)h(ho)o(w)f(sequen)o(tial)300 2285 y(comp)q(osition)c(is)i(implemen)
o(ted)d(in)j(con)o(v)o(en)o(tional)f(languages!)333 2342
y(W)m(e)c(migh)o(t)e(attempt)i(to)g(reco)o(v)o(er)h(some)f(of)f(this)i
(lost)f(e\016ciency)h(b)o(y)f(treating)g(state-transformer)300
2392 y(op)q(erations)15 b(sp)q(ecially)g(in)g(the)h(co)q(de)g
(generator,)g(but)f(that)g(risks)h(complicating)d(an)i(already)300
2442 y(complex)g(part)h(of)f(the)i(compiler.)23 b(Instead)17
b(w)o(e)f(implemen)o(t)d(state)k(transformers)f(in)f(a)h(w)o(a)o(y)300
2492 y(whic)o(h)f(is)g(b)q(oth)h(direct)g(and)f(e\016cien)o(t:)22
b(w)o(e)15 b(simply)f(giv)o(e)g(Hask)o(ell)h(de\014nitions)h(for)f(the)
h(state)300 2541 y(transformer)11 b(t)o(yp)q(e)i(and)e(its)h(com)o
(binators.)k(These)d(de\014nitions)e(are)i(almost)c(precise)14
b(translit-)300 2591 y(erations)g(of)f(the)i(seman)o(tics)e(giv)o(en)h
(for)f(them)g(in)h(Figure)g(5)1243 2576 y Fv(9)1261 2591
y Fo(.)p eop
%%Page: 33 33
33 32 bop 1749 275 a Fm(33)300 416 y Fl(9.3.1.)42 b(The)15
b(state)g(tr)n(ansformer)e(implementation)300 517 y Fo(A)h(state)g
(transformer,)f(of)f(t)o(yp)q(e)j Fk(ST)21 b(s)g(a)p
Fo(,)13 b(is)h(represen)o(ted)i(b)o(y)d(a)h(function)f(from)e
Fk(State)21 b(s)13 b Fo(to)300 567 y(a)h(pair)f(of)g(the)i(result,)f
(of)f(t)o(yp)q(e)i Fk(a)e Fo(and)h(the)h(transformed)e(state.)344
667 y Fk(type)21 b(ST)g(s)h(a)f(=)h(State)e(s)i(->)f(\(a,)h(State)e
(s\))333 767 y Fo(\(This)12 b(represen)o(tation)g(of)f
Fk(ST)g Fo(is)g(not,)h(of)e(course,)j(exp)q(osed)g(to)e(the)h
(programmer,)d(lest)j(he)f(or)300 817 y(she)i(write)g(functions)g(whic)
o(h)f(duplicate)g(or)h(discard)g(the)g(state.\))18 b(The)13
b(one)g(resp)q(ect)h(in)e(whic)o(h)300 867 y(this)i(implemen)o(tation)d
(di\013ers)k(from)d(the)j(seman)o(tics)e(in)h(Figure)28
b(5)14 b(is)g(in)g(the)g(result)h(t)o(yp)q(e)g(of)300
917 y Fk(ST)p Fo(:)i(the)12 b(seman)o(tics)g(used)h(a)f(simple)e(pro)q
(duct,)j(whereas)h(a)d(Hask)o(ell)h(pair)g(is)g(a)f(lifted)h(pro)q
(duct.)300 967 y(\(That)i(is,)f(the)h(v)n(alue)f Fn(?)g
Fo(di\013ers)h(from)e Fk(\()p Fn(?)p Fk(,)o Fn(?)p Fk(\))o
Fo(.\))18 b(As)c(w)o(e)g(shall)f(see,)h(this)g(distinction)f(has)h(an)
300 1016 y(unfortunate)g(implication)d(for)j(e\016ciency)m(.)333
1067 y(The)h(de\014nitions)e(of)h Fk(thenST)n Fo(,)g
Fk(returnST)n Fo(,)g(and)f Fk(fixST)g Fo(follo)o(w)f(immedia)o(tely:)
344 1167 y Fk(returnST)20 b(x)h(s)h(=)f(\(x,s\))344 1217
y(thenST)f(m)i(k)f(s)h(=)f(k)h(x)g(s')f(where)g(\(x,s'\))f(=)i(m)g(s)
344 1267 y(fixST)e(k)87 b(s)22 b(=)f(\(r,s'\))g(where)g(\(r,s'\))f(=)i
(k)g(r)f(s)333 1367 y Fo(The)f(b)q(eaut)o(y)g(of)f(this)g(approac)o(h)h
(is)f(that)h(all)e(the)i(com)o(binators)e(can)i(then)g(b)q(e)g
(in-lined)300 1417 y(at)c(their)h(call)f(sites,)h(th)o(us)g(largely)f
(remo)o(ving)e(the)j(\\plum)o(bing")d(costs.)26 b(F)m(or)16
b(example,)g(the)300 1467 y(expression)344 1567 y Fk(m1)21
b(`thenST`)f(\\v1)h(->)344 1617 y(m2)g(`thenST`)f(\\v2)h(->)344
1667 y(returnST)f(e)333 1767 y Fo(b)q(ecomes,)12 b(after)f(in-lining)e
Fk(thenST)g Fo(and)i Fk(returnST)n Fo(,)g(the)h(m)o(uc)o(h)e(more)g
(e\016cien)o(t)h(expression)344 1867 y Fk(\\s)21 b(->)g(let)h
(\(v1,s1\))e(=)h(m1)h(s)562 1917 y(\(v2,s2\))e(=)h(m2)h(s1)474
1967 y(in)g(\(e,s3\))333 2067 y Fo(W)m(e)14 b(ha)o(v)o(e)f(not)h(so)g
(far)g(giv)o(en)f(the)i(implem)o(en)o(tation)c(of)i Fk(runST)o
Fo(,)h(whic)o(h)f(is)h(in)o(triguing:)344 2162 y Fk(runST)20
b(m)i(=)g(r)f(where)g(\(r,s\))g(=)g(m)h(dummyState)333
2256 y Fo(Since)17 b(its)f(argumen)o(t,)e Fk(m)p Fo(,)i(w)o(orks)g
(regardless)h(of)f(what)f(state)i(is)f(passed)h(to)f(it,)f(w)o(e)h
(simply)300 2306 y(pass)c(a)f(v)n(alue)g(represen)o(ting)h(the)g
(curren)o(t)h(state)f(of)f(the)h(w)o(orld.)k(As)c(w)o(e)g(will)e(see)i
(shortly)f(\(Sec-)300 2356 y(tion)i(9.3.3\),)e(this)i(v)n(alue)f(is)h
(nev)o(er)h(actually)e(lo)q(ok)o(ed)h(at,)f(so)h(a)g(constan)o(t)h(v)n
(alue,)e Fk(dummyState)n Fo(,)300 2406 y(will)17 b(do.)30
b(W)m(e)18 b(need)h(to)f(tak)o(e)g(care)h(here,)h(though.)31
b(Consider)18 b(the)h(follo)o(wing)d(expression,)300
2456 y(whic)o(h)e(has)g(t)o(w)o(o)f(distinct)h(state)h(threads:)344
2541 y Fk(...\(runST)20 b(\(newVar)g(1)h(`thenST`)g(\\v)g(->)g
(e1\)\)...)344 2591 y(...\(runST)f(\(newVar)g(1)h(`thenST`)g(\\v)g(->)g
(e2\)\)...)p eop
%%Page: 34 34
34 33 bop 300 275 a Fm(34)300 416 y Fo(After)15 b(inlining)c
Fk(runST)i Fo(and)h Fk(thenST)f Fo(w)o(e)h(transform)e(to:)344
502 y Fk(...\(let)20 b(\(v,s1\))g(=)i(newVar)f(1)g(dummyState)f(in)h
(e1)h(s1\)...)344 552 y(...\(let)e(\(v,s1\))g(=)i(newVar)f(1)g
(dummyState)f(in)h(e2)h(s1\)...)300 637 y Fo(No)o(w,)c(it)g(lo)q(ok)f
(as)h(though)g(it)f(w)o(ould)g(legitimate)f(to)i(share)h
Fk(newVar)h(1)i(dummyState)16 b Fo(as)i(a)300 686 y(common)11
b(sub-expression:)344 772 y Fk(let)21 b(\(v,s1\))f(=)i(newVar)e(1)i
(dummyState)344 822 y(in)344 872 y(...\(e1)e(s1\)...)344
922 y(...\(e2)g(s1\)...)300 1007 y Fo(but)10 b(of)f(course)h(this)g
(transformation)e(is)h(b)q(ogus.)17 b(The)10 b(t)o(w)o(o)f
Fk(dummyState)n Fo(s)g(are)h(distinct)g(v)n(alues!)300
1057 y(There)21 b(are)f(t)o(w)o(o)g(solutions)f(to)h(this)g(problem:)28
b(do)20 b(not)g(inline)e Fk(runST)o Fo(,)j(or)f(alternativ)o(ely)m(,)
300 1106 y(when)c(inlining)d Fk(runST)h Fo(create)j(a)e(new)g(constan)o
(t)h Fk(dummyState)d Fo(on)i(eac)o(h)h(o)q(ccasion,)f(akin)f(to)300
1156 y(sk)o(olemization)e(of)h(logic)g(v)n(ariables.)333
1207 y(This)k(pro)o(vides)g(us)g(with)g(a)f(second)i(reason)g(wh)o(y)e
Fk(runST)g Fo(should)h(not)f(b)q(e)i(regarded)g(as)f(a)300
1257 y(standard)10 b(v)n(alue)g(\(its)g(t)o(yp)q(e)g(pro)o(vided)g(the)
g(\014rst\).)18 b(Rather,)11 b Fk(runST)d Fo(is)i(an)g(eliminable)d
(language)300 1306 y(construct.)333 1357 y(The)14 b(co)q(de)g
(generator)h(m)o(ust,)d(of)g(course,)j(remain)d(resp)q(onsible)i(for)f
(pro)q(ducing)h(the)g(appro-)300 1407 y(priate)e(co)q(de)g(for)g(eac)o
(h)g(primitiv)o(e)e(op)q(eration,)h(suc)o(h)i(as)e Fk(readVar)o
Fo(,)h Fk(ccall)o Fo(,)f(and)h(so)g(on.)17 b(In)11 b(our)300
1456 y(implemen)o(tatio)o(n)h(w)o(e)j(actually)f(pro)o(vide)h(a)f(Hask)
o(ell)g(\\wrapp)q(er")h(for)g(eac)o(h)g(primitiv)o(e)d(whic)o(h)300
1506 y(mak)o(es)f(explicit)h(the)h(ev)n(aluation)e(of)h(their)h
(argumen)o(ts,)f(using)g(so-called)g(\\un)o(b)q(o)o(xed)g(v)n(alues".)
300 1556 y(Both)g(the)g(motiv)n(ation)c(for)k(and)f(the)h(implemen)o
(tation)c(of)j(our)h(approac)o(h)f(to)h(un)o(b)q(o)o(xed)g(v)n(alues)
300 1606 y(is)i(detailed)g(in)f(P)o(eyton)h(Jones)h(&)f(Launc)o(h)o
(bury)g([1991],)e(and)i(w)o(e)g(do)f(not)h(rehearse)i(it)d(here.)300
1741 y Fl(9.3.2.)42 b(Strictness)300 1842 y Fo(In)16
b(the)h(previous)f(section)g(w)o(e)h(pro)q(duced)g(the)f(follo)o(wing)e
(co)q(de)j(from)d(a)h(comp)q(osition)f(of)i Fk(m1)300
1892 y Fo(and)e Fk(m2)o Fo(:)344 1992 y Fk(\\s)21 b(->)g(let)h
(\(v1,s1\))e(=)h(m1)h(s)562 2042 y(\(v2,s2\))e(=)h(m2)h(s1)474
2092 y(in)g(\(e,s3\))333 2192 y Fo(This)16 b(migh)o(t)d(b)q(e)k(b)q
(etter)g(than)f(the)g(original,)e(in)h(whic)o(h)g(function-v)n(alued)g
(argumen)o(ts)g(are)300 2242 y(passed)e(to)f Fk(thenST)o
Fo(,)g(but)g(it)g(is)g(still)f(not)i(v)o(ery)f(go)q(o)q(d!)17
b(In)12 b(particular,)g(heap-allo)q(cated)g(th)o(unks)300
2292 y(are)21 b(created)h(for)e Fk(m1)h(s)f Fo(and)h
Fk(m2)g(s1)p Fo(,)g(along)f(with)g(heap-allo)q(cated)g(selectors)i(to)e
(extract)300 2341 y(the)d(comp)q(onen)o(ts)g(\()p Fk(v1)p
Fo(,)g Fk(s1)f Fo(and)h Fk(v2)o Fo(,)g Fk(s2)p Fo(,)g(resp)q(ectiv)o
(ely\).)28 b(Ho)o(w)o(ev)o(er,)18 b(the)f(program)e(is)i(no)o(w)300
2391 y(exp)q(osed)d(to)e(the)h(full)e(range)h(of)g(analyses)h(and)f
(program)f(transformations)f(implemen)o(ted)h(b)o(y)300
2441 y(the)h(compiler.)k(If)c(the)g(compiler)f(can)h(sp)q(ot)g(that)g
(the)g(ab)q(o)o(v)o(e)g(co)q(de)g(will)f(b)q(e)h(used)h(in)e(a)h(con)o
(text)300 2491 y(whic)o(h)i(is)g(strict)g(in)g(either)g(comp)q(onen)o
(t)g(of)f(the)h(result)h(tuple,)f(it)f(will)g(b)q(e)h(transformed)f(to)
344 2591 y Fk(\\s)21 b(->)g(case)g(m1)h(s)f(of)p eop
%%Page: 35 35
35 34 bop 1749 275 a Fm(35)518 416 y Fk(\(v1,s2\))20
b(->)i(case)f(m2)g(s1)g(of)801 466 y(\(v2,s2\))g(->)g(\(e,s2\))333
565 y Fo(This)c(is)g Fl(much)g Fo(more)f(e\016cien)o(t.)28
b(First)17 b Fk(m1)f Fo(is)h(called,)g(returning)h(a)e(pair)h(whic)o(h)
f(is)h(tak)o(en)300 615 y(apart;)c(then)g Fk(m2)g Fo(is)g(called,)f
(and)h(its)g(result)g(tak)o(en)g(apart)g(b)q(efore)h(returning)f(the)h
(\014nal)e(result.)300 665 y(In)17 b(our)h(implem)o(en)o(tation,)d(no)i
(heap)h(allo)q(cation)d(is)j(p)q(erformed)f(at)g(all.)27
b(If)17 b Fk(m1)g Fo(and)g Fk(m2)g Fo(are)300 715 y(primitiv)o(e)f(op)q
(erations,)j(then)f(the)h(co)q(de)g(implemen)o(ting)14
b Fk(m2)k Fo(simply)e(follo)o(ws)h(that)h(for)f Fk(m2)p
Fo(,)300 765 y(just)d(as)g(it)g(w)o(ould)f(in)g(C.)333
814 y(It)i(turns)h(out)f(that)f(ev)o(en)i(relativ)o(ely)e(simple)f
(strictness)k(analysis)d(can)h(often)g(successfully)300
864 y(enable)21 b(this)g(transformation,)f(pro)o(vided)g(that)h(Hask)o
(ell)f(is)h(extended)h(in)e(a)h(mo)q(dest)f(but)300 914
y(imp)q(ortan)o(t)12 b(regard.)19 b(Consider)14 b(the)g(function)344
1000 y Fk(f)21 b(::)h(MutVar)e(s)i(Int)f(->)g(ST)h(s)f(\(\))344
1050 y(f)g(x)h(=)f(writeVar)f(y)i(0)g(`thenST_`)474 1099
y(returnST)e(\(\))333 1185 y Fo(Is)c Fk(f)f Fo(strict)i(in)e(its)h
(input)f(state?)24 b(In)o(tuitiv)o(ely)m(,)14 b(it)h(m)o(ust)g(b)q(e:)
22 b(its)15 b(only)g(useful)h(result)g(is)f(its)300 1235
y(result)h(state,)f(whic)o(h)g(dep)q(ends)i(on)e(its)g(input)g(state.)
22 b(This)15 b(argumen)o(t)f(holds)h(for)f(an)o(y)h(v)n(alue)300
1285 y(of)h(t)o(yp)q(e)h Fk(ST)22 b(s)f(\(\))p Fo(.)26
b(Do)q(es)17 b(the)h(strictness)g(analyser)f(sp)q(ot)g(this)g
(strictness?)29 b(Alas,)16 b(it)h(do)q(es)300 1335 y(not.)h(After)c
(inlining,)e Fk(f)i Fo(b)q(ecomes:)344 1421 y Fk(f)21
b(x)h(s)f(=)h(let)f(\(_,s1\))g(=)g(writeVar)f(y)i(0)g(s)518
1470 y(in)518 1520 y(\(\(\),s1\))333 1606 y Fo(This)17
b(de\014nition)f(is)g(manifestly)e(not)j(strict)g(in)f(either)h
(argumen)o(t:)22 b(it)16 b(will)f(return)j(a)e(pair)300
1656 y(regardless)f(of)e(the)h(v)n(alues)g(of)f(its)h(argumen)o(ts.)j
(There)e(are)f(t)o(w)o(o)f(problems,)f(with)i(a)f(common)300
1706 y(cause:)300 1784 y Fn(\017)45 b Fo(Hask)o(ell)17
b(pairs)g(are)g(lifted,)g(so)g(that)g Fk(\()p Fn(?)p
Fk(,)o Fn(?)p Fk(\))f Fo(is)h(distinct)h(from)d Fn(?)p
Fo(.)27 b(The)17 b(seman)o(tics)g(in)366 1834 y(Figure)f(5)f(used)i(an)
e(ordinary)m(,)g(unlifted)g(pro)q(duct,)h(so)g(the)g(lifting)e(is)h
(not)h(certainly)f(not)366 1884 y(required)g(b)o(y)f(seman)o(tics.)300
1965 y Fn(\017)45 b Fo(The)13 b(unit)f(t)o(yp)q(e,)g
Fk(\(\))p Fo(,)g(is)g(also)f(a)h(lifted)f(domain,)f(with)h(t)o(w)o(o)h
(v)n(alues:)17 b Fk(\(\))11 b Fo(and)h Fn(?)p Fo(.)17
b(When)12 b(w)o(e)366 2014 y(c)o(hose)h Fk(\(\))d Fo(as)i(the)f(result)
h(t)o(yp)q(e)g(of)f(state)h(transfomers)f(whic)o(h)g(had)g(no)g(result)
h(w)o(e)f(certainly)366 2064 y(did)17 b(not)g(ha)o(v)o(e)g(in)f(mind)g
(that)h(t)o(w)o(o)f(distinct)i(v)n(alues)e(could)h(b)q(e)h(returned.)29
b(Again,)17 b(the)366 2114 y(lifting)12 b(of)i(the)g(Hask)o(ell)g(t)o
(yp)q(e)g Fk(\(\))f Fo(is)h(not)g(required.)300 2193
y(If)f(neither)h(pairs)e(nor)h(the)h(unit)f(t)o(yp)q(e)g(w)o(ere)h
(lifted)f(then)g(it)g(is)g(easy)g(to)g(see)h(that)f Fk(f)g
Fo(is)g(strict)h(in)300 2242 y Fk(s)p Fo(.)k(Supp)q(ose)c
Fk(s)e Fo(w)o(ere)j Fn(?)p Fo(:)h(then)e(b)q(ecause)h(the)f(primitiv)o
(e)d Fk(writeVar)g Fo(is)i(strict,)h Fk(s1)f Fo(w)o(ould)f(also)300
2292 y(b)q(e)h Fn(?)p Fo(,)f(so)g(the)h(result)g(of)f
Fk(f)g Fo(w)o(ould)g(b)q(e)h(the)g(pair)f Fk(\(\(\),)o
Fn(?)p Fk(\))o Fo(.)18 b(But)13 b(if)e Fk(\(\))h Fo(w)o(ere)h(unlifted)
f(to)q(o,)g(this)300 2342 y(is)i(the)g(same)f(as)h Fk(\()p
Fn(?)p Fk(,)o Fn(?)p Fk(\))o Fo(,)g(whic)o(h,)f(if)g(pairs)h(are)g
(unlifted,)f(is)h(the)g(same)f(as)h Fn(?)p Fo(.)333 2392
y(In)e(short,)g(in)g(order)g(to)g(giv)o(e)f(the)h(strictness)i
(analyser)e(a)f(real)h(c)o(hance,)h(a)e(state)i(transformer)300
2442 y(m)o(ust)j(return)h(an)g(unlifted)f(pair,)g(and)h(the)g(result)h
(t)o(yp)q(e)f(of)f(a)g(state)i(transformer)e(whic)o(h)g(is)300
2492 y(used)f(only)e(for)h(its)g(e\013ect)h(on)f(the)h(state)f(should)g
(b)q(e)h(an)e(unlifted,)g(one-p)q(oin)o(t)h(t)o(yp)q(e.)19
b(Though)300 2541 y(this)d(is)f(an)h(imp)q(ortan)o(t)e(e\013ect,)j(it)f
(is)f(far)h(from)e(ob)o(vious;)h(indeed,)h(it)g(only)f(b)q(ecame)g
(clear)h(to)300 2591 y(us)e(as)g(w)o(e)g(w)o(ere)h(w)o(orking)e(on)h
(the)g(\014nal)g(v)o(ersion)g(of)f(this)h(pap)q(er.)p
eop
%%Page: 36 36
36 35 bop 300 275 a Fm(36)333 416 y Fo(It)17 b(is)g(also)f(regrettable)
i(that)f(an)f(o)q(ccasionally-substan)o(tial)f(p)q(erformance)i
(e\013ect)i(should)300 466 y(dep)q(end)11 b(on)f(something)f(as)h
(complex)f(as)h(strictness)i(analysis.)k(Indeed,)11 b(w)o(e)g(pro)o
(vide)f(a)f(v)n(arian)o(t)300 516 y(of)17 b Fk(returnST)o
Fo(,)h(called)f Fk(returnStrictlyST)m Fo(,)i(whic)o(h)e(is)h(strict)h
(in)e(the)h(state,)i(precisely)e(to)300 565 y(allo)o(w)c(a)i
(programmer)e(to)h(enforce)i(strictness,)h(and)e(hence)h(ensure)h
(greater)f(e\016ciency)m(.)24 b(Of)300 615 y(course,)14
b(if)d Fk(returnStrictlyST)e Fo(is)k(used)g(indiscriminately)d(then)j
(the)g(incremen)o(tal)f(laziness)300 665 y(of)h(stateful)h
(computations)f(\(discussed)i(in)f(Section)g(5\))g(is)g(lost.)333
719 y(In)k(the)g(sp)q(ecial)f(\(but)h(common\))c(case)19
b(of)e(I/O)g(state)h(transformers,)g(w)o(e)f(can)h(guaran)o(tee)300
769 y(to)g(compile)f(e\016cien)o(t)h(co)q(de,)i(b)q(ecause)g
Fl(the)f(\014nal)g(state)g(of)g(the)g(I/O)g(thr)n(e)n(ad)f(wil)r(l)g(c)
n(ertainly)300 819 y(b)n(e)e(demande)n(d)p Fo(.)23 b(Wh)o(y?)f(Because)
17 b(the)e(whole)g(p)q(oin)o(t)g(in)g(running)g(the)g(program)f(in)h
(the)h(\014rst)300 868 y(place)h(is)g(to)g(cause)i(some)d(c)o(hange)i
(to)f(the)g(real)h(w)o(orld!)27 b(It)17 b(is)g(easy)h(to)f(use)h(this)f
(strictness)300 918 y(prop)q(ert)o(y)d(\(whic)o(h)f(cannot,)f(of)h
(course,)h(b)q(e)f(inferred)h(b)o(y)e(the)i(strictness)h(analyser\))e
(to)g(ensure)300 968 y(that)h(ev)o(ery)h(I/O)e(state)i(transformer)f
(is)f(compiled)g(e\016cien)o(tly)m(.)300 1113 y Fl(9.3.3.)42
b(Passing)16 b(the)f(state)f(ar)n(ound)300 1221 y Fo(The)i(implemen)o
(tation)d(of)i(the)h Fk(ST)g Fo(t)o(yp)q(e,)g(giv)o(en)f(ab)q(o)o(v)o
(e,)h(passes)h(around)f(an)g(explicit)f(state.)300 1271
y(Y)m(et,)k(w)o(e)f(said)f(earlier)h(that)g(state-manipulating)d(op)q
(erations)j(are)h(implem)o(en)o(ted)d(b)o(y)i(p)q(er-)300
1321 y(forming)f(state)j(c)o(hanges)h(in)e(the)h(common,)e(global)f
(heap.)36 b(What,)20 b(then,)h(is)e(the)h(role)g(of)300
1371 y(the)e(explicit)e(state)i(v)n(alue)f(whic)o(h)g(is)g(passed)h
(around)f(b)o(y)g(the)h(ab)q(o)o(v)o(e)e(co)q(de?)29
b(It)17 b(pla)o(ys)g(t)o(w)o(o)300 1421 y(imp)q(ortan)o(t)12
b(roles.)333 1474 y(Firstly)m(,)i(the)i(compiler)e(\\shak)o(es)h(the)h
(co)q(de)f(around")g(quite)g(considerably:)21 b(is)14
b(it)h(p)q(ossible)300 1524 y(that)i(it)g(migh)o(t)e(someho)o(w)h(end)i
(up)g(c)o(hanging)e(the)i(order)g(in)f(whic)o(h)g(the)h(primitiv)o(e)d
(op)q(era-)300 1574 y(tions)g(are)g(p)q(erformed?)21
b(No,)15 b(it)g(is)g(not.)21 b(The)15 b(input)g(state)h(of)e(eac)o(h)i
(primitiv)o(e)d(op)q(eration)h(is)300 1624 y(pro)q(duced)h(b)o(y)f(the)
h(preceding)g(op)q(eration,)f(so)g(the)h(ordering)g(b)q(et)o(w)o(een)g
(them)f(is)g(main)o(tained)300 1674 y(b)o(y)f(simple)f(data)h(dep)q
(endencies)j(of)d(the)h(explicit)f(state,)h(whic)o(h)g(are)g(certainly)
f(preserv)o(ed)j(b)o(y)300 1724 y(ev)o(ery)f(correct)g(program)e
(transformation.)333 1778 y(Secondly)m(,)h(the)h(explicit)f(state)i
(allo)o(ws)d(us)i(to)f(express)j(to)d(the)h(compiler)e(the)i
(strictness)i(of)300 1827 y(the)d(primitiv)o(e)e(op)q(erations)i(in)g
(the)g(state.)19 b(The)14 b Fk(State)f Fo(t)o(yp)q(e)i(is)e(de\014ned)i
(lik)o(e)e(this:)344 1931 y Fk(data)21 b(State)f(s)i(=)f(MkState)g
(\(State#)f(s\))333 2035 y Fo(That)14 b(is,)e(a)i(state)g(is)f
(represen)o(ted)j(b)o(y)d(a)h(single-constructor)g(algebraic)f(data)g
(t)o(yp)q(e,)h(whose)300 2085 y(only)h(con)o(ten)o(ts)j(is)e(a)g(v)n
(alue)f(of)h(t)o(yp)q(e)h Fk(State#)j(s)p Fo(,)c(the)h(\(\014nally!\))
24 b(primitiv)o(e)14 b(t)o(yp)q(e)j(of)f(states.)300
2135 y(The)h(lifting)d(implied)g(b)o(y)i(the)h Fk(MkState)d
Fo(constructor)k(corresp)q(onds)g(exactly)e(to)g(the)h(lifting)300
2184 y(in)h(the)h(seman)o(tics.)31 b(Using)18 b(this)g(de\014nition)g
(of)g Fk(State)f Fo(w)o(e)i(can)g(no)o(w)f(de\014ne)h
Fk(newVar)o Fo(,)g(for)300 2234 y(example,)12 b(lik)o(e)h(this:)344
2338 y Fk(newVar)20 b(init)h(\(MkState)f(s#\))h(=)h(case)f(newVar#)f
(init)h(s#)h(of)997 2388 y(\(v,t#\))f(->)g(\(v,)g(MkState)g(t#\))333
2492 y Fo(This)11 b(de\014nition)f(mak)o(es)f(absolutely)h(explicit)g
(the)h(ev)n(aluation)e(of)h(the)h(strictness)i(of)d Fk(newVar)300
2541 y Fo(in)17 b(its)h(state)h(argumen)o(t,)e(\014nally)g(calling)f
(the)i(truly)g(primitiv)o(e)e Fk(newVar#)g Fo(to)i(p)q(erform)f(the)300
2591 y(allo)q(cation.)p eop
%%Page: 37 37
37 36 bop 1749 275 a Fm(37)333 416 y Fo(W)m(e)13 b(think)g(of)g(a)g
(primitiv)o(e)e(state)j(|)f(that)g(is,)g(a)g(v)n(alue)g(of)f(t)o(yp)q
(e)i Fk(State#)21 b(s)p Fo(,)12 b(for)h(some)g(t)o(yp)q(e)300
466 y Fk(s)j Fo(|)h(as)f(a)h(\\tok)o(en")f(whic)o(h)h(stands)g(for)g
(the)g(state)g(of)f(the)i(heap)f(and)f(\(in)h(the)g(case)h(of)e(the)300
516 y(I/O)11 b(thread\))i(the)f(real)f(w)o(orld.)17 b(The)12
b(implem)o(en)o(tation)d(nev)o(er)j(actually)e(insp)q(ects)j(a)f
(primitiv)o(e)300 565 y(state)j(v)n(alue,)e(but)i(it)f(is)g(faithfully)
e(passed)j(to,)f(and)g(returned)i(from)d(ev)o(ery)i(primitiv)o(e)d
(state-)300 615 y(transformer)k(op)q(eration.)25 b(By)17
b(the)g(time)e(the)i(program)d(reac)o(hes)k(the)f(co)q(de)g(generator,)
h(the)300 665 y(role)e(of)g(these)h(state)g(v)n(alues)f(is)g(o)o(v)o
(er,)h(and)f(the)g(co)q(de)h(generator)g(arranges)g(to)f(generate)i(no)
300 715 y(co)q(de)d(at)e(all)g(to)h(mo)o(v)o(e)e(around)i(v)n(alues)f
(of)h(t)o(yp)q(e)g Fk(State#)o Fo(.)300 894 y Fl(9.3.4.)42
b(A)o(rr)n(ays)300 1024 y Fo(The)16 b(implem)o(en)o(tation)c(of)j(arra)
o(ys)h(is)f(straigh)o(tforw)o(ard.)21 b(The)16 b(only)f(complication)e
(lies)i(with)300 1074 y Fk(freezeArray)n Fo(,)f(whic)o(h)h(tak)o(es)g
(a)f(m)o(utable)f(arra)o(y)i(and)f(returns)j(a)d(frozen,)h(imm)o(utabl)
o(e)d(cop)o(y)m(.)300 1124 y(Often,)19 b(though,)g(w)o(e)f(w)o(an)o(t)g
(to)g(construct)i(an)e(arra)o(y)g(incremen)o(tally)m(,)f(and)h(then)g
(freeze)i(it,)300 1174 y(p)q(erforming)13 b(no)h(further)h(m)o(utation)
d(on)h(the)i(m)o(utable)e(arra)o(y)m(.)18 b(In)c(this)g(case)h(it)f
(seems)g(rather)300 1224 y(a)h(w)o(aste)g(to)g(cop)o(y)f(the)i(en)o
(tire)f(arra)o(y)m(,)f(only)g(to)h(discard)g(the)h(m)o(utable)d(v)o
(ersion)i(immedia)o(tely)300 1273 y(thereafter.)333 1339
y(The)f(righ)o(t)e(solution)g(is)h(to)g(do)g(a)g(go)q(o)q(d)f(enough)h
(job)g(in)f(the)i(compiler)e(to)h(sp)q(ot)g(this)g(sp)q(ecial)300
1388 y(case.)18 b(What)9 b(w)o(e)h(actually)f(do)h(at)f(the)i(momen)o
(t)c(is)j(to)f(pro)o(vide)h(a)g(highly)e(dangerous)i(op)q(eration)300
1438 y Fk(unsafeFreezeArray)l Fo(,)20 b(whose)f(t)o(yp)q(e)g(is)g(the)g
(same)f(as)h Fk(freezeArray)m Fo(,)h(but)f(whic)o(h)f(w)o(orks)300
1488 y(without)i(cop)o(ying)g(the)h(m)o(utable)e(arra)o(y)m(.)37
b(F)m(rankly)19 b(this)i(is)f(a)g(hac)o(k,)i(but)e(since)h(w)o(e)g
(only)300 1538 y(exp)q(ect)d(to)f(use)g(it)g(in)f(one)h(or)f(t)o(w)o(o)
h(critical)f(pieces)i(of)e(the)h(standard)g(library)m(,)f(w)o(e)h
(couldn't)300 1588 y(w)o(ork)e(up)h(enough)g(steam)f(to)h(do)f(the)i
(job)e(prop)q(erly)h(just)g(to)g(handle)f(these)i(few)f(o)q(ccasions.)
300 1638 y(W)m(e)d(do)h(not)g(pro)o(vide)g(general)g(access)h(to)f
Fk(unsafeFreezeArray)m Fo(.)300 1817 y Fp(10.)48 b(In)o(terlea)o(v)o
(ed)12 b(state)j(transformers)300 1947 y Fo(The)c(state-transformer)g
(comp)q(osition)d(com)o(binator)h(de\014ned)i(so)g(far,)f
Fk(thenST)o Fo(,)g(is)h(completely)300 1997 y(sequen)o(tial:)24
b(the)18 b(state)g(is)f(passed)h(from)d(the)i(\014rst)h(state)g
(transformer)f(on)f(to)h(the)h(second.)300 2047 y(But)f(sometimes)d
(that)j(is)f(not)g(what)g(is)g(w)o(an)o(ted.)26 b(Consider,)17
b(for)e(example,)h(the)g(op)q(eration)300 2097 y(of)k(reading)g(a)g
(\014le.)38 b(W)m(e)20 b(ma)o(y)e(not)i(w)o(an)o(t)g(to)g(sp)q(ecify)h
(the)g(precise)h(relativ)o(e)e(ordering)h(of)300 2146
y(the)14 b(individual)d(c)o(haracter-b)o(y-c)o(haracter)k(reads)f(from)
d(the)j(\014le)f(and)g(other)h(I/O)f(op)q(erations.)300
2196 y(Rather,)h(w)o(e)g(ma)o(y)e(w)o(an)o(t)h(the)i(\014le)e(to)h(b)q
(e)h(read)f(lazily)m(,)e(as)i(its)g(con)o(ten)o(ts)h(is)e(demanded.)333
2261 y(W)m(e)h(can)g(pro)o(vide)g(this)f(abilit)o(y)g(with)g(a)h(new)g
(com)o(binator,)e Fk(interleaveST)m Fo(:)344 2376 y Fk(interleaveST)19
b(::)i(ST)h(s)f(a)h(->)f(ST)h(s)f(a)344 2426 y(interleaveST)e(m)i(s)h
(=)g(\(r,s\))42 b(where)21 b(\(r,s'\))g(=)g(m)h(s)333
2541 y Fo(Unlik)o(e)11 b(ev)o(ery)h(other)f(state)h(transformer)f(so)g
(far,)g Fk(interleaveST)d Fo(actually)i(duplicates)i(the)300
2591 y(state!)19 b(The)14 b(\\plum)o(bing)d(diagram")h(for)h
Fk(\(interleaveST)19 b(s\))14 b Fo(is)f(lik)o(e)g(this:)p
eop
%%Page: 38 38
38 37 bop 300 275 a Fm(38)647 674 y @beginspecial @setspecial
%%BeginDocument: interleave-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-2 0 translate
0.000000 72.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 24 63 moveto 48 63 lineto stroke
stroke
newpath 40.000 61.000 moveto 48.000 63.000 lineto 40.000 65.000 lineto stroke
% Polyline
newpath 171 80 moveto 171 23 lineto 48 23 lineto 48 80 lineto closepath stroke
% Polyline
newpath 119 55 moveto 119 37 lineto 78 37 lineto 78 55 lineto closepath stroke
% Polyline
newpath 49 63 moveto 171 63 lineto 171 63 lineto stroke
stroke
% Polyline
newpath 59 63 moveto 59 52 lineto 78 52 lineto stroke
stroke
newpath 70.000 50.000 moveto 78.000 52.000 lineto 70.000 54.000 lineto stroke
% Polyline
newpath 119 52 moveto 139 52 lineto stroke
stroke
% Polyline
newpath 139 48 moveto 139 55 lineto stroke
stroke
% Polyline
newpath 120 42 moveto 171 42 lineto stroke
stroke
% Polyline
newpath 171 42 moveto 186 42 lineto 186 19 lineto stroke
stroke
newpath 184.000 27.000 moveto 186.000 19.000 lineto 188.000 27.000 lineto stroke
% Polyline
newpath 171 63 moveto 211 63 lineto stroke
stroke
newpath 203.000 61.000 moveto 211.000 63.000 lineto 203.000 65.000 lineto stroke
/Times-Roman findfont 12.000 scalefont setfont
177 79 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
2 76 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
173 14 moveto 
1 -1 scale
(Result) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 12.000 scalefont setfont
93 49 moveto 
1 -1 scale
(s) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 759 a Fo(The)12 b(seman)o(tics)f(of)g
Fk(interleaveST)d Fo(are)k(m)o(uc)o(h)e(less)i(easy)g(to)f(de\014ne)i
(and)e(reason)h(ab)q(out)f(than)300 809 y(the)18 b(seman)o(tics)f(of)f
(our)i(other)f(com)o(binators,)g(giv)o(en)f(that)i(our)f(in)o(tended)h
(implemen)o(tatio)o(n)300 859 y(remains)c(that)h(of)g(up)q(date)h(in)f
(place.)22 b(The)16 b(purp)q(ose)g(of)e(this)i(section)g(is)f(to)g(pro)
o(vide)g(sev)o(eral)300 909 y(motiv)n(ating)c(examples)i(for)g
Fk(interleaveST)n Fo(,)g(while)g(lea)o(ving)g(op)q(en)h(the)h(question)
f(of)f(ho)o(w)g(to)300 959 y(reason)i(ab)q(out)e(whether)j(it)d(is)h(b)
q(eing)g(used)h(\\safely".)j(In)13 b(this)i(con)o(text,)f(w)o(e)g
(regard)g(a)g(use)h(of)300 1008 y Fk(interleaveST)10
b Fo(as)i(\\safe")g(if)f(the)i(resulting)f(program)e(can)j(still)e(b)q
(e)h(ev)n(aluated)g(in)g(an)o(y)g(order)300 1058 y(that)i(resp)q(ects)i
(data)e(dep)q(endencies.)300 1193 y Fp(10.1.)48 b(Lazy)16
b(\014le)f(read)300 1294 y Fo(One)f(w)o(a)o(y)f(for)g
Fk(interleaveST)e Fo(to)j(b)q(e)g(safe)f(is)h(to)f(regard)h(it)f(as)h
(splitting)f(the)h(state)g(in)o(to)f(t)o(w)o(o)300 1344
y(disjoin)o(t)g(parts.)19 b(In)14 b(the)g(lazy-\014le-read)g(example,)f
(the)h(state)h(of)e(the)i(\014le)f(is)g(passed)h(in)o(to)e(one)300
1394 y(branc)o(h,)h(and)g(the)h(rest)g(of)f(the)g(state)h(of)f(the)g(w)
o(orld)g(is)g(passed)h(in)o(to)e(the)i(other.)k(Since)c(these)300
1443 y(states)e(are)f(disjoin)o(t,)e(an)h(arbitrary)h(in)o(terlea)o
(ving)e(of)h(op)q(erations)h(in)f(eac)o(h)h(branc)o(h)g(of)f(the)h
(fork)300 1493 y(is)i(legitimate.)333 1544 y(Here)h(is)f(an)g(implem)o
(en)o(tation)d(of)i(lazy)h(\014le)g(read,)g(using)f Fk(interleaveST)n
Fo(:)344 1644 y Fk(readFile)20 b(::)h(String)g(->)g(IO)g([Char])344
1694 y(readFile)f(filename)g(=)h(openFile)g(filename)42
b(`thenST`)20 b(\\f)h(->)779 1744 y(interleaveST)f(\(readCts)g(f\))344
1843 y(readCts)g(::)h(FileDescriptor)e(->)j(IO)f([Char])344
1893 y(readCts)f(f)i(=)f(readCh)g(f)217 b(`thenST`)21
b(\\c)g(->)605 1943 y(if)g(c)h(==)f(eofChar)605 1993
y(then)g(returnST)f([])605 2043 y(else)h(readCts)f(f)87
b(`thenST`)21 b(\\cs)g(->)714 2092 y(returnST)f(\(c:cs\)\))333
2193 y Fo(Notice)11 b(that)f(the)h(recursiv)o(e)h(call)d(to)h
Fk(readCts)f Fo(do)q(es)i(not)f(immediately)d(read)k(the)g(rest)g(of)f
(the)300 2242 y(\014le.)21 b(Because)c Fk(thenST)d Fo(and)h(the)g
(follo)o(wing)e Fk(returnST)g Fo(are)i(non-strict,)h(the)f(list)g
Fk(c:cs)f Fo(will)300 2292 y(b)q(e)f(returned)h(without)d(further)i
(ado.)k(If)12 b Fk(cs)g Fo(is)g(ev)o(er)h(ev)n(aluated,)f(the)g
(recursiv)o(e)i Fk(readCts)d Fo(will)300 2342 y(then)16
b(\(and)g(only)e(then\))j(b)q(e)f(p)q(erformed.)23 b(This)15
b(is)h(a)f(go)q(o)q(d)g(example)f(of)h(laziness)h(in)f(action.)300
2392 y(Ev)o(en)k(though)e(op)q(erations)i(are)f(b)q(eing)g(rigidly)f
(sequenced)j(|)e(in)f(this)h(case)h(the)g(reads)g(of)300
2442 y(successiv)o(e)e(c)o(haracters)g(of)d(the)i(\014le)f(|)g(the)g
(rate)h(at)f(whic)o(h)g(this)g(sequence)i(is)e(p)q(erformed)f(is)300
2492 y(driv)o(en)h(en)o(tirely)g(b)o(y)f(lazy)h(ev)n(aluation.)k(The)c
(single)g(call)f(to)h Fk(interleaveST)d Fo(simply)h(allo)o(ws)300
2541 y(these)j(op)q(erations)f(to)g(o)q(ccur)h(async)o(hronously)e
(with)h(resp)q(ect)i(to)d(other)i(I/O)f(op)q(erations)g(on)300
2591 y(the)f(main)e(\\trunk".)p eop
%%Page: 39 39
39 38 bop 1749 275 a Fm(39)300 416 y Fp(10.2.)48 b(Unique-supp)o(ly)13
b(trees)300 521 y Fo(In)h(the)h(lazy)f(\014le-read)g(example,)f(the)i
(use)g(of)e Fk(interleaveST)f Fo(could)i(b)q(e)g(regarded)i(as)e
(split-)300 570 y(ting)j(the)h(state)g(in)o(to)f(t)o(w)o(o)g(disjoin)o
(t)g(parts.)29 b(Ho)o(w)o(ev)o(er,)19 b(w)o(e)e(ha)o(v)o(e)h(found)f
(some)g(comp)q(elling)300 620 y(situations)g(in)g(whic)o(h)h(the)g
(fork)o(ed-o\013)f(thread)h(quite)g(delib)q(erately)f(shares)i(state)g
(with)e(the)300 670 y(\\trunk".)h(This)c(section)g(explores)h(the)f
(\014rst)h(suc)o(h)g(example.)333 722 y(A)j(common)d(problem)h(in)h
(functional)g(programs)f(is)i(to)f(distribute)h(a)g(supply)f(of)g
(unique)300 772 y(names)h(around)h(a)f(program.)31 b(F)m(or)19
b(example,)f(a)g(compiler)g(ma)o(y)f(w)o(an)o(t)h(to)h(giv)o(e)f(a)g
(unique)300 822 y(name)13 b(to)h(eac)o(h)h(iden)o(ti\014er)g(in)f(the)h
(program)e(b)q(eing)h(compiled.)k(In)d(an)f(imp)q(erativ)o(e)f(program)
300 872 y(one)g(migh)o(t)e(simply)h(call)g Fk(GenSym\(\))g
Fo(for)g(eac)o(h)i(iden)o(ti\014er,)f(to)g(allo)q(cate)g(a)g(unique)g
(name)f(from)300 922 y(a)h(global)f(supply)m(,)h(and)h(to)f
(side-e\013ect)j(the)e(supply)f(so)h(that)g(subsequen)o(t)h(calls)f(to)
f Fk(GenSym\(\))300 971 y Fo(will)f(deliv)o(er)i(a)g(new)g(v)n(alue.)
333 1024 y(In)j(a)f(functional)f(program)g(matters)h(are)h(not)f(so)g
(simple;)g(indeed,)h(sev)o(eral)g(pap)q(ers)h(ha)o(v)o(e)300
1073 y(discussed)c(the)f(problem)e(\(Augustsson,)j(Rittri)e(&)g(Synek)h
([1994];)e(Hanco)q(c)o(k)i([1987];)d(W)m(adler)300 1123
y([1992a]\).)15 b(The)e(rest)g(of)f(this)g(section)g(sho)o(ws)h(a)f
(rather)h(elegan)o(t)f(implem)o(en)o(tation)d(of)j(the)g(b)q(est)300
1173 y(approac)o(h,)j(that)h(of)f(Augustsson,)h(Rittri)e(&)i(Synek)g
([1994].)k(The)c(idea)f(is)h(to)f(implemen)o(t)e(a)300
1223 y(pair)c(of)g(abstract)h(data)f(t)o(yp)q(es,)i Fk(UniqueSupply)c
Fo(and)i Fk(Unique)o Fo(,)h(with)f(the)h(follo)o(wing)c(signature:)344
1316 y Fk(newUniqueSupply)62 b(::)21 b(IO)h(UniqueSupply)344
1366 y(splitUniqueSupp)o(ly)d(::)i(UniqueSupply)f(->)h(\(UniqueSupply,)
e(UniqueSupply\))344 1416 y(getUnique)194 b(::)21 b(UniqueSupply)f(->)h
(Unique)344 1515 y(instance)f(Eq)65 b(Unique)344 1565
y(instance)20 b(Ord)43 b(Unique)344 1615 y(instance)20
b(Text)h(Unique)300 1705 y Fo(The)11 b(three)g Fk(instance)e
Fo(declarations)h(sa)o(y)g(that)g(the)h Fk(Unique)e Fo(t)o(yp)q(e)i
(has)f(de\014ned)h(on)f(it)g(equalit)o(y)300 1755 y(and)k(ordering)h
(op)q(erations,)f(and)g(mappings)e(to)j(and)f(from)e(strings.)20
b(Naturally)m(,)13 b(the)h(idea)g(is)300 1805 y(that)e(the)h(t)o(w)o(o)
e Fk(UniqueSupply)n Fo(s)h(returned)i(b)o(y)e Fk(splitUniqueSupply)c
Fo(are)13 b(forev)o(er)g(separate,)300 1855 y(and)j(can)g(nev)o(er)g
(deliv)o(er)g(the)h(same)e Fk(Unique)n Fo(.)24 b(The)17
b(implem)o(en)o(tation)c(is)j(giv)o(en)f(some)g(extra)300
1905 y(freedom)e(b)o(y)g(making)e Fk(newUniqueSupply)f
Fo(in)o(to)j(an)g(I/O)h(op)q(eration.)k(Di\013eren)o(t)c(runs)g(of)f
(the)300 1954 y(same)e(program)g(are)h(therefore)i(p)q(ermitted)e(to)g
(allo)q(cate)g(uniques)g(in)g(a)g(di\013eren)o(t)h(order)g(|)f(all)300
2004 y(that)i(matters)f(ab)q(out)h Fk(Unique)o Fo(s)g(is)g(that)g(they)
g(are)h(distinct)f(from)e(eac)o(h)i(other.)333 2056 y(One)e(p)q
(ossible)g(implemen)o(tatio)o(n)d(w)o(ould)h(represen)o(t)k(a)d
Fk(UniqueSupply)e Fo(and)i(a)g Fk(Unique)f Fo(b)o(y)i(a)300
2106 y(\(p)q(oten)o(tially)h(v)o(ery)i(long\))e(bit-string.)19
b(The)c Fk(splitUnique)d Fo(function)i(w)o(ould)g(split)f(a)h(supply)
300 2156 y(in)o(to)d(t)o(w)o(o)h(b)o(y)g(app)q(ending)g(a)g(zero)h(and)
f(a)g(one)g(to)g(it)g(resp)q(ectiv)o(ely)m(.)18 b(The)13
b(trouble)f(is,)g(of)g(course,)300 2206 y(that)i(the)g(name)f(supply)h
(is)g(used)g(v)o(ery)h(sparsely)m(.)333 2258 y(The)10
b(idea)f(suggested)i(b)o(y)e(Augustsson,)h(Rittri)f(&)g(Synek)h([1994])
d(is)i(to)g(represen)o(t)j(a)d Fk(UniqueSupply)300 2308
y Fo(b)o(y)h(an)g(in\014nite)g(tree,)i(whic)o(h)e(has)g(a)g
Fk(Unique)f Fo(at)h(ev)o(ery)h(no)q(de,)g(and)g(t)o(w)o(o)e(c)o(hild)h
Fk(UniqueSupply)m Fo(s:)344 2401 y Fk(data)21 b(UniqueSupply)e(=)i(US)h
(Unique)e(UniqueSupply)g(UniqueSupply)300 2492 y Fo(No)o(w)12
b(the)g(implemen)o(tation)d(of)i Fk(splitUniqueSupply)d
Fo(and)k Fk(getUnique)e Fo(are)i(trivial,)f(and)h(all)300
2541 y(the)h(excitemen)o(t)f(is)g(in)g Fk(newUniqueSupply)l
Fo(.)18 b(Here)13 b(is)f(its)g(de\014nition,)g(assuming)f(for)g(the)i
(sak)o(e)300 2591 y(of)g(simplicit)o(y)f(that)i(a)f Fk(Unique)g
Fo(is)g(represen)o(ted)k(b)o(y)d(an)f Fk(Int)p Fo(:)p
eop
%%Page: 40 40
40 39 bop 300 275 a Fm(40)344 416 y Fk(type)21 b(Unique)f(=)i(Int)344
516 y(newUniqueSupply)c(::)k(IO)f(UniqueSupply)344 565
y(newUniqueSupply)387 615 y(=)h(newVar)e(0)218 b(`thenST`)20
b(\\)i(uvar)f(->)431 665 y(let)474 715 y(next)g(::)h(IO)f(Unique)474
765 y(next)g(=)h(interleaveST)d(\()692 814 y(readVar)i(uvar)217
b(`thenST`)20 b(\\)h(u)h(->)692 864 y(writeVar)e(uvar)h(\(u+1\))65
b(`thenST_`)692 914 y(returnStrictlyST)19 b(u)649 964
y(\))474 1064 y(supply)i(::)g(IO)h(UniqueSupply)474 1113
y(supply)f(=)g(interleaveST)f(\()714 1163 y(next)195
b(`thenST`)21 b(\\)g(u)h(->)714 1213 y(supply)151 b(`thenST`)21
b(\\)g(s1)g(->)714 1263 y(supply)151 b(`thenST`)21 b(\\)g(s2)g(->)714
1313 y(returnST)f(\(US)h(u)h(s1)f(s2\))692 1362 y(\))431
1412 y(in)431 1462 y(supply)300 1545 y Fo(The)10 b(t)o(w)o(o)g(uses)h
(of)e Fk(interleaveST)f Fo(sp)q(ecify)i(that)g(the)h(relativ)o(e)f
(ordering)g(of)f(the)i(state)g(c)o(hanges)300 1595 y(in)j
Fk(next)o Fo(,)g(and)g(in)g(the)h(t)o(w)o(o)f(uses)h(of)f
Fk(supply)o Fo(,)g(is)g(delib)q(erately)g(left)g(to)g(the)h(implemen)o
(tation.)300 1645 y(The)21 b(only)e(side)i(e\013ects)h(are)f(in)e
Fk(next)p Fo(,)i(whic)o(h)f(allo)q(cates)g(a)g(new)h
Fk(Unique)o Fo(,)g(so)f(what)g(this)300 1694 y(amoun)o(ts)12
b(to)h(is)g(that)h(the)g(uniques)g(are)f(allo)q(cated)g(in)g(the)h
(order)g(in)f(whic)o(h)g(the)h Fk(Unique)o Fo(s)g(are)300
1744 y(ev)n(aluated,)f(whic)o(h)h(is)g(just)g(what)g(w)o(e)g(w)o(an)o
(ted!)333 1794 y(If)19 b(the)h(program)d(w)o(as)i(recompiled)f(with,)i
(sa)o(y)m(,)f(a)g(di\013eren)o(t)h(analysis)e(tec)o(hnique)i(whic)o(h)
300 1844 y(mean)o(t)15 b(that)h(the)g(ev)n(aluation)f(order)h(c)o
(hanged,)h(then)f(indeed)h(di\013eren)o(t)f(uniques)h(w)o(ould)e(b)q(e)
300 1894 y(generated.)37 b(But)20 b(since)h(the)f(whole)g
Fk(mkUniqueSupply)c Fo(op)q(eration)k(is)g(t)o(yp)q(ed)g(as)g(an)f(I/O)
300 1944 y(op)q(eration)c Fl(ther)n(e)g(is)h(no)g(r)n(e)n(ason)g(to)g
(supp)n(ose)h(that)f(the)g(same)g(uniques)g(wil)r(l)f(b)n(e)h(gener)n
(ate)n(d)p Fo(,)f(a)300 1993 y(nice)f(touc)o(h.)333 2043
y(There)e(is)e(one)g(imp)q(ortan)o(t)f(subtlet)o(y)i(in)e(the)i(co)q
(de,)h(namely)c(the)j(use)g(of)f Fk(returnStrictlyST)300
2093 y Fo(in)18 b(the)i(de\014nition)e(of)g Fk(next)o
Fo(.)33 b(The)19 b(trap)g(\(in)o(to)f(whic)o(h)h(w)o(e)g(fell)f
(headlong\))g(is)g(this:)28 b Fl(sinc)n(e)300 2143 y
Fk(interleaveST)14 b Fl(disc)n(ar)n(ds)i(the)h(\014nal)g(state,)f(and)h
(the)g(r)n(esult)e(of)i(the)f Fk(writeVar)f Fl(is)h(also)h(dis-)300
2193 y(c)n(ar)n(de)n(d,)f(if)g Fk(returnST)e Fl(is)i(use)n(d)g(inste)n
(ad)h(ther)n(e)e(is)h(nothing)h(to)f(for)n(c)n(e)g(the)g
Fk(writeVar)e Fl(to)i(take)300 2242 y(plac)n(e)i(at)g(al)r(l)t
Fo(!)28 b(Indeed,)18 b(if)f(w)o(e)g(used)h(the)g(standard)g
Fk(returnST)n Fo(,)f(no)g Fk(writeVar)o Fo(s)g(w)o(ould)g(b)q(e)300
2292 y(p)q(erformed,)f(and)g(eac)o(h)g Fk(readVar)f Fo(w)o(ould)g(see)i
(the)g(same,)e(undisturb)q(ed)j(v)n(alue.)24 b(Of)16
b(course,)300 2342 y(what)11 b(w)o(e)g(w)o(an)o(t)f(to)h(happ)q(en)g
(is)g(that)f(once)i(the)f(thread)h(in)e Fk(next)o Fo('s)h(righ)o
(t-hand-side)f(is)h(started,)300 2392 y(then)i(it)g(m)o(ust)e(run)i(to)
g(completion.)j(That)c(is)h(exactly)f(what)h Fk(returnStrictlyST)c
Fo(ac)o(hiev)o(es.)300 2442 y(The)18 b(di\013erence)h(b)q(et)o(w)o(een)
f Fk(returnST)e Fo(and)h Fk(returnStrictlyST)d Fo(is)j(simply)e(that)i
(the)h(lat-)300 2492 y(ter)g(is)f(strict)h(in)e(the)i(state.)29
b(Op)q(erationally)m(,)16 b(it)g(will)g(not)h(deliv)o(er)g(a)g(result)h
(at)f(all)f(un)o(til)g(it)300 2541 y(has)f(ev)n(aluated)g(its)g(input)g
(state.)22 b(W)m(e)14 b(can)h(picture)h(it)f(lik)o(e)f(this)h
(\(compare)f(the)i(picture)g(for)300 2591 y Fk(returnST)c
Fo(in)i(Section)g(2.1\):)p eop
%%Page: 41 41
41 40 bop 1749 275 a Fm(41)701 587 y @beginspecial @setspecial
%%BeginDocument: return-strictly-st.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

 /DrawEllipse {
	/endangle exch def
	/startangle exch def
	/yrad exch def
	/xrad exch def
	/y exch def
	/x exch def
	/savematrix mtrx currentmatrix def
	x y translate xrad yrad scale 0 0 1 startangle endangle arc
	savematrix setmatrix
	} def newpath 0 0 0 0 0 1 DrawEllipse stroke

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
-5 2 translate
0.000000 51.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Ellipse
newpath 101 22 5 5 0 360 DrawEllipse stroke
% Polyline
newpath 142 44 moveto 182 44 lineto stroke
stroke
newpath 174.000 42.000 moveto 182.000 44.000 lineto 174.000 46.000 lineto stroke
% Polyline
newpath 142 54 moveto 142 14 lineto 62 14 lineto 62 54 lineto closepath stroke
% Polyline
newpath 22 44 moveto 62 44 lineto stroke
stroke
newpath 54.000 42.000 moveto 62.000 44.000 lineto 54.000 46.000 lineto stroke
% Polyline
newpath 41 4 moveto 41 22 lineto 62 22 lineto stroke
stroke
newpath 54.000 20.000 moveto 62.000 22.000 lineto 54.000 24.000 lineto stroke
% Polyline
newpath 142 22 moveto 162 22 lineto 162 2 lineto stroke
stroke
newpath 160.000 10.000 moveto 162.000 2.000 lineto 164.000 10.000 lineto stroke
% Polyline
newpath 62 44 moveto 142 44 lineto stroke
stroke
% Polyline
newpath 97 25 moveto 105 19 lineto stroke
stroke
% Polyline
newpath 99 18 moveto 104 26 lineto stroke
stroke
% Polyline
newpath 62 22 moveto 96 22 lineto stroke
stroke
newpath 88.000 20.000 moveto 96.000 22.000 lineto 88.000 24.000 lineto stroke
% Polyline
newpath 107 22 moveto 142 22 lineto stroke
stroke
% Polyline
newpath 101 44 moveto 101 28 lineto stroke
stroke
newpath 99.000 36.000 moveto 101.000 28.000 lineto 103.000 36.000 lineto stroke
/Times-Roman findfont 12.000 scalefont setfont
151 58 moveto 
1 -1 scale
(State out) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
5 57 moveto 
1 -1 scale
(State in) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 676 a Fo(In)14 b(this)g(picture,)g(the)h(result)f(is)g
(held)g(up)g(b)o(y)g(the)g(\\v)n(alv)o(e")f(un)o(til)g(the)h(state)h
(is)e(a)o(v)n(ailable.)333 728 y(Despite)18 b(this)f(subtlet)o(y)m(,)g
(this)f(co)q(de)i(is)f(a)f(distinct)h(impro)o(v)o(emen)o(t)d(on)j(that)
g(giv)o(en)f(in)g(Au-)300 778 y(gustsson,)c(Rittri)e(&)h(Synek)h
([1994],)d(whic)o(h)i(has)g(commen)o(ts)e(suc)o(h)j(as)f(\\The)g
Fl(gensym)h Fo(function)300 828 y(m)o(ust)k(b)q(e)h(co)q(ded)h(in)f
(assem)o(bler")f(and)h(\\A)g(to)q(o-clev)o(er)g(compiler)f(migh)o(t)e
(recognise)k(the)g(re-)300 878 y(p)q(eated)g(calls)e(to)g
Fl(gen)i(x)e Fo(and)h([generate])g(co)q(de)g(whic)o(h)f(creates)i
(sharing...if)d(suc)o(h)i(compiler)300 927 y(optimisations)d(cannot)k
(b)q(e)f(turned)h(o\013)f(or)g(fo)q(oled,)f(one)h(m)o(ust)f(generate)i
(co)q(de)g(for)e Fl(gen)i Fo([as)300 977 y(w)o(ell)13
b(as)h Fl(gensym)p Fo(])g(b)o(y)g(hand.".)300 1117 y
Fp(10.3.)48 b(Lazy)16 b(arra)o(ys)300 1220 y Fo(A)g(second)g(example)f
(of)g(the)h(use)g(of)f Fk(interleaveST)f Fo(where)i(the)g(fork)o
(ed-o\013)g(thread)g(shares)300 1270 y(state)e(with)g(the)g(trunk)g
(concerns)h(so-called)e Fl(lazy)h(arr)n(ays)p Fo(.)k(Hask)o(ell)13
b(arra)o(ys)g(are)h(strict)h(in)e(the)300 1320 y(list)i(of)g(index-v)n
(alue)f(pairs,)h(and)g(in)g(the)h(indices)g(in)f(this)g(list)g
(\(though)g(not)g(in)g(the)h(v)n(alues\).)300 1370 y(An)d(alternativ)o
(e,)g(and)g(more)f(p)q(o)o(w)o(erful,)h(arra)o(y)f(constructor)j(w)o
(ould)e(ha)o(v)o(e)g(the)g(same)g(t)o(yp)q(e)g(as)300
1420 y Fk(array)o Fo(,)g(but)h(b)q(e)h(non-strict)f(in)g(the)g(index-v)
n(alue)f(pairs:)344 1511 y Fk(lazyArray)20 b(::)h(Ix)g(i)h(=>)f
(\(i,i\))g(->)g([\(i,v\)])g(->)g(Array)g(i)g(v)300 1601
y Fo(What)15 b(do)q(es)h(it)f(mean)f(for)h Fk(lazyArray)e
Fo(to)i(b)q(e)h(non-strict)g(in)e(the)i(index-v)n(alue)f(pairs?)22
b(Pre-)300 1651 y(sumably)m(,)14 b(it)i(m)o(ust)g(return)h(an)g(arra)o
(y)f(imm)o(ediately)m(,)d(and)k(searc)o(h)g(the)g(list)f(only)g(when)h
(the)300 1700 y(arra)o(y)g(is)g(indexed.)29 b(Since)18
b(c)o(hec)o(king)g(for)f(duplicate)g(indices)h(w)o(ould)e(en)o(tail)h
(searc)o(hing)h(the)300 1750 y(whole)d(list,)f Fk(lazyArray)f
Fo(simply)g(returns)k(the)e(v)n(alue)g(in)f(the)i Fl(\014rst)e
Fo(index-v)n(alue)h(pair)f(in)h(the)300 1800 y(list)i(with)h(the)g(sp)q
(eci\014ed)h(index.)29 b(In)18 b(short,)h(the)f(seman)o(tics)f(of)g
(indexing)g(a)h(lazy)f(arra)o(y)g(is)300 1850 y(precisely)h(that)g(of)e
(searc)o(hing)i(an)f(asso)q(ciation)g(list)g(|)g(except)i(that,)f(of)e
(course,)j(w)o(e)f(hop)q(e)300 1900 y(that)12 b(it)f(will)g(b)q(e)h
(more)f(e\016cien)o(t.)18 b(Figure)12 b(8)f(giv)o(es)h(a)g(\(rather)g
(amazing\))e(program)g(whic)o(h)i(uses)300 1949 y(lazy)h(arra)o(ys)h
(to)g(compute)g(prime)e(n)o(um)o(b)q(ers)i(using)f(the)i(siev)o(e)f(of)
g(Eratosthenes.)333 2001 y(The)e(basis)f(of)f(the)i(algorithm)c(is)j
(an)g(arra)o(y)g Fk(minFactor)e Fo(whic)o(h,)i(for)g(eac)o(h)g(index,)g
(stores)i(the)300 2051 y(minim)n(um)6 b(factor)11 b(\(>1\))f(of)g(that)
h(index.)17 b(A)10 b(n)o(um)o(b)q(er)g(is)h(prime,)e(therefore,)j(if)e
(the)h(v)n(alue)f(stored)300 2101 y(at)16 b(its)g(index)f(in)h
Fk(minFactor)e Fo(is)i(equal)f(to)h(the)g(n)o(um)o(b)q(er)g(itself.)23
b(The)17 b(function)e Fk(multiples)300 2151 y Fo(generates)j(one)f(or)g
(more)f(m)o(ultiples)f(of)h(its)g(argumen)o(t)g(\(eac)o(h)h(paired)g
(with)g(its)f(argumen)o(t\))300 2201 y(b)o(y)d(\014rst)g(returning)h
(its)f(argumen)o(t,)e(and)i(then,)g(if)f(the)i(argumen)o(t)e(is)g
(prime,)g(returning)h(more)300 2250 y(m)o(ultiples.)27
b(Note)18 b(that)g Fk(multiple)e Fo(alw)o(a)o(ys)g(returns)k(its)d
(argumen)o(t)g(as)g(a)h(m)o(ultiple)d Fl(b)n(efor)n(e)300
2300 y Fo(c)o(hec)o(king)e(its)g(primalit)o(y)e(so)i(guaran)o(teeing)g
(that)g Fk(minFactor)e Fo(will)g(ha)o(v)o(e)i(b)q(een)i(initialised)c
(\(if)300 2350 y(not)h(b)o(y)f(this)h(call)f(of)g Fk(multiples)n
Fo(,)g(then)i(b)o(y)e(a)g(previous\).)18 b(This)12 b(prev)o(en)o(ts)h
(the)f(program)e(from)300 2400 y(en)o(tering)k(a)g(blac)o(k)f(hole)h
(\(deadlo)q(c)o(k\).)333 2452 y(Ho)o(w)g(can)g(w)o(e)g(implemen)o(t)d
Fk(lazyArray)n Fo(?)18 b(The)d(e\013ect)g(w)o(e)f(w)o(an)o(t)g(to)f(ac)
o(hiev)o(e)i(is:)300 2541 y Fn(\017)45 b Fk(lazyArray)11
b Fo(allo)q(cates)i(and)g(initialises)f(a)g(suitable)h(arra)o(y)m(,)f
(and)h(returns)h(it)f(immedia)o(tely)366 2591 y(without)h(lo)q(oking)e
(at)i(the)g(index-v)n(alue)g(pairs.)p eop
%%Page: 42 42
42 41 bop 300 275 a Fm(42)339 442 y Fi(primesUpTo)16
b(::)j(Int)f(->)h([Int])339 488 y(primesUpTo)d(n)j(=)g(filter)f
(isPrime)f([2..n])378 533 y(where)418 625 y(minFactor)f(::)j(Array)e
(Int)i(Int)418 670 y(minFactor)d(=)39 b(lazyArray)16
b(\(2,n\))h(\(concat)g(\(map)h(multiples)f([2..n]\)\))418
762 y(isPrime)g(p)i(::)g(Int)f(->)h(Bool)418 807 y(isPrime)e(p)i(=)39
b(minFactor)o(!p)16 b(==)j(p)418 899 y(multiples)55 b(::)19
b(Int)f(->)h([\(Int,Int\))o(])418 944 y(multiples)d(k)j(=)39
b(\(k,k\))18 b(:)h(if)g(isPrime)e(k)986 990 y(then)i([\(m,k\))e(|)i(m)g
(<-)g([2*k,3*k..)o(n]])986 1036 y(else)g([])300 1191
y Fr(Figur)n(e)14 b(8.)i Fw(Computing)9 b(primes)h(using)g(the)h(Siev)o
(e)f(of)i(Eratosthene)o(s,)d(using)h(a)i(lazy)e(arra)o(y)300
1324 y Fn(\017)45 b Fo(When)12 b(this)f(arra)o(y)g(is)f(indexed,)i
(with)f(the)g(standard)h Fk(\(!\))e Fo(op)q(erator,)i(the)g(index-v)n
(alue)e(list)366 1374 y(is)16 b(searc)o(hed)h(for)e(the)h(sp)q
(eci\014ed)h(index.)22 b(As)16 b(a)f(side)h(e\013ect)h(of)e(this)g
(searc)o(h,)h(the)g(arra)o(y)f(is)366 1424 y(\014lled)10
b(in)f(with)h(all)f(the)h(index-v)n(alue)f(pairs)h(encoun)o(tered,)i
(up)e(to)g(and)g(including)f(the)h(index)366 1474 y(sough)o(t.)18
b(When)13 b(this)f(index)h(is)f(found)h(the)g(searc)o(h)h(terminates,)e
(and)g(the)h(corresp)q(onding)366 1523 y(v)n(alue)h(is)f(returned.)300
1610 y Fn(\017)45 b Fo(If)17 b(the)h(arra)o(y)e(is)h(subsequen)o(tly)h
(indexed)f(at)g(the)h(same)e(index,)h(the)h(v)n(alue)e(is)h(returned)
366 1660 y(immediately)m(.)333 1746 y(This)11 b(b)q(eha)o(viour)g(is)g
(not)g(easy)g(to)g(ac)o(hiev)o(e)h(in)e(Hask)o(ell!)17
b(It)11 b(relies)h(inheren)o(tly)f(on)g(imp)q(erativ)o(e)300
1796 y(actions.)35 b(The)19 b(fact)h(that)f(the)h(results)h(are)f
(indep)q(enden)o(t)g(of)f(the)h(order)g(in)f(whic)o(h)h(arra)o(y)300
1846 y(elemen)o(ts)g(are)h(accessed)i(is)d(a)h(deep)g(prop)q(ert)o(y)h
(of)d(the)j(pro)q(cess.)39 b(Nev)o(ertheless,)24 b(w)o(e)d(can)300
1896 y(express)16 b(it)d(all)g(with)g(the)i(help)f(of)f
Fk(interleaveST)n Fo(;)g(the)i(co)q(de)f(is)g(giv)o(en)f(in)h(Figure)g
(9.)333 1946 y(Referring)g(\014rst)h(to)e(Figure)h(9,)g
Fk(lazyArray)e Fo(allo)q(cates)h(the)i(follo)o(wing)c(m)o(utable)h(v)n
(alues:)300 2032 y Fn(\017)45 b Fo(A)14 b(v)n(ariable,)f
Fk(feederVar)n Fo(,)g(to)h(hold)f(the)i(\\feeder-list")f(of)f(index-v)n
(alue)g(pairs.)300 2119 y Fn(\017)45 b Fo(A)14 b(m)o(utable)e(arra)o(y)
m(,)g Fk(valArr)o Fo(,)h(in)g(whic)o(h)g(the)h(result)h(of)e(the)h
(whole)f(call)g(to)g Fk(lazyArray)e Fo(is)366 2169 y(accum)o(ulated.)
300 2256 y Fn(\017)45 b Fo(A)11 b(m)o(utable)e(arra)o(y)i(of)f(b)q(o)q
(oleans,)g Fk(doneArr)o Fo(,)h(whose)g(purp)q(ose)h(is)e(to)h(record)h
(when)f(the)g(cor-)366 2306 y(resp)q(onding)k(slot)e(of)g
Fk(valArr)g Fo(has)h(b)q(een)h(assigned)f(with)f(its)h(\014nal)f(v)n
(alue.)18 b(Eac)o(h)c(elemen)o(t)366 2356 y(of)g(the)g
Fk(doneArr)f Fo(is)g(initialise)g(to)g Fk(False)o Fo(.)333
2442 y(Next,)19 b Fk(lazyArray)d Fo(initialises)h(eac)o(h)h(slot)g(in)f
Fk(valArr)g Fo(b)o(y)g(calling)g Fk(initVal)n Fo(,)i(de\014ned)g(in)300
2492 y(the)d Fk(let)o Fo(.)21 b(Finally)m(,)13 b Fk(lazyArray)g
Fo(freezes)k(the)e(arra)o(y)g(and)g(returns)h(the)g(frozen)f(v)n(alue.)
21 b(Here,)300 2541 y(w)o(e)f Fl(must)g Fo(use)h Fk(unsafeFreezeArray)
16 b Fo(b)q(ecause)22 b(the)e(whole)g(idea)g(is)g(that)g
Fk(valArr)e Fo(is)i(go-)300 2591 y(ing)c(to)h(b)q(e)g(m)o(utated)f(as)g
(a)h(side)g(e\013ect)h(of)e(the)i(ev)n(aluation)d(of)h(its)h(elemen)o
(ts.)26 b(\(Recall)16 b(that)p eop
%%Page: 43 43
43 42 bop 1749 275 a Fm(43)300 568 y Fi(lazyArray)16
b(::)j(Ix)g(i)g(=>)g(\(i,i\))f(->)g([\(i,val\)])f(->)h(Array)g(i)h(val)
300 614 y(lazyArray)d(bounds)h(feederList)339 659 y(=)i(runST)f(\()418
705 y(newVar)f(feederList)330 b(`thenST`)16 b(\\)j(feederVar)d(->)418
751 y(newArray)g(bounds)i(False)253 b(`thenST`)16 b(\\)j(doneArr)e(->)
418 796 y(newArray)f(bounds)i(initial)213 b(`thenST`)16
b(\\)j(valArr)f(->)418 888 y(let)457 933 y(initVal)f(k)i(=)g
(interleave)o(ST)d(\()751 979 y(readVar)h(feederVar)193
b(`thenST`)16 b(\\)j(ivs)g(->)751 1024 y(writeVar)e(feederVar)f(badVal)
37 b(`thenST_`)751 1070 y(fillUntil)16 b(k)j(ivs)235
b(`thenST`)16 b(\\)j(ivs')g(->)751 1116 y(writeVar)e(feederVar)f(ivs')
77 b(`thenST_`)751 1161 y(readArray)16 b(valArr)i(ix)967
1207 y(\))176 b(`thenST`)17 b(\\)i(delayedVa)o(l)e(->)692
1253 y(writeArray)f(valArr)h(k)j(delayedV)o(al)457 1344
y(fillUntil)c(k)j([])g(=)g(noValue)e(k)457 1390 y(fillUntil)f(k)j
(\(\(i,v\))f(:)h(ivs\))496 1435 y(=)g(readArray)e(doneArr)f(i)235
b(`thenST`)17 b(\\)i(done)f(->)535 1481 y(\(if)h(not)f(done)g(then)594
1527 y(writeArray)e(doneArr)h(i)i(True)57 b(`thenST_`)594
1572 y(writeArray)16 b(valArr)h(i)i(v)555 1618 y(else)594
1664 y(returnST)e(\(\))i(\))293 b(`thenST_`)535 1755
y(if)19 b(i)g(==)g(k)h(then)575 1801 y(returnST)c(ivs)535
1846 y(else)575 1892 y(fillUntil)g(k)j(ivs)418 1938 y(in)418
2029 y(mapST)e(initVal)g(\(range)h(bounds\))36 b(`thenST_`)418
2075 y(unsafeFre)o(ez)o(eAr)o(r)17 b(valArr)g(\))339
2166 y(where)378 2212 y(initial)57 b(=)19 b(error)f("lazyArr)o(ay:)e
(uninitial)o(ise)o(d)g(element")378 2257 y(badVal)77
b(=)19 b(error)f("lazyArr)o(ay:)e(an)j(index)e(depends)g(on)i(a)g
(later)f(value")378 2303 y(noValue)f(k)j(=)f(error)f(\("lazyAr)o(ray)o
(:)e(no)j(value)f(for:)g(")h(++)g(show)f(\(index)g(bounds)f(k\)\))300
2459 y Fr(Figur)n(e)d(9.)i Fw(An)c(implemen)o(t)o(atio)o(n)d(of)i(lazy)
f(arra)o(ys)p eop
%%Page: 44 44
44 43 bop 300 275 a Fm(44)517 1166 y @beginspecial @setspecial
%%BeginDocument: lazy-array.ps
/$F2psDict 32 dict def 
$F2psDict begin
	$F2psDict /mtrx matrix put

	end
	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def
	/$F2psEnd {$F2psEnteredState restore end} def
	%%EndProlog

$F2psBegin
1 setlinecap 1 setlinejoin
0 22 translate
0.000000 180.000000 translate 0.900 -0.900 scale
1.000 setlinewidth
% Polyline
newpath 6 24 moveto -1 24 -1 217 7 arcto 4 {pop} repeat -1 224 282 224 7 arcto 4 {pop} repeat 289 224 289 31 7 arcto 4 {pop} repeat 289 24 6 24 7 arcto 4 {pop} repeat closepath stroke
% Polyline
newpath 279 59 moveto 279 39 lineto 79 39 lineto 79 59 lineto closepath stroke
% Polyline
newpath 279 99 moveto 279 79 lineto 79 79 lineto 79 99 lineto closepath stroke
% Polyline
newpath 119 39 moveto 119 59 lineto stroke
stroke
% Polyline
newpath 159 39 moveto 159 59 lineto stroke
stroke
% Polyline
newpath 199 39 moveto 199 59 lineto stroke
stroke
% Polyline
newpath 239 39 moveto 239 59 lineto stroke
stroke
% Polyline
newpath 239 79 moveto 239 99 lineto stroke
stroke
% Polyline
newpath 159 79 moveto 159 99 lineto stroke
stroke
% Polyline
newpath 119 79 moveto 119 99 lineto stroke
stroke
% Polyline
newpath 199 79 moveto 199 99 lineto stroke
stroke
% Polyline
newpath 99 89 moveto 99 114 lineto stroke
stroke
newpath 101.000 106.000 moveto 99.000 114.000 lineto 97.000 106.000 lineto stroke
% Polyline
newpath 179 89 moveto 179 114 lineto stroke
stroke
newpath 181.000 106.000 moveto 179.000 114.000 lineto 177.000 106.000 lineto stroke
% Polyline
newpath 259 89 moveto 259 114 lineto stroke
stroke
newpath 261.000 106.000 moveto 259.000 114.000 lineto 257.000 106.000 lineto stroke
% Polyline
newpath 99 199 moveto 99 179 lineto 59 179 lineto 59 199 lineto closepath stroke
% Polyline
newpath 279 199 moveto 279 179 lineto 219 179 lineto 219 199 lineto closepath stroke
% Polyline
newpath 199 199 moveto 199 179 lineto 139 179 lineto 139 199 lineto closepath stroke
% Polyline
newpath 179 179 moveto 179 199 lineto stroke
stroke
% Polyline
newpath 259 179 moveto 259 199 lineto stroke
stroke
% Polyline
newpath 189 189 moveto 214 189 lineto stroke
stroke
newpath 206.000 187.000 moveto 214.000 189.000 lineto 206.000 191.000 lineto stroke
% Polyline
newpath 79 189 moveto 134 189 lineto stroke
stroke
newpath 126.000 187.000 moveto 134.000 189.000 lineto 126.000 191.000 lineto stroke
% Polyline
newpath 259 199 moveto 279 179 lineto stroke
stroke
% Polyline
newpath 111 134 moveto 104 134 104 147 7 arcto 4 {pop} repeat 104 154 172 154 7 arcto 4 {pop} repeat 179 154 179 141 7 arcto 4 {pop} repeat 179 134 111 134 7 arcto 4 {pop} repeat closepath stroke
% Polyline
newpath 206 134 moveto 199 134 199 147 7 arcto 4 {pop} repeat 199 154 267 154 7 arcto 4 {pop} repeat 274 154 274 141 7 arcto 4 {pop} repeat 274 134 206 134 7 arcto 4 {pop} repeat closepath stroke
% Polyline
newpath 139 94 moveto 139 129 lineto stroke
stroke
newpath 141.000 121.000 moveto 139.000 129.000 lineto 137.000 121.000 lineto stroke
% Polyline
newpath 219 94 moveto 219 129 lineto stroke
stroke
newpath 221.000 121.000 moveto 219.000 129.000 lineto 217.000 121.000 lineto stroke
/Courier findfont 12.000 scalefont setfont
9 54 moveto 
1 -1 scale
(done_arr) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 12.000 scalefont setfont
9 94 moveto 
1 -1 scale
(val_arr) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
89 74 moveto 
1 -1 scale
(1) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
134 74 moveto 
1 -1 scale
(2) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
174 74 moveto 
1 -1 scale
(3) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
214 74 moveto 
1 -1 scale
(4) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
254 74 moveto 
1 -1 scale
(5) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
84 54 moveto 
1 -1 scale
(True) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
124 54 moveto 
1 -1 scale
(False) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
164 54 moveto 
1 -1 scale
(True) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
204 54 moveto 
1 -1 scale
(False) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
244 54 moveto 
1 -1 scale
(True) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
94 129 moveto 
1 -1 scale
(6) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
254 129 moveto 
1 -1 scale
(18) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
174 129 moveto 
1 -1 scale
(10) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
224 194 moveto 
1 -1 scale
(\(4,7\)) gsave  0.000 rotate show grestore 1 -1 scale
/Times-Roman findfont 12.000 scalefont setfont
144 194 moveto 
1 -1 scale
(\(2,10\)) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 12.000 scalefont setfont
109 149 moveto 
1 -1 scale
(initVal 2) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 12.000 scalefont setfont
204 149 moveto 
1 -1 scale
(initVal 4) gsave  0.000 rotate show grestore 1 -1 scale
/Courier findfont 12.000 scalefont setfont
49 174 moveto 
1 -1 scale
(f_list_var) gsave  0.000 rotate show grestore 1 -1 scale
$F2psEnd
%%EndDocument
 @endspecial 300 1322 a Fr(Figur)n(e)14 b(10.)i Fw(Lazy)11
b(arra)o(y)f(construction)300 1469 y Fk(unsafeFreezeArray)j
Fo(con)o(v)o(erts)18 b(a)f(m)o(utable)f(arra)o(y)g(to)h(a)g(v)n(alue)f
(of)h(the)g(imm)o(utabl)o(e-arra)o(y)300 1519 y(t)o(yp)q(e,)c(without)f
(cop)o(ying)g(the)h(arra)o(y;)f(further)h(m)o(utations)e(of)h(the)h(m)o
(utable)e(arra)o(y)h(will)f(there-)300 1569 y(fore)j(also)f(a\013ect)i
(the)g(\\imm)n(utabl)o(e")c(v)n(alue.\))333 1627 y(Referring)k(no)o(w)f
(to)h(the)g(lo)q(cal)f(functions:)20 b(the)15 b(function)f
Fk(initVal)g Fo(initialises)f(the)i(slot)g(of)300 1677
y Fk(valArr)f Fo(with)g(an)h(in)o(terlea)o(v)o(ed)g(state)g
(transformer)g(whic)o(h,)f(when)h(its)g(result)h(is)e(demanded,)300
1727 y(will:)300 1835 y Fn(\017)45 b Fo(read)14 b Fk(feederVar)e
Fo(to)h(get)h(the)g(curren)o(t)i(list)d(of)g(as-y)o(et-unconsumed)g
(index-v)n(alue)g(pairs;)300 1951 y Fn(\017)45 b Fo(call)14
b Fk(fillUntil)n Fo(,)h(to)f(consume)h(the)g(list)f(of)g(index-v)n
(alue)g(pairs,)g(writing)g(eac)o(h)h(v)n(alue)f(to)366
2001 y(the)k(appropriate)f(slot)f(of)h Fk(valArr)e Fo(\(the)j(arra)o(y)
e Fk(done)g Fo(records)j(whether)f(that)f(elemen)o(t)366
2051 y(has)d(already)g(b)q(een)h(written\),)f(un)o(til)f(the)i(sough)o
(t-for)e(index)h(is)g(found;)300 2167 y Fn(\017)45 b
Fo(write)15 b(the)f(depleted)h(list)f(of)f(index-v)n(alue)g(pairs)h
(bac)o(k)g(to)f Fk(feederVar)n Fo(;)300 2284 y Fn(\017)45
b Fo(read)15 b(the)f(arra)o(y)g(to)g(deliv)o(er)g(the)g(desired)h(v)n
(alue.)300 2392 y(F)m(urther)i(accesses)i(to)d(the)h(same)f(arra)o(y)g
(slot)g(will)e(no)o(w)i(\014nd)h(the)g(\014nal)e(v)n(alue,)h(rather)h
(than)300 2442 y(the)j(in)o(terlea)o(v)o(ed)f(state)g(transformer.)33
b(All)18 b(of)h(this)g(is)g(illustrated)f(b)o(y)h(Figure)g(10,)g(whic)o
(h)300 2492 y(illustrates)c(an)g(in)o(termediate)f(state)i(of)e(a)h
(lazy-arra)o(y)f(v)n(alue.)21 b(The)16 b(arra)o(y)f(has)g(\014v)o(e)g
(slots,)g(of)300 2541 y(whic)o(h)i(three)i(ha)o(v)o(e)e(already)g(b)q
(een)i(\014lled)e(in.)28 b(The)18 b(remaining)e(t)o(w)o(o)h(are)h(sp)q
(eci\014ed)h(b)o(y)e(the)300 2591 y(depleted)e(p)q(ortion)f(of)f(the)h
(list)g(of)f(index-v)n(alue)g(pairs,)g(con)o(tained)h(in)g
Fk(feederVar)n Fo(.)p eop
%%Page: 45 45
45 44 bop 1749 275 a Fm(45)300 416 y Fp(10.4.)48 b(P)o(arallel)13
b(state)i(transformers)300 516 y Fo(A)f(careful)g(reading)g(of)f
Fk(newUniqueSupply)d Fo(or)k Fk(lazyArray)e Fo(rev)o(eals)i(an)g(imp)q
(ortan)o(t)e(resp)q(ect)300 565 y(in)i(whic)o(h)g(b)q(oth)h(are)g
(unsafe)f(\(in)g(the)h(sense)h(of)e(indep)q(endence)j(of)d(ev)n
(aluation)f(order\).)20 b(Both)300 615 y(rely)g(on)f(reading)h(a)f(v)n
(ariable)g(and)h(writing)f(bac)o(k)g(a)h(mo)q(di\014ed)e(v)n(alue)h(|)h
(in)f(the)h(case)h(of)300 665 y Fk(newUniqueSupply)10
b Fo(the)15 b(v)n(ariable)d(is)i(called)f Fk(uvar)o Fo(,)g(while)g(in)g
Fk(lazyArray)f Fo(it)h(is)h Fk(feederVar)n Fo(.)300 715
y(Implicitly)m(,)i(w)o(e)j(ha)o(v)o(e)g(assumed)f(that)h(if)f(the)i
(read)f(tak)o(es)g(place)g(then)h(so)f(will)e(the)j(write,)300
765 y(and)c(so)g(they)g(will)f(in)g(an)o(y)g(sequen)o(tial)h
(normal-order)f(implemen)o(tatio)o(n.)21 b(Ho)o(w)o(ev)o(er,)c(if)e(t)o
(w)o(o)300 814 y(\\threads")k(are)f(executed)j(sim)o(ultaneously)16
b(\(whic)o(h)i(is)g(one)g(legitimate)e(execution)j(order\))300
864 y(then)c(this)e(assumption)g(migh)o(t)f(not)i(hold,)e(and)i(the)h
(programs)d(w)o(ould)h(fail.)333 914 y(This)g(is)g(not)g(just)g(a)f
(purist's)i(ob)r(jection,)e(b)q(ecause)j(an)e(ob)o(vious)f(dev)o
(elopmen)o(t)g(is)h(a)f(v)n(arian)o(t)300 964 y Fk(interleaveST)h
Fo(whic)o(h)i(starts)h(a)f(concurren)o(t)i(pro)q(cess)g(to)e(execute)i
(the)f(fork)o(ed-o\013)f(thread.)300 1014 y(Suc)o(h)h(a)f(v)n(arian)o
(t,)g(whic)o(h)g(w)o(e)h(call)f Fk(forkST)o Fo(,)g(is)h(v)o(ery)g
(useful.)23 b(F)m(or)15 b(example,)g(in)g(a)g(graphical)300
1064 y(I/O)f(system)g(it)g(migh)o(t)e(b)q(e)j(used)g(to)g(start)f(a)g
(concurren)o(t)i(pro)q(cess)h(to)d(handle)g(I/O)g(in)g(a)g(new)300
1113 y(p)q(op-up)g(windo)o(w,)e(indep)q(enden)o(t)k(of,)c(and)i
(concurren)o(t)i(with,)d(other)h(I/O)g(op)q(erations.)333
1163 y(In)21 b(e\013ect,)j Fk(interleaveST)18 b Fo(forces)j(us)h(to)e
(address)i(the)g(usual)e(textb)q(o)q(ok)h(problems)f(of)300
1213 y(m)o(utual)8 b(exclusion)h(and)h(sync)o(hronisation)g(that)f(m)o
(ust)g(b)q(e)h(solv)o(ed)g(b)o(y)f(an)o(y)h(system)f(supp)q(orting)300
1263 y(b)q(oth)17 b(concurrency)i(and)e(shared)h(state.)28
b(W)m(e)16 b(are)i(b)o(y)e(no)h(means)f(the)i(\014rst)g(to)e(meet)h
(these)300 1313 y(issues)e(in)e(a)g(functional)g(setting.)18
b(Concurren)o(t)d(ML)e(\(Repp)o(y)h([1991]\),)d(and)j(the)g
(I-structures)300 1362 y(\(Arvind,)d(Nikhil)f(&)h(Pingali)f([1989]\))f
(and)i(M-structures)i(\(Barth,)f(Nikhil)e(&)h(Arvind)g([1991]\))300
1412 y(of)20 b(Id)g(\(Nikhil)g([1988]\))e(are)j(ob)o(vious)f(examples.)
37 b(W)m(e)20 b(are)h(curren)o(tly)g(studying)f(ho)o(w)g(to)300
1462 y(incorp)q(orate)14 b(some)f(of)h(these)h(no)o(w-standard)f
(solutions)f(in)h(our)g(framew)o(ork.)300 1595 y Fp(10.5.)48
b(Summary)300 1694 y Fo(It)16 b(should)f(b)q(e)i(clear)f(b)o(y)f(no)o
(w)g(that)h Fk(interleaveST)d Fo(has)j(v)o(ery)g(undesirable)g(prop)q
(erties.)25 b(It)300 1744 y(duplicates)18 b(and)g(discards)h(the)g
(state,)g(whic)o(h)f(giv)o(es)g(rise)g(to)g(a)g(v)o(ery)g(subtle)h
(class)f(of)f(pro-)300 1794 y(grammi)o(ng)c(errors.)26
b(W)m(e)16 b(ha)o(v)o(e)g(so)g(far)g(failed)f(to)h(dev)o(elop)g(go)q(o)
q(d)f(tec)o(hniques)j(for)d(reasoning)300 1844 y(ab)q(out)j(its)h
(correctness.)35 b(A)o(t)19 b(\014rst)g(w)o(e)g(w)o(ondered)h(ab)q(out)
e(w)o(a)o(ys)g(to)h(ensure)h(that)f(the)g(t)o(w)o(o)300
1894 y(state)d(threads)g(use)g(di\013eren)o(t)h(v)n(ariables,)d(but)h
(t)o(w)o(o)g(of)g(our)g(most)f(in)o(teresting)i(applications,)300
1944 y Fk(lazyArray)9 b Fo(and)i Fk(newUniqueSupply)m
Fo(,)g(delib)q(erately)g(p)q(erform)g(side)g(e\013ects)i(on)e
Fl(shar)n(e)n(d)g Fo(state.)300 1993 y(Their)16 b(correctness)i(dep)q
(ends)f(on)f(\(relativ)o(ely\))f(deep)h(meta-reasoning,)e(and)i(a)f
(certain)h(sort)300 2043 y(of)f(atomicit)o(y)e(\(for)j(example,)e(the)i
(read)g(and)g(write)g(of)f Fk(uvar)f Fo(m)o(ust)h(tak)o(e)h(place)f
(atomically)300 2093 y(in)e Fk(next)g Fo(in)h Fk(newUniquesupply)m
Fo(\).)333 2143 y(Should)g(w)o(e)h(outla)o(w)f Fk(interleaveST)e
Fo(on)i(the)i(grounds)e(that)h(it)f(is)h(insu\016cien)o(tly)f(w)o(ell)g
(b)q(e-)300 2193 y(ha)o(v)o(ed?)k(Not)13 b(necessarily)m(.)18
b(Outla)o(wing)12 b Fk(interleaveST)f Fo(w)o(ould)h(simply)f(driv)o(e)j
(its)f(function-)300 2242 y(alitly)k(underground)j(rather)f(than)g
(prev)o(en)o(t)h(it)e(happ)q(ening.)33 b(F)m(or)18 b(example,)g(w)o(e)h
(w)o(an)o(t)f(to)300 2292 y(ha)o(v)o(e)d(lazy)g(\014le)g(reading.)21
b(If)15 b(it)g(cannot)g(b)q(e)h(implem)o(en)o(ted)d(in)i(Hask)o(ell)g
(then)g(it)g(will)f(ha)o(v)o(e)g(to)300 2342 y(b)q(e)i(implemen)o(ted)e
(\\underground")i(as)f(a)h(primitiv)o(e)d(op)q(eration)j(written)g(in)f
(C)h(or)g(mac)o(hine)300 2392 y(co)q(de.)j(The)14 b(same)f(go)q(es)i
(for)e(unique-supply)h(trees)h(and)f(lazy)g(arra)o(ys.)333
2442 y Fl(Implementing)19 b(such)f(op)n(er)n(ations)h(in)f(C)g(do)n(es)
g(not)h(make)f(them)h(mor)n(e)f(hygienic)g(or)g(e)n(asy)300
2492 y(to)i(r)n(e)n(ason)f(ab)n(out)p Fo(.)34 b(On)19
b(the)h(con)o(trary)m(,)g(it)e(is)h(m)o(uc)o(h)f(easier)i(to)f
(understand,)i(mo)q(dify)c(and)300 2541 y(construct)k(v)n(arian)o(ts)d
(of)g(them)g(if)g(they)h(are)h(implem)o(en)o(ted)d(in)i(a)f(Hask)o(ell)
h(library)f(mo)q(dule)300 2591 y(than)c(if)f(they)h(are)h(em)o(b)q
(edded)f(in)f(the)i(run)o(time)d(system.)p eop
%%Page: 46 46
46 45 bop 300 275 a Fm(46)333 416 y Fo(The)19 b(need)h(for)f(sp)q
(ecial)g(care)g(to)g(b)q(e)g(tak)o(en)g(is)g(\015agged)g(b)o(y)f(the)i
(use)f(of)f Fk(interleaveST)n Fo(,)300 466 y(whic)o(h)d(iden)o
(ti\014es)g(a)g(pro)q(of)f(obligation)f(for)i(the)g(programmer)e(to)i
(sho)o(w)f(that)h(the)h(results)g(of)300 516 y(the)g(program)d(are)i
(nev)o(ertheless)i(indep)q(enden)o(t)g(of)d(ev)n(aluation)g(order.)21
b(W)m(e)15 b(fear)g(that)g(there)300 565 y(ma)o(y)e(b)q(e)i(no)g
(absolutely)g(secure)h(system)f(|)f(that)h(is,)g(one)g(whic)o(h)g
(guaran)o(tees)g(the)h(Ch)o(urc)o(h-)300 615 y(Rosser)d(prop)q(ert)o(y)
h(|)e(whic)o(h)g(is)h(also)e(expressiv)o(e)k(enough)d(to)h(describ)q(e)
h(the)f(programs)e(whic)o(h)300 665 y(systems)f(programmers)e(\(at)i
(least\))h(w)o(an)o(t)e(to)h(write,)h(suc)o(h)f(as)h(those)f(ab)q(o)o
(v)o(e.)17 b(W)m(e)9 b(do,)h(ho)o(w)o(ev)o(er,)300 715
y(regard)k Fk(interleaveST)e Fo(as)i(useful)g(primarily)d(for)i
(systems)i(programmers.)300 848 y Fp(11.)48 b(Related)14
b(w)o(ork)300 947 y Fo(Monads)j(w)o(ere)g(in)o(tro)q(duced)h(to)e
(computer)h(science)h(b)o(y)f(Moggi)e(in)h(the)i(con)o(text)f(of)f
(writing)300 997 y(mo)q(dular)d(language)g(seman)o(tics)i(\(Moggi)e
([1989]\).)19 b(He)c(noticed)g(that)g(denotational)e(seman-)300
1047 y(tics)g(of)e(languages)h(could)g(b)q(e)h(factored)g(in)o(to)e(t)o
(w)o(o)h(parts:)18 b(what)12 b(happ)q(ens)h(to)f(v)n(alues,)g(and)g
(the)300 1097 y(underlying)j(computational)e(mo)q(del.)21
b(F)m(urthermore,)16 b(all)e(the)i(usual)f(computational)e(mo)q(d-)300
1147 y(els)18 b(satis\014ed)h(the)g(categorical)e(de\014nition)h(of)f
(monads)g(\(often)h(called)g Fl(triples)e Fo(in)i(category)300
1196 y(theory\))d(including)f(state,)h(exceptions,)h(jumps,)d(and)h(so)
h(on.)20 b(W)m(adler)14 b(subsequen)o(tly)i(wrote)300
1246 y(sev)o(eral)j(highly)d(accessible)k(pap)q(ers)f(sho)o(wing)e(ho)o
(w)h(monads)f(could)h(b)q(e)g(similarly)d(used)k(as)300
1296 y(a)f(programmi)o(ng)d(st)o(yle)j(in)g(con)o(v)o(en)o(tional)e
(functional)h(programming)e(languages)i(\(W)m(adler)300
1346 y([1992a];)11 b(W)m(adler)i([1992b];)f(W)m(adler)h([1990]\).)333
1396 y(Based)j(on)g(this)f(w)o(ork,)g(w)o(e)g(dev)o(elop)q(ed)h(a)f
(monadic)f(approac)o(h)h(to)g(I/O)g(\(P)o(eyton)h(Jones)g(&)300
1445 y(W)m(adler)f([1993]\))e(and)j(state)g(\(Launc)o(h)o(bury)g
([1993]\))e(in)h(the)h(con)o(text)g(of)f(non-strict)h(purely-)300
1495 y(functional)g(languages.)27 b(The)17 b(approac)o(h)g(tak)o(en)g
(b)o(y)g(these)h(pap)q(ers)g(has)f(t)o(w)o(o)g(ma)r(jor)e(short-)300
1545 y(comings:)300 1628 y Fn(\017)45 b Fo(State)15 b(and)g
(input/output)f(existed)h(in)f(separate)h(framew)o(orks.)k(The)c(same)e
(general)i(ap-)366 1678 y(proac)o(h)h(can)g(handle)f(b)q(oth)h(but,)f
(for)g(example,)g(di\013eren)o(t)h(com)o(binators)e(w)o(ere)i(required)
366 1728 y(to)d(comp)q(ose)f(stateful)g(computations)f(from)g(those)i
(required)h(for)e(I/O-p)q(erforming)f(com-)366 1778 y(putation.)300
1861 y Fn(\017)45 b Fo(State)16 b(could)g(only)e(safely)i(b)q(e)g
(handled)f(if)g(it)g(w)o(as)g Fl(anonymous)p Fo(.)25
b(Consequen)o(tly)m(,)15 b(it)g(w)o(as)366 1910 y(di\016cult)21
b(to)h(write)g(programs)e(whic)o(h)i(manipulate)d(more)i(than)g(one)h
(piece)h(of)e(state)366 1960 y(at)d(once.)29 b(Hence,)20
b(programs)c(b)q(ecame)h(rather)i(\\brittle":)25 b(an)17
b(apparen)o(tly)g(inno)q(cuous)366 2010 y(c)o(hange)e(\(adding)e(an)g
(extra)i(up)q(datable)f(arra)o(y\))f(b)q(ecame)h(di\016cult)f(or)h(imp)
q(ossible.)300 2093 y(Both)d(these)i(shortcomings)d(are)i(solv)o(ed)e
(in)h(this)g(pap)q(er,)h(the)g(core)g(of)e(whic)o(h)h(app)q(eared)h
(earlier)300 2143 y(\(Launc)o(h)o(bury)i(&)g(P)o(eyton)h(Jones)f
([1994]\).)333 2193 y(Sev)o(eral)d(other)h(languages)e(from)f(the)i
(functional)f(stable)h(pro)o(vide)g(some)e(kind)i(of)f(state.)18
b(F)m(or)300 2242 y(example,)12 b(Standard)i(ML)g(pro)o(vides)g
Fl(r)n(efer)n(enc)n(e)g(typ)n(es)p Fo(,)f(whic)o(h)h(ma)o(y)e(b)q(e)j
(up)q(dated)f(\(Milner)g(&)300 2292 y(T)m(ofte)c([1990]\).)15
b(The)c(resulting)g(system)f(has)h(serious)g(shortcomings,)f(though.)16
b(The)11 b(meaning)300 2342 y(of)j(programs)f(whic)o(h)h(use)h
(references)i(dep)q(ends)f(on)e(a)g(complete)g(sp)q(eci\014cation)h(of)
f(the)h(order)300 2392 y(of)d(ev)n(aluation)f(of)h(the)h(program.)i
(Since)e(SML)g(is)f(strict)h(this)g(is)f(an)g(acceptable)h(price)h(to)e
(pa)o(y)m(,)300 2442 y(but)18 b(it)g(w)o(ould)f(b)q(ecome)g(un)o(w)o
(ork)n(able)g(in)h(a)f(non-strict)i(language)e(where)i(the)f(exact)h
(order)300 2492 y(of)g(ev)n(aluation)f(is)h(hard)g(to)g(\014gure)h
(out.)34 b(What)19 b(is)g(w)o(orse,)i(ho)o(w)o(ev)o(er,)f(is)g(that)f
(referen)o(tial)300 2541 y(transparency)d(is)e(lost.)20
b(Because)d(an)d(arbitrary)g(function)h(ma)o(y)d(rely)j(on)f(state)h
(accesses,)i(its)300 2591 y(result)e(need)h(not)e(dep)q(end)i(purely)e
(on)h(the)g(v)n(alues)f(of)g(its)g(argumen)o(ts.)19 b(This)c(has)f
(additional)p eop
%%Page: 47 47
47 46 bop 1749 275 a Fm(47)300 416 y Fo(implications)14
b(for)j(p)q(olymorphism)o(,)d(leading)i(to)h(a)g(w)o(eak)o(ened)g(form)
e(in)i(order)g(to)g(main)o(tain)300 466 y(t)o(yp)q(e)d(safet)o(y)g(\(T)
m(ofte)g([1990]\).)i(W)m(e)e(ha)o(v)o(e)f(none)i(of)e(these)i(problems)
e(here.)333 516 y(The)23 b(data\015o)o(w)e(language)g(Id)h(pro)o(vides)
g(I-structures)i(and)e(M-structures)i(as)e(m)o(utable)300
566 y(datat)o(yp)q(es)d(\(Nikhil)e([1988]\).)29 b(Within)17
b(a)h(stateful)g(program)e(referen)o(tial)j(transparency)g(is)300
616 y(lost.)i(F)m(or)14 b(I-structures,)j(the)e(result)h(is)f(indep)q
(enden)o(t)h(of)e(ev)n(aluation)f(order,)j(pro)o(vided)e(that)300
666 y(all)c(sub-expressions)j(are)f(ev)o(en)o(tually)f(ev)n(aluated)g
(\(in)f(case)j(they)f(side-e\013ect)h(an)e(I-structure\).)300
715 y(F)m(or)k(M-structures,)j(the)f(result)f(of)f(a)h(program)e(can)h
(dep)q(end)i(on)f(ev)n(aluation)e(order.)24 b(Com-)300
765 y(pared)19 b(with)g(I-structures)i(and)e(M-structures,)j(our)d
(approac)o(h)g(p)q(ermits)f(lazy)h(ev)n(aluation)300
815 y(\(where)f(v)n(alues)f(are)h(ev)n(aluated)f(on)g(demand,)f(and)h
(ma)o(y)e(nev)o(er)j(b)q(e)g(ev)n(aluated)f(if)f(they)i(are)300
865 y(not)c(required\),)h(and)g(supp)q(orts)g(a)f(m)o(uc)o(h)f
(stronger)j(notion)d(of)h(encapsulation.)19 b(The)c(big)f(ad-)300
915 y(v)n(an)o(tage)h(of)g(I-structures)j(and)d(M-structures)j(is)d
(that)h(they)g(are)g(b)q(etter)h(suited)f(to)g(parallel)300
964 y(programming)10 b(than)k(is)g(our)g(metho)q(d.)333
1015 y(The)j(Clean)g(language)f(tak)o(es)h(a)g(di\013eren)o(t)h
(approac)o(h)e(\(Barendsen)j(&)e(Smetsers)h([1993]\).)300
1065 y(The)e(Clean)f(t)o(yp)q(e)h(system)f(supp)q(orts)h(a)g(form)d(of)
i(linear)g(t)o(yp)q(es,)h(called)f(\\unique)g(t)o(yp)q(es".)23
b(A)300 1114 y(v)n(alue)11 b(whose)i(t)o(yp)q(e)g(is)f(unique)g(can)g
(safely)g(b)q(e)h(up)q(dated)g(in)e(place,)h(b)q(ecause)i(the)f(t)o(yp)
q(e)g(system)300 1164 y(ensures)f(that)d(the)h(up)q(dating)f(op)q
(eration)h(has)f(the)i(sole)e(reference)j(to)e(the)g(v)n(alue.)16
b(The)10 b(con)o(trast)300 1214 y(with)15 b(our)g(w)o(ork)f(is)h(in)o
(teresting.)22 b(W)m(e)14 b(separate)i(references)i(from)13
b(the)j(state)f(to)g(whic)o(h)g(they)300 1264 y(refer,)k(and)f(do)f
(not)h(p)q(ermit)e(explicit)i(manipulatio)o(n)d(of)i(the)h(state.)30
b(Clean)18 b(iden)o(ti\014es)g(the)300 1314 y(t)o(w)o(o,)i(and)g(in)f
(consequence)k(requires)e(state)f(to)g(b)q(e)g(manipulated)e
(explicitly)m(.)35 b(W)m(e)19 b(allo)o(w)300 1364 y(references)f(to)c
(b)q(e)i(duplicated,)f(stored)g(in)g(data)f(structures)k(and)c(so)h
(on,)g(while)f(Clean)h(do)q(es)300 1413 y(not.)i(Clean)9
b(requires)j(a)d(new)i(t)o(yp)q(e)f(system)g(to)g(b)q(e)h(explained)e
(to)h(the)h(programmer,)d(while)h(our)300 1463 y(system)15
b(do)q(es)h(not.)21 b(On)15 b(the)h(other)g(hand,)f(the)g(separation)g
(b)q(et)o(w)o(een)i(references)h(and)d(state)300 1513
y(is)g(sometimes)d(tiresome.)20 b(F)m(or)15 b(example,)e(while)h(b)q
(oth)h(systems)f(can)h(express)i(the)e(idea)g(of)f(a)300
1563 y(m)o(utable)c(list,)h(Clean)g(do)q(es)i(so)e(more)g(neatly)g(b)q
(ecause)i(there)g(is)f(less)g(explicit)f(de-referencing.)300
1613 y(The)17 b(tradeo\013)g(b)q(et)o(w)o(een)h(implicit)c(and)i
(explicit)g(state)h(in)f(purely-functional)g(languages)f(is)300
1662 y(far)f(from)e(clear.)333 1713 y(There)j(are)e(signi\014can)o(t)g
(similarities)e(with)i(Gi\013ord)f(and)h(Lucassen's)i
Fl(e\013e)n(ct)f(system)f Fo(whic)o(h)300 1763 y(uses)22
b(t)o(yp)q(es)g(to)f(record)h(side)g(e\013ects)h(p)q(erformed)d(b)o(y)h
(a)g(program)e(\(Gi\013ord)i(&)g(Lucassen)300 1812 y([1986]\).)30
b(Ho)o(w)o(ev)o(er,)20 b(the)f(e\013ects)h(system)e(is)h(designed)g(to)
f(delimit)f(the)i(e\013ect)h(of)e(side)g(ef-)300 1862
y(fects)e(whic)o(h)f(ma)o(y)e(o)q(ccur)k(as)e(a)g(result)g(of)g(ev)n
(aluation.)20 b(Th)o(us)c(the)f(seman)o(tic)g(setting)g(is)g(still)300
1912 y(one)d(whic)o(h)f(relies)h(on)f(a)g(predictable)h(order)g(of)f
(ev)n(aluation.)16 b(In)11 b(another)h(w)o(a)o(y)m(,)e(though,)i
(e\013ect)300 1962 y(systems)h(are)g(m)o(uc)o(h)e(more)g(expressiv)o(e)
k(than)d(ours,)h(b)q(ecause)h(they)f(pro)o(vide)f(a)h(simple)e(w)o(a)o
(y)g(to)300 2012 y(describ)q(e)16 b(com)o(binations)11
b(of)j(lo)q(cal)f(bits)h(of)f(state.)19 b(F)m(or)13 b(example,)f(one)i
(migh)o(t)e(ha)o(v)o(e)818 2101 y Fj(f)29 b Fo(::)24
b Fj(a)12 b Fn(!)991 2107 y Fg(r)q(eg)q(ion)1089 2111
y Fe(1)1118 2101 y Fj(b)818 2151 y(g)29 b Fo(::)24 b
Fj(c)12 b Fn(!)987 2157 y Fg(r)q(eg)q(ion)1085 2161 y
Fe(2)1114 2151 y Fj(d)818 2201 y(h)25 b Fo(::)f Fj(e)12
b Fn(!)988 2207 y Fg(r)q(eg)q(ion)1086 2211 y Fe(1)1102
2207 y Fu([)p Fg(r)q(eg)q(ion)1222 2211 y Fe(2)1252 2201
y Fj(f)300 2292 y Fo(where)j Fj(h)e Fo(is)h(de\014ned)g(using)g
Fj(f)k Fo(and)c Fj(g)q Fo(.)k(The)c(side)g(e\013ects)h(of)f
Fj(f)k Fo(and)13 b Fj(g)i Fo(cannot)f(in)o(terfere)h(with)300
2341 y(eac)o(h)d(other)g(\(since)g(they)f(mo)q(dify)e(di\013eren)o(t)j
(regions\))g(so)f(they)h(can)f(pro)q(ceed)i(async)o(hronously)300
2391 y(with)h(resp)q(ect)i(to)d(eac)o(h)i(other.)333
2442 y(Our)21 b(w)o(ork)f(also)f(has)h(strong)g(similarities)e(with)i
(Odersky)m(,)i(Rabin)c(and)i(Hudak's)g Fj(\025)1740 2448
y Fg(v)q(ar)300 2492 y Fo(\(Odersky,)e(Rabin)e(&)h(Hudak)f([1993]\),)f
(whic)o(h)i(itself)f(w)o(as)h(in\015uenced)h(b)o(y)e(the)h(Imp)q
(erativ)o(e)300 2541 y(Lam)o(b)q(da)c(Calculus)i(\(ILC\))h(of)e(Sw)o
(arup,)h(Reddy)g(&)h(Ireland)f([1991].)20 b(ILC)15 b(imp)q(osed)f(a)h
(rigid)300 2591 y(strati\014cation)f(of)f(applicativ)o(e,)g(state)i
(reading,)e(and)h(imp)q(erativ)o(e)f(op)q(erations.)19
b(The)14 b(t)o(yp)q(e)h(of)p eop
%%Page: 48 48
48 47 bop 300 275 a Fm(48)300 416 y Fk(runST)13 b Fo(mak)o(es)h(this)g
(strati\014cation)g(unnecessary:)22 b(state)15 b(op)q(erations)g(can)f
(b)q(e)h(encapsulated)300 466 y(and)e(app)q(ear)h(purely)g(functional.)
j(This)c(w)o(as)h(also)f(true)h(of)f Fj(\025)1271 472
y Fg(v)q(ar)1339 466 y Fo(but)h(there)g(it)g(w)o(as)f(ac)o(hiev)o(ed)
300 516 y(only)f(through)h(run-time)f(c)o(hec)o(king)i(whic)o(h,)f(as)g
(a)g(direct)g(consequence,)j(precludes)e(the)g(st)o(yle)300
565 y(of)f(lazy)h(state)g(giv)o(en)g(here.)333 615 y(Our)20
b(use)f(of)f(parametricit)o(y)g(to)g(encapsulate)i(state)g(has)f(ec)o
(ho)q(es)h(of)e(w)o(ork)g(b)o(y)h(O'Hearn)300 665 y(and)13
b(T)m(ennan)o(t)g(\(O'Hearn)g(&)g(T)m(ennen)o(t)h([1993]\).)h(In)e(imp)
q(erativ)o(e)f(languages,)g(lo)q(cal)g(v)n(ariables)300
715 y(ough)o(t)e(to)g(b)q(e)i(in)o(visible)d(to)h(the)h(the)h(outside)e
(w)o(orld.)17 b(Most)10 b(mo)q(dels)g(of)g(these)i(languages,)e(ho)o
(w-)300 765 y(ev)o(er,)16 b(do)f(not)g(re\015ect)h(this,)f(making)e(mo)
q(del-based)h(reasoning)h(ab)q(out)g(program)f(b)q(eha)o(viour)300
814 y(less)k(than)f(satisfactory)m(.)27 b(O'Hearn)18
b(and)f(T)m(ennan)o(t)g(disco)o(v)o(ered)h(that)f(b)o(y)g(using)g
(Reynolds-)300 864 y(st)o(yle)9 b(relational)f(parametricit)o(y)m(,)g
(it)h(w)o(as)h(p)q(ossible)f(to)g(construct)i(mo)q(dels)d(for)h(these)i
(languages)300 914 y(where)g(lo)q(cal)f(v)n(ariables)f(w)o(ere)i(truly)
f(in)o(visible)f(from)g(outside)h(the)h(scop)q(e)h(of)d(the)i(v)n
(ariable.)16 b(One)300 964 y(ma)o(y)11 b(view)h(our)h(w)o(ork)g(as)f
(extending)h(this)g(idea)g(to)f(the)i(case)f(where)h(v)n(ariables)e
(are)h(\014rst)h(class)300 1014 y(v)n(alues.)25 b(Then)17
b(it)f(is)g(no)g(longer)g(su\016cien)o(t)h(to)f(restrict)i(the)f
(application)e(of)h(parametricit)o(y)300 1064 y(solely)d(at)h(the)h(mo)
q(del)d(lev)o(el)i(|)f(it)g(b)q(ecomes)i(a)e(source)i(language)e
(concern)j(instead.)333 1113 y(Hall's)f(recen)o(t)j(w)o(ork)e(on)f
(list-compression)g(in)h(Hask)o(ell)g(also)f(has)h(in)o(triguing)f
(similarities)300 1163 y(to)e(ours)h(\(Hall)f([1994]\).)j(Hall)c(in)o
(tro)q(duces)j(an)e(extra)h(t)o(yp)q(e)g(v)n(ariable)f(in)o(to)g(the)h
(list)f(t)o(yp)q(e,)h(and)300 1213 y(uses)h(its)f(uni\014cation)f(or)h
(otherwise)h(to)e(determine)h(the)g(scop)q(e)i(of)d(eac)o(h)h(list.)k
(If)13 b(a)h(particular)300 1263 y(application)i(in)o(v)o(olving)f(a)i
(list)g(do)q(es)h(not)f(ha)o(v)o(e)g(the)h(extra)f(t)o(yp)q(e)h(v)n
(ariable)e(instan)o(tiated)h(to)300 1313 y(\\unoptimised",)i(then)i
(she)g(replaces)g(the)g(list)f(with)f(a)h(m)o(ulti-headed)f(v)o
(ersion.)36 b(This)20 b(is)300 1362 y(rather)c(similar)c(to)j(our)g
(use)h(of)e(univ)o(ersal)h(quan)o(ti\014cation)f(whic)o(h,)g(in)h
(essence,)i(c)o(hec)o(ks)f(that)300 1412 y(the)e(state-thread's)i
(state)e(index)g(is)g(free)h(of)e(constrain)o(t.)333
1462 y(It)g(also)f(seems)h(p)q(ossible)f(to)h(use)g(existen)o(tial)g
(quan)o(ti\014cation)e(to)i(ac)o(hiev)o(e)f(encapsulation)h(of)300
1512 y(state.)19 b(In)13 b(classical)f(logic,)g(of)g(course,)i(a)f
(univ)o(ersal)g(quan)o(ti\014er)g(on)g(the)g(left)g(of)g(an)f(arro)o(w)
h(can)300 1562 y(b)q(e)j(brough)o(t)g(out)o(w)o(ards,)f(con)o(v)o
(erting)h(to)f(an)g(existen)o(tial)g(in)g(the)h(pro)q(cess.)25
b(In)16 b(in)o(tuitionistic)300 1611 y(logic,)e(this)h(is)g(not)g(v)n
(alid)f(in)h(general.)22 b(Nonetheless,)17 b(Thiemann)c(has)j(dev)o
(elop)q(ed)g(a)f(system)300 1661 y(whic)o(h)d(captures)i(this)f
(\(Thiemann)e([1993]\),)g(though)h(the)h(result)g(is)g(far)f(more)f
(complex)g(than)300 1711 y(the)j(metho)q(d)g(presen)o(ted)i(here.)300
1844 y Fp(Ac)o(kno)o(wledgemen)o(ts)300 1944 y Fo(The)k(idea)f(of)g
(adding)g(an)g(extra)h(t)o(yp)q(e)g(v)n(ariable)e(to)h(distinguish)g
(state)h(threads)h(arose)f(in)300 1993 y(discussion)d(with)f(John)h
(Hughes,)g(and)f(w)o(as)h(presen)o(ted)h(brie\015y)f(at)f(the)h(1993)f
(Cop)q(enhagen)300 2043 y(w)o(orkshop)f(on)f(State)h(in)f(Programming)d
(Languages,)j(though)h(at)f(that)h(time)e(w)o(e)i(suggested)300
2093 y(using)f(an)f(existen)o(tial)h(quan)o(ti\014cation)f(in)g(the)i
(t)o(yp)q(e)f(of)f Fk(runST)o Fo(.)333 2143 y(Philip)g(W)m(adler)h
(made)f(a)h(n)o(um)o(b)q(er)f(of)h(insigh)o(tful)f(and)h(helpful)f
(suggestions.)20 b(In)14 b(addition,)300 2193 y(all)h(these)k(ideas)d
(ha)o(v)o(e)h(b)q(ene\014ted)h(from)d(discussions)j(amongst)d(the)i(F)m
(unctional)f(Program-)300 2242 y(ming)c(Group)h(at)h(Glasgo)o(w.)300
2375 y Fp(References)300 2475 y Fo(Arvind,)20 b(RS)f(Nikhil)g(&)h(KK)h
(Pingali)5 b([Oct)21 b(1989],)d(\\I-structures)k(-)e(data)g(structures)
j(for)449 2525 y(parallel)13 b(computing,")f Fd(TOPLAS)e
Fo(11,)j(598{632.)p eop
%%Page: 49 49
49 48 bop 1749 275 a Fm(49)300 416 y Fo(L)20 b(Augustsson,)g(M)f
(Rittri)g(&)h(D)f(Synek)8 b([Jan)19 b(1994],)f(\\On)h(generating)h
(unique)g(names,")449 466 y Fd(Journal)14 b(of)f(F)m(unctional)g
(Programming)7 b Fo(4,)13 b(117{123.)300 528 y(E)18 b(Barendsen)j(&)d
(JEW)h(Smetsers)7 b([Dec)19 b(1993],)d(\\Con)o(v)o(en)o(tional)g(and)j
(uniqueness)g(t)o(yping)449 578 y(in)14 b(graph)f(rewrite)i(systems,")e
(in)g Fd(Pro)q(c)i(13th)e(Conference)i(on)f(the)g(F)m(oundations)f(of)
449 628 y(Soft)o(w)o(are)k(T)m(ec)o(hnology)f(and)g(Theoretical)i
(Computer)e(Science)r Fo(,)i(Springer)f(V)m(erlag)449
677 y(LNCS.)300 740 y(PS)i(Barth,)g(RS)g(Nikhil)f(&)h(Arvind)7
b([Sept)19 b(1991],)e(\\M-structures:)k(extending)e(a)g(parallel,)449
790 y(non-strict)k(functional)e(language)g(with)h(state,")g(in)g
Fd(F)m(unctional)f(Programming)449 839 y(Languages)d(and)f(Computer)f
(Arc)o(hitecture,)j(Boston)p Fo(,)e(Hughes,)h(ed.,)e(LNCS)i(523,)449
889 y(Springer)d(V)m(erlag,)e(538{568.)300 951 y(RS)g(Bird)7
b([1984],)12 b(\\Using)h(circular)h(programs)e(to)i(eliminate)e(m)o
(ultiple)f(tra)o(v)o(ersals)j(of)f(data,")449 1001 y
Fd(Acta)i(Informatica)5 b Fo(21,)13 b(239{250.)300 1064
y(WN)k(Chin)7 b([Marc)o(h)17 b(1990],)f(\\Automatic)f(metho)q(ds)i(for)
h(program)e(transformation,")e(PhD)449 1113 y(thesis,)h(Imp)q(erial)d
(College,)h(London.)300 1176 y(DK)21 b(Gi\013ord)f(&)h(JM)g(Lucassen)8
b([Aug)20 b(1986],)f(\\In)o(tegrating)h(functional)g(and)h(imp)q
(erativ)o(e)449 1225 y(programming,)o(")10 b(in)i Fd(A)o(CM)g
(Conference)i(on)e(Lisp)h(and)f(F)m(unctional)f(Programming,)449
1275 y(MIT)s Fo(,)j(A)o(CM,)f(28{38.)300 1337 y(A)d(Gill,)d(J)i(Launc)o
(h)o(bury)h(&)g(SL)f(P)o(eyton)h(Jones)e([June)i(1993],)d(\\A)i(short)h
(cut)g(to)g(deforestation,")449 1387 y(in)16 b Fd(Pro)q(c)g(F)m
(unctional)f(Programmi)o(ng)e(Languages)i(and)h(Computer)f(Arc)o
(hitecture,)449 1437 y(Cop)q(enhagen)p Fo(,)f(A)o(CM,)g(223{232.)300
1499 y(CV)20 b(Hall)5 b([June)20 b(1994],)e(\\Using)h(Hindley-Milner)g
(t)o(yp)q(e)h(inference)h(to)e(optimise)f(list)h(rep-)449
1549 y(resen)o(tation,")e(in)f Fd(A)o(CM)g(Symp)q(osium)e(on)i(Lisp)h
(and)f(F)m(unctional)f(Programming,)449 1599 y(Orlando)r
Fo(,)f(A)o(CM,)f(162{172.)300 1661 y(P)f(Hanco)q(c)o(k)c([1987],)i(\\A)
i(t)o(yp)q(e)h(c)o(hec)o(k)o(er,")g(in)f Fd(The)g(implemen)o(tation)d
(of)j(functional)f(program-)449 1711 y(ming)h(languages)r
Fo(,)h(SL)h(P)o(eyton)g(Jones,)g(ed.,)g(Pren)o(tice)h(Hall,)d(163{182.)
300 1773 y(John)k(Hughes)7 b([Apr)16 b(1989],)d(\\Wh)o(y)i(functional)f
(programming)e(matters,")i Fd(The)i(Computer)449 1823
y(Journal)9 b Fo(32,)k(98{107.)300 1885 y(AJ)18 b(Kfoury)7
b([June)18 b(1992],)e(\\T)o(yp)q(e)i(reconstruction)h(in)f(\014nite)g
(rank)g(fragmen)o(ts)e(of)h(second-)449 1935 y(order)e(lam)o(b)q(da)d
(calculus,")h Fd(Information)e(and)j(Computation)5 b
Fo(98,)13 b(228{257.)300 1998 y(AJ)k(Kfoury)f(&)g(JB)h(W)m(ells)6
b([June)17 b(1994],)e(\\A)h(direct)h(algorithm)c(for)j(t)o(yp)q(e)h
(inference)h(in)e(the)449 2047 y(rank-2)11 b(fragmen)o(t)e(of)h(the)h
(second-order)h(lam)o(b)q(da)d(calculus,")h(in)g Fd(A)o(CM)g(Symp)q
(osium)449 2097 y(on)k(Lisp)g(and)g(F)m(unctional)e(Programming,)e
(Orlando)r Fo(,)j(A)o(CM,)h(196{207.)300 2159 y(D)e(King)g(&)h(J)g
(Launc)o(h)o(bury)7 b([July)12 b(1993],)e(\\F)m(unctional)h(graph)i
(algorithms)d(with)i(depth-\014rst)449 2209 y(searc)o(h,")j(in)e
Fd(Glasgo)o(w)g(F)m(unctional)f(Programming)f(W)m(orkshop,)i(Ayr)s
Fo(.)300 2271 y(J)h(Launc)o(h)o(bury)7 b([June)14 b(1993],)d(\\Lazy)i
(imp)q(erativ)o(e)f(programming,)o(")e(in)j Fd(Pro)q(c)h(A)o(CM)g
(Sigplan)449 2321 y(W)m(orkshop)f(on)h(State)g(in)f(Programming)d
(Languages,)k(Cop)q(enhagen)g(\(a)o(v)n(ailable)d(as)449
2371 y(Y)m(ALEU/DCS/RR-968,)g(Y)m(ale)j(Univ)o(ersit)o(y\))q
Fo(,)f(pp46{56.)300 2433 y(J)i(Launc)o(h)o(bury)g(&)g(SL)f(P)o(eyton)h
(Jones)8 b([June)15 b(1994],)e(\\Lazy)h(functional)f(state)j(threads,")
f(in)449 2483 y Fd(SIGPLAN)g(Symp)q(osium)d(on)i(Programming)d
(Language)j(Design)g(and)h(Implemen-)449 2533 y(tation)f(\(PLDI'94\),)e
(Orlando)r Fo(,)h(A)o(CM.)p eop
%%Page: 50 50
50 49 bop 300 275 a Fm(50)300 416 y Fo(S)13 b(Marlo)o(w)e(&)i(PL)g(W)m
(adler)6 b([1993],)k(\\Deforestation)j(for)f(higher-order)h
(functions,")f(in)g Fd(F)m(unc-)449 466 y(tional)18 b(Programmi)o(ng,)d
(Glasgo)o(w)i(1992)s Fo(,)g(J)i(Launc)o(h)o(bury)g(&)f(PM)h(Sansom,)d
(eds.,)449 516 y(W)m(orkshops)e(in)f(Computing,)f(Springer)i(V)m
(erlag,)f(154{165.)300 578 y(NJ)d(McCrac)o(k)o(en)e([June)j(1984],)c
(\\The)k(t)o(yp)q(ec)o(hec)o(king)f(of)g(programs)e(with)i(implicit)d
(t)o(yp)q(e)j(struc-)449 628 y(ture,")k(in)g Fd(Seman)o(tics)f(of)g
(data)h(t)o(yp)q(es)r Fo(,)g(Springer)g(V)m(erlag)f(LNCS)h(173,)f
(301{315.)300 690 y(R)g(Milner)h(&)g(M)g(T)m(ofte)7 b([1990],)k
Fd(The)j(de\014nition)g(of)f(Standard)h(ML)p Fo(,)g(MIT)f(Press.)300
752 y(JC)h(Mitc)o(hell)e(&)i(AR)f(Mey)o(er)8 b([1985],)i
(\\Second-order)15 b(logical)c(relations,")i(in)g Fd(Logics)g(of)f
(Pro-)449 802 y(grams)r Fo(,)g(R)i(P)o(arikh,)f(ed.,)g(Springer)h(V)m
(erlag)g(LNCS)g(193.)300 864 y(E)j(Moggi)6 b([June)17
b(1989],)e(\\Computational)f(lam)o(b)q(da)h(calculus)i(and)g(monads,")e
(in)h Fd(Logic)h(in)449 914 y(Computer)d(Science,)g(California)p
Fo(,)e(IEEE.)300 976 y(Rishiyur)j(Nikhil)6 b([Marc)o(h)16
b(1988],)e(\\Id)h(Reference)j(Man)o(ual,")c(Lab)i(for)f(Computer)g
(Science,)449 1026 y(MIT.)300 1088 y(PW)g(O'Hearn)h(&)g(RD)f(T)m(ennen)
o(t)7 b([Jan)15 b(1993],)f(\\Relational)f(parametricit)o(y)h(and)i(lo)q
(cal)e(v)n(ari-)449 1138 y(ables,")c(in)g Fd(20th)h(A)o(CM)f(Symp)q
(osium)e(on)i(Principles)h(of)f(Programming)d(Languages,)449
1188 y(Charleston)p Fo(,)14 b(A)o(CM,)g(171{184.)300
1250 y(M)i(Odersky,)g(D)f(Rabin)f(&)i(P)g(Hudak)7 b([Jan)15
b(1993],)e(\\Call)h(b)o(y)i(name,)d(assignmen)o(t,)h(and)i(the)449
1300 y(lam)o(b)q(da)10 b(calculus,")i(in)g Fd(20th)f(A)o(CM)i(Symp)q
(osium)c(on)j(Principles)g(of)g(Programming)449 1350
y(Languages,)i(Charleston)p Fo(,)f(A)o(CM,)h(43{56.)300
1412 y(SL)22 b(P)o(eyton)h(Jones)8 b([1987],)20 b Fd(The)j(Implemen)o
(tation)d(of)h(F)m(unctional)h(Programming)d(Lan-)449
1462 y(guages)p Fo(,)14 b(Pren)o(tice)h(Hall.)300 1524
y(SL)21 b(P)o(eyton)g(Jones)8 b([Apr)20 b(1992],)f(\\Implemen)o(ting)f
(lazy)i(functional)g(languages)g(on)h(sto)q(c)o(k)449
1574 y(hardw)o(are:)e(the)g(Spineless)g(T)m(agless)f(G-mac)o(hine,")e
Fd(Journal)i(of)g(F)m(unctional)f(Pro-)449 1624 y(gramming)7
b Fo(2,)13 b(127{202.)300 1686 y(SL)j(P)o(eyton)g(Jones)g(&)g(J)g
(Launc)o(h)o(bury)8 b([Sept)16 b(1991],)d(\\Un)o(b)q(o)o(xed)j(v)n
(alues)f(as)h(\014rst)h(class)f(citi-)449 1736 y(zens,")d(in)f
Fd(F)m(unctional)f(Programming)e(Languages)j(and)g(Computer)g(Arc)o
(hitecture,)449 1786 y(Boston)p Fo(,)i(Hughes,)h(ed.,)e(LNCS)h(523,)f
(Springer)h(V)m(erlag,)f(636{666.)300 1848 y(SL)e(P)o(eyton)f(Jones)i
(&)f(PL)g(W)m(adler)6 b([Jan)k(1993],)f(\\Imp)q(erativ)o(e)g
(functional)h(programmi)o(ng,")d(in)449 1898 y Fd(20th)i(A)o(CM)h(Symp)
q(osium)c(on)j(Principles)h(of)e(Programming)e(Languages,)j(Charleston)
p Fo(,)449 1948 y(A)o(CM,)14 b(71{84.)300 2010 y(CG)f(P)o(onder,)g(PC)g
(McGeer)h(&)f(A)g(P-C)h(Ng)6 b([June)14 b(1988],)d(\\Are)i(applicativ)o
(e)f(languages)h(inef-)449 2060 y(\014cien)o(t?,")h Fd(SIGPLAN)g
(Notices)9 b Fo(23,)k(135{139.)300 2122 y(JH)i(Repp)o(y)7
b([June)15 b(1991],)d(\\CML:)i(a)h(higher-order)g(concurren)o(t)h
(language,")d(in)h Fd(A)o(CM)h(SIG-)449 2172 y(PLAN)f(Conference)g(on)f
(Programmi)o(ng)d(Language)i(Design)h(and)f(Implemen)o(tation)449
2222 y(\(PLDI\))q Fo(,)i(A)o(CM.)300 2284 y(D)o(A)e(Sc)o(hmidt)5
b([Apr)12 b(1985],)e(\\Detecting)i(global)f(v)n(ariables)g(in)g
(denotational)g(sp)q(eci\014cations,")449 2334 y Fd(TOPLAS)f
Fo(7,)k(299{310.)300 2396 y(V)j(Sw)o(arup,)g(US)g(Reddy)h(&)f(E)h
(Ireland)7 b([Sept)17 b(1991],)e(\\Assignmen)o(ts)i(for)g(applicativ)o
(e)f(lan-)449 2446 y(guages,")g(in)g Fd(F)m(unctional)f(Programming)e
(Languages)j(and)g(Computer)f(Arc)o(hitec-)449 2496 y(ture,)g(Boston)p
Fo(,)f(Hughes,)g(ed.,)f(LNCS)h(523,)f(Springer)h(V)m(erlag,)f(192{214.)
p eop
%%Page: 51 51
51 50 bop 1749 275 a Fm(51)300 416 y Fo(P)20 b(Thiemann)5
b([1993],)17 b(\\Safe)i(Sequencing)h(of)f(Assignmen)o(ts)g(in)g(Purely)
h(F)m(unctional)e(Pro-)449 466 y(gramming)10 b(Languages,")i(T)m(ec)o
(h.)h(Rep)q(ort.)g(Wilhelm-Sc)o(hic)o(k)n(ard-Institut)d(WSI-93-)449
516 y(i6,)j(T)q(\177)-22 b(ubingen,)13 b(German)o(y)m(.)300
578 y(M)h(T)m(ofte)6 b([No)o(v)13 b(1990],)f(\\T)o(yp)q(e)i(inference)h
(for)e(p)q(olymorphic)f(references,")k Fd(Information)c(and)449
628 y(Computation)5 b Fo(89.)300 690 y(PL)13 b(W)m(adler)6
b([1990],)11 b(\\Deforestation:)h(transforming)f(programs)h(to)h
(eliminate)e(trees,")j Fd(The-)449 740 y(oretical)g(Computer)f(Science)
e Fo(73,)i(231{248.)300 802 y(PL)k(W)m(adler)6 b([1992a],)14
b(\\Comprehending)i(monads,")e Fd(Mathematical)h(Structures)k(in)d
(Com-)449 852 y(puter)f(Science)c Fo(2,)i(461{493.)300
914 y(PL)i(W)m(adler)6 b([Jan)14 b(1992b],)f(\\The)h(essence)j(of)d
(functional)g(programmi)o(ng,")d(in)j Fd(Pro)q(c)h(Princi-)449
964 y(ples)g(of)e(Programming)d(Languages)r Fo(,)j(A)o(CM.)300
1026 y(PL)18 b(W)m(adler)6 b([June)19 b(1990],)d(\\Comprehending)h
(monads,")f(in)h Fd(Pro)q(c)i(A)o(CM)f(Conference)i(on)449
1076 y(Lisp)14 b(and)g(F)m(unctional)f(Programmi)o(ng,)e(Nice)r
Fo(,)j(A)o(CM.)300 1209 y Fp(Notes)300 1308 y Fw(1.)22
b(Actually)12 b(the)i(distributed)d(system)h(is)i(rather)e(ric)o(her,)h
(as)h(it)g(includes)e(some)g(error)h(handling)f(facilities)350
1348 y(also)300 1396 y(2.)22 b(Bac)o(kquotes)9 b(are)i(Hask)o(ell's)f
(notation)f(for)i(an)g(in\014x)f(op)q(erator.)300 1450
y(3.)22 b(The)14 b(\\)p Fc(Ix)j(i)g(=>)p Fw(")d(part)f(of)i(the)e(t)o
(yp)q(e)h(is)g(just)g(Hask)o(ell's)g(w)o(a)o(y)g(of)g(sa)o(ying)f(that)
h(the)g(t)o(yp)q(e)f Fc(a)i Fw(m)o(ust)e(b)q(e)h(an)350
1489 y(index)g(t)o(yp)q(e;)i(that)f(is,)i(there)d(m)o(ust)h(b)q(e)g(a)g
(mapping)f(of)h(a)g(v)n(alue)g(of)g(t)o(yp)q(e)g Fc(a)g
Fw(to)h(an)f(o\013set)f(in)i(a)f(linear)350 1528 y(arra)o(y)m(.)h(In)o
(tegers,)10 b(c)o(haracters)g(and)h(tuples)g(are)h(automatic)o(ally)d
(in)j(the)f Fc(Ix)h Fw(class,)f(but)h(arra)o(y)f(indexing)f(is)350
1568 y(not)j(restricted)e(to)j(these.)21 b(An)o(y)14
b(t)o(yp)q(e)f(for)g(whic)o(h)h(a)f(mapping)f(to)h Fc(Int)h
Fw(is)f(pro)o(vided)f(\(via)h(an)g Fc(instance)350 1607
y Fw(declaration)8 b(for)j(the)g(class)g Fc(Ix)g Fw(at)g(that)f(t)o(yp)
q(e\))g(will)i(do.)300 1651 y(4.)22 b(In)10 b(Hask)o(ell)f(1.2)h(the)f
(list)h(of)g(index-v)n(alue)d(pairs)i(had)g(t)o(yp)q(e)h
Fc([Assoc)15 b(i)i(v])p Fw(,)10 b(where)g Fc(Assoc)f
Fw(is)h(just)f(a)i(pairing)350 1690 y(constructor,)d(but)j(Hask)o(ell)f
(1.3)h(uses)g(ordinary)e(pairs)i(in)g(the)g(list.)300
1733 y(5.)35 b(The)13 b(de\014nition)e(of)i Fc(indices)d
Fw(sho)o(ws)j(up)g(an)f(in)o(teresting)f(shortcoming)f(in)i(Hask)o
(ell's)g(t)o(yp)q(e)g(signatures,)350 1773 y(whic)o(h)g(it)g(shares)f
(with)h(sev)o(eral)f(other)g(similar)g(languages:)j(there)d(is)i(no)f
(w)o(a)o(y)g(to)g(giv)o(e)g(the)f(correct)g(t)o(yp)q(e)350
1812 y(signature)h(to)i Fc(indices)n Fw(,)h(b)q(ecause)e(the)g(t)o(yp)q
(e)h(in)o(v)o(olv)o(es)e(t)o(yp)q(e)i(v)n(ariables)e(lo)q(cal)h(to)h
(the)g(enclosing)e(de\014ni-)350 1851 y(tion.)18 b(W)m(e)12
b(cannot)f(write)i Fc(indices)i(::)i([\(i,v\)])10 b Fw(b)q(ecause)h
(that)g(w)o(ould)h(mean)g(that)f Fc(indices)g Fw(has)h(t)o(yp)q(e)350
1891 y Fb(8)p Fa(i;)t(v)q(:)p Fw([\()p Fa(i;)6 b(v)q
Fw(\)],)11 b(whic)o(h)g(is)g(certainly)e(not)i(what)g(w)o(e)h(mean.)i
(Instead,)9 b(a)j(notation)d(is)i(required)e(to)i(allo)o(w)g(the)350
1930 y(t)o(yp)q(e)g(v)n(ariables)g(in)h(the)g(signature)e(for)i
Fc(newArr)f Fw(to)h(scop)q(e)g(o)o(v)o(er)f(the)h(b)q(o)q(dy)g(of)g
Fc(newArr)n Fw(.)19 b(Here)12 b(w)o(e)h(simply)350 1970
y(giv)o(e)d(the)h(t)o(yp)q(e)g(of)g Fc(indices)e Fw(in)i(a)h(commen)o
(t,)c(in)o(tro)q(duced)h(b)o(y)i(\\)p Fc(--)o Fw(".)300
2017 y(6.)22 b(Notice)11 b(the)f(t)o(yp)q(e)h(signatures)e(in)i(commen)
o(ts)e(again!)300 2071 y(7.)22 b(Indeed,)16 b(the)h(formal)e(seman)o
(tics)g(of)i(an)g(imp)q(erativ)o(e)d(language)h(often)g(expresses)h
(the)g(meaning)f(of)i(a)350 2111 y(statemen)o(t)9 b(as)i(a)g
(state-to-state)d(function.)300 2159 y(8.)22 b(Because)10
b(the)h Fc(let)f Fw(is)i(recursiv)o(e)d(w)o(e)j(also)f(ha)o(v)o(e)f(to)
h(require)f Fa(r)i Fw(to)g(b)q(e)f(strict)300 2213 y(9.)22
b(Indeed,)9 b(w)o(e)j(ha)o(v)o(e)f(to)g(admit)f(that)g(the)h(implemen)o
(ta)o(tio)o(n)e(came)h(\014rst!)p eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
